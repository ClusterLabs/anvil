"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[876],{19121:(e,r,t)=>{t.d(r,{A:()=>o});let n=e=>{let{free:r,size:t,used:n,uuid:s,...i}=e,o=BigInt(r),l=BigInt(t),a=BigInt(n);return{...i,free:o,size:l,used:a,uuid:s}},s=(e,r)=>{let t,n,s,{free:i,size:o,used:l,uuid:a,...u}=r;try{t=BigInt(i),n=BigInt(o),s=BigInt(l)}catch(r){return e}return e[a]={...u,free:t,size:n,used:s,uuid:a},e},i=(e,r)=>{let t,{uuid:s}=r;try{t=n(r)}catch(r){return e}return e[s]=t,e},o=e=>{let r,t,n,{storageGroupTotals:o,storageGroups:l,volumeGroups:a,...u}=e,c=Object.values(l).reduce(s,{}),d=Object.values(a).reduce(i,{});try{r=BigInt(o.free),t=BigInt(o.size),n=BigInt(o.used)}catch(e){return{...u,storageGroups:c,totalFree:BigInt(0),totalSize:BigInt(0),totalUsed:BigInt(0),volumeGroups:d}}return{...u,storageGroups:c,totalFree:r,totalSize:t,totalUsed:n,volumeGroups:d}}},22073:(e,r,t)=>{t.d(r,{W:()=>n});let n=["B","KiB","MiB","GiB","TiB"].map(e=>({value:e}))},30764:(e,r,t)=>{t.d(r,{A:()=>l});var n=t(37876),s=t(14232),i=t(75925),o=t(5755);let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initial:{actionProceedText:r="",content:t="",titleText:l="",...a}={}}=e,u=(0,s.useRef)(null),[c,d]=(0,s.useState)({actionProceedText:r,content:t,titleText:l}),m=(0,s.useCallback)(e=>d(r=>{let{loading:t,...n}=r;return{...n,loading:e}}),[]),h=(0,s.useCallback)(e=>{var r,t;return null==u||null==(t=u.current)||null==(r=t.setOpen)?void 0:r.call(null,e)},[]),p=(0,s.useCallback)((e,r)=>d({actionProceedText:"",content:(0,n.jsx)(o.A,{...r}),showActionArea:!1,showClose:!0,titleText:e}),[]);return{confirmDialog:(0,s.useMemo)(()=>(0,n.jsx)(i.A,{...a,...c,ref:u}),[c,a]),confirmDialogRef:u,setConfirmDialogLoading:m,setConfirmDialogOpen:h,setConfirmDialogProps:d,finishConfirm:p}}},57763:(e,r,t)=>{t.d(r,{A:()=>b});var n=t(37876),s=t(24766),i=t(11951),o=t(54773),l=t(69209),a=t(85088),u=t(7674),c=t(4590),d=t(12981),m=t(99623),h=t(50046),p=t.n(h),g=t(14232),v=t(90890),x=t(71949),j=t(69267);let y=e=>(0,n.jsx)(s.A,{in:!0,children:(0,n.jsx)(i.A,{...e})}),A=(0,o.Ay)("ul")({padding:0}),f=l.A,b=e=>{let{componentsProps:r,extendRenderInput:t,getGroupLabel:s,label:i,ListboxProps:o,messageBoxProps:l,renderGroup:h,renderInput:b,required:k,sx:O,...C}=e,I=(0,g.useMemo)(()=>p()({paper:{sx:{backgroundColor:v.Qu,["& .".concat(a.A.groupLabel)]:{backgroundColor:v.Qu}}}},r),[r]),w=(0,g.useMemo)(()=>p()({sx:{["& .".concat(a.A.option)]:{'&[aria-selected="true"]':{backgroundColor:v.a$,["&.".concat(a.A.focused)]:{backgroundColor:v.a$}},["&.".concat(a.A.focused)]:{backgroundColor:v.a$}}}},o),[o]),G=(0,g.useMemo)(()=>h||s&&(e=>(0,n.jsxs)("li",{children:[(0,n.jsx)(f,{component:"div",className:a.A.groupLabel,children:s(e.group)}),(0,n.jsx)(A,{className:a.A.groupUl,children:e.children})]},e.key)),[s,h]),B=(0,g.useMemo)(()=>null!=b?b:e=>{let{fullWidth:r,InputProps:s,InputLabelProps:o,inputProps:l}=e,a={formControlProps:{fullWidth:r,ref:s.ref},inputLabelProps:o,inputProps:{className:s.className,endAdornment:s.endAdornment,inputProps:l,startAdornment:s.startAdornment,sx:{["& .".concat(u.A.input)]:{margin:0}}},label:i,required:k,value:l.value};return null==t||t.call(null,a,e),(0,n.jsx)(j.A,{...a})},[t,i,b,k]),M=(0,g.useMemo)(()=>p()({["& .".concat(u.A.root," .").concat(a.A.endAdornment)]:{right:"7px",["& .".concat(c.A.root)]:{color:v.Qu}}},O),[O]);return(0,n.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)(m.A,{autoHighlight:!0,autoSelect:k,PaperComponent:y,...C,ListboxProps:w,renderGroup:G,renderInput:B,slotProps:I,sx:M}),(0,n.jsx)(x.A,{...l})]})}},64830:(e,r,t)=>{t.d(r,{_0:()=>D,Yy:()=>q,l9:()=>T,kL:()=>H});var n=t(37876),s=t(14232),i=t(57547),o=t(14361),l=t(51677);let a=e=>{let{files:r,nodes:t,servers:n,storageGroups:s,subnodes:i}=e;return{files:r,nodes:Object.values(t).reduce((e,r)=>{let{memory:t,...n}=r;return e[r.uuid]={...n,memory:{allocated:BigInt(t.allocated),available:BigInt(t.available),system:BigInt(t.system),total:BigInt(t.total)}},e},{}),servers:Object.values(n).reduce((e,r)=>{let{memory:t,...n}=r;return e[r.uuid]={...n,memory:{total:BigInt(t.total)}},e},{}),storageGroups:Object.values(s).reduce((e,r)=>{let{usage:t,...n}=r;return e[r.uuid]={...n,usage:{free:BigInt(t.free),total:BigInt(t.total),used:BigInt(t.used)}},e},{}),subnodes:Object.values(i).reduce((e,r)=>{let{memory:t,...n}=r;return e[r.uuid]={...n,memory:{total:BigInt(t.total)}},e},{})}};var u=t(5755),c=t(60282),d=t(12981),m=t(64410),h=t(69647),p=t(41946),g=t.n(p),v=t(22073),x=t(63190),j=t(23934),y=t(57763),A=t(5806),f=t(54773),b=t(53198);let k=(0,f.Ay)(b.A)({minWidth:"unset",whiteSpace:"nowrap"}),O=e=>{let{children:r,onClick:t,slotProps:s}=e;return(0,n.jsxs)(k,{onClick:t,...null==s?void 0:s.button,children:["Max: ",r]})};var C=t(71401),I=t(69267),w=t(75242),G=t(4064);let B=e=>{let{formikUtils:r,id:t,resources:i,scope:o}=e,{changeFieldValue:a,formik:u,handleChange:d}=r,p=(0,s.useMemo)(()=>{let e="disks.".concat(t),r="".concat(e,".size");return{size:r,unit:"".concat(r,".unit"),value:"".concat(r,".value"),storageGroup:"".concat(e,".storageGroup")}},[t]),g=(0,s.useMemo)(()=>({uuids:Object.keys(i.storageGroups)}),[i.storageGroups]),x=(0,s.useCallback)(e=>{let{[e]:r}=i.storageGroups,{[r.node]:t}=i.nodes;return{node:t,sg:r}},[i.nodes,i.storageGroups]),j=u.values.disks[t],A=(0,s.useMemo)(()=>o.reduce((e,r)=>{let{storageGroup:t}=r,n=i.storageGroups[t];return n.usage.free>e?n.usage.free:e},BigInt(0)),[i.storageGroups,o]),f=(0,s.useMemo)(()=>{let e=(0,h.u7)(A,{toUnit:j.size.unit});return e?{...e,str:"".concat(e.value," ").concat(e.unit)}:{str:"unknown",unit:"B",value:"0"}},[j.size.unit,A]);return(0,n.jsxs)(m.Ay,{container:!0,spacing:"1em",children:[(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(G.A,{input:(0,n.jsx)(w.A,{id:p.size,label:"Disk ".concat(t,": size"),inputWithLabelProps:{id:p.value,inputProps:{endAdornment:(0,n.jsx)(O,{onClick:()=>{a(p.value,f.value,!0)},children:f.str})},name:p.value,required:!0},onChange:d,selectItems:v.W,selectWithLabelProps:{id:p.unit,name:p.unit,onChange:u.handleChange,value:j.size.unit},value:j.size.value})})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(y.A,{filterOptions:(0,c.Z)({ignoreCase:!0,stringify:e=>{let{node:r,sg:t}=x(e);return"".concat(t.name,"\n").concat(r.name)}}),getOptionDisabled:e=>o.every(r=>r.storageGroup!==e),getOptionLabel:e=>{let{node:r,sg:t}=x(e);return"".concat(t.name," (").concat(r.name,")")},id:p.storageGroup,isOptionEqualToValue:(e,r)=>e===r,label:"Disk ".concat(t,": storage group"),noOptionsText:"No matching storage group",onChange:(e,r)=>{a(p.storageGroup,r,!0)},openOnFocus:!0,options:g.uuids,renderOption:(e,r)=>{let{node:t,sg:i}=x(r);return(0,s.createElement)("li",{...e,key:"storage-group-op-".concat(r)},(0,n.jsxs)(m.Ay,{alignItems:"center",container:!0,children:[(0,n.jsxs)(m.Ay,{item:!0,xs:!0,children:[(0,n.jsx)(l.a3,{inheritColour:!0,noWrap:!0,children:i.name}),(0,n.jsx)(l.a3,{inheritColour:!0,noWrap:!0,children:t.name})]}),(0,n.jsx)(m.Ay,{item:!0,children:(0,n.jsxs)(l.a3,{inheritColour:!0,noWrap:!0,children:[(0,h.zz)(i.usage.free,{toUnit:"ibyte"})," free"]})})]}))},required:!0,value:j.storageGroup})})]})};var M=t(74799);let z=e=>{let{resources:r}=e,t=(0,s.useMemo)(()=>Object.values(r.servers).sort((e,r)=>r.name.localeCompare(e.name,void 0,{numeric:!0})).reduce((e,r)=>(e[r.uuid]=r,e),{}),[r.servers]);return(0,n.jsx)(M.A,{header:"Existing",listItems:t,listProps:{dense:!0,sx:{maxHeight:"calc(60vh - 12em)"}},renderListItem:(e,r)=>(0,n.jsx)(l.a3,{children:r.name}),scroll:!0})},F=e=>{let{lsos:r,resources:t,values:i}=e,o=(0,s.useMemo)(()=>({ids:Object.keys(i.disks)}),[i.disks]),a=(0,s.useMemo)(()=>t.nodes[i.node],[t.nodes,i.node]);return(0,n.jsxs)(m.Ay,{container:!0,rowSpacing:"0.5em",children:[(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsxs)(l.a3,{children:["Server ",(0,n.jsx)(l.kp,{children:i.name})," will be created on node ",(0,n.jsx)(l.kp,{children:a.name})," with the following properties:"]})}),(0,n.jsx)(m.Ay,{item:!0,width:"30%",children:(0,n.jsx)(l.a3,{children:"CPU"})}),(0,n.jsx)(m.Ay,{item:!0,width:"70%",children:(0,n.jsxs)(l.a3,{children:[(0,n.jsx)(l.kp,{edge:"start",children:i.cpu.cores})," ","core(s) of ",(0,n.jsx)(l.kp,{children:a.cpu.cores.total})," ","available"]})}),(0,n.jsx)(m.Ay,{item:!0,width:"30%",children:(0,n.jsx)(l.a3,{children:"Memory"})}),(0,n.jsx)(m.Ay,{item:!0,width:"70%",children:(0,n.jsxs)(l.a3,{children:[(0,n.jsxs)(l.kp,{edge:"start",children:[i.memory.value," ",i.memory.unit]})," ","of"," ",(0,n.jsx)(l.kp,{children:(0,h.zz)(a.memory.available,{toUnit:"ibyte"})})," ","available"]})}),...o.ids.reduce((e,r)=>{let{[r]:s}=i.disks,o="disk-".concat(r,"-sum"),{[s.storageGroup]:a}=t.storageGroups;return e.push((0,n.jsx)(m.Ay,{item:!0,width:"30%",children:(0,n.jsxs)(l.a3,{children:["Disk ",(0,n.jsx)(l.kp,{children:r})]})},"".concat(o,"-label")),(0,n.jsx)(m.Ay,{item:!0,width:"70%",children:(0,n.jsxs)(l.a3,{children:[(0,n.jsxs)(l.kp,{edge:"start",children:[s.size.value," ",s.size.unit]})," ","of"," ",(0,n.jsx)(l.kp,{children:(0,h.zz)(a.usage.free,{toUnit:"ibyte"})})," ","free on ",(0,n.jsx)(l.kp,{children:a.name})]})},"".concat(o,"-value"))),e},[]),(0,n.jsx)(m.Ay,{item:!0,width:"30%",children:(0,n.jsx)(l.a3,{children:"Install ISO"})}),(0,n.jsx)(m.Ay,{item:!0,width:"70%",children:(0,n.jsx)(l.a3,{children:(0,n.jsx)(l.kp,{edge:"start",children:t.files[i.install].name})})}),(0,n.jsx)(m.Ay,{item:!0,width:"30%",children:(0,n.jsx)(l.a3,{children:"Driver ISO"})}),(0,n.jsx)(m.Ay,{item:!0,width:"70%",children:(0,n.jsx)(l.a3,{children:(0,n.jsx)(l.kp,{edge:"start",children:i.driver?t.files[i.driver].name:"none"})})}),(0,n.jsx)(m.Ay,{item:!0,width:"30%",children:(0,n.jsx)(l.a3,{children:"Optimize for"})}),(0,n.jsx)(m.Ay,{item:!0,width:"70%",children:(0,n.jsx)(l.a3,{children:(0,n.jsx)(l.kp,{edge:"start",children:r[i.os]})})})]})};var S=t(91408);let U=e=>S.ai().min(1).max(e).required();var P=t(45566);let W=BigInt(0x6400000),D=e=>(0,P.Yj)({max:e,min:W}),N=BigInt(0),E=(e,r)=>{let t=e.map(e=>r.storageGroups[e.storageGroup]).reduce((e,r)=>(r.usage.free>e.free&&(e.free=r.usage.free),e),{free:N});return S.Ik({size:S.gl().when(["storageGroup"],e=>{let[n]=e,{[n]:s}=r.storageGroups;return s?D(s.usage.free):D(t.free)}),storageGroup:(0,P.ZC)()})},L=BigInt(65536),q=e=>(0,P.Yj)({max:e,min:L}),T=(e,r)=>{let t;return t=r instanceof Array?r:Object.values(r),e&&(t=t.filter(r=>r.uuid!==e)),S.Yj().min(1).max(32).matches(/^[\w-]+$/,{message:"${path} can only contain alphanumeric, hyphen, and underscore characters"}).notOneOf(t.map(e=>e.name),"${path} already exists").required()};var Z=t(2062);let R=BigInt(0),Q=(e,r,t)=>{let n=e.map(e=>r.nodes[e.node]).reduce((e,r)=>{let{cpu:t,memory:n}=r;return t.cores.total>e.cpu.cores&&(e.cpu.cores=t.cores.total),n.available>e.memory.available&&(e.memory.available=n.available),e},{cpu:{cores:0},memory:{available:R}}),s=Object.keys(t);return S.Ik({cpu:S.Ik({cores:U(n.cpu.cores)}),disks:S.RZ(t=>S.Ik((0,Z.A)(t,E(e,r)))),driver:(0,P.ZC)().notOneOf([S.KR("install")]).nullable(),install:(0,P.ZC)().notOneOf([S.KR("driver")]).required(),memory:q(n.memory.available),name:T(null,r.servers),node:(0,P.ZC)().oneOf(e.map(e=>e.node)).required(),os:S.Yj().oneOf(s)})};var V=t(30764),$=t(71986);let _=e=>{let{lsos:r,resources:t}=e,o=(0,s.useContext)(i.MV),a=(0,s.useMemo)(()=>({uuids:Object.keys(t.files)}),[t.files]),p=(0,s.useMemo)(()=>({uuids:Object.keys(t.nodes),values:Object.values(t.nodes)}),[t.nodes]),f=(0,s.useMemo)(()=>({keys:Object.keys(r).sort((e,r)=>r.localeCompare(e,void 0,{numeric:!0}))}),[r]),b=(0,s.useMemo)(()=>({uuids:Object.keys(t.storageGroups),values:Object.values(t.storageGroups)}),[t.storageGroups]),k=(0,s.useMemo)(()=>p.values.reduce((e,r)=>(r.storageGroups.forEach(t=>{e.push({node:r.uuid,storageGroup:t})}),e),[]),[p.values]),[M,S]=(0,s.useState)(k),{confirmDialog:U,finishConfirm:P,setConfirmDialogProps:W,setConfirmDialogLoading:D,setConfirmDialogOpen:N}=(0,V.A)(),E=(0,s.useMemo)(()=>Q(M,t,r),[r,t,M]),L=(0,$.A)({initialValues:{cpu:{cores:"2"},disks:{0:{size:{unit:"GiB",value:"20"},storageGroup:null}},driver:null,install:null,memory:{unit:"GiB",value:"1"},name:"",node:null,os:null},onSubmit:(e,s)=>{let{setSubmitting:i}=s;W({actionProceedText:"Provision",content:(0,n.jsx)(F,{lsos:r,resources:t,values:e}),onCancelAppend:()=>i(!1),onProceedAppend:()=>{let r;D(!0);let t=(0,h.u7)(e.memory.value,{fromUnit:e.memory.unit,precision:0,toUnit:"B"});if(!t)return void P("Error",{children:(0,n.jsx)(n.Fragment,{children:"Failed to convert memory to bytes."})});try{r=Object.keys(e.disks).map(r=>{let{[r]:t}=e.disks,{size:n,storageGroup:s}=t,i=(0,h.u7)(n.value,{fromUnit:n.unit,precision:0,toUnit:"B"});if(!i)throw Error("Failed to convert disk ".concat(r," size to bytes."));return{storageSize:i.value,storageGroupUUID:s}})}catch(e){P("Error",{children:String(e)});return}let s={serverName:e.name,cpuCores:Number(e.cpu.cores),memory:t.value,virtualDisks:r,installISOFileUUID:e.install,driverISOFileUUID:e.driver?e.driver:"",anvilUUID:e.node,optimizeForOS:e.os};j.A.post("/server",s).then(()=>{P("Success",{children:(0,n.jsx)(n.Fragment,{children:"Provision server job registered."})}),null==o||o.setOpen(!1)}).catch(e=>{let r=(0,A.A)(e);r.children=(0,n.jsxs)(n.Fragment,{children:["Failed to start provision server job. ",r.children]}),P("Error",r),i(!1)})},titleText:"Provision ".concat(e.name,"?")}),N(!0)},validationSchema:E}),{changeFieldValue:q,disabledSubmit:T,formik:Z,formikErrors:R,getFieldChanged:_,handleChange:Y}=L,K=(0,s.useMemo)(()=>({cpu:{cores:"cpu.cores"},driver:"driver",install:"install",memory:{unit:"memory.unit",value:"memory.value"},name:"name",node:"node",os:"os"}),[]),H=(0,s.useMemo)(()=>({ids:Object.keys(Z.values.disks)}),[Z.values.disks]);(0,s.useEffect)(()=>{let e=[...k];Z.values.node&&(e=e.filter(e=>e.node===Z.values.node));let r=Number(Z.values.cpu.cores);Number.isSafeInteger(r)&&(e=e.filter(e=>{let{[e.node]:n}=t.nodes;return n.cpu.cores.total>=r}));let n=(0,h.u7)(Z.values.memory.value,{fromUnit:Z.values.memory.unit,precision:0,toUnit:"B"});if(n){let r=BigInt(n.value);e=e.filter(e=>{let{[e.node]:n}=t.nodes;return n.memory.available>=r})}H.ids.forEach(r=>{let{size:n,storageGroup:s}=Z.values.disks[r];if(s){let{[s]:r}=t.storageGroups;e=e.filter(e=>e.node===r.node)}let i=(0,h.u7)(n.value,{fromUnit:n.unit,precision:0,toUnit:"B"});if(i){let r=BigInt(i.value);e=e.filter(e=>{let{[e.storageGroup]:n}=t.storageGroups;return n.usage.free>=r})}}),g()(M,e)||S(e)},[H.ids,Z.values.cpu.cores,Z.values.disks,Z.values.memory.unit,Z.values.memory.value,Z.values.node,k,t.nodes,t.storageGroups,M]),(0,s.useEffect)(()=>{if(1===a.uuids.length){let[e]=a.uuids;[_(K.install),Z.values.install].every(e=>!e)&&Z.setFieldValue(K.install,e,!0)}let e=M.reduce((e,r)=>{let{node:t,storageGroup:n}=r;return e.nodes[t]=t,e.storageGroups[n]=n,e},{nodes:{},storageGroups:{}}),r=Object.keys(e.nodes);if(1===r.length){let[e]=r;[_(K.node),Z.values.node].every(e=>!e)&&Z.setFieldValue(K.node,e,!0)}let t=Object.keys(e.storageGroups);if(1===t.length){let[e]=t;H.ids.forEach(r=>{let t="disks.".concat(r,".storageGroup");[_(t),Z.values.disks[r].storageGroup].every(e=>!e)&&Z.setFieldValue(t,e,!0)})}},[K.install,K.node,H.ids,a.uuids,Z,_,M]);let J=(0,s.useMemo)(()=>M.reduce((e,r)=>{let{node:n}=r,s=t.nodes[n];return s.memory.available>e?s.memory.available:e},BigInt(0)),[t.nodes,M]),X=(0,s.useMemo)(()=>{let e=(0,h.u7)(J,{toUnit:Z.values.memory.unit});return e?{...e,str:"".concat(e.value," ").concat(e.unit)}:{str:"unknown",unit:"B",value:"0"}},[Z.values.memory.unit,J]),ee=(0,s.useMemo)(()=>Array.from({length:p.values.reduce((e,r)=>Math.max(e,r.cpu.cores.total),0)},(e,r)=>String(r+1)),[p]),er=(0,s.useCallback)(e=>{let{[e]:r}=t.files;return r.name},[t.files]),et=(0,s.useMemo)(()=>(0,c.Z)({ignoreCase:!0,stringify:e=>{let{[e]:r}=t.files;return r.name}}),[t.files]),en=(0,s.useCallback)((e,r,i)=>{let{[i]:o}=t.files,a=Object.values(o.locations).reduce((e,r)=>{let{ready:n,subnode:s}=r,{[s]:i}=t.subnodes;return n||!i||e.push(i),e},[]),u=a.length?(0,n.jsxs)(n.Fragment,{children:["Syncing to ",a.map(e=>{let{short:r}=e;return r}).join(", ")]}):(0,n.jsx)(n.Fragment,{children:"Ready"});return(0,s.createElement)("li",{...r,key:"".concat(e,"-op-").concat(i)},(0,n.jsxs)(d.A,{width:"100%",children:[(0,n.jsx)(l.a3,{inheritColour:!0,noWrap:!0,children:o.name}),(0,n.jsx)(l.xF,{inheritColour:!0,noWrap:!0,children:u})]}))},[t.files,t.subnodes]),es=(0,s.useMemo)(()=>{let e={};return[["file",a.uuids.length],["node",p.uuids.length],["storage group",b.uuids.length]].reduce((e,r)=>{let[t,s]=r;return s||(e[t]={children:(0,n.jsxs)(n.Fragment,{children:["No ",t," available yet. It will appear shortly after its creation."]})}),e},e),{entries:Object.entries(e),messages:e}},[a.uuids.length,p.uuids.length,b.uuids.length]);if(es.entries.length){let{entries:e}=es;return(0,n.jsx)(m.Ay,{container:!0,spacing:"1em",children:e.map(e=>{let[r,t]=e;return(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(u.A,{type:"warning",...t})},"".concat(r,"-message"))})})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m.Ay,{container:!0,spacing:"1em",children:[(0,n.jsx)(m.Ay,{item:!0,width:"16em",children:(0,n.jsx)(z,{resources:t})}),(0,n.jsx)(m.Ay,{item:!0,xs:!0,children:(0,n.jsxs)(m.Ay,{component:"form",container:!0,onSubmit:e=>{e.preventDefault(),Z.handleSubmit(e)},spacing:"1em",children:[(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(G.A,{input:(0,n.jsx)(I.A,{id:K.name,label:"Server name",name:K.name,onChange:Y,required:!0,value:Z.values.name})})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(y.A,{getOptionDisabled:e=>{let r=Number(e);return M.every(e=>{let{[e.node]:n}=t.nodes;return n.cpu.cores.total<r})},id:K.cpu.cores,label:"CPU cores",noOptionsText:"No node has the requested cores",onChange:(e,r)=>{q(K.cpu.cores,r,!0)},openOnFocus:!0,options:ee,required:!0,value:Z.values.cpu.cores})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(G.A,{input:(0,n.jsx)(w.A,{id:"memory",inputWithLabelProps:{id:K.memory.value,inputProps:{endAdornment:(0,n.jsx)(O,{onClick:()=>{q(K.memory.value,X.value,!0)},children:X.str})},name:K.memory.value,required:!0},label:"Memory",onChange:Y,selectItems:v.W,selectWithLabelProps:{id:K.memory.unit,name:K.memory.unit,onChange:Z.handleChange,value:Z.values.memory.unit},value:Z.values.memory.value})})}),H.ids.map(e=>(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(B,{formikUtils:L,id:e,resources:t,scope:M})},"disk-".concat(e,"-form"))),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(y.A,{filterOptions:et,getOptionDisabled:e=>e===Z.values.driver,getOptionLabel:er,id:K.install,label:"Install ISO",noOptionsText:"No matching ISO",onChange:(e,r)=>{q(K.install,r,!0)},openOnFocus:!0,options:a.uuids,renderOption:(e,r)=>en(K.install,e,r),required:!0,value:Z.values.install})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(y.A,{filterOptions:et,getOptionDisabled:e=>e===Z.values.install,getOptionLabel:er,id:K.driver,label:"Driver ISO",noOptionsText:"No matching ISO",onChange:(e,r)=>{q(K.driver,r,!0)},openOnFocus:!0,options:a.uuids,renderOption:(e,r)=>en(K.driver,e,r),value:Z.values.driver})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(y.A,{filterOptions:(0,c.Z)({ignoreCase:!0,stringify:e=>{let{[e]:r}=t.nodes;return"".concat(r.name,"\n").concat(r.description)}}),getOptionDisabled:e=>M.every(r=>r.node!==e),getOptionLabel:e=>{let{[e]:r}=t.nodes;return r.name},id:K.node,label:"Node",noOptionsText:"No matching node",onChange:(e,r)=>{q(K.node,r,!0)},openOnFocus:!0,options:p.uuids,renderOption:(e,r)=>{let{[r]:i}=t.nodes;return(0,s.createElement)("li",{...e,key:"node-op-".concat(r)},(0,n.jsxs)(m.Ay,{alignItems:"center",container:!0,children:[(0,n.jsxs)(m.Ay,{item:!0,width:"70%",children:[(0,n.jsx)(l.a3,{inheritColour:!0,noWrap:!0,children:i.name}),(0,n.jsx)(l.xF,{inheritColour:!0,noWrap:!0,children:i.description})]}),(0,n.jsxs)(m.Ay,{item:!0,width:"30%",children:[(0,n.jsxs)(l.a3,{inheritColour:!0,noWrap:!0,children:["CPU: ",i.cpu.cores.total," cores"]}),(0,n.jsxs)(l.a3,{inheritColour:!0,noWrap:!0,children:["Memory:"," ",(0,h.zz)(i.memory.available,{toUnit:"ibyte"})]})]})]}))},required:!0,value:Z.values.node})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(y.A,{filterOptions:(0,c.Z)({ignoreCase:!0,stringify:e=>{let{[e]:t}=r;return"".concat(e,"\n").concat(t)}}),getOptionLabel:e=>{let{[e]:t}=r;return t},id:K.os,label:"Optimize for OS",noOptionsText:"No OS that matches exactly; try finding a close match",onChange:(e,r)=>{q(K.os,r,!0)},openOnFocus:!0,options:f.keys,renderOption:(e,t)=>{let{[t]:i}=r;return(0,s.createElement)("li",{...e,key:"os-op-".concat(t)},(0,n.jsxs)(d.A,{width:"100%",children:[(0,n.jsx)(l.a3,{inheritColour:!0,noWrap:!0,children:i}),(0,n.jsx)(l.xF,{inheritColour:!0,noWrap:!0,children:t})]}))},required:!0,value:Z.values.os})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(C.A,{count:1,messages:R})}),(0,n.jsx)(m.Ay,{item:!0,width:"100%",children:(0,n.jsx)(x.A,{actions:[{background:"blue",children:"Provision",disabled:T,type:"submit"}]})})]})})]}),U]})};var Y=t(59664);let K=()=>{let{data:e,loading:r}=(0,Y.A)("/server/lsos"),{altData:t,loading:i,validating:o}=(0,Y.A)("/server/provision",{mod:a,refreshInterval:5e3});return{form:(0,s.useMemo)(()=>[e,t].some(e=>!e)?(0,n.jsx)(u.A,{type:"warning",children:"Failed to prepare resources for provision server."}):(0,n.jsx)(_,{lsos:e,resources:t}),[e,t]),loading:r||i,lsos:e,resources:t,validating:o}},H=()=>{let e=(0,s.useRef)(null),{form:r,loading:t,validating:a}=K(),u=(0,s.useCallback)(function(){var r;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(r=e.current)?void 0:r.setOpen(t)},[]);return{dialog:(0,s.useMemo)(()=>(0,n.jsx)(i.K_,{header:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.HM,{children:"Provision a server"}),(0,n.jsx)(o.A,{syncing:a})]}),loading:t,ref:e,showClose:!0,wide:!0,children:r}),[r,t,a]),setOpen:u}}},74503:(e,r,t)=>{t.d(r,{A:()=>h});var n=t(37876),s=t(54773),i=t(27844),o=t(75638),l=t(14232),a=t(90890),u=t(69209);let c=(0,s.Ay)(u.A)({backgroundColor:a.Qu});var d=t(72015);let m=(0,s.Ay)(i.A)({["& .".concat(o.A.paper)]:{backgroundColor:a.Qu}}),h=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let[s]=r,{children:i,getItemDisabled:o,getItemHref:a,items:u={},onItemClick:h,open:p,renderItem:g,slotProps:v}=s,x=(0,l.useMemo)(()=>Object.entries(u),[u]),j=(0,l.useMemo)(()=>x.map(e=>{let[r,t]=e;if(r.includes("subheader"))return(0,n.jsx)(c,{children:null==g?void 0:g.call(null,r,t)},r);let s={disabled:null==o?void 0:o.call(null,r,t)},i=null==a?void 0:a.call(null,r,t);return i?(s.component="a",s.href=i):s.onClick=function(){for(var e=arguments.length,n=Array(e),s=0;s<e;s++)n[s]=arguments[s];return null==h?void 0:h.call(null,r,t,...n)},(0,n.jsx)(d.A,{...s,...null==v?void 0:v.item,children:null==g?void 0:g.call(null,r,t)},r)}),[o,a,h,x,g,null==v?void 0:v.item]);return(0,n.jsx)(m,{open:p,...null==v?void 0:v.menu,children:i||j})}},75242:(e,r,t)=>{t.d(r,{A:()=>d});var n=t(37876),s=t(12981),i=t(17550),o=t(7674),l=t(90890),a=t(71949),u=t(69267),c=t(65873);let d=e=>{let{id:r,label:t,inputWithLabelProps:d,messageBoxProps:m,onChange:h,selectItems:p,selectWithLabelProps:g,value:v}=e;return(0,n.jsxs)(s.A,{children:[(0,n.jsxs)(s.A,{sx:{display:"flex",flexDirection:"row","& > :first-child":{flexGrow:1},"& > :not(:last-child)":{marginRight:".5em"},["&:hover\n          .".concat(i.A.root,"\n          .").concat(o.A.root,"\n          .").concat(o.A.notchedOutline)]:{borderColor:l.Qu}},children:[(0,n.jsx)(u.A,{id:r,label:t,onChange:h,value:v,...d}),(0,n.jsx)(c.A,{formControlProps:{fullWidth:!1,sx:{minWidth:"min-content"}},id:"".concat(r,"-nested-select"),selectItems:p,...g})]}),(0,n.jsx)(a.A,{...m})]})}}}]);