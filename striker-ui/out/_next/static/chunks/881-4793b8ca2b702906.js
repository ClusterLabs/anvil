"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[881],{48801:function(e,r,n){var t=n(85893),s=n(21640),i=n(93454),o=n(77527),l=n(4989),a=n(1142),u=n(58219),c=n(35562),d=n(90642),m=n(96245),h=n(82492),p=n.n(h),v=n(67294),g=n(39971),x=n(17512),j=n(23852);let f=e=>(0,t.jsx)(s.Z,{in:!0,children:(0,t.jsx)(i.Z,{...e})}),b=(0,o.ZP)("ul")({padding:0}),Z=l.Z;r.Z=e=>{let{componentsProps:r,extendRenderInput:n,getGroupLabel:s,label:i,ListboxProps:o,messageBoxProps:l,renderGroup:h,renderInput:y,required:O,sx:k,...P}=e,C=(0,v.useMemo)(()=>p()({paper:{sx:{backgroundColor:g.s7,["& .".concat(a.Z.groupLabel)]:{backgroundColor:g.s7}}}},r),[r]),w=(0,v.useMemo)(()=>p()({sx:{["& .".concat(a.Z.option)]:{'&[aria-selected="true"]':{backgroundColor:g.lD,["&.".concat(a.Z.focused)]:{backgroundColor:g.lD}},["&.".concat(a.Z.focused)]:{backgroundColor:g.lD}}}},o),[o]),G=(0,v.useMemo)(()=>h||s&&(e=>(0,t.jsxs)("li",{children:[(0,t.jsx)(Z,{component:"div",className:a.Z.groupLabel,children:s(e.group)}),(0,t.jsx)(b,{className:a.Z.groupUl,children:e.children})]},e.key)),[s,h]),I=(0,v.useMemo)(()=>null!=y?y:e=>{let{fullWidth:r,InputProps:s,InputLabelProps:o,inputProps:l}=e,a={formControlProps:{fullWidth:r,ref:s.ref},inputLabelProps:o,inputProps:{className:s.className,endAdornment:s.endAdornment,inputProps:l,startAdornment:s.startAdornment,sx:{["& .".concat(u.Z.input)]:{margin:0}}},label:i,required:O};return null==n||n.call(null,a,e),(0,t.jsx)(j.Z,{...a})},[n,i,y,O]),A=(0,v.useMemo)(()=>p()({["& .".concat(u.Z.root," .").concat(a.Z.endAdornment)]:{right:"7px",["& .".concat(c.Z.root)]:{color:g.s7}}},k),[k]);return(0,t.jsxs)(d.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,t.jsx)(m.Z,{autoHighlight:!0,autoSelect:!0,PaperComponent:f,...P,ListboxProps:w,renderGroup:G,renderInput:I,slotProps:C,sx:A}),(0,t.jsx)(x.Z,{...l})]})}},75492:function(e,r,n){n.d(r,{Z:function(){return h}});var t=n(85893),s=n(77527),i=n(33466),o=n(37906),l=n(67294),a=n(39971),u=n(4989);let c=(0,s.ZP)(u.Z)({backgroundColor:a.s7});var d=n(18766);let m=(0,s.ZP)(i.Z)({["& .".concat(o.Z.paper)]:{backgroundColor:a.s7}});var h=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];let[s]=r,{children:i,getItemDisabled:o,getItemHref:a,items:u={},onItemClick:h,open:p,renderItem:v,slotProps:g}=s,x=(0,l.useMemo)(()=>Object.entries(u),[u]),j=(0,l.useMemo)(()=>x.map(e=>{let[r,n]=e;if(r.includes("subheader"))return(0,t.jsx)(c,{children:null==v?void 0:v.call(null,r,n)});let s={disabled:null==o?void 0:o.call(null,r,n)},i=null==a?void 0:a.call(null,r,n);return i?(s.component="a",s.href=i):s.onClick=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return null==h?void 0:h.call(null,r,n,...t)},(0,t.jsx)(d.Z,{...s,...null==g?void 0:g.item,children:null==v?void 0:v.call(null,r,n)},r)}),[o,a,h,x,v,null==g?void 0:g.item]);return(0,t.jsx)(m,{open:p,...null==g?void 0:g.menu,children:i||j})}},52257:function(e,r,n){var t=n(85893),s=n(90642),i=n(13435),o=n(58219),l=n(39971),a=n(17512),u=n(23852),c=n(37628);let d=e=>{let{id:r,label:n,inputWithLabelProps:d,messageBoxProps:m,onChange:h,selectItems:p,selectWithLabelProps:v,value:g}=e;return(0,t.jsxs)(s.Z,{children:[(0,t.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"row","& > :first-child":{flexGrow:1},"& > :not(:last-child)":{marginRight:".5em"},["&:hover\n          .".concat(i.Z.root,"\n          .").concat(o.Z.root,"\n          .").concat(o.Z.notchedOutline)]:{borderColor:l.s7}},children:[(0,t.jsx)(u.Z,{id:r,label:n,onChange:h,value:g,...d}),(0,t.jsx)(c.Z,{formControlProps:{fullWidth:!1,sx:{minWidth:"min-content"}},id:"".concat(r,"-nested-select"),selectItems:p,...v})]}),(0,t.jsx)(a.Z,{...m})]})};d.defaultProps={inputWithLabelProps:void 0,messageBoxProps:void 0,selectWithLabelProps:void 0},r.Z=d},43267:function(e,r,n){n.d(r,{BQ:function(){return N},xJ:function(){return L},RN:function(){return q},Zd:function(){return $}});var t=n(85893),s=n(67294),i=n(45036),o=n(18573),l=n(57882),a=e=>{let{files:r,nodes:n,servers:t,storageGroups:s,subnodes:i}=e;return{files:r,nodes:Object.values(n).reduce((e,r)=>{let{memory:n,...t}=r;return e[r.uuid]={...t,memory:{allocated:BigInt(n.allocated),available:BigInt(n.available),system:BigInt(n.system),total:BigInt(n.total)}},e},{}),servers:Object.values(t).reduce((e,r)=>{let{memory:n,...t}=r;return e[r.uuid]={...t,memory:{total:BigInt(n.total)}},e},{}),storageGroups:Object.values(s).reduce((e,r)=>{let{usage:n,...t}=r;return e[r.uuid]={...t,usage:{free:BigInt(n.free),total:BigInt(n.total),used:BigInt(n.used)}},e},{}),subnodes:Object.values(i).reduce((e,r)=>{let{memory:n,...t}=r;return e[r.uuid]={...t,memory:{total:BigInt(n.total)}},e},{})}},u=n(29873),c=n(93362),d=n(90642),m=n(8506),h=n(54490),p=n(18446),v=n.n(p),g=n(4615),x=n(42050),j=n(66389),f=n(48801),b=n(11100),Z=n(77527),y=n(46194);let O=(0,Z.ZP)(y.Z)({minWidth:"unset",whiteSpace:"nowrap"});var k=e=>{let{children:r,onClick:n,slotProps:s}=e;return(0,t.jsxs)(O,{onClick:n,...null==s?void 0:s.button,children:["Max: ",r]})},P=n(18050),C=n(23852),w=n(52257),G=n(12823),I=e=>{let{formikUtils:r,id:n,resources:i,scope:o}=e,{changeFieldValue:a,formik:u,handleChange:d}=r,p=(0,s.useMemo)(()=>{let e="disks.".concat(n),r="".concat(e,".size");return{size:r,unit:"".concat(r,".unit"),value:"".concat(r,".value"),storageGroup:"".concat(e,".storageGroup")}},[n]),v=(0,s.useMemo)(()=>({uuids:Object.keys(i.storageGroups)}),[i.storageGroups]),x=(0,s.useCallback)(e=>{let{[e]:r}=i.storageGroups,{[r.node]:n}=i.nodes;return{node:n,sg:r}},[i.nodes,i.storageGroups]),j=u.values.disks[n],b=(0,s.useMemo)(()=>o.reduce((e,r)=>{let{storageGroup:n}=r,t=i.storageGroups[n];return t.usage.free>e?t.usage.free:e},BigInt(0)),[i.storageGroups,o]),Z=(0,s.useMemo)(()=>{let e=(0,h.Gh)(b,{toUnit:j.size.unit});return e?{...e,str:"".concat(e.value," ").concat(e.unit)}:{str:"unknown",unit:"B",value:"0"}},[j.size.unit,b]);return(0,t.jsxs)(m.ZP,{container:!0,spacing:"1em",children:[(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(G.Z,{input:(0,t.jsx)(w.Z,{id:p.size,label:"Disk ".concat(n,": size"),inputWithLabelProps:{id:p.value,inputProps:{endAdornment:(0,t.jsx)(k,{onClick:()=>{a(p.value,Z.value,!0)},children:Z.str})},name:p.value,required:!0},onChange:d,selectItems:g.k,selectWithLabelProps:{id:p.unit,name:p.unit,onChange:u.handleChange,value:j.size.unit},value:j.size.value})})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(f.Z,{filterOptions:(0,c.D)({ignoreCase:!0,stringify:e=>{let{node:r,sg:n}=x(e);return"".concat(n.name,"\n").concat(r.name)}}),getOptionDisabled:e=>o.every(r=>r.storageGroup!==e),getOptionLabel:e=>{let{node:r,sg:n}=x(e);return"".concat(n.name," (").concat(r.name,")")},id:p.storageGroup,isOptionEqualToValue:(e,r)=>e===r,label:"Disk ".concat(n,": storage group"),noOptionsText:"No matching storage group",onChange:(e,r)=>{a(p.storageGroup,r,!0)},openOnFocus:!0,options:v.uuids,renderOption:(e,r)=>{let{node:n,sg:i}=x(r);return(0,s.createElement)("li",{...e,key:"storage-group-op-".concat(r)},(0,t.jsxs)(m.ZP,{alignItems:"center",container:!0,children:[(0,t.jsxs)(m.ZP,{item:!0,xs:!0,children:[(0,t.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:i.name}),(0,t.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:n.name})]}),(0,t.jsx)(m.ZP,{item:!0,children:(0,t.jsxs)(l.Ac,{inheritColour:!0,noWrap:!0,children:[(0,h._d)(i.usage.free,{toUnit:"ibyte"})," free"]})})]}))},required:!0,value:j.storageGroup})})]})},A=n(18541),M=e=>{let{resources:r}=e,n=(0,s.useMemo)(()=>Object.values(r.servers).sort((e,r)=>r.name.localeCompare(e.name,void 0,{numeric:!0})).reduce((e,r)=>(e[r.uuid]=r,e),{}),[r.servers]);return(0,t.jsx)(A.Z,{header:"Existing",listItems:n,listProps:{dense:!0,sx:{maxHeight:"calc(60vh - 12em)"}},renderListItem:(e,r)=>(0,t.jsx)(l.Ac,{children:r.name}),scroll:!0})},S=e=>{let{lsos:r,resources:n,values:i}=e,o=(0,s.useMemo)(()=>({ids:Object.keys(i.disks)}),[i.disks]),a=(0,s.useMemo)(()=>n.nodes[i.node],[n.nodes,i.node]);return(0,t.jsxs)(m.ZP,{container:!0,rowSpacing:"0.5em",children:[(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsxs)(l.Ac,{children:["Server ",(0,t.jsx)(l.Q0,{children:i.name})," will be created on node ",(0,t.jsx)(l.Q0,{children:a.name})," with the following properties:"]})}),(0,t.jsx)(m.ZP,{item:!0,width:"30%",children:(0,t.jsx)(l.Ac,{children:"CPU"})}),(0,t.jsx)(m.ZP,{item:!0,width:"70%",children:(0,t.jsxs)(l.Ac,{children:[(0,t.jsx)(l.Q0,{edge:"start",children:i.cpu.cores})," ","core(s) of ",(0,t.jsx)(l.Q0,{children:a.cpu.cores.total})," ","available"]})}),(0,t.jsx)(m.ZP,{item:!0,width:"30%",children:(0,t.jsx)(l.Ac,{children:"Memory"})}),(0,t.jsx)(m.ZP,{item:!0,width:"70%",children:(0,t.jsxs)(l.Ac,{children:[(0,t.jsxs)(l.Q0,{edge:"start",children:[i.memory.value," ",i.memory.unit]})," ","of"," ",(0,t.jsx)(l.Q0,{children:(0,h._d)(a.memory.available,{toUnit:"ibyte"})})," ","available"]})}),...o.ids.reduce((e,r)=>{let{[r]:s}=i.disks,o="disk-".concat(r,"-sum"),{[s.storageGroup]:a}=n.storageGroups;return e.push((0,t.jsx)(m.ZP,{item:!0,width:"30%",children:(0,t.jsxs)(l.Ac,{children:["Disk ",(0,t.jsx)(l.Q0,{children:r})]})},"".concat(o,"-label")),(0,t.jsx)(m.ZP,{item:!0,width:"70%",children:(0,t.jsxs)(l.Ac,{children:[(0,t.jsxs)(l.Q0,{edge:"start",children:[s.size.value," ",s.size.unit]})," ","of"," ",(0,t.jsx)(l.Q0,{children:(0,h._d)(a.usage.free,{toUnit:"ibyte"})})," ","free on ",(0,t.jsx)(l.Q0,{children:a.name})]})},"".concat(o,"-value"))),e},[]),(0,t.jsx)(m.ZP,{item:!0,width:"30%",children:(0,t.jsx)(l.Ac,{children:"Install ISO"})}),(0,t.jsx)(m.ZP,{item:!0,width:"70%",children:(0,t.jsx)(l.Ac,{children:(0,t.jsx)(l.Q0,{edge:"start",children:n.files[i.install].name})})}),(0,t.jsx)(m.ZP,{item:!0,width:"30%",children:(0,t.jsx)(l.Ac,{children:"Driver ISO"})}),(0,t.jsx)(m.ZP,{item:!0,width:"70%",children:(0,t.jsx)(l.Ac,{children:(0,t.jsx)(l.Q0,{edge:"start",children:i.driver?n.files[i.driver].name:"none"})})}),(0,t.jsx)(m.ZP,{item:!0,width:"30%",children:(0,t.jsx)(l.Ac,{children:"Optimize for"})}),(0,t.jsx)(m.ZP,{item:!0,width:"70%",children:(0,t.jsx)(l.Ac,{children:(0,t.jsx)(l.Q0,{edge:"start",children:r[i.os]})})})]})},B=n(16310),F=e=>B.Rx().min(1).max(e).required(),U=n(48313);let D=BigInt(104857600);var N=e=>(0,U.r)({max:e,min:D});let W=BigInt(0);var z=(e,r)=>{let n=e.map(e=>r.storageGroups[e.storageGroup]).reduce((e,r)=>(r.usage.free>e.free&&(e.free=r.usage.free),e),{free:W});return B.Ry({size:B.nK().when(["storageGroup"],e=>{let[t]=e,{[t]:s}=r.storageGroups;return s?N(s.usage.free):N(n.free)}),storageGroup:(0,U.uI)()})};let E=BigInt(65536);var L=e=>(0,U.r)({max:e,min:E}),q=(e,r)=>{let n;return n=r instanceof Array?r:Object.values(r),e&&(n=n.filter(r=>r.uuid!==e)),B.Z_().min(1).max(32).matches(/^[\w-]+$/,{message:"${path} can only contain alphanumeric, hyphen, and underscore characters"}).notOneOf(n.map(e=>e.name),"${path} already exists").required()},Q=n(74178);let T=BigInt(0);var V=(e,r,n)=>{let t=e.map(e=>r.nodes[e.node]).reduce((e,r)=>{let{cpu:n,memory:t}=r;return n.cores.total>e.cpu.cores&&(e.cpu.cores=n.cores.total),t.available>e.memory.available&&(e.memory.available=t.available),e},{cpu:{cores:0},memory:{available:T}}),s=Object.keys(n);return B.Ry({cpu:B.Ry({cores:F(t.cpu.cores)}),disks:B.Vo(n=>B.Ry((0,Q.Z)(n,z(e,r)))),driver:(0,U.uI)().notOneOf([B.iH("install")]).nullable(),install:(0,U.uI)().notOneOf([B.iH("driver")]).required(),memory:L(t.memory.available),name:q(null,r.servers),node:(0,U.uI)().oneOf(e.map(e=>e.node)).required(),os:B.Z_().oneOf(s)})},R=n(40657),_=n(2094),H=e=>{let{lsos:r,resources:n}=e,o=(0,s.useContext)(i.MJ),a=(0,s.useMemo)(()=>({uuids:Object.keys(n.files)}),[n.files]),p=(0,s.useMemo)(()=>({uuids:Object.keys(n.nodes),values:Object.values(n.nodes)}),[n.nodes]),Z=(0,s.useMemo)(()=>({keys:Object.keys(r).sort((e,r)=>r.localeCompare(e,void 0,{numeric:!0}))}),[r]),y=(0,s.useMemo)(()=>({uuids:Object.keys(n.storageGroups),values:Object.values(n.storageGroups)}),[n.storageGroups]),O=(0,s.useMemo)(()=>p.values.reduce((e,r)=>(r.storageGroups.forEach(n=>{e.push({node:r.uuid,storageGroup:n})}),e),[]),[p.values]),[A,B]=(0,s.useState)(O),{confirmDialog:F,finishConfirm:U,setConfirmDialogProps:D,setConfirmDialogLoading:N,setConfirmDialogOpen:W}=(0,R.Z)(),z=(0,s.useMemo)(()=>V(A,n,r),[r,n,A]),E=(0,_.Z)({initialValues:{cpu:{cores:"2"},disks:{0:{size:{unit:"GiB",value:"10"},storageGroup:null}},driver:null,install:null,memory:{unit:"GiB",value:"1"},name:"",node:null,os:null},onSubmit:(e,s)=>{let{setSubmitting:i}=s;D({actionProceedText:"Provision",content:(0,t.jsx)(S,{lsos:r,resources:n,values:e}),onCancelAppend:()=>i(!1),onProceedAppend:()=>{let r;N(!0);let n=(0,h.Gh)(e.memory.value,{fromUnit:e.memory.unit,precision:0,toUnit:"B"});if(!n){U("Error",{children:(0,t.jsx)(t.Fragment,{children:"Failed to convert memory to bytes."})});return}try{r=Object.keys(e.disks).map(r=>{let{[r]:n}=e.disks,{size:t,storageGroup:s}=n,i=(0,h.Gh)(t.value,{fromUnit:t.unit,precision:0,toUnit:"B"});if(!i)throw Error("Failed to convert disk ".concat(r," size to bytes."));return{storageSize:i.value,storageGroupUUID:s}})}catch(e){U("Error",{children:(0,t.jsx)(t.Fragment,{children:e})});return}let s={serverName:e.name,cpuCores:Number(e.cpu.cores),memory:n.value,virtualDisks:r,installISOFileUUID:e.install,driverISOFileUUID:e.driver?e.driver:"",anvilUUID:e.node,optimizeForOS:e.os};j.Z.post("/server",s).then(()=>{U("Success",{children:(0,t.jsx)(t.Fragment,{children:"Provision server job registered."})}),null==o||o.setOpen(!1)}).catch(e=>{let r=(0,b.Z)(e);r.children=(0,t.jsxs)(t.Fragment,{children:["Failed to start provision server job. ",r.children]}),U("Error",r)})},titleText:"Provision ".concat(e.name,"?")}),W(!0)},validationSchema:z}),{changeFieldValue:L,disabledSubmit:q,formik:Q,formikErrors:T,getFieldChanged:H,handleChange:K}=E,J=(0,s.useMemo)(()=>({cpu:{cores:"cpu.cores"},driver:"driver",install:"install",memory:{unit:"memory.unit",value:"memory.value"},name:"name",node:"node",os:"os"}),[]),$=(0,s.useMemo)(()=>({ids:Object.keys(Q.values.disks)}),[Q.values.disks]);(0,s.useEffect)(()=>{let e=[...O];Q.values.node&&(e=e.filter(e=>e.node===Q.values.node));let r=Number(Q.values.cpu.cores);Number.isSafeInteger(r)&&(e=e.filter(e=>{let{[e.node]:t}=n.nodes;return t.cpu.cores.total>=r}));let t=(0,h.Gh)(Q.values.memory.value,{fromUnit:Q.values.memory.unit,precision:0,toUnit:"B"});if(t){let r=BigInt(t.value);e=e.filter(e=>{let{[e.node]:t}=n.nodes;return t.memory.available>=r})}$.ids.forEach(r=>{let{size:t,storageGroup:s}=Q.values.disks[r];if(s){let{[s]:r}=n.storageGroups;e=e.filter(e=>e.node===r.node)}let i=(0,h.Gh)(t.value,{fromUnit:t.unit,precision:0,toUnit:"B"});if(i){let r=BigInt(i.value);e=e.filter(e=>{let{[e.storageGroup]:t}=n.storageGroups;return t.usage.free>=r})}}),v()(A,e)||B(e)},[$.ids,Q.values.cpu.cores,Q.values.disks,Q.values.memory.unit,Q.values.memory.value,Q.values.node,O,n.nodes,n.storageGroups,A]),(0,s.useEffect)(()=>{if(1===a.uuids.length){let[e]=a.uuids;[H(J.install),Q.values.install].every(e=>!e)&&Q.setFieldValue(J.install,e,!0)}let e=A.reduce((e,r)=>{let{node:n,storageGroup:t}=r;return e.nodes[n]=n,e.storageGroups[t]=t,e},{nodes:{},storageGroups:{}}),r=Object.keys(e.nodes);if(1===r.length){let[e]=r;[H(J.node),Q.values.node].every(e=>!e)&&Q.setFieldValue(J.node,e,!0)}let n=Object.keys(e.storageGroups);if(1===n.length){let[e]=n;$.ids.forEach(r=>{let n="disks.".concat(r,".storageGroup");[H(n),Q.values.disks[r].storageGroup].every(e=>!e)&&Q.setFieldValue(n,e,!0)})}},[J.install,J.node,$.ids,a.uuids,Q,H,A]);let X=(0,s.useMemo)(()=>A.reduce((e,r)=>{let{node:t}=r,s=n.nodes[t];return s.memory.available>e?s.memory.available:e},BigInt(0)),[n.nodes,A]),Y=(0,s.useMemo)(()=>{let e=(0,h.Gh)(X,{toUnit:Q.values.memory.unit});return e?{...e,str:"".concat(e.value," ").concat(e.unit)}:{str:"unknown",unit:"B",value:"0"}},[Q.values.memory.unit,X]),ee=(0,s.useMemo)(()=>Array.from({length:p.values.reduce((e,r)=>Math.max(e,r.cpu.cores.total),0)},(e,r)=>String(r+1)),[p]),er=(0,s.useCallback)(e=>{let{[e]:r}=n.files;return r.name},[n.files]),en=(0,s.useMemo)(()=>(0,c.D)({ignoreCase:!0,stringify:e=>{let{[e]:r}=n.files;return r.name}}),[n.files]),et=(0,s.useCallback)((e,r,i)=>{let{[i]:o}=n.files,a=Object.values(o.locations).reduce((e,r)=>{let{ready:t,subnode:s}=r,{[s]:i}=n.subnodes;return t||!i||e.push(i),e},[]),u=a.length?(0,t.jsxs)(t.Fragment,{children:["Syncing to ",a.map(e=>{let{short:r}=e;return r}).join(", ")]}):(0,t.jsx)(t.Fragment,{children:"Ready"});return(0,s.createElement)("li",{...r,key:"".concat(e,"-op-").concat(i)},(0,t.jsxs)(d.Z,{width:"100%",children:[(0,t.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:o.name}),(0,t.jsx)(l.KI,{inheritColour:!0,noWrap:!0,children:u})]}))},[n.files,n.subnodes]),es=(0,s.useMemo)(()=>{let e={};return[["file",a.uuids.length],["node",p.uuids.length],["storage group",y.uuids.length]].reduce((e,r)=>{let[n,s]=r;return s||(e[n]={children:(0,t.jsxs)(t.Fragment,{children:["No ",n," available yet. It will appear shortly after its creation."]})}),e},e),{entries:Object.entries(e),messages:e}},[a.uuids.length,p.uuids.length,y.uuids.length]);if(es.entries.length){let{entries:e}=es;return(0,t.jsx)(m.ZP,{container:!0,spacing:"1em",children:e.map(e=>{let[r,n]=e;return(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(u.Z,{type:"warning",...n})},"".concat(r,"-message"))})})}return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.ZP,{container:!0,spacing:"1em",children:[(0,t.jsx)(m.ZP,{item:!0,width:"16em",children:(0,t.jsx)(M,{resources:n})}),(0,t.jsx)(m.ZP,{item:!0,xs:!0,children:(0,t.jsxs)(m.ZP,{component:"form",container:!0,onSubmit:e=>{e.preventDefault(),Q.handleSubmit(e)},spacing:"1em",children:[(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(G.Z,{input:(0,t.jsx)(C.Z,{id:J.name,label:"Server name",name:J.name,onChange:K,required:!0,value:Q.values.name})})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(f.Z,{getOptionDisabled:e=>{let r=Number(e);return A.every(e=>{let{[e.node]:t}=n.nodes;return t.cpu.cores.total<r})},id:J.cpu.cores,label:"CPU cores",noOptionsText:"No node has the requested cores",onChange:(e,r)=>{L(J.cpu.cores,r,!0)},openOnFocus:!0,options:ee,required:!0,value:Q.values.cpu.cores})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(G.Z,{input:(0,t.jsx)(w.Z,{id:"memory",inputWithLabelProps:{id:J.memory.value,inputProps:{endAdornment:(0,t.jsx)(k,{onClick:()=>{L(J.memory.value,Y.value,!0)},children:Y.str})},name:J.memory.value,required:!0},label:"Memory",onChange:K,selectItems:g.k,selectWithLabelProps:{id:J.memory.unit,name:J.memory.unit,onChange:Q.handleChange,value:Q.values.memory.unit},value:Q.values.memory.value})})}),$.ids.map(e=>(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(I,{formikUtils:E,id:e,resources:n,scope:A})},"disk-".concat(e,"-form"))),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(f.Z,{filterOptions:en,getOptionDisabled:e=>e===Q.values.driver,getOptionLabel:er,id:J.install,label:"Install ISO",noOptionsText:"No matching ISO",onChange:(e,r)=>{L(J.install,r,!0)},openOnFocus:!0,options:a.uuids,renderOption:(e,r)=>et(J.install,e,r),required:!0,value:Q.values.install})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(f.Z,{autoSelect:!1,filterOptions:en,getOptionDisabled:e=>e===Q.values.install,getOptionLabel:er,id:J.driver,label:"Driver ISO",noOptionsText:"No matching ISO",onChange:(e,r)=>{L(J.driver,r,!0)},openOnFocus:!0,options:a.uuids,renderOption:(e,r)=>et(J.driver,e,r),value:Q.values.driver})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(f.Z,{filterOptions:(0,c.D)({ignoreCase:!0,stringify:e=>{let{[e]:r}=n.nodes;return"".concat(r.name,"\n").concat(r.description)}}),getOptionDisabled:e=>A.every(r=>r.node!==e),getOptionLabel:e=>{let{[e]:r}=n.nodes;return r.name},id:J.node,label:"Node",noOptionsText:"No matching node",onChange:(e,r)=>{L(J.node,r,!0)},openOnFocus:!0,options:p.uuids,renderOption:(e,r)=>{let{[r]:i}=n.nodes;return(0,s.createElement)("li",{...e,key:"node-op-".concat(r)},(0,t.jsxs)(m.ZP,{alignItems:"center",container:!0,children:[(0,t.jsxs)(m.ZP,{item:!0,width:"70%",children:[(0,t.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:i.name}),(0,t.jsx)(l.KI,{inheritColour:!0,noWrap:!0,children:i.description})]}),(0,t.jsxs)(m.ZP,{item:!0,width:"30%",children:[(0,t.jsxs)(l.Ac,{inheritColour:!0,noWrap:!0,children:["CPU: ",i.cpu.cores.total," cores"]}),(0,t.jsxs)(l.Ac,{inheritColour:!0,noWrap:!0,children:["Memory:"," ",(0,h._d)(i.memory.available,{toUnit:"ibyte"})]})]})]}))},required:!0,value:Q.values.node})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(f.Z,{filterOptions:(0,c.D)({ignoreCase:!0,stringify:e=>{let{[e]:n}=r;return"".concat(e,"\n").concat(n)}}),getOptionLabel:e=>{let{[e]:n}=r;return n},id:J.os,label:"Optimize for OS",noOptionsText:"No OS that matches exactly; try finding a close match",onChange:(e,r)=>{L(J.os,r,!0)},openOnFocus:!0,options:Z.keys,renderOption:(e,n)=>{let{[n]:i}=r;return(0,s.createElement)("li",{...e,key:"os-op-".concat(n)},(0,t.jsxs)(d.Z,{width:"100%",children:[(0,t.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:i}),(0,t.jsx)(l.KI,{inheritColour:!0,noWrap:!0,children:n})]}))},required:!0,value:Q.values.os})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(P.Z,{count:1,messages:T})}),(0,t.jsx)(m.ZP,{item:!0,width:"100%",children:(0,t.jsx)(x.Z,{actions:[{background:"blue",children:"Provision",disabled:q,type:"submit"}]})})]})})]}),F]})},K=n(5499),J=()=>{let{data:e,loading:r}=(0,K.Z)("/server/lsos"),{altData:n,loading:i,validating:o}=(0,K.Z)("/server/provision",{mod:a,refreshInterval:5e3});return{form:(0,s.useMemo)(()=>[e,n].some(e=>!e)?(0,t.jsx)(u.Z,{type:"warning",children:"Failed to prepare resources for provision server."}):(0,t.jsx)(H,{lsos:e,resources:n}),[e,n]),loading:r||i,lsos:e,resources:n,validating:o}},$=()=>{let e=(0,s.useRef)(null),{form:r,loading:n,validating:a}=J(),u=(0,s.useCallback)(function(){var r;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null===(r=e.current)||void 0===r?void 0:r.setOpen(n)},[]);return{dialog:(0,s.useMemo)(()=>(0,t.jsx)(i.Js,{header:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.z,{children:"Provision a server"}),(0,t.jsx)(o.Z,{syncing:a})]}),loading:n,ref:e,showClose:!0,wide:!0,children:r}),[r,n,a]),setOpen:u}}},40657:function(e,r,n){var t=n(85893),s=n(67294),i=n(47177),o=n(29873);r.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initial:{actionProceedText:r="",content:n="",titleText:l="",...a}={}}=e,u=(0,s.useRef)(null),[c,d]=(0,s.useState)({actionProceedText:r,content:n,titleText:l}),m=(0,s.useCallback)(e=>d(r=>{let{loading:n,...t}=r;return{...t,loading:e}}),[]),h=(0,s.useCallback)(e=>{var r,n;return null==u?void 0:null===(n=u.current)||void 0===n?void 0:null===(r=n.setOpen)||void 0===r?void 0:r.call(null,e)},[]),p=(0,s.useCallback)((e,r)=>d({actionProceedText:"",content:(0,t.jsx)(o.Z,{...r}),showActionArea:!1,showClose:!0,titleText:e}),[]);return{confirmDialog:(0,s.useMemo)(()=>(0,t.jsx)(i.Z,{...a,...c,ref:u}),[c,a]),confirmDialogRef:u,setConfirmDialogLoading:m,setConfirmDialogOpen:h,setConfirmDialogProps:d,finishConfirm:p}}},2094:function(e,r,n){n.d(r,{Z:function(){return x}});var t=n(20512),s=n(18446),i=n.n(s),o=n(13218),l=n.n(o),a=n(47037),u=n.n(a),c=n(67294),d=n(16310),m=n(23279),h=n.n(m),p=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{wait:n=500,...t}=r;return h()(e,n,t)},v=n(46671);let g=(e,r,n)=>{let[t,...s]=u()(r)?r.split("."):r;if(!(t in e))return!1;let o=e[t],a=n[t];return l()(o)&&l()(a)&&s.length?g(o,s,a):!i()(o,a)};var x=e=>{let r=(0,c.useRef)({}),n=(0,c.useCallback)(e=>(0,t.u9)(r.current,e),[]),s=(0,c.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.current=(0,t.tP)(r.current,e,n)},[]),[i,o]=(0,c.useState)(!1),l=(0,t.TA)({...e}),a=(0,c.useCallback)(async function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];let[t]=r;s(t,!0),await l.setFieldValue(...r)},[l.setFieldValue,s]),m=(0,c.useCallback)(e=>g(l.values,e,l.initialValues),[l.initialValues,l.values]),h=(0,c.useMemo)(()=>{let e=p(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];l.handleChange(...r),o(!1)});return function(){for(var r=arguments.length,n=Array(r),t=0;t<r;t++)n[t]=arguments[t];o(!0);let[i]=n;u()(i)||s((i.target?i.target:i.currentTarget).name,!0),e(...n)}},[l.handleChange,s]),x=(0,c.useMemo)(()=>i||!l.dirty||!l.isValid||l.isValidating||l.isSubmitting,[i,l.dirty,l.isSubmitting,l.isValid,l.isValidating]),j=(0,c.useMemo)(()=>(0,v.Z)(l.errors,{skip:e=>!n(e)}),[l.errors,n]);return{changeFieldValue:a,disabledSubmit:x,formik:l,formikErrors:j,getFieldChanged:n,getFieldIsDiff:m,handleChange:h,setFieldChanged:s,validationSchemaHelpers:(0,c.useMemo)(()=>{if(!d.nN(e.validationSchema))return;let r=e.validationSchema.describe();return{description:r,required:e=>{if(!("fields"in r))return;let n=r.fields[e];if(n&&"optional"in n)return!n.optional}}},[e.validationSchema])}}},4615:function(e,r,n){n.d(r,{k:function(){return t}});let t=["B","KiB","MiB","GiB","TiB"].map(e=>({value:e}))}}]);