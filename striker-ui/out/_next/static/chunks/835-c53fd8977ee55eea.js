"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[835],{48801:function(e,r,t){var n=t(85893),s=t(21640),i=t(93454),o=t(77527),l=t(4989),a=t(1142),u=t(58219),c=t(35562),d=t(90642),m=t(96245),h=t(82492),p=t.n(h),g=t(67294),v=t(39971),x=t(17512),j=t(23852);let f=e=>(0,n.jsx)(s.Z,{in:!0,children:(0,n.jsx)(i.Z,{...e})}),b=(0,o.ZP)("ul")({padding:0}),Z=l.Z;r.Z=e=>{let{componentsProps:r,extendRenderInput:t,getGroupLabel:s,label:i,ListboxProps:o,messageBoxProps:l,renderGroup:h,renderInput:y,sx:O,...P}=e,k=(0,g.useMemo)(()=>p()({paper:{sx:{backgroundColor:v.s7,["& .".concat(a.Z.groupLabel)]:{backgroundColor:v.s7}}}},r),[r]),C=(0,g.useMemo)(()=>p()({sx:{["& .".concat(a.Z.option)]:{'&[aria-selected="true"]':{backgroundColor:v.lD,["&.".concat(a.Z.focused)]:{backgroundColor:v.lD}},["&.".concat(a.Z.focused)]:{backgroundColor:v.lD}}}},o),[o]),w=(0,g.useMemo)(()=>h||s&&(e=>(0,n.jsxs)("li",{children:[(0,n.jsx)(Z,{component:"div",className:a.Z.groupLabel,children:s(e.group)}),(0,n.jsx)(b,{className:a.Z.groupUl,children:e.children})]},e.key)),[s,h]),I=(0,g.useMemo)(()=>null!=y?y:e=>{let{fullWidth:r,InputProps:s,InputLabelProps:o,inputProps:l}=e,a={formControlProps:{fullWidth:r,ref:s.ref},inputLabelProps:o,inputProps:{className:s.className,endAdornment:s.endAdornment,inputProps:l,startAdornment:s.startAdornment},label:i};return null==t||t.call(null,a,e),(0,n.jsx)(j.Z,{...a})},[t,i,y]),G=(0,g.useMemo)(()=>p()({["& .".concat(u.Z.root," .").concat(a.Z.endAdornment)]:{right:"7px",["& .".concat(c.Z.root)]:{color:v.s7}}},O),[O]);return(0,n.jsxs)(d.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)(m.Z,{autoHighlight:!0,autoSelect:!0,PaperComponent:f,...P,ListboxProps:C,renderGroup:w,renderInput:I,slotProps:k,sx:G}),(0,n.jsx)(x.Z,{...l})]})}},37600:function(e,r,t){var n=t(85893),s=t(77527),i=t(33466),o=t(37906),l=t(67294),a=t(39971),u=t(18766);let c=(0,s.ZP)(i.Z)({["& .".concat(o.Z.paper)]:{backgroundColor:a.s7}});r.Z=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let[s]=r,{children:i,getItemDisabled:o,items:a={},muiMenuProps:d,onItemClick:m,open:h,renderItem:p}=s,g=(0,l.useMemo)(()=>Object.entries(a),[a]),v=(0,l.useMemo)(()=>g.map(e=>{let[r,t]=e;return(0,n.jsx)(u.Z,{disabled:null==o?void 0:o.call(null,r,t),onClick:function(){for(var e=arguments.length,n=Array(e),s=0;s<e;s++)n[s]=arguments[s];return null==m?void 0:m.call(null,r,t,...n)},children:null==p?void 0:p.call(null,r,t)},r)}),[o,m,g,p]);return(0,n.jsx)(c,{open:h,...d,children:i||v})}},52257:function(e,r,t){var n=t(85893),s=t(90642),i=t(13435),o=t(58219),l=t(39971),a=t(17512),u=t(23852),c=t(37628);let d=e=>{let{id:r,label:t,inputWithLabelProps:d,messageBoxProps:m,onChange:h,selectItems:p,selectWithLabelProps:g,value:v}=e;return(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"row","& > :first-child":{flexGrow:1},"& > :not(:last-child)":{marginRight:".5em"},["&:hover\n          .".concat(i.Z.root,"\n          .").concat(o.Z.root,"\n          .").concat(o.Z.notchedOutline)]:{borderColor:l.s7}},children:[(0,n.jsx)(u.Z,{id:r,label:t,onChange:h,value:v,...d}),(0,n.jsx)(c.Z,{formControlProps:{fullWidth:!1,sx:{minWidth:"min-content"}},id:"".concat(r,"-nested-select"),selectItems:p,...g})]}),(0,n.jsx)(a.Z,{...m})]})};d.defaultProps={inputWithLabelProps:void 0,messageBoxProps:void 0,selectWithLabelProps:void 0},r.Z=d},78025:function(e,r,t){t.d(r,{BQ:function(){return M},xJ:function(){return D},RN:function(){return U},Zd:function(){return R}});var n=t(85893),s=t(67294),i=t(45036),o=t(18573),l=t(57882),a=e=>{let{files:r,nodes:t,servers:n,storageGroups:s,subnodes:i}=e;return{files:r,nodes:Object.values(t).reduce((e,r)=>{let{memory:t,...n}=r;return e[r.uuid]={...n,memory:{allocated:BigInt(t.allocated),available:BigInt(t.available),system:BigInt(t.system),total:BigInt(t.total)}},e},{}),servers:Object.values(n).reduce((e,r)=>{let{memory:t,...n}=r;return e[r.uuid]={...n,memory:{total:BigInt(t.total)}},e},{}),storageGroups:Object.values(s).reduce((e,r)=>{let{usage:t,...n}=r;return e[r.uuid]={...n,usage:{free:BigInt(t.free),total:BigInt(t.total),used:BigInt(t.used)}},e},{}),subnodes:Object.values(i).reduce((e,r)=>{let{memory:t,...n}=r;return e[r.uuid]={...n,memory:{total:BigInt(t.total)}},e},{})}},u=t(29873),c=t(93362),d=t(90642),m=t(8506),h=t(54490),p=t(4615),g=t(42050),v=t(66389),x=t(48801),j=t(11100),f=t(18050),b=t(23852),Z=t(52257),y=t(12823),O=e=>{let{formikUtils:r,id:t,resources:i,scope:o}=e,{changeFieldValue:a,formik:u,handleChange:d}=r,g=(0,s.useMemo)(()=>{let e="disks.".concat(t),r="".concat(e,".size");return{size:r,unit:"".concat(r,".unit"),value:"".concat(r,".value"),storageGroup:"".concat(e,".storageGroup")}},[t]),v=(0,s.useMemo)(()=>({uuids:Object.keys(i.storageGroups)}),[i.storageGroups]),j=(0,s.useCallback)(e=>{let{[e]:r}=i.storageGroups,{[r.node]:t}=i.nodes;return{node:t,sg:r}},[i.nodes,i.storageGroups]),f=u.values.disks[t];return(0,n.jsxs)(m.ZP,{container:!0,spacing:"1em",children:[(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(y.Z,{input:(0,n.jsx)(Z.Z,{id:g.size,label:"Disk ".concat(t,": size"),inputWithLabelProps:{id:g.value,name:g.value},onChange:d,selectItems:p.k,selectWithLabelProps:{id:g.unit,name:g.unit,onChange:u.handleChange,value:f.size.unit},value:f.size.value})})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(x.Z,{filterOptions:(0,c.D)({ignoreCase:!0,stringify:e=>{let{node:r,sg:t}=j(e);return"".concat(t.name,"\n").concat(r.name)}}),getOptionDisabled:e=>o.current.every(r=>r.storageGroup!==e),getOptionLabel:e=>{let{node:r,sg:t}=j(e);return"".concat(t.name," (").concat(r.name,")")},id:g.storageGroup,isOptionEqualToValue:(e,r)=>e===r,label:"Disk ".concat(t,": storage group"),noOptionsText:"No matching storage group",onChange:(e,r)=>{a(g.storageGroup,r,!0)},openOnFocus:!0,options:v.uuids,renderOption:(e,r)=>{let{node:t,sg:i}=j(r);return(0,s.createElement)("li",{...e,key:"storage-group-op-".concat(r)},(0,n.jsxs)(m.ZP,{alignItems:"center",container:!0,children:[(0,n.jsxs)(m.ZP,{item:!0,xs:!0,children:[(0,n.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:i.name}),(0,n.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:t.name})]}),(0,n.jsx)(m.ZP,{item:!0,children:(0,n.jsxs)(l.Ac,{inheritColour:!0,noWrap:!0,children:[(0,h._d)(i.usage.free,{toUnit:"ibyte"})," free"]})})]}))},value:f.storageGroup})})]})},P=t(18541),k=e=>{let{resources:r}=e,t=(0,s.useMemo)(()=>Object.values(r.servers).sort((e,r)=>r.name.localeCompare(e.name,void 0,{numeric:!0})).reduce((e,r)=>(e[r.uuid]=r,e),{}),[r.servers]);return(0,n.jsx)(P.Z,{header:"Existing",listItems:t,listProps:{dense:!0,sx:{maxHeight:"calc(60vh - 12em)"}},renderListItem:(e,r)=>(0,n.jsx)(l.Ac,{children:r.name}),scroll:!0})},C=e=>{let{lsos:r,resources:t,values:i}=e,o=(0,s.useMemo)(()=>({ids:Object.keys(i.disks)}),[i.disks]),a=(0,s.useMemo)(()=>t.nodes[i.node],[t.nodes,i.node]);return(0,n.jsxs)(m.ZP,{container:!0,rowSpacing:"0.5em",children:[(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsxs)(l.Ac,{children:["Server ",(0,n.jsx)(l.Q0,{children:i.name})," will be created on node ",(0,n.jsx)(l.Q0,{children:a.name})," with the following properties:"]})}),(0,n.jsx)(m.ZP,{item:!0,width:"30%",children:(0,n.jsx)(l.Ac,{children:"CPU"})}),(0,n.jsx)(m.ZP,{item:!0,width:"70%",children:(0,n.jsxs)(l.Ac,{children:[(0,n.jsx)(l.Q0,{edge:"start",children:i.cpu.cores})," ","core(s) of ",(0,n.jsx)(l.Q0,{children:a.cpu.cores.total})," ","available"]})}),(0,n.jsx)(m.ZP,{item:!0,width:"30%",children:(0,n.jsx)(l.Ac,{children:"Memory"})}),(0,n.jsx)(m.ZP,{item:!0,width:"70%",children:(0,n.jsxs)(l.Ac,{children:[(0,n.jsxs)(l.Q0,{edge:"start",children:[i.memory.value," ",i.memory.unit]})," ","of"," ",(0,n.jsx)(l.Q0,{children:(0,h._d)(a.memory.available,{toUnit:"ibyte"})})," ","available"]})}),...o.ids.reduce((e,r)=>{let{[r]:s}=i.disks,o="disk-".concat(r,"-sum"),{[s.storageGroup]:a}=t.storageGroups;return e.push((0,n.jsx)(m.ZP,{item:!0,width:"30%",children:(0,n.jsxs)(l.Ac,{children:["Disk ",(0,n.jsx)(l.Q0,{children:r})]})},"".concat(o,"-label")),(0,n.jsx)(m.ZP,{item:!0,width:"70%",children:(0,n.jsxs)(l.Ac,{children:[(0,n.jsxs)(l.Q0,{edge:"start",children:[s.size.value," ",s.size.unit]})," ","of"," ",(0,n.jsx)(l.Q0,{children:(0,h._d)(a.usage.free,{toUnit:"ibyte"})})," ","free on ",(0,n.jsx)(l.Q0,{children:a.name})]})},"".concat(o,"-value"))),e},[]),(0,n.jsx)(m.ZP,{item:!0,width:"30%",children:(0,n.jsx)(l.Ac,{children:"Install ISO"})}),(0,n.jsx)(m.ZP,{item:!0,width:"70%",children:(0,n.jsx)(l.Ac,{children:(0,n.jsx)(l.Q0,{edge:"start",children:t.files[i.install].name})})}),(0,n.jsx)(m.ZP,{item:!0,width:"30%",children:(0,n.jsx)(l.Ac,{children:"Driver ISO"})}),(0,n.jsx)(m.ZP,{item:!0,width:"70%",children:(0,n.jsx)(l.Ac,{children:(0,n.jsx)(l.Q0,{edge:"start",children:i.driver?t.files[i.driver].name:"none"})})}),(0,n.jsx)(m.ZP,{item:!0,width:"30%",children:(0,n.jsx)(l.Ac,{children:"Optimize for"})}),(0,n.jsx)(m.ZP,{item:!0,width:"70%",children:(0,n.jsx)(l.Ac,{children:(0,n.jsx)(l.Q0,{edge:"start",children:r[i.os]})})})]})},w=t(16310),I=e=>w.Rx().min(1).max(e).required(),G=t(48313);let A=BigInt(104857600);var M=e=>(0,G.r)({max:e,min:A});let B=BigInt(0);var F=(e,r)=>{let t=e.map(e=>r.storageGroups[e.storageGroup]).reduce((e,r)=>(r.usage.free>e.free&&(e.free=r.usage.free),e),{free:B});return w.Ry({size:w.nK().when(["storageGroup"],e=>{let[n]=e,{[n]:s}=r.storageGroups;return s?M(s.usage.free):M(t.free)}),storageGroup:(0,G.uI)()})};let S=BigInt(65536);var D=e=>(0,G.r)({max:e,min:S}),U=(e,r)=>{let t;return t=r instanceof Array?r:Object.values(r),e&&(t=t.filter(r=>r.uuid!==e)),w.Z_().min(1).max(32).matches(/^[\w-]+$/,{message:"${path} can only contain alphanumeric, hyphen, and underscore characters"}).notOneOf(t.map(e=>e.name),"${path} already exists").required()},N=t(74178);let W=BigInt(0);var E=(e,r,t)=>{let n=e.map(e=>r.nodes[e.node]).reduce((e,r)=>{let{cpu:t,memory:n}=r;return t.cores.total>e.cpu.cores&&(e.cpu.cores=t.cores.total),n.available>e.memory.available&&(e.memory.available=n.available),e},{cpu:{cores:0},memory:{available:W}}),s=Object.keys(t);return w.Ry({cpu:w.Ry({cores:I(n.cpu.cores)}),disks:w.Vo(t=>w.Ry((0,N.Z)(t,F(e,r)))),driver:(0,G.uI)().notOneOf([w.iH("install")]).nullable(),install:(0,G.uI)().notOneOf([w.iH("driver")]).required(),memory:D(n.memory.available),name:U(null,r.servers),node:(0,G.uI)().oneOf(e.map(e=>e.node)).required(),os:w.Z_().oneOf(s)})},L=t(40657),z=t(2094),Q=e=>{let{lsos:r,resources:t}=e,o=(0,s.useContext)(i.MJ),a=(0,s.useMemo)(()=>({uuids:Object.keys(t.files)}),[t.files]),P=(0,s.useMemo)(()=>({uuids:Object.keys(t.nodes),values:Object.values(t.nodes)}),[t.nodes]),w=(0,s.useMemo)(()=>({keys:Object.keys(r).sort((e,r)=>r.localeCompare(e,void 0,{numeric:!0}))}),[r]),I=(0,s.useMemo)(()=>({uuids:Object.keys(t.storageGroups),values:Object.values(t.storageGroups)}),[t.storageGroups]),G=(0,s.useMemo)(()=>P.values.reduce((e,r)=>(r.storageGroups.forEach(t=>{e.push({node:r.uuid,storageGroup:t})}),e),[]),[P.values]),A=(0,s.useRef)(G),{confirmDialog:M,finishConfirm:B,setConfirmDialogProps:F,setConfirmDialogLoading:S,setConfirmDialogOpen:D}=(0,L.Z)(),U=(0,s.useMemo)(()=>E(A.current,t,r),[r,t]),N=(0,z.Z)({initialValues:{cpu:{cores:"2"},disks:{0:{size:{unit:"GiB",value:"1"},storageGroup:null}},driver:null,install:null,memory:{unit:"GiB",value:"1"},name:"",node:null,os:null},onSubmit:(e,s)=>{let{setSubmitting:i}=s;F({actionProceedText:"Provision",content:(0,n.jsx)(C,{lsos:r,resources:t,values:e}),onCancelAppend:()=>i(!1),onProceedAppend:()=>{let r;S(!0);let t=(0,h.Gh)(e.memory.value,{fromUnit:e.memory.unit,toUnit:"B"});if(!t){B("Error",{children:(0,n.jsx)(n.Fragment,{children:"Failed to convert memory to bytes."})});return}try{r=Object.keys(e.disks).map(r=>{let{[r]:t}=e.disks,{size:n,storageGroup:s}=t,i=(0,h.Gh)(n.value,{fromUnit:n.unit,toUnit:"B"});if(!i)throw Error("Failed to convert disk ".concat(r," size to bytes."));return{storageSize:i.value,storageGroupUUID:s}})}catch(e){B("Error",{children:(0,n.jsx)(n.Fragment,{children:e})});return}let s={serverName:e.name,cpuCores:Number(e.cpu.cores),memory:t.value,virtualDisks:r,installISOFileUUID:e.install,driverISOFileUUID:e.driver?e.driver:"",anvilUUID:e.node,optimizeForOS:e.os};v.Z.post("/server",s).then(()=>{B("Success",{children:(0,n.jsx)(n.Fragment,{children:"Provision server job registered."})}),null==o||o.setOpen(!1)}).catch(e=>{let r=(0,j.Z)(e);r.children=(0,n.jsxs)(n.Fragment,{children:["Failed to start provision server job. ",r.children]}),B("Error",r)})},titleText:"Provision ".concat(e.name,"?")}),D(!0)},validationSchema:U}),{changeFieldValue:W,disabledSubmit:Q,formik:T,formikErrors:V,getFieldChanged:R,handleChange:_}=N,q=(0,s.useMemo)(()=>({cpu:{cores:"cpu.cores"},driver:"driver",install:"install",memory:{unit:"memory.unit",value:"memory.value"},name:"name",node:"node",os:"os"}),[]),K=(0,s.useMemo)(()=>({ids:Object.keys(T.values.disks)}),[T.values.disks]);(0,s.useEffect)(()=>{A.current=[...G],T.values.node&&(A.current=A.current.filter(e=>e.node===T.values.node));let e=Number(T.values.cpu.cores);Number.isSafeInteger(e)&&(A.current=A.current.filter(r=>{let{[r.node]:n}=t.nodes;return n.cpu.cores.total>=e}));let r=(0,h.Gh)(T.values.memory.value,{fromUnit:T.values.memory.unit,toUnit:"B"});if(r){let e=BigInt(r.value);A.current=A.current.filter(r=>{let{[r.node]:n}=t.nodes;return n.memory.available>=e})}K.ids.forEach(e=>{let{size:r,storageGroup:n}=T.values.disks[e];if(n){let{[n]:e}=t.storageGroups;A.current=A.current.filter(r=>r.node===e.node)}let s=(0,h.Gh)(r.value,{fromUnit:r.unit,toUnit:"B"});if(s){let e=BigInt(s.value);A.current=A.current.filter(r=>{let{[r.storageGroup]:n}=t.storageGroups;return n.usage.free>=e})}})},[K.ids,T.values.cpu.cores,T.values.disks,T.values.memory.unit,T.values.memory.value,T.values.node,G,t.nodes,t.storageGroups]),(0,s.useEffect)(()=>{if(1===a.uuids.length){let[e]=a.uuids;[R(q.install),T.values.install].every(e=>!e)&&T.setFieldValue(q.install,e,!0)}let e=A.current.reduce((e,r)=>{let{node:t,storageGroup:n}=r;return e.nodes[t]=t,e.storageGroups[n]=n,e},{nodes:{},storageGroups:{}}),r=Object.keys(e.nodes);if(1===r.length){let[e]=r;[R(q.node),T.values.node].every(e=>!e)&&T.setFieldValue(q.node,e,!0)}let t=Object.keys(e.storageGroups);if(1===t.length){let[e]=t;K.ids.forEach(r=>{let t="disks.".concat(r,".storageGroup");[R(t),T.values.disks[r].storageGroup].every(e=>!e)&&T.setFieldValue(t,e,!0)})}},[q.install,q.node,K.ids,a.uuids,T,R]);let H=(0,s.useMemo)(()=>Array.from({length:P.values.reduce((e,r)=>Math.max(e,r.cpu.cores.total),0)},(e,r)=>String(r+1)),[P]),J=(0,s.useCallback)(e=>{let{[e]:r}=t.files;return r.name},[t.files]),$=(0,s.useMemo)(()=>(0,c.D)({ignoreCase:!0,stringify:e=>{let{[e]:r}=t.files;return r.name}}),[t.files]),X=(0,s.useCallback)((e,r,i)=>{let{[i]:o}=t.files,a=Object.values(o.locations).filter(e=>!e.ready),u=a.length?(0,n.jsxs)(n.Fragment,{children:["Syncing to"," ",a.map(e=>{let{subnode:r}=e;return t.subnodes[r].short}).join(", ")]}):(0,n.jsx)(n.Fragment,{children:"Ready"});return(0,s.createElement)("li",{...r,key:"".concat(e,"-op-").concat(i)},(0,n.jsxs)(d.Z,{width:"100%",children:[(0,n.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:o.name}),(0,n.jsx)(l.KI,{inheritColour:!0,noWrap:!0,children:u})]}))},[t.files,t.subnodes]),Y=(0,s.useMemo)(()=>{let e={};return[["file",a.uuids.length],["node",P.uuids.length],["storage group",I.uuids.length]].reduce((e,r)=>{let[t,s]=r;return s||(e[t]={children:(0,n.jsxs)(n.Fragment,{children:["No ",t," available yet. It will appear shortly after its creation."]})}),e},e),{entries:Object.entries(e),messages:e}},[a.uuids.length,P.uuids.length,I.uuids.length]);if(Y.entries.length){let{entries:e}=Y;return(0,n.jsx)(m.ZP,{container:!0,spacing:"1em",children:e.map(e=>{let[r,t]=e;return(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(u.Z,{type:"warning",...t})},"".concat(r,"-message"))})})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m.ZP,{container:!0,spacing:"1em",children:[(0,n.jsx)(m.ZP,{item:!0,width:"16em",children:(0,n.jsx)(k,{resources:t})}),(0,n.jsx)(m.ZP,{item:!0,xs:!0,children:(0,n.jsxs)(m.ZP,{component:"form",container:!0,onSubmit:e=>{e.preventDefault(),T.handleSubmit(e)},spacing:"1em",children:[(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(y.Z,{input:(0,n.jsx)(b.Z,{id:q.name,label:"Server name",name:q.name,onChange:_,value:T.values.name})})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(x.Z,{getOptionDisabled:e=>{let r=Number(e);return A.current.every(e=>{let{[e.node]:n}=t.nodes;return n.cpu.cores.total<r})},id:q.cpu.cores,label:"CPU cores",noOptionsText:"No node has the requested cores",onChange:(e,r)=>{W(q.cpu.cores,r,!0)},openOnFocus:!0,options:H,value:T.values.cpu.cores})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(y.Z,{input:(0,n.jsx)(Z.Z,{id:"memory",inputWithLabelProps:{id:q.memory.value,name:q.memory.value},label:"Memory",onChange:_,selectItems:p.k,selectWithLabelProps:{id:q.memory.unit,name:q.memory.unit,onChange:T.handleChange,value:T.values.memory.unit},value:T.values.memory.value})})}),K.ids.map(e=>(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(O,{formikUtils:N,id:e,resources:t,scope:A})},"disk-".concat(e,"-form"))),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(x.Z,{filterOptions:$,getOptionDisabled:e=>e===T.values.driver,getOptionLabel:J,id:q.install,label:"Install ISO",noOptionsText:"No matching ISO",onChange:(e,r)=>{W(q.install,r,!0)},openOnFocus:!0,options:a.uuids,renderOption:(e,r)=>X(q.install,e,r),value:T.values.install})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(x.Z,{filterOptions:$,getOptionDisabled:e=>e===T.values.install,getOptionLabel:J,id:q.driver,label:"Driver ISO",noOptionsText:"No matching ISO",onChange:(e,r)=>{W(q.driver,r,!0)},openOnFocus:!0,options:a.uuids,renderOption:(e,r)=>X(q.driver,e,r),value:T.values.driver})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(x.Z,{filterOptions:(0,c.D)({ignoreCase:!0,stringify:e=>{let{[e]:r}=t.nodes;return"".concat(r.name,"\n").concat(r.description)}}),getOptionDisabled:e=>A.current.every(r=>r.node!==e),getOptionLabel:e=>{let{[e]:r}=t.nodes;return r.name},id:q.node,label:"Node",noOptionsText:"No matching node",onChange:(e,r)=>{W(q.node,r,!0)},openOnFocus:!0,options:P.uuids,renderOption:(e,r)=>{let{[r]:i}=t.nodes;return(0,s.createElement)("li",{...e,key:"node-op-".concat(r)},(0,n.jsxs)(m.ZP,{alignItems:"center",container:!0,children:[(0,n.jsxs)(m.ZP,{item:!0,xs:!0,children:[(0,n.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:i.name}),(0,n.jsx)(l.KI,{inheritColour:!0,noWrap:!0,children:i.description})]}),(0,n.jsxs)(m.ZP,{item:!0,children:[(0,n.jsxs)(l.Ac,{inheritColour:!0,noWrap:!0,children:["CPU: ",i.cpu.cores.total," cores"]}),(0,n.jsxs)(l.Ac,{inheritColour:!0,noWrap:!0,children:["Memory:"," ",(0,h._d)(i.memory.available,{toUnit:"ibyte"})]})]})]}))},value:T.values.node})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(x.Z,{filterOptions:(0,c.D)({ignoreCase:!0,stringify:e=>{let{[e]:t}=r;return"".concat(e,"\n").concat(t)}}),getOptionLabel:e=>{let{[e]:t}=r;return t},id:q.os,label:"Optimize for OS",noOptionsText:"No OS that matches exactly; try finding a close match",onChange:(e,r)=>{W(q.os,r,!0)},openOnFocus:!0,options:w.keys,renderOption:(e,t)=>{let{[t]:i}=r;return(0,s.createElement)("li",{...e,key:"os-op-".concat(t)},(0,n.jsxs)(d.Z,{width:"100%",children:[(0,n.jsx)(l.Ac,{inheritColour:!0,noWrap:!0,children:i}),(0,n.jsx)(l.KI,{inheritColour:!0,noWrap:!0,children:t})]}))}})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(f.Z,{count:1,messages:V})}),(0,n.jsx)(m.ZP,{item:!0,width:"100%",children:(0,n.jsx)(g.Z,{actions:[{background:"blue",children:"Provision",disabled:Q,type:"submit"}]})})]})})]}),M]})},T=t(5499),V=()=>{let{data:e,loading:r}=(0,T.Z)("/server/lsos"),{altData:t,loading:i,validating:o}=(0,T.Z)("/server/provision",{mod:a,refreshInterval:5e3});return{form:(0,s.useMemo)(()=>[e,t].some(e=>!e)?(0,n.jsx)(u.Z,{type:"warning",children:"Failed to prepare resources for provision server."}):(0,n.jsx)(Q,{lsos:e,resources:t}),[e,t]),loading:r||i,lsos:e,resources:t,validating:o}},R=()=>{let e=(0,s.useRef)(null),{form:r,loading:t,validating:a}=V(),u=(0,s.useCallback)(function(){var r;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null===(r=e.current)||void 0===r?void 0:r.setOpen(t)},[]);return{dialog:(0,s.useMemo)(()=>(0,n.jsx)(i.Js,{header:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.z,{children:"Provision a server"}),(0,n.jsx)(o.Z,{syncing:a})]}),loading:t,ref:e,showClose:!0,wide:!0,children:r}),[r,t,a]),setOpen:u}}},18573:function(e,r,t){var n=t(85893),s=t(62549),i=t(77527),o=t(39971);let l=(0,i.ZP)(e=>{let{syncing:r,...t}=e;return(0,n.jsx)(s.Z,{...t})})(e=>{let{syncing:r}=e,t=o.UZ;return r&&(t=o.Ej),{color:t}});r.Z=l},40657:function(e,r,t){var n=t(85893),s=t(67294),i=t(47177),o=t(29873);r.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initial:{actionProceedText:r="",content:t="",titleText:l="",...a}={}}=e,u=(0,s.useRef)(null),[c,d]=(0,s.useState)({actionProceedText:r,content:t,titleText:l}),m=(0,s.useCallback)(e=>d(r=>{let{loading:t,...n}=r;return{...n,loading:e}}),[]),h=(0,s.useCallback)(e=>{var r,t;return null==u?void 0:null===(t=u.current)||void 0===t?void 0:null===(r=t.setOpen)||void 0===r?void 0:r.call(null,e)},[]),p=(0,s.useCallback)((e,r)=>d({actionProceedText:"",content:(0,n.jsx)(o.Z,{...r}),showActionArea:!1,showClose:!0,titleText:e}),[]);return{confirmDialog:(0,s.useMemo)(()=>(0,n.jsx)(i.Z,{...a,...c,ref:u}),[c,a]),confirmDialogRef:u,setConfirmDialogLoading:m,setConfirmDialogOpen:h,setConfirmDialogProps:d,finishConfirm:p}}},2094:function(e,r,t){t.d(r,{Z:function(){return v}});var n=t(20512),s=t(18446),i=t.n(s),o=t(13218),l=t.n(o),a=t(47037),u=t.n(a),c=t(67294),d=t(23279),m=t.n(d),h=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{wait:t=500,...n}=r;return m()(e,t,n)},p=t(46671);let g=(e,r,t)=>{let[n,...s]=u()(r)?r.split("."):r;if(!(n in e))return!1;let o=e[n],a=t[n];return l()(o)&&l()(a)&&s.length?g(o,s,a):!i()(o,a)};var v=e=>{let r=(0,c.useRef)({}),t=(0,c.useCallback)(e=>(0,n.u9)(r.current,e),[]),s=(0,c.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.current=(0,n.tP)(r.current,e,t)},[]),[i,o]=(0,c.useState)(!1),l=(0,n.TA)({...e}),a=(0,c.useMemo)(()=>{let e=h(function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];l.handleChange(...r),o(!1)});return function(){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];o(!0);let[i]=t;u()(i)||s((i.target?i.target:i.currentTarget).name,!0),e(...t)}},[l.handleChange,s]),d=(0,c.useCallback)(e=>g(l.values,e,l.initialValues),[l.initialValues,l.values]),m=(0,c.useCallback)(async function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let[n]=r;s(n,!0),await l.setFieldValue(...r)},[l.setFieldValue,s]),v=(0,c.useMemo)(()=>i||!l.dirty||!l.isValid||l.isValidating||l.isSubmitting,[i,l.dirty,l.isSubmitting,l.isValid,l.isValidating]),x=(0,c.useMemo)(()=>(0,p.Z)(l.errors,{skip:e=>!t(e)}),[l.errors,t]);return{changeFieldValue:m,disabledSubmit:v,formik:l,formikErrors:x,getFieldChanged:t,getFieldIsDiff:d,handleChange:a,setFieldChanged:s}}},4615:function(e,r,t){t.d(r,{k:function(){return n}});let n=["B","KiB","MiB","GiB","TiB"].map(e=>({value:e}))}}]);