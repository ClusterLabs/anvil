"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[215],{2690:(e,n,l)=>{l.d(n,{pO:()=>z,lN:()=>L,i:()=>_,wL:()=>V});var r=l(37876),t=l(48504),o=l(92156),s=l(49209),i=l(34713),c=l(12981),a=l(77018),u=l(54773),d=l(18847),h=l.n(d),f=l(14232),m=l(49948),v=l(22481);let x="0xffe3",p="0xffe9",j=[{keys:"Ctrl + Alt + Delete",scans:[]},{keys:"Ctrl + Alt + F1",scans:[x,p,"0xffbe"]},{keys:"Ctrl + Alt + F2",scans:[x,p,"0xffbf"]},{keys:"Ctrl + Alt + F3",scans:[x,p,"0xffc0"]},{keys:"Ctrl + Alt + F4",scans:[x,p,"0xffc1"]},{keys:"Ctrl + Alt + F5",scans:[x,p,"0xffc2"]},{keys:"Ctrl + Alt + F6",scans:[x,p,"0xffc3"]},{keys:"Ctrl + Alt + F7",scans:[x,p,"0xffc4"]},{keys:"Ctrl + Alt + F8",scans:[x,p,"0xffc5"]},{keys:"Ctrl + Alt + F9",scans:[x,p,"0xffc6"]}];var g=l(74503),A=l(72015),b=l(23437),C=l(98513),y=l(79982),w=l(51677);let k=()=>{let e=(0,f.useRef)(!0);return e.current?(e.current=!1,!0):e.current},F="FullSize",M={displayBox:"".concat(F,"-displayBox"),spinnerBox:"".concat(F,"-spinnerBox")},B=(0,u.Ay)("div")(()=>({["& .".concat(M.displayBox)]:{width:"75vw",height:"75vh"},["& .".concat(M.spinnerBox)]:{flexDirection:"column",width:"75vw",height:"75vh",alignItems:"center",justifyContent:"center"}})),I=h()(()=>Promise.all([l.e(346),l.e(285)]).then(l.bind(l,83285)),{loadableGenerated:{webpack:()=>[83285]},ssr:!1}),S={1e3:"in-use by another process?",1006:"destination is down?"},P=(e,n)=>"ws://".concat(e,"/ws/server/vnc/").concat(n),z=function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let[u]=n,{node:d,onClickCloseButton:h,server:x,vncReconnectTimerStart:p=3}=u,[F]=(0,m.lT)(["suiapi.vncerror.".concat(x.uuid)]),z=k(),[E,R]=(0,f.useState)(null),[T,W]=(0,f.useState)(void 0),[q,H]=(0,f.useState)(!1),[N,O]=(0,f.useState)(!1),[D,_]=(0,f.useState)(),[G,K]=(0,f.useState)(),[L,V]=(0,f.useState)(p),J=(0,f.useRef)(null),Q=(0,f.useRef)(null),U=e=>{R(e.currentTarget)},X=e=>{if(J.current){if(e.length){for(let n=0;n<=e.length-1;n+=1)J.current.sendKey(e[n],1);for(let n=e.length-1;n>=0;n-=1)J.current.sendKey(e[n],0)}else J.current.sendCtrlAltDel();R(null)}},Z=(0,f.useCallback)(()=>{H(!0),O(!1),W({url:P(window.location.host,x.uuid)})},[x.uuid]),$=(0,f.useCallback)(()=>{(null==J?void 0:J.current)&&(J.current.disconnect(),J.current=null),W(void 0)},[]),Y=(0,f.useCallback)(()=>{$(),Z()},[Z,$]),ee=(0,f.useCallback)(()=>{let e=setInterval(()=>{V(n=>{let l=n-1;return l<1&&clearInterval(e),l})},1e3)},[]),en=(0,f.useCallback)(()=>{H(!1)},[]),el=(0,f.useCallback)(e=>{let{clean:n}=e.detail;n||(H(!1),O(!0),ee())},[ee]),er=(0,f.useCallback)(e=>{if(!e)return void _(void 0);let{code:n,reason:l}=e,r="ws: ".concat(n),t=S[n];t&&(r+=" (".concat(t,")")),l&&(r+=", ".concat(l)),_(r);let o=F["suiapi.vncerror.".concat(x.uuid)];if(!o)return void K(void 0);let{code:s,message:i}=o;K("api: ".concat(s,", ").concat(i))},[F,x.uuid]),et=(0,f.useMemo)(()=>!q&&!N,[q,N]),eo=(0,f.useMemo)(()=>(0,r.jsx)(c.A,{children:(0,r.jsx)(v.A,{onClick:()=>{var e;null==(e=Q.current)||e.requestFullscreen()},children:(0,r.jsx)(s.A,{})})}),[]),es=(0,f.useMemo)(()=>(0,r.jsxs)(c.A,{children:[(0,r.jsx)(v.A,{onClick:U,children:(0,r.jsx)(i.A,{})}),(0,r.jsx)(g.A,{open:!!E,slotProps:{menu:{anchorEl:E,keepMounted:!0,onClose:()=>R(null)}},children:j.map(e=>{let{keys:n,scans:l}=e;return(0,r.jsx)(A.A,{onClick:()=>X(l),children:(0,r.jsx)(a.A,{variant:"subtitle1",children:n})},n)})})]}),[E]),ei=(0,f.useMemo)(()=>(0,r.jsx)(c.A,{children:(0,r.jsx)(v.A,{onClick:function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];$(),null==h||h.call(null,...n)},children:(0,r.jsx)(t.A,{})})}),[$,h]),ec=(0,f.useMemo)(()=>(0,r.jsx)(c.A,{children:(0,r.jsx)(v.A,{onClick:()=>{window&&($(),window.location.assign("/"))},children:(0,r.jsx)(o.A,{})})}),[$]),ea=(0,f.useMemo)(()=>(0,r.jsxs)(r.Fragment,{children:[eo,es,(0,r.jsx)(C.A,{node:d,server:x}),ec,ei]}),[eo,es,d,ec,x,ei]);return(0,f.useEffect)(()=>{0===L&&(V(p),Y())},[Y,L,p]),(0,f.useEffect)(()=>{z&&Z()},[Z,z]),(0,r.jsxs)(b.Zk,{children:[(0,r.jsxs)(b.aO,{children:[(0,r.jsx)(w.HM,{text:"Server: ".concat(x.name)}),ea]}),(0,r.jsxs)(B,{children:[(0,r.jsx)(c.A,{display:et?"flex":"none",className:M.displayBox,children:(0,r.jsx)(I,{onConnect:en,onDisconnect:el,onWsClose:er,rfb:J,rfbConnectArgs:T,rfbScreen:Q})}),!et&&(0,r.jsxs)(c.A,{display:"flex",className:M.spinnerBox,textAlign:"center",children:[q&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.HM,{children:["Connecting to ",x.name,"."]}),(0,r.jsx)(y.A,{})]}),N&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.HM,{children:"Can't connect to the server."}),(0,r.jsx)(w.a3,{children:G}),(0,r.jsx)(w.a3,{children:D}),(0,r.jsxs)(w.HM,{mt:".5em",children:["Retrying in ",L,"."]})]})]})]})]})};var E=l(56744),R=l(73460),T=l(86250),W=l(52076),q=l.n(W),H=l(50046),N=l.n(H),O=l(90890),D=l(37422);let _=(0,u.Ay)(c.A)({alignItems:"center",display:"flex",justifyContent:"center",margin:".2em",overflow:"hidden",position:"relative"});var G=l(71603),K=l(59664);let L=function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let[t]=n,{onClick:o,server:s,slotProps:i,slots:a}=t,{href:u="/server?name=".concat(s.name,"&view=vnc")}=t,{data:d,loading:h}=(0,K.A)("/server/".concat(s.uuid,"?ss=1"),{refreshInterval:6e4}),m=null==d?void 0:d.screenshot,v=null==d?void 0:d.timestamp,x=(0,G.tB)(),p=(0,f.useMemo)(()=>!!v&&!(0,G.HV)(v,300),[v]),j=(0,f.useMemo)(()=>{var e;return null!=(e=null==a?void 0:a.screenshotBox)?e:(0,r.jsx)(_,{})},[null==a?void 0:a.screenshotBox]),g=(0,f.useMemo)(()=>({...null==i?void 0:i.screenshotBox}),[null==i?void 0:i.screenshotBox]),A=(0,f.useMemo)(()=>{let e,n;if(s.jobs)return(0,f.cloneElement)(j,g,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.a3,{children:"Provisioning..."}),Object.values(s.jobs).map((e,n)=>{let{peer:l,progress:t,uuid:o}=e;return(0,r.jsx)(D.A,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(7em - ".concat(1.5*n,"em)"),sx:{opacity:l?.6:void 0,["& .".concat(R.A.circle)]:{strokeLinecap:"round"}},thickness:3},underline:{thickness:+!t}},value:t},"".concat(o,"-progress"))})]}));if(h)return(0,f.cloneElement)(j,g,(0,r.jsx)(y.A,{mt:0}));if("running"!==s.state)return(0,f.cloneElement)(j,g,(0,r.jsx)(E.A,{sx:{color:O.XS,height:"100%",width:"auto"}}));let l="1";if(v&&p){l="0.4";let{unit:n,value:t}=(0,G.vk)(x-v);e=(0,r.jsxs)(w.a3,{position:"absolute",children:["Updated ~",t," ",n," ago"]})}let t=null==i?void 0:i.screenshot;return t&&({sx:n,...t}=t),(0,f.cloneElement)(j,g,(0,r.jsx)(c.A,{alt:"".concat(q()(s.state),". Preview unavailable"),component:"img",src:"data:image;base64,".concat(m),sx:N()({color:O.Qu,fontFamily:"Roboto Condensed",height:m?"100%":"auto",opacity:l,width:"auto"},n),...t}),e)},[h,x,m,s.jobs,s.state,null==i?void 0:i.screenshot,p,v,j,g]);return(0,f.useMemo)(()=>{let e,n=!!s.jobs,l=null==i?void 0:i.button;return l&&({sx:e,...l}=l),(0,f.createElement)(T.A,{disabled:n,href:u,onClick:o,sx:N()({padding:0,width:"calc(100% - 0em)"},e),...l},A)},[A,o,u,s.jobs,null==i?void 0:i.button])},V=function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let[t]=n,{children:o,getHeader:s=e=>{let{name:n}=e;return(0,r.jsx)(w.a3,{children:n})},server:i,showControls:c=!0,slotProps:a}=t;return(0,r.jsxs)(b.t$,{mb:0,mt:0,...null==a?void 0:a.panel,children:[(0,r.jsxs)(b.WJ,{...null==a?void 0:a.header,children:[s(i),c&&(0,r.jsx)(C.A,{node:i.anvil,server:i,slotProps:{button:{slotProps:{button:{icon:{size:"small"}}}}}})]}),o]})}},44981:(e,n,l)=>{l.d(n,{A:()=>t});let r=e=>{let{free:n,size:l,used:r,...t}=e,o=BigInt(0),s=BigInt(0),i=BigInt(0);try{o=BigInt(n),s=BigInt(l),i=r?BigInt(r):s-o}catch(e){}return{...t,free:o,size:s,used:i}},t=e=>{let{storage:n,...l}=e,t=Object.values(n.volumeGroups).reduce((e,n)=>(e[n.uuid]=r(n),e),{}),o=r(n.volumeGroupTotals);return{...l,storage:{volumeGroups:t,volumeGroupTotals:o}}}},46274:(e,n,l)=>{l.d(n,{A:()=>s});var r=l(37876),t=l(23934),o=l(5806);let s=function(e,n,l){var s,i;let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{body:a,description:u,messages:d,method:h="put",onCancel:f,onFail:m,onProceed:v,onSuccess:x,dangerous:p=/delete/i.test(null!=(s=null==d?void 0:d.proceed)?s:"")}=c;e.confirm.prepare({actionProceedText:null!=(i=null==d?void 0:d.proceed)?i:"Confirm",content:u,onCancelAppend:()=>{null==f||f.call(null)},onProceedAppend:()=>{e.confirm.loading(!0),null==v||v.call(null),t.A.request({data:a,method:h,url:n}).then(()=>{e.confirm.finish("Success",{children:null==d?void 0:d.success}),null==x||x.call(null)}).catch(n=>{let l=(0,o.A)(n);l.children=(0,r.jsxs)(r.Fragment,{children:[null==d?void 0:d.fail," ",l.children]}),e.confirm.finish("Error",l),null==m||m.call(null)})},proceedColour:p?"red":void 0,titleText:l}),e.confirm.open(!0)}},91322:(e,n,l)=>{l.d(n,{A:()=>r});let r=e=>{let{allocated:n,available:l,reserved:r,total:t}=e,o=BigInt(n),s=BigInt(l);return{allocated:o,available:s,reserved:BigInt(r),total:BigInt(t)}}},98513:(e,n,l)=>{l.d(n,{A:()=>j});var r=l(37876),t=l(56826),o=l(12981),s=l(64410),i=l(14232),c=l(50046),a=l.n(c),u=l(53198),d=l(14732),h=l(74503);let f=function(){for(var e,n,l,s,c,f=arguments.length,m=Array(f),v=0;v<f;v++)m[v]=arguments[v];let[x]=m,{children:p,onClick:j,onItemClick:g,slotProps:A,variant:b="icon",...C}=x,[y,w]=(0,i.useState)(null),k=(0,i.useMemo)(()=>!!y,[y]),F=(0,i.useMemo)(()=>{if(p)return p;if("icon"===b){var e,n;return(0,r.jsx)(t.A,{fontSize:null==A||null==(n=A.button)||null==(e=n.icon)?void 0:e.size})}return"Options"},[p,null==A||null==(n=A.button)||null==(e=n.icon)?void 0:e.size,b]),M=(0,i.useCallback)(function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let{0:{currentTarget:r}}=n;return w(r),null==j?void 0:j.call(null,...n)},[j]),B=(0,i.useMemo)(()=>{var e,n;return"contained"===b?(0,r.jsx)(u.A,{onClick:M,...null==A||null==(n=A.button)?void 0:n.contained,children:F}):(0,r.jsx)(d.A,{onClick:M,...null==A||null==(e=A.button)?void 0:e.icon,children:F})},[M,F,null==A||null==(l=A.button)?void 0:l.contained,null==A||null==(s=A.button)?void 0:s.icon,b]),I=(0,i.useCallback)(function(e,n){for(var l=arguments.length,r=Array(l>2?l-2:0),t=2;t<l;t++)r[t-2]=arguments[t];return w(null),null==g?void 0:g.call(null,e,n,...r)},[g]),S=(0,i.useMemo)(()=>{var e;return a()({menu:{anchorEl:y,keepMounted:!0,onClose:()=>w(null)}},null==A||null==(e=A.menu)?void 0:e.slotProps)},[y,null==A||null==(c=A.menu)?void 0:c.slotProps]);return(0,r.jsxs)(o.A,{children:[B,(0,r.jsx)(h.A,{onItemClick:I,open:k,...C,...null==A?void 0:A.menu,slotProps:S})]})};var m=l(30198),v=l(46274),x=l(51677),p=l(30764);let j=function(){for(var e,n,l,c,a=arguments.length,d=Array(a),h=0;h<a;h++)d[h]=arguments[h];let[j]=d,{node:g,server:A,slotProps:b}=j,{confirmDialog:C,setConfirmDialogLoading:y,setConfirmDialogOpen:w,setConfirmDialogProps:k,finishConfirm:F}=(0,p.A)(),M=(0,i.useRef)({add:{open:()=>null},confirm:{finish:F,loading:y,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return w(e)},prepare:k},edit:{open:()=>null}}),B=(0,i.useMemo)(()=>"shut off"===A.state,[A.state]),I=(0,i.useMemo)(()=>"provisioning"===A.state,[A.state]),S=(0,i.useMemo)(()=>{let e={server:{disabled:()=>I,href:()=>"/server?name=".concat(A.name),render:()=>(0,r.jsx)(x.a3,{inheritColour:!0,noWrap:!0,children:"Manage server"})},node:{href:()=>"/anvil?name=".concat(g.name),render:()=>(0,r.jsxs)(x.a3,{inheritColour:!0,noWrap:!0,children:["On node: ",g.name]})},"subheader-power":{render:()=>(0,r.jsx)(m.A,{orientation:"horizontal",sx:{margin:".4em 0"}})}};return e["power on"]={disabled:()=>!B,onClick:()=>{(0,v.A)(M.current,"/command/start-server/".concat(A.uuid),"Power on server ".concat(A.name,"?"),{description:(0,r.jsx)(x.a3,{children:"This is equal to pushing the power button."}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register power on job on ",A.name,"."]}),proceed:"Power on",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered power on job on ",A.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.a3,{inheritColour:!0,noWrap:!0,children:"Power on"})},e.reset={disabled:()=>B,onClick:()=>{(0,v.A)(M.current,"/server/".concat(A.uuid,"/reset"),"Reset server ".concat(A.name,"?"),{dangerous:!0,description:(0,r.jsxs)(s.Ay,{container:!0,spacing:"1em",children:[(0,r.jsx)(s.Ay,{item:!0,width:"100%",children:(0,r.jsx)(x.a3,{children:"This is equal to holding the power button to force shut down, followed by pushing the power button again to turn the machine back on."})}),(0,r.jsx)(s.Ay,{item:!0,width:"100%",children:(0,r.jsx)(x.a3,{children:"Reset is usually used to access the boot menu when you've missed it in the live VNC connection."})})]}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register reset job on ",A.name,"."]}),proceed:"Reset",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered reset join on ",A.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.a3,{color:u.S.red,inheritColour:!0,noWrap:!0,children:"Reset"})},e["power off"]={disabled:()=>B,onClick:()=>{(0,v.A)(M.current,"/command/stop-server/".concat(A.uuid),"Power off server ".concat(A.name,"?"),{description:(0,r.jsx)(x.a3,{children:"This is equal to pushing the power button. If the server doesn't respond to the corresponding signals, you may have to manually shut it down."}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register power off job on ",A.name,"."]}),proceed:"Power off",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered power off job on ",A.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.a3,{inheritColour:!0,noWrap:!0,children:"Power off"})},e["force off"]={disabled:()=>B,onClick:()=>{(0,v.A)(M.current,"/command/stop-server/".concat(A.uuid,"?force=1"),"Force off server ".concat(A.name,"?"),{dangerous:!0,description:(0,r.jsx)(x.a3,{children:"This is equal to pulling the power cord, which may cause data loss or system corruption."}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register force off job on ",A.name,"."]}),proceed:"Force off",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered force off job on ",A.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.a3,{color:u.S.red,inheritColour:!0,noWrap:!0,children:"Force off"})},e},[g.name,B,I,A.name,A.uuid]);return(0,r.jsxs)(o.A,{children:[(0,r.jsx)(f,{getItemDisabled:(e,n)=>{var l;return null==(l=n.disabled)?void 0:l.call(null,e,n)},getItemHref:(e,n)=>{var l;return null==(l=n.href)?void 0:l.call(null,e,n)},items:S,onItemClick:(e,n)=>{var l;return null==(l=n.onClick)?void 0:l.call(null,e,n)},renderItem:(e,n)=>n.render(e,n),...null==b?void 0:b.button,children:(0,r.jsx)(t.A,{fontSize:null==b||null==(c=b.button)||null==(l=c.slotProps)||null==(n=l.button)||null==(e=n.icon)?void 0:e.size})}),C]})}}}]);