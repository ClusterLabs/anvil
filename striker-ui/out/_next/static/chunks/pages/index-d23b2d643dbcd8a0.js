(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(67809)}])},82777:function(e,t,n){"use strict";var s=n(85893),i=n(67294),r=n(99514),c=n(14440);t.Z=e=>{let{calculateItemBreakpoints:t=()=>({xs:1}),layout:n,wrapperBoxProps:l,...a}=e,o=(0,i.useMemo)(()=>Object.entries(n).map((e,n)=>{let[s,c]=e;return c?(0,i.createElement)(r.ZP,{...t(n,s),key:s,item:!0,...c}):void 0}),[t,n]);return(0,s.jsx)(c.Z,{...l,children:(0,s.jsx)(r.ZP,{container:!0,...a,children:o})})}},86549:function(e,t,n){"use strict";var s=n(85893),i=n(11632),r=n(77574),c=n(77831),l=n(56903);t.Z=e=>{let{children:t,sx:n,...a}=e;return(0,s.jsx)(r.Z,{underline:"hover",variant:"subtitle1",...a,sx:{color:c.lD,textDecorationColor:c.s7,...n},children:(0,s.jsxs)(l.Z,{row:!0,children:[t,(0,s.jsx)(i.Z,{sx:{marginLeft:".3em"}})]})})}},77510:function(e,t,n){"use strict";var s=n(67294),i=n(8100),r=n(92230),c=n(54120);t.Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{baseUrl:n=r.Z,fetcher:l=c.Z,mod:a,...o}=t,{data:d,error:h,mutate:x}=(0,i.ZP)("".concat(n).concat(e),l,o),u=(0,s.useMemo)(()=>a&&d&&a(d),[d,a]),m=!h&&!d;return{altData:u,data:d,error:h,mutate:x,loading:m}}},59752:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=e=>e.reduce((e,t)=>{let{hostName:n,hostType:s,hostUUID:i}=t;return e[i]={name:n,type:s,uuid:i},e},{}),i=e=>e.reduce((e,t)=>{let{anvilDescription:n,anvilName:i,anvilUUID:r,hosts:c}=t;return e[r]={description:n,hosts:s(c),name:i,uuid:r},e},{})},67809:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return F}});var s=n(85893),i=n(31530),r=n(99514),c=n(14440),l=n(59505),a=n(9008),o=n.n(a),d=n(67294),h=n(92230),x=n(77831),u=n(84501),m=n(54490),j=e=>{let{anvil_name:t,anvil_state:n,anvil_uuid:s,hosts:i}=e;return{hosts:i.reduce((e,t)=>{let{host_name:n,host_uuid:s,maintenance_mode:i,server_count:r,state:c,state_percent:l}=t;return e[s]={name:n,maintenance:i,serverCount:r,state:c,stateProgress:l,uuid:s},e},{}),name:t,state:n,uuid:s}},v=n(92643),Z=n(97733),p=n(29535),g=n(56903),f=n(25137),_=n(38196),P=n(59278),w=n(77510);let S=BigInt(100),b={degraded:x.hM,not_ready:x.Wd,optimal:x.Ej},y={offline:x.Wd,online:x.Ej};var C=e=>{let{anvilUuid:t,refreshInterval:n=5e3}=e,{altData:i,loading:c}=(0,w.Z)("/anvil/".concat(t),{mod:j,refreshInterval:n}),{data:l,loading:a}=(0,w.Z)("/anvil/".concat(t,"/cpu"),{refreshInterval:n}),o=(0,d.useMemo)(()=>l&&Object.values(l.hosts),[l]),{altData:h,loading:C}=(0,w.Z)("/anvil/".concat(t,"/memory"),{mod:v.Z,refreshInterval:n}),{altData:M,loading:A}=(0,w.Z)("/anvil/".concat(t,"/store"),{mod:Z.Z,refreshInterval:n}),E=(0,d.useMemo)(()=>[c,a,C,A].some(e=>e),[c,a,C,A]),U=(0,d.useMemo)(()=>i&&(0,s.jsx)(P.$_,{inheritColour:!0,color:b[i.state],children:i.state}),[i]),N=(0,d.useMemo)(()=>i&&(0,s.jsx)(r.ZP,{alignItems:"center",columns:20,columnSpacing:"0.5em",container:!0,sx:{["& > .".concat(u.Z.item,":nth-child(-n + 4)")]:{marginBottom:"-.6em"}},children:Object.values(i.hosts).map(e=>{var t;let n;let{name:i,serverCount:c,state:l,stateProgress:a,uuid:o}=e,d=null!==(t=y[l])&&void 0!==t?t:x.s7,h=l;return["offline","online"].includes(l)?n=(0,s.jsx)(P.$_,{variant:"caption",children:c}):h="".concat(a,"%"),[(0,s.jsx)(r.ZP,{item:!0,xs:7,children:(0,s.jsx)(P.Ac,{variant:"caption",whiteSpace:"nowrap",children:i})},"".concat(o,"-state-label")),(0,s.jsx)(r.ZP,{item:!0,xs:5,children:(0,s.jsx)(P.$_,{inheritColour:!0,color:d,children:h})},"".concat(o,"-state")),(0,s.jsx)(r.ZP,{item:!0,xs:!0,children:(0,s.jsx)(p.Z,{sx:{marginBottom:"-.4em"}})},"".concat(o,"-divider")),(0,s.jsx)(r.ZP,{item:!0,width:"2.2em",children:n&&(0,s.jsx)(P.Ac,{variant:"caption",children:"Servers"})},"".concat(o,"-server-label")),(0,s.jsx)(r.ZP,{display:"flex",item:!0,justifyContent:"flex-end",width:"2em",children:n},"".concat(o,"-server-count"))]})}),[i]),I=(0,d.useMemo)(()=>l&&o&&(0,s.jsxs)(g.Z,{row:!0,spacing:".5em",children:[(0,s.jsx)(g.Z,{spacing:0,children:(0,s.jsxs)(P.Ac,{variant:"caption",whiteSpace:"nowrap",children:["Vendor"," ",(0,s.jsx)(P.Q0,{sx:{paddingRight:0},children:o[0].vendor})]})}),(0,s.jsx)(p.Z,{sx:{flexGrow:1}}),(0,s.jsxs)(r.ZP,{alignItems:"center",columns:2,container:!0,sx:{width:"3.7em",["& > .".concat(u.Z.item,":nth-child(-n + 2)")]:{marginBottom:"-.6em"}},children:[(0,s.jsx)(r.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{variant:"caption",children:"Cores"})}),(0,s.jsx)(r.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(P.$_,{variant:"caption",children:l.cores})}),(0,s.jsx)(r.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{variant:"caption",children:"Threads"})}),(0,s.jsx)(r.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(P.$_,{variant:"caption",children:l.threads})})]})]}),[l,o]),D=(0,d.useMemo)(()=>h&&(0,s.jsxs)(g.Z,{spacing:0,children:[(0,s.jsx)(g.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(P.Ac,{mb:"-.3em",variant:"caption",children:["Free",(0,s.jsx)(P.Q0,{children:(0,m._d)(h.total-(h.reserved+h.allocated),{toUnit:"ibyte"})}),"/",(0,s.jsx)(P.Q0,{sx:{paddingRight:0},children:(0,m._d)(h.total,{toUnit:"ibyte"})})]})}),(0,s.jsx)(_.Z,{thin:!0,value:{reserved:{value:Number(h.reserved*S/h.total)},allocated:{value:Number((h.reserved+h.allocated)*S/h.total),colour:{0:x.Ej,70:x.Wd,90:x.hM}}}})]}),[h]),O=(0,d.useMemo)(()=>M&&(0,s.jsxs)(g.Z,{spacing:0,children:[(0,s.jsx)(g.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(P.Ac,{mb:"-.3em",variant:"caption",children:["Total free",(0,s.jsx)(P.Q0,{children:(0,m._d)(M.totalFree,{toUnit:"ibyte"})}),"/",(0,s.jsx)(P.Q0,{sx:{paddingRight:0},children:(0,m._d)(M.totalSize,{toUnit:"ibyte"})})]})}),(0,s.jsx)(_.Z,{thin:!0,value:{allocated:{value:Number((M.totalSize-M.totalFree)*S/M.totalSize),colour:{0:x.Ej,70:x.Wd,90:x.hM}}}})]}),[M]);return E?(0,s.jsx)(f.Z,{mt:0}):(0,s.jsxs)(r.ZP,{alignItems:"center",columns:4,container:!0,sx:{["& > .".concat(u.Z.item,":nth-child(odd)")]:{alignItems:"center",display:"flex",height:"2.2em"}},children:[(0,s.jsx)(r.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Node"})}),(0,s.jsx)(r.ZP,{item:!0,xs:3,children:U}),(0,s.jsx)(r.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Subnodes"})}),(0,s.jsx)(r.ZP,{item:!0,xs:3,children:N}),(0,s.jsx)(r.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"CPU"})}),(0,s.jsx)(r.ZP,{item:!0,xs:3,children:I}),(0,s.jsx)(r.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Memory"})}),(0,s.jsx)(r.ZP,{item:!0,xs:3,children:D}),(0,s.jsx)(r.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Storage"})}),(0,s.jsx)(r.ZP,{item:!0,xs:3,children:O})]})},M=n(59752),A=n(82777),E=n(23930),U=e=>{let{refreshInterval:t=5e3}=e,{data:n,loading:i}=(0,w.Z)("/anvil",{refreshInterval:t}),r=(0,d.useMemo)(()=>n&&(0,M.Z)(n),[n]),c=(0,d.useMemo)(()=>r&&(0,s.jsx)(A.Z,{columns:{xs:1,sm:2,md:3,xl:4},layout:Object.values(r).reduce((e,n)=>{let{description:i,name:r,uuid:c}=n;return e["anvil-".concat(c)]={children:(0,s.jsxs)(E.Lg,{height:"100%",mv:0,children:[(0,s.jsx)(E.CH,{children:(0,s.jsxs)(P.Ac,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:[r,": ",i]})}),(0,s.jsx)(E.bc,{children:(0,s.jsx)(C,{anvilUuid:c,refreshInterval:t})})]})},e},{}),spacing:"1em",sx:{alignContent:"stretch",["& > .".concat(u.Z.item)]:{minWidth:"20em"}}}),[r,t]);return(0,s.jsxs)(E.s_,{children:[(0,s.jsx)(E.V9,{children:(0,s.jsx)(P.z,{children:"Nodes"})}),i?(0,s.jsx)(f.Z,{}):c]})},N=n(13089),I=n(54120),D=n(74717),O=n(65895),k=n(86549),T=n(15627),W=n(98337),B=n(41021);let $=e=>(0,s.jsx)(r.ZP,{alignContent:"stretch",columns:{xs:1,sm:2,md:3,xl:4},container:!0,spacing:"1em",children:e.map(e=>{let{anvil:{name:t,uuid:n},isScreenshotStale:i,loading:c,screenshot:l,name:a,state:o,uuid:d,timestamp:h}=e;return(0,s.jsx)(r.ZP,{item:!0,sx:{minWidth:"20em","& > div":{height:"100%",marginBottom:0,marginTop:0}},xs:1,children:(0,s.jsx)(N.M,{externalPreview:l,externalTimestamp:h,headerEndAdornment:[(0,s.jsx)(k.Z,{href:"/server?uuid=".concat(d,"&server_name=").concat(a,"&server_state=").concat(o),children:a},"server_list_to_server_".concat(d)),(0,s.jsx)(k.Z,{href:"/anvil?anvil_uuid=".concat(n),sx:{opacity:.7},children:t},"server_list_server_".concat(d,"_to_anvil_").concat(n))],hrefPreview:"/server?uuid=".concat(d,"&server_name=").concat(a,"&server_state=").concat(o,"&vnc=1"),isExternalLoading:c,isExternalPreviewStale:i,isFetchPreview:!1,isShowControls:!1,isUseInnerPanel:!0,serverState:o,serverUUID:d})},"".concat(d,"-preview"))})}),z=(e,t)=>""===t?{exclude:e,include:[]}:e.reduce((e,n)=>{let{name:s}=n;return s.includes(t)?e.include.push(n):e.exclude.push(n),e},{exclude:[],include:[]});var F=()=>{let[e,t]=(0,d.useState)([]),[n,r]=(0,d.useState)([]),[a,u]=(0,d.useState)([]),[m,j]=(0,d.useState)(""),[v,Z]=(0,d.useState)(!1),p=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let{exclude:s,include:i}=z(...t);r(s),u(i)},{loading:g}=(0,w.Z)("/server",{onSuccess:n=>{let s=Object.values(n).map(n=>{var i;let{uuid:r}=n,c=(null===(i=e.find(e=>{let{uuid:t}=e;return t===r}))||void 0===i?void 0:i.screenshot)||"",l={...n,loading:!0,screenshot:c,timestamp:0};return(0,I.Z)("".concat(h.Z,"/server/").concat(r,"?ss=1")).then(e=>{let{screenshot:n,timestamp:i}=e;0!==n.length&&(l.isScreenshotStale=!(0,B.Z$)(i,300),l.loading=!1,l.screenshot=n,l.timestamp=i,t([...s]))}).catch(()=>{l.isScreenshotStale=!0}).finally(()=>{l.loading=!1}),l});t(s),p(s,m)},refreshInterval:6e4});return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(o(),{children:(0,s.jsx)("title",{children:"Dashboard"})}),(0,s.jsx)(D.Z,{}),(0,s.jsx)(E.s_,{children:g?(0,s.jsx)(f.Z,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(E.V9,{sx:{marginBottom:"2em"},children:[(0,s.jsx)(P.z,{children:"Servers"}),(0,s.jsx)(O.Z,{onClick:()=>Z(!0),children:(0,s.jsx)(i.Z,{})}),(0,s.jsx)(T.Z,{placeholder:"Search by server name",onChange:t=>{let{target:{value:n}}=t;j(n),p(e,n)},sx:{minWidth:"16em"},value:m})]}),$(a),a.length>0&&(0,s.jsx)(l.Z,{sx:{backgroundColor:x.d}}),$(n)]})}),(0,s.jsx)(U,{}),(0,s.jsx)(W.Z,{dialogProps:{open:v},onClose:()=>{Z(!1)}})]})}}},function(e){e.O(0,[810,433,618,74,314,62,717,93,78,888,774,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);