(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(95911)}])},91905:function(e,n,t){"use strict";var s=t(85893),r=t(67294),i=t(8506),l=t(90642);n.Z=e=>{let{calculateItemBreakpoints:n=()=>({xs:1}),layout:t,wrapperBoxProps:c,...a}=e,o=(0,r.useMemo)(()=>Object.entries(t).map((e,t)=>{let[s,l]=e;return l?(0,r.createElement)(i.ZP,{...n(t,s),key:s,item:!0,...l}):void 0}),[n,t]);return(0,s.jsx)(l.Z,{...c,children:(0,s.jsx)(i.ZP,{container:!0,...a,children:o})})}},65716:function(e,n,t){"use strict";var s=t(85893),r=t(11825),i=t(61769),l=t(39971),c=t(5387);n.Z=e=>{let{children:n,sx:t,...a}=e;return(0,s.jsx)(i.Z,{underline:"hover",variant:"subtitle1",...a,sx:{color:l.lD,textDecorationColor:l.s7,...t},children:(0,s.jsxs)(c.Z,{row:!0,children:[n,(0,s.jsx)(r.Z,{sx:{marginLeft:".3em"}})]})})}},12823:function(e,n,t){"use strict";var s=t(67294),r=t(46315),i=t(56351);let l=(0,s.forwardRef)((e,n)=>{let{input:t,onChange:l=function(e){let{handlers:{base:n,origin:t}}=e;for(var s=arguments.length,r=Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];null==n||n.call(null,...r),null==t||t.call(null,...r)},onMount:c,onUnmount:a}=e,{props:o}=t,{valueKey:d,valueType:h}=(0,s.useMemo)(()=>{let{type:e}=o,n="value",t="string";return e===r.Z.checkbox&&(n="checked",t="boolean"),{valueKey:n,valueType:t}},[o]),{onChange:x,[d]:u,...m}=o,[j,Z]=(0,s.useState)(u),v=(0,s.useCallback)(e=>{let{target:{[d]:n}}=e;Z(i.Z[h](n))},[d,h]),p=(0,s.useCallback)(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return null==l?void 0:l.call(null,{handlers:{base:v,origin:x}},...n)},[v,x,l]);return(0,s.useEffect)(()=>(null==c||c.call(null),a),[]),(0,s.useEffect)(()=>{Z(u)},[u]),(0,s.useImperativeHandle)(n,()=>({get:()=>j,set:Z}),[j]),(0,s.cloneElement)(t,{...m,onChange:p,[d]:j})});l.displayName="UncontrolledInput",n.Z=l},39806:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var s=e=>e.reduce((e,n)=>{let{hostName:t,hostType:s,hostUUID:r,shortHostName:i}=n;return e[r]={name:t,short:i,type:s,uuid:r},e},{}),r=e=>e.reduce((e,n)=>{let{anvilDescription:t,anvilName:r,anvilUUID:i,hosts:l}=n;return e[i]={description:t,hosts:s(l),name:r,uuid:i},e},{})},56351:function(e,n){"use strict";n.Z={boolean:e=>!!e,number:e=>parseInt(String(e),10)||0,string:e=>String(e)}},95911:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ex}});var s=t(85893),r=t(90642),i=t(9008),l=t.n(i),c=t(24811),a=t(67294),o=t(8506),d=t(54490),h=t(39971),x=e=>{let{anvilStatus:n,anvil_name:t,anvil_uuid:s,hosts:r}=e;return{hosts:r.reduce((e,n)=>{let{host_name:t,host_uuid:s,maintenance_mode:r,server_count:i,state:l,state_percent:c}=n;return e[s]={name:t,maintenance:r,serverCount:i,state:l,stateProgress:c,uuid:s},e},{}),name:t,status:n,uuid:s}},u=t(22700),m=t(60665),j=t(82092),Z=t(5387),v=t(90209),p=t(55507),g=t(57882),f=t(29255),P=t(5499);let w=BigInt(100),b={offline:h.s7,optimal:h.Ej},y={offline:h.s7,optimal:h.Ej},_={offline:h.s7,online:h.Ej};var C=e=>{let{anvilUuid:n,refreshInterval:t=5e3}=e,{altData:r,loading:i}=(0,P.Z)("/anvil/".concat(n),{mod:x,refreshInterval:t}),{data:l,loading:C}=(0,P.Z)("/anvil/".concat(n,"/cpu"),{refreshInterval:t}),S=(0,a.useMemo)(()=>l&&Object.values(l.hosts),[l]),{altData:A,loading:k}=(0,P.Z)("/anvil/".concat(n,"/memory"),{mod:u.Z,refreshInterval:t}),{altData:M,loading:E}=(0,P.Z)("/anvil/".concat(n,"/store"),{mod:m.Z,refreshInterval:t}),I=(0,a.useMemo)(()=>[i,C,k,E].some(e=>e),[i,C,k,E]),N=(0,a.useMemo)(()=>{var e;if(!r)return;let n=null!==(e=b[r.status.system])&&void 0!==e?e:h.Wd;return(0,s.jsx)(g.$_,{inheritColour:!0,color:n,children:r.status.system})},[r]),W=(0,a.useMemo)(()=>{var e;let n;if(!r)return;let{drbd:t}=r.status;t.estimatedTimeToSync&&(n=(0,f.F6)(t.estimatedTimeToSync));let i=null!==(e=y[r.status.drbd.status])&&void 0!==e?e:h.Wd;return(0,s.jsxs)(g.$_,{inheritColour:!0,color:i,children:[r.status.drbd.status,n&&"(needs ~".concat(n,")")]})},[r]),O=(0,a.useMemo)(()=>r&&(0,s.jsx)(o.ZP,{columns:1,container:!0,children:Object.values(r.hosts).map(e=>{var n;let{name:t,serverCount:r,state:i,stateProgress:l,uuid:c}=e,a=null!==(n=_[i])&&void 0!==n?n:h.Wd,d=i;return["offline","online"].includes(i)||(d="".concat(i," (").concat(l,"%)")),(0,s.jsxs)(o.ZP,{alignItems:"center",columnSpacing:"0.5em",container:!0,sx:{},children:[(0,s.jsx)(o.ZP,{item:!0,xs:"auto",children:(0,s.jsx)(g.Ac,{variant:"caption",whiteSpace:"nowrap",children:t})}),(0,s.jsx)(o.ZP,{item:!0,xs:"auto",children:(0,s.jsx)(g.$_,{inheritColour:!0,color:a,children:d})}),(0,s.jsx)(o.ZP,{item:!0,xs:!0,children:(0,s.jsx)(j.Z,{})}),(0,s.jsx)(o.ZP,{item:!0,xs:"auto",children:(0,s.jsxs)(o.ZP,{alignItems:"center",columns:2,container:!0,width:"4em",children:[(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{variant:"caption",children:"Servers"})}),(0,s.jsx)(o.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(g.$_,{variant:"caption",children:r})})]})})]},"subnode-".concat(c))})}),[r]),U=(0,a.useMemo)(()=>l&&S&&(0,s.jsxs)(Z.Z,{row:!0,rowSpacing:".5em",children:[(0,s.jsxs)(g.Ac,{variant:"caption",whiteSpace:"nowrap",children:["Vendor"," ",(0,s.jsx)(g.Q0,{sx:{paddingRight:0},children:S[0].vendor})]}),(0,s.jsx)(j.Z,{sx:{flexGrow:1}}),(0,s.jsxs)(o.ZP,{alignItems:"center",columns:2,container:!0,width:"4em",children:[(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{variant:"caption",children:"Cores"})}),(0,s.jsx)(o.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(g.$_,{variant:"caption",children:l.cores})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{variant:"caption",children:"Threads"})}),(0,s.jsx)(o.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(g.$_,{variant:"caption",children:l.threads})})]})]}),[l,S]),z=(0,a.useMemo)(()=>A&&(0,s.jsxs)(Z.Z,{spacing:0,children:[(0,s.jsx)(Z.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(g.Ac,{mb:"-.3em",variant:"caption",children:["Free",(0,s.jsx)(g.Q0,{children:(0,d._d)(A.available,{toUnit:"ibyte"})}),"/",(0,s.jsx)(g.Q0,{sx:{paddingRight:0},children:(0,d._d)(A.total,{toUnit:"ibyte"})})]})}),(0,s.jsx)(p.Z,{thin:!0,value:{reserved:{value:Number(A.reserved*w/A.total)},allocated:{value:Number((A.reserved+A.allocated)*w/A.total),colour:{0:h.Ej,70:h.Wd,90:h.hM}}}})]}),[A]),D=(0,a.useMemo)(()=>M&&(0,s.jsxs)(Z.Z,{spacing:0,children:[(0,s.jsx)(Z.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(g.Ac,{mb:"-.3em",variant:"caption",children:["Total free",(0,s.jsx)(g.Q0,{children:(0,d._d)(M.totalFree,{toUnit:"ibyte"})}),"/",(0,s.jsx)(g.Q0,{sx:{paddingRight:0},children:(0,d._d)(M.totalSize,{toUnit:"ibyte"})})]})}),(0,s.jsx)(p.Z,{thin:!0,value:{allocated:{value:Number((M.totalSize-M.totalFree)*w/M.totalSize),colour:{0:h.Ej,70:h.Wd,90:h.hM}}}})]}),[M]);return I?(0,s.jsx)(v.Z,{mt:0}):(0,s.jsxs)(o.ZP,{alignItems:"center",columns:4,container:!0,sx:{["& > .".concat(c.Z.item,":nth-child(odd)")]:{alignItems:"center",display:"flex",height:"2.2em"}},children:[(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Node"})}),(0,s.jsx)(o.ZP,{item:!0,xs:3,children:N}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Replication"})}),(0,s.jsx)(o.ZP,{item:!0,xs:3,children:W}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Subnodes"})}),(0,s.jsx)(o.ZP,{item:!0,xs:3,children:O}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"CPU"})}),(0,s.jsx)(o.ZP,{item:!0,xs:3,children:U}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Memory"})}),(0,s.jsx)(o.ZP,{item:!0,xs:3,children:z}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Storage"})}),(0,s.jsx)(o.ZP,{item:!0,xs:3,children:D})]})},S=t(39806),A=t(91905),k=t(65716),M=t(65375),E=t(18573),I=e=>{let{refreshInterval:n=4e3}=e,{altData:t,loading:r,validating:i}=(0,P.Z)("/anvil",{mod:S.Z,refreshInterval:n}),l=(0,a.useMemo)(()=>t&&(0,s.jsx)(A.Z,{columns:{xs:1,md:2,lg:3,xl:4},layout:Object.values(t).reduce((e,t)=>{let{description:r,name:i,uuid:l}=t;return e["anvil-".concat(l)]={children:(0,s.jsxs)(M.Lg,{height:"100%",mv:0,children:[(0,s.jsxs)(M.CH,{children:[(0,s.jsx)(k.Z,{href:"/anvil?name=".concat(i),noWrap:!0,children:i}),(0,s.jsx)(g.Ac,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:r})]}),(0,s.jsx)(M.bc,{children:(0,s.jsx)(C,{anvilUuid:l,refreshInterval:n})})]})},e},{}),spacing:"1em",sx:{alignContent:"stretch",["& > .".concat(c.Z.item)]:{minWidth:"20em"}}}),[t,n]);return(0,s.jsxs)(M.s_,{children:[(0,s.jsxs)(M.V9,{children:[(0,s.jsx)(g.z,{children:"Nodes"}),(0,s.jsx)(E.Z,{syncing:i})]}),r?(0,s.jsx)(v.Z,{}):l]})},N=t(25436),W=t(86142),O=t(38855),U=t(44859),z=t(23279),D=t.n(z),T=t(46194),R=t(45328),$=t(37600),F=t(18766),B=t(29873),H=t(43463),Q=t(64860),L=t(77527),V=t(65625),X=t(48403),G=t.n(X),J=t(9968),K=t(45842),q=t(21758),Y=t(54420);let ee={running:"ok","shut off":"off",crashed:"error"},en=(0,L.ZP)(K.$x)(()=>({borderRadius:h.n_,height:"calc(".concat("3em"," * 0.8)"),width:"3em"})),et=(0,L.ZP)(K.$x)(()=>{let e="3.2em";return{height:e,margin:0,width:e}}),es=e=>{var n;return null!==(n=ee[e])&&void 0!==n?n:"warning"};var er=e=>{let n,t,i,l;let{servers:c,uuid:d}=e,h=c[d],x=(0,a.useMemo)(()=>"provisioning"===h.state,[h.state]),u=(0,a.useMemo)(()=>{let{jobs:e}=h;if(e)return(0,s.jsx)(et,{children:[...Object.values(e).map((e,n)=>{let{peer:t,progress:r,uuid:i}=e;return(0,s.jsx)(q.Z,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(2.8em - ".concat(1.5*n,"em)"),sx:{opacity:t?.6:void 0,["& .".concat(V.Z.circle)]:{strokeLinecap:"round"}},thickness:6},underline:{thickness:r?0:1}},value:r},"".concat(i,"-progress"))})]})},[h]);return x?(n=(0,s.jsx)(o.ZP,{item:!0,children:u}),i=(0,s.jsx)(g.Ac,{noWrap:!0,children:h.name}),l=(0,s.jsxs)(g.Ac,{noWrap:!0,children:[G()(h.state),"..."]})):(n=(0,s.jsx)(o.ZP,{alignSelf:"stretch",item:!0,children:(0,s.jsx)(J.Z,{colour:es(h.state)})}),t=(0,s.jsx)(K.MB,{server:h,slots:{screenshotBox:(0,s.jsx)(en,{})},slotProps:{screenshot:{sx:{fontSize:".6em"}}}}),i=(0,s.jsx)(k.Z,{href:"/server?name=".concat(h.name),noWrap:!0,children:h.name}),l=(0,s.jsx)(g.Ac,{noWrap:!0,children:G()(h.state)})),(0,s.jsxs)(o.ZP,{alignItems:"center",container:!0,spacing:"0.5em",children:[n,(0,s.jsx)(o.ZP,{item:!0,children:t}),(0,s.jsx)(o.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(o.ZP,{container:!0,children:[(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:i}),(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:l})]})}),(0,s.jsx)(o.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(k.Z,{href:"/anvil?name=".concat(h.anvil.name),noWrap:!0,children:h.anvil.name}),h.host&&(0,s.jsx)(g.Ac,{noWrap:!0,children:h.host.short})]})}),(0,s.jsx)(o.ZP,{item:!0,children:(0,s.jsx)(Y.Z,{iconButtonProps:{size:"small"},serverName:h.name,serverState:h.state,serverUuid:h.uuid})})]})},ei=e=>{let{groups:n,servers:t}=e,{altData:r,loading:i}=(0,P.Z)("/anvil",{mod:S.Z}),l=(0,a.useMemo)(()=>r?Object.entries(n).reduce((e,n,i,l)=>{let[c,a]=n;return a.length&&(a.forEach(n=>{e.push((0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(er,{anvils:r,servers:t,uuid:n})},"".concat(n,"-summary")))}),i+1!==l.length&&e.push((0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{orientation:"horizontal"})},"".concat(c,"-end")))),e},[]):[],[r,n,t]);return i?(0,s.jsx)(o.ZP,{container:!0,spacing:"1em",children:(0,s.jsx)(v.Z,{mt:0})}):(0,s.jsx)(o.ZP,{columns:{xs:1,md:2,lg:3,xl:4},container:!0,spacing:"1em",children:[...l]})};let el=(0,L.ZP)(K.$x)(e=>{let{theme:n}=e,t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return"calc(".concat(e," * 0.6)")};return{width:"100%",[n.breakpoints.up("xs")]:{height:t("100vw")},[n.breakpoints.up("sm")]:{height:t("50vw")},[n.breakpoints.up("md")]:{height:t("100vw / 3")},[n.breakpoints.up("lg")]:{height:t("25vw")},[n.breakpoints.up("xl")]:{height:t("100vw / 6")}}}),ec=e=>(0,s.jsx)(o.ZP,{item:!0,children:(0,s.jsx)(K.bC,{getHeader:e=>{let{anvil:n,jobs:t,name:r}=e;return(0,s.jsxs)(s.Fragment,{children:[t?(0,s.jsx)(g.Ac,{noWrap:!0,children:r}):(0,s.jsx)(k.Z,{href:"/server?name=".concat(r),noWrap:!0,children:r}),(0,s.jsx)(k.Z,{href:"/anvil?name=".concat(n.name),noWrap:!0,sx:{opacity:.7},children:n.name})]})},server:e,showControls:!e.jobs,children:(0,s.jsx)(K.MB,{server:e,slots:{screenshotBox:(0,s.jsx)(el,{})}})},"".concat(e.uuid,"-preview"))});var ea=e=>{let{groups:n,servers:t}=e,r=(0,a.useMemo)(()=>Object.entries(n).reduce((e,n,r,i)=>{let[l,c]=n;return c.length&&(c.forEach(n=>{let r=t[n];e.push((0,s.jsx)(o.ZP,{item:!0,xs:1,children:ec(r)},"".concat(n,"-panel")))}),r+1!==i.length&&e.push((0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{orientation:"horizontal"})},"".concat(l,"-end")))),e},[]),[n,t]);return(0,s.jsx)(o.ZP,{columns:{xs:1,sm:2,md:3,lg:4,xl:6},container:!0,spacing:"1em",children:r})},eo=t(12823);let ed=(e,n)=>{let t={match:[],none:[]};if(!e)return t;let s=Object.keys(e);return n?s.reduce((t,s)=>{let r=e[s],i=RegExp(n,"i"),l=JSON.stringify(r);return i.test(l)?t.match.push(s):t.none.push(s),t},t):t.none=s,t};var eh=()=>{let e;let[n,t]=(0,a.useState)(null),[i,l]=(0,a.useState)(),[c,d]=(0,a.useState)(!1),[x,u]=(0,a.useState)(""),{data:m,loading:Z,error:p,validating:f}=(0,P.Z)("/server",{refreshInterval:4e3,onSuccess:e=>{l(ed(e,x))}}),w=(0,a.useMemo)(()=>D()(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[,s=""]=n;u(s),l(ed(...n))},500),[]),b=(0,a.useMemo)(()=>{if(x&&(null==i||!i.match.length))return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(g.Ac,{noWrap:!0,children:"No match"})}),(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{orientation:"horizontal"})})]})},[null==i?void 0:i.match.length,x]);if(Z)return(0,s.jsx)(M.s_,{children:(0,s.jsx)(v.Z,{mt:0})});if(!m||!i)return(0,s.jsx)(M.s_,{children:(0,s.jsxs)(B.Z,{type:"warning",children:["Couldn't get the list of servers. ",null==p?void 0:p.message]})});let y="preferences.servers.view";return e="list"===localStorage.getItem(y)?(0,s.jsx)(ei,{groups:i,servers:m}):(0,s.jsx)(ea,{groups:i,servers:m}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(M.s_,{children:[(0,s.jsxs)(M.V9,{children:[(0,s.jsx)(g.z,{children:"Servers"}),(0,s.jsx)(E.Z,{syncing:f}),(0,s.jsxs)(r.Z,{sx:{["&.".concat(U.Z.root)]:{marginRight:".5em"}},children:[(0,s.jsx)(T.Z,{onClick:e=>{t(e.currentTarget)},startIcon:(0,s.jsx)(W.Z,{}),sx:{lineHeight:2},children:"View"}),(0,s.jsxs)($.Z,{muiMenuProps:{anchorEl:n,keepMounted:!0,onClose:()=>t(null)},open:!!n,children:[(0,s.jsx)(F.Z,{onClick:()=>{localStorage.setItem(y,"previews"),t(null)},children:(0,s.jsx)(g.Ac,{inheritColour:!0,children:"Previews"})}),(0,s.jsx)(F.Z,{onClick:()=>{localStorage.setItem(y,"list"),t(null)},children:(0,s.jsx)(g.Ac,{inheritColour:!0,children:"List"})})]})]}),(0,s.jsx)(R.Z,{mapPreset:"add",onClick:()=>{d(!0)}}),(0,s.jsx)(eo.Z,{input:(0,s.jsx)(H.Z,{onChange:e=>{let{value:n}=e.target;w(m,n)},startAdornment:(0,s.jsx)(O.Z,{sx:{color:h.d,marginRight:".4em"}}),sx:{width:"20em"}})})]}),(0,s.jsxs)(o.ZP,{container:!0,spacing:"1em",children:[b,(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:e})]})]}),(0,s.jsx)(Q.Z,{dialogProps:{open:c},onClose:()=>{d(!1)}})]})},ex=()=>(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(l(),{children:(0,s.jsx)("title",{children:"Dashboard"})}),(0,s.jsx)(N.Z,{}),(0,s.jsx)(eh,{}),(0,s.jsx)(I,{})]})}},function(e){e.O(0,[447,256,940,245,965,529,436,215,352,888,774,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);