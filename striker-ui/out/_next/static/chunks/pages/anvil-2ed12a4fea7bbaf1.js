(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{72315:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/anvil",function(){return n(3442)}])},84337:function(e,t,n){"use strict";var s=n(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:n="",...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.useState)({actionProceedText:e,content:t,titleText:n,...a})}},72094:function(e,t){"use strict";t.Z=(e,t,n)=>{let s;let{query:a}=e;if(void 0===n){let{[t]:e,...n}=a;s=n}else s={...a,[t]:n};return s}},86142:function(e,t,n){"use strict";var s=n(54743),a=n(85893);t.Z=(0,s.Z)((0,a.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert")},62549:function(e,t,n){"use strict";var s=n(54743),a=n(85893);t.Z=(0,s.Z)((0,a.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"}),"Sync")},13539:function(e,t,n){"use strict";var s=n(63366),a=n(87462),o=n(67294),r=n(8780),i=n(94780),c=n(41796),l=n(66643),d=n(87486),h=n(29567),u=n(77527),x=n(71230),m=n(85893);let p=["className","color","edge","size","sx"],v=e=>{let{classes:t,edge:n,size:s,color:o,checked:r,disabled:c}=e,d={root:["root",n&&"edge".concat((0,l.Z)(n)),"size".concat((0,l.Z)(s))],switchBase:["switchBase","color".concat((0,l.Z)(o)),r&&"checked",c&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},h=(0,i.Z)(d,x.H,t);return(0,a.Z)({},t,h)},g=(0,u.ZP)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.edge&&t["edge".concat((0,l.Z)(n.edge))],t["size".concat((0,l.Z)(n.size))]]}})(e=>{let{ownerState:t}=e;return(0,a.Z)({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},"start"===t.edge&&{marginLeft:-8},"end"===t.edge&&{marginRight:-8},"small"===t.size&&{width:40,height:24,padding:7,["& .".concat(x.Z.thumb)]:{width:16,height:16},["& .".concat(x.Z.switchBase)]:{padding:4,["&.".concat(x.Z.checked)]:{transform:"translateX(16px)"}}})}),j=(0,u.ZP)(d.Z,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.switchBase,{["& .".concat(x.Z.input)]:t.input},"default"!==n.color&&t["color".concat((0,l.Z)(n.color))]]}})(e=>{let{theme:t}=e;return{position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:"".concat("light"===t.palette.mode?t.palette.common.white:t.palette.grey[300]),transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),["&.".concat(x.Z.checked)]:{transform:"translateX(20px)"},["&.".concat(x.Z.disabled)]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:"".concat("light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600])},["&.".concat(x.Z.checked," + .").concat(x.Z.track)]:{opacity:.5},["&.".concat(x.Z.disabled," + .").concat(x.Z.track)]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:"".concat("light"===t.palette.mode?.12:.2)},["& .".concat(x.Z.input)]:{left:"-100%",width:"300%"}}},e=>{let{theme:t,ownerState:n}=e;return(0,a.Z)({"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.action.activeChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,c.Fq)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{["&.".concat(x.Z.checked)]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n.color].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,c.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(x.Z.disabled)]:{color:t.vars?t.vars.palette.Switch["".concat(n.color,"DisabledColor")]:"".concat("light"===t.palette.mode?(0,c.$n)(t.palette[n.color].main,.62):(0,c._j)(t.palette[n.color].main,.55))}},["&.".concat(x.Z.checked," + .").concat(x.Z.track)]:{backgroundColor:(t.vars||t).palette[n.color].main}})}),f=(0,u.ZP)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(e=>{let{theme:t}=e;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:"".concat("light"===t.palette.mode?t.palette.common.black:t.palette.common.white),opacity:t.vars?t.vars.opacity.switchTrack:"".concat("light"===t.palette.mode?.38:.3)}}),Z=(0,u.ZP)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(e=>{let{theme:t}=e;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}}),w=o.forwardRef(function(e,t){let n=(0,h.Z)({props:e,name:"MuiSwitch"}),{className:o,color:i="primary",edge:c=!1,size:l="medium",sx:d}=n,u=(0,s.Z)(n,p),x=(0,a.Z)({},n,{color:i,edge:c,size:l}),w=v(x),b=(0,m.jsx)(Z,{className:w.thumb,ownerState:x});return(0,m.jsxs)(g,{className:(0,r.Z)(w.root,o),sx:d,ownerState:x,children:[(0,m.jsx)(j,(0,a.Z)({type:"checkbox",icon:b,checkedIcon:b,ref:t,ownerState:x},u,{classes:(0,a.Z)({},w,{root:w.switchBase})})),(0,m.jsx)(f,{className:w.track,ownerState:x})]})});t.Z=w},3442:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eU}});var s=n(85893),a=n(77527),o=n(90642),r=n(9008),i=n.n(r),c=n(11163),l=n(67294),d=n(39971);let h=(0,l.createContext)({uuid:""});var u=e=>{let{children:t}=e,[n,a]=(0,l.useState)("");return(0,s.jsx)(h.Provider,{value:{uuid:n,setAnvilUuid:e=>{e!==n&&a(e)}},children:t})},x=n(47407),m=n(56912),p=n(52311),v=n(57882);let g=new Map([["degraded","Degraded"],["optimal","Optimal"],["offline","Offline"]]);var j=e=>{var t;let{anvil:n}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Ac,{text:n.anvil_name}),(0,s.jsx)(v.Ac,{text:null!==(t=g.get(n.anvilStatus.system))&&void 0!==t?t:"State unavailable"})]})},f=n(9968),Z=n(72094);let w="AnvilList",b={root:"".concat(w,"-root"),divider:"".concat(w,"-divider"),button:"".concat(w,"-button"),anvil:"".concat(w,"-anvil")},_=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(b.root)]:{width:"100%",overflow:"auto",height:"30vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(b.divider)]:{backgroundColor:d.d},["& .".concat(b.button)]:{"&:hover":{backgroundColor:d.$T},paddingLeft:0},["& .".concat(b.anvil)]:{paddingLeft:0}}}),k=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}};var y=e=>{let{list:t}=e,n=(0,c.useRouter)();return(0,s.jsx)(_,{children:(0,s.jsx)(x.Z,{component:"nav",className:b.root,"aria-label":"mailbox folders",children:t.map(e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{className:b.divider}),(0,s.jsx)(p.Z,{className:b.button,onClick:()=>{let t=(0,Z.Z)(n,"name",e.anvil_name);n.replace({query:t},void 0,{shallow:!0})},children:(0,s.jsxs)(o.Z,{display:"flex",flexDirection:"row",width:"100%",children:[(0,s.jsx)(o.Z,{p:1,children:(0,s.jsx)(f.Z,{colour:k(e.anvilStatus.system)})}),(0,s.jsx)(o.Z,{p:1,flexGrow:1,className:b.anvil,children:(0,s.jsx)(j,{anvil:e})})]})},e.anvil_uuid)]}))})})},N=n(65375),C=n(13539),S=n(48403),A=n.n(S),P=n(66389),T=n(11100),M=n(90209),B=n(40657);let F={anvilName:"".concat("SelectedAnvil","-anvilName")},R=(0,a.ZP)(o.Z)(()=>({display:"flex",flexDirection:"row",width:"100%",["& .".concat(F.anvilName)]:{paddingLeft:0}})),z=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}},L=e=>-1!==e.hosts.findIndex(e=>{let{state:t}=e;return"offline"!==t});var D=e=>{var t;let{list:n}=e,{uuid:a}=(0,l.useContext)(h),r=(0,l.useMemo)(()=>n.findIndex(e=>e.anvil_uuid===a),[n,a]),i=n[r],{confirmDialog:c,finishConfirm:d,setConfirmDialogLoading:u,setConfirmDialogOpen:x,setConfirmDialogProps:m}=(0,B.Z)();return i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(R,{children:[(0,s.jsx)(o.Z,{p:1,children:(0,s.jsx)(f.Z,{colour:z(i.anvilStatus.system)})}),(0,s.jsxs)(o.Z,{p:1,flexGrow:1,className:F.anvilName,children:[(0,s.jsx)(v.z,{text:i.anvil_name}),(0,s.jsx)(v.z,{text:null!==(t=g.get(i.anvilStatus.system))&&void 0!==t?t:"State unavailable"})]}),(0,s.jsx)(o.Z,{p:1,children:(0,s.jsx)(C.Z,{checked:L(i),onChange:()=>{let e;let{[r]:t}=n,{anvil_name:a,anvil_uuid:o}=t,i="start",c="blue";L(t)&&(i="stop",e="Servers hosted on this node will be shut down!",c="red");let l="".concat(i,"-an"),h=A()(i);m({actionProceedText:h,content:e,onProceedAppend:()=>{u(!0),P.Z.put("/command/".concat(l,"/").concat(o)).then(()=>{d("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register power job. ",t.children]}),d("Error",t)})},proceedColour:c,titleText:"".concat(h," ").concat(a,"?")}),x(!0)}})})]}),c]}):(0,s.jsx)(M.Z,{})},I=n(5499);let E=e=>{let{anvil:t,anvils:n}=e;return(0,I.Z)("/anvil/".concat(t.anvil_uuid),{onSuccess:e=>{let s=n.value.findIndex(e=>e.anvil_uuid===t.anvil_uuid);if(-1===s){n.set(n=>[...n,{...t,...e}]);return}n.set(t=>{let n=[...t];return n[s]={...n[s],...e},n})},periodic:!0}),(0,s.jsx)(o.Z,{display:"none"})};var O=e=>{let{list:t}=e,[n,a]=(0,l.useState)([]),o=(0,l.useMemo)(()=>t.anvils.map(e=>(0,s.jsx)(E,{anvil:e,anvils:{set:a,value:n}},"".concat(e.anvil_uuid,"-fetcher"))),[n,t.anvils]);return(0,s.jsxs)(N.s_,{children:[o,(0,s.jsx)(D,{list:n}),(0,s.jsx)(y,{list:n})]})},U=n(5387),G=()=>{let{uuid:e}=(0,l.useContext)(h),{data:{allocated:t=0,cores:n=0,threads:a=0}={},loading:o}=(0,I.Z)("/anvil/".concat(e,"/cpu"),{periodic:!0}),r=(0,l.useMemo)(()=>o?(0,s.jsx)(M.Z,{}):(0,s.jsxs)(U.Z,{spacing:0,children:[(0,s.jsx)(v.Ac,{text:"Total Cores: ".concat(n)}),(0,s.jsx)(v.Ac,{text:"Total Threads: ".concat(a)}),(0,s.jsx)(v.Ac,{text:"Allocated Cores: ".concat(t)})]}),[t,n,o,a]);return(0,s.jsxs)(N.s_,{children:[(0,s.jsx)(N.V9,{children:(0,s.jsx)(v.z,{text:"CPU"})}),r]})},V=n(25436);let q=new Map([["message_0222","The subnode is in an unknown state."],["message_0223","The subnode is a full cluster member."],["message_0224","The subnode is coming online; the cluster resource manager is running (step 2/3)."],["message_0225","The subnode is coming online; the subnode is a consensus cluster member (step 1/3)."],["message_0226","The subnode has booted, but it is not (yet) joining the cluster."]]);var H=n(41373);let X="AnvilHost",W={state:"".concat(X,"-state"),bar:"".concat(X,"-bar"),label:"".concat(X,"-label"),decoratorBox:"".concat(X,"-decoratorBox")},$=(0,a.ZP)(o.Z)(e=>{let{theme:t}=e;return{overflow:"auto",height:"28vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"},["& .".concat(W.state)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(W.bar)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(W.label)]:{paddingTop:".3em"},["& .".concat(W.decoratorBox)]:{alignSelf:"stretch"}}}),Y=(e,t)=>{let n=e.exec(t);return n?q.get(n[0])||"Error code not recognized":"Error code not found"},J=e=>{switch(e){case"online":return"ok";case"offline":return"off";default:return"warning"}};var K=e=>{let{hosts:t}=e,n=/^[a-zA-Z]/,a=/^(message_[0-9]+)/,{confirmDialog:r,finishConfirm:i,setConfirmDialogLoading:c,setConfirmDialogOpen:l,setConfirmDialogProps:d}=(0,B.Z)();return t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)($,{children:t.map(e=>{var t;if(!e)return;let r="online"===e.state,h="offline"===e.state,u=!h;return(0,s.jsxs)(N.Lg,{children:[(0,s.jsxs)(N.CH,{children:[(0,s.jsx)(o.Z,{flexGrow:1,children:(0,s.jsx)(v.Ac,{text:e.host_name})}),(0,s.jsx)(o.Z,{className:W.decoratorBox,children:(0,s.jsx)(f.Z,{colour:J(e.state)})}),(0,s.jsx)(o.Z,{children:(0,s.jsx)(v.Ac,{text:(null==e?void 0:null===(t=e.state)||void 0===t?void 0:t.replace(n,e=>e.toUpperCase()))||"Not Available"})})]}),(0,s.jsxs)(o.Z,{display:"flex",className:W.state,children:[(0,s.jsx)(o.Z,{className:W.label,children:(0,s.jsx)(v.Ac,{text:"Power: "})}),(0,s.jsx)(o.Z,{flexGrow:1,children:(0,s.jsx)(C.Z,{checked:u,onChange:()=>{let t=u?"stop":"start",n="".concat(t,"-subnode"),a=A()(t);d({actionProceedText:a,content:"start"===t?(0,s.jsx)(v.Ac,{children:"The subnode will be powered on with IPMI commands."}):(0,s.jsxs)(U.Z,{children:[(0,s.jsx)(v.Ac,{children:"The subnode will be powered off."}),(0,s.jsx)(v.Ac,{children:e.server_count?(0,s.jsxs)(s.Fragment,{children:["All ",e.server_count," servers on this subnode will be migrated to the peer subnode if possible. Otherwise, the servers will be shut down."]}):(0,s.jsx)(s.Fragment,{children:"No servers are on this subnode."})})]}),onProceedAppend:()=>{c(!0),P.Z.put("/command/".concat(n,"/").concat(e.host_uuid)).then(()=>{i("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register power job. ",t.children]}),i("Error",t)})},titleText:"".concat(a," ").concat(e.host_name,"?")}),l(!0)}})}),(0,s.jsx)(o.Z,{className:W.label,children:(0,s.jsx)(v.Ac,{text:"Member: "})}),(0,s.jsx)(o.Z,{children:(0,s.jsx)(C.Z,{checked:r,disabled:h,onChange:()=>{let t=r?"leave":"join",n="".concat(t,"-an"),a=A()(t);d({actionProceedText:a,content:"leave"===t?(0,s.jsxs)(U.Z,{children:[(0,s.jsx)(v.Ac,{children:"The subnode will be withdrawn from its cluster and servers will be migrated as necessary."}),(0,s.jsx)(v.Ac,{children:"The operation is reversible. You can tell it to join the cluster again later."})]}):(0,s.jsxs)(U.Z,{children:[(0,s.jsx)(v.Ac,{children:"The subnode will join the cluster it belongs to."}),(0,s.jsx)(v.Ac,{children:"The operation is reversible. You can tell it to withdraw from the cluster again later."})]}),onProceedAppend:()=>{c(!0),P.Z.put("/command/".concat(n,"/").concat(e.host_uuid)).then(()=>{i("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered cluster membership job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register cluster memebership job."," ",t.children]}),i("Error",t)})},titleText:"".concat(a," cluster on ").concat(e.host_name,"?")}),l(!0)}})})]}),!r&&u&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{display:"flex",width:"100%",className:W.state,children:(0,s.jsx)(o.Z,{children:(0,s.jsx)(v.Ac,{text:Y(a,e.state_message)})})}),(0,s.jsx)(o.Z,{display:"flex",width:"100%",className:W.bar,children:(0,s.jsx)(o.Z,{flexGrow:1,children:(0,s.jsx)(H.ko,{progressPercentage:e.state_percent})})})]})]},e.host_uuid)})}),r]}):(0,s.jsx)($,{})},Q=e=>null==e?void 0:e.filter(e=>e.host_uuid),ee=e=>{let{anvil:t}=e,{uuid:n}=(0,l.useContext)(h),{data:a,loading:o}=(0,I.Z)("/anvil/".concat(n),{periodic:!0}),r=t.findIndex(e=>e.anvil_uuid===n);return(0,s.jsxs)(N.s_,{children:[(0,s.jsx)(v.z,{text:"Subnodes"}),o?(0,s.jsx)(M.Z,{}):(0,s.jsx)(s.Fragment,{children:-1!==r&&a&&(0,s.jsx)(K,{hosts:Q(t[r].hosts).reduce((e,t,n)=>{let s=a.hosts[n];return s&&e.push(s),e},[])})})]})},et=n(46283),en=()=>{let{uuid:e}=(0,l.useContext)(h),{data:{allocated:t="0",reserved:n="0",total:a="0"}={},loading:r}=(0,I.Z)("/anvil/".concat(e,"/memory"),{periodic:!0}),i=(0,l.useMemo)(()=>BigInt(t),[t]),c=(0,l.useMemo)(()=>BigInt(n),[n]),d=(0,l.useMemo)(()=>BigInt(a),[a]);return(0,s.jsxs)(N.s_,{children:[(0,s.jsx)(N.V9,{children:(0,s.jsx)(v.z,{text:"Memory"})}),r?(0,s.jsx)(M.Z,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.Z,{display:"flex",width:"100%",children:[(0,s.jsx)(o.Z,{flexGrow:1,children:(0,s.jsx)(v.Ac,{text:"Allocated: ".concat((0,et.MU)(i))})}),(0,s.jsx)(o.Z,{children:(0,s.jsx)(v.Ac,{text:"Free: ".concat((0,et.MU)(d-(c+i)))})})]}),(0,s.jsx)(o.Z,{display:"flex",width:"100%",children:(0,s.jsx)(o.Z,{flexGrow:1,children:(0,s.jsx)(H.CD,{allocated:d?Number((c+i)*BigInt(100)/d):0})})}),(0,s.jsx)(o.Z,{display:"flex",justifyContent:"center",width:"100%",children:(0,s.jsx)(v.Ac,{text:"Total: ".concat((0,et.MU)(d)," | Reserved: ").concat((0,et.MU)(c))})})]})]})},es=n(29873),ea=e=>{let t=[],n={bonds:[]};return e.hosts.forEach(e=>{e.bonds.forEach(s=>{let a=t.findIndex(e=>e===s.bond_name);-1===a?(t.push(s.bond_name),n.bonds.push({bond_name:s.bond_name,bond_uuid:s.bond_uuid,bond_speed:0,bond_state:"degraded",hosts:[{host_name:e.host_name,host_uuid:e.host_uuid,link:s.links[0].is_active?s.links[0]:s.links[1]}]})):n.bonds[a].hosts.push({host_name:e.host_name,host_uuid:e.host_uuid,link:s.links[0].is_active?s.links[0]:s.links[1]})})}),n.bonds.forEach(e=>{let t=e.hosts[0].link.link_speed>e.hosts[1].link.link_speed?1:0;e.bond_speed=e.hosts[t].link.link_speed,e.bond_state=e.hosts[t].link.link_state}),n};let eo="Network",er={container:"".concat(eo,"-container"),root:"".concat(eo,"-root"),noPaddingLeft:"".concat(eo,"-noPaddingLeft"),divider:"".concat(eo,"-divider"),verticalDivider:"".concat(eo,"-verticalDivider")},ei=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(er.container)]:{width:"100%",overflow:"auto",height:"32vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(er.root)]:{paddingTop:".7em",paddingBottom:".7em"},["& .".concat(er.noPaddingLeft)]:{paddingLeft:0},["& .".concat(er.divider)]:{backgroundColor:d.d},["& .".concat(er.verticalDivider)]:{height:"3.5em"}}}),ec=e=>{switch(e){case"optimal":return"ok";case"degraded":default:return"warning";case"down":return"error"}};var el=()=>{let{uuid:e}=(0,l.useContext)(h),[t,n]=(0,l.useState)(),{loading:a}=(0,I.Z)("/anvil/".concat(e,"/network"),{onSuccess:e=>{n(ea(e))},periodic:!0});return(0,s.jsx)(N.s_,{children:(0,s.jsxs)(ei,{children:[(0,s.jsx)(v.z,{text:"Network"}),a?(0,s.jsx)(M.Z,{}):(0,s.jsx)(o.Z,{className:er.container,children:t&&t.bonds.map(e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.Z,{className:er.root,display:"flex",flexDirection:"row",width:"100%",children:[(0,s.jsx)(o.Z,{p:1,className:er.noPaddingLeft,children:(0,s.jsx)(f.Z,{colour:ec(e.bond_state)})}),(0,s.jsxs)(o.Z,{p:1,flexGrow:1,className:er.noPaddingLeft,children:[(0,s.jsx)(v.Ac,{text:e.bond_name}),(0,s.jsx)(v.Ac,{text:"".concat(e.bond_speed,"Mbps")})]}),(0,s.jsx)(o.Z,{display:"flex",style:{paddingTop:".5em"},children:e.hosts.map((t,n)=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{p:1,style:{paddingTop:0,paddingBottom:0},children:(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(v.Ac,{text:t.host_name,selected:!1}),(0,s.jsx)(v.Ac,{text:t.link.link_name})]})},t.host_name),n!==e.hosts.length-1&&(0,s.jsx)(m.Z,{className:"".concat(er.divider," ").concat(er.verticalDivider),orientation:"vertical",flexItem:!0})]}))})]}),(0,s.jsx)(m.Z,{className:er.divider})]}))})]})})},ed=n(86142),eh=n(96788),eu=n(73939),ex=n(19304);let em=new Map([["running","Running"],["idle","Idle"],["paused","Paused"],["in shutdown","Shutting Down"],["shut off","Off"],["crashed","Crashed"],["pmsuspended","PM Suspended"],["migrating","Migrating"],["provisioning","Provisioning"]]);var ep=n(47177),ev=n(46194),eg=n(45328),ej=n(37600),ef=n(18766),eZ=n(64860),ew=n(84337);let eb="Servers",e_={root:"".concat(eb,"-root"),divider:"".concat(eb,"-divider"),verticalDivider:"".concat(eb,"-verticalDivider"),button:"".concat(eb,"-button"),headerPadding:"".concat(eb,"-headerPadding"),hostsBox:"".concat(eb,"-hostsBox"),hostBox:"".concat(eb,"-hostBox"),checkbox:"".concat(eb,"-checkbox"),editButtonBox:"".concat(eb,"-editButtonBox"),dropdown:"".concat(eb,"-dropdown"),on:"".concat(eb,"-on"),off:"".concat(eb,"-off"),all:"".concat(eb,"-all")},ek=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(e_.root)]:{width:"100%",overflow:"auto",height:"78vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(e_.divider)]:{backgroundColor:d.d},["& .".concat(e_.verticalDivider)]:{height:"75%",paddingTop:"1em"},["& .".concat(e_.button)]:{"&:hover":{backgroundColor:d.$T},paddingLeft:0},["& .".concat(e_.headerPadding)]:{paddingLeft:".3em"},["& .".concat(e_.hostsBox)]:{padding:"1em",paddingRight:0},["& .".concat(e_.hostBox)]:{paddingTop:0},["& .".concat(e_.checkbox)]:{paddingTop:".8em"},["& .".concat(e_.editButtonBox)]:{paddingTop:".3em"},["& .".concat(e_.dropdown)]:{paddingTop:".8em",paddingBottom:".8em"},["& .".concat(e_.all)]:{paddingTop:".5em",paddingLeft:".3em"}}}),ey=e=>{switch(e){case"running":return"ok";case"shut off":return"off";case"crashed":return"error";default:return"warning"}},eN=(0,a.ZP)(eh.Z)({["&.".concat(e_.on)]:{color:d.Ej},["&.".concat(e_.off)]:{color:d.hM}});var eC=e=>{var t;let{anvil:n}=e,[a,r]=(0,l.useState)(null),[i,c]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!1),[g,j]=(0,l.useState)([]),[Z,w]=(0,l.useState)(!1),b=(0,l.useRef)({}),[_,k]=(0,ew.Z)(),{uuid:y}=(0,l.useContext)(h),C=(0,l.useRef)([]),{data:S}=(0,I.Z)("/server?anvilUUIDs=".concat(y),{periodic:!0}),A=(0,l.useMemo)(()=>S&&Object.values(S),[S]),B=e=>{C.current=[],e.filter(e=>"running"===e.state).length&&C.current.push("off"),e.filter(e=>"shut off"===e.state).length&&C.current.push("on")},F=e=>{r(null),g.length&&g.forEach(t=>{P.Z.put("/command".concat("on"===e?"start-server":"stop-server","/").concat(t)).catch(e=>{(0,T.Z)(e)})})},R=e=>{if(!A)return;let t=g.indexOf(e);-1===t?g.push(e):g.splice(t,1),B(A.filter(e=>-1!==g.indexOf(e.uuid))),j([...g])},z=n.findIndex(e=>e.anvil_uuid===y),L=Q(null===(t=n[z])||void 0===t?void 0:t.hosts),D=(0,l.useMemo)(()=>!g.length,[g.length]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.s_,{children:(0,s.jsxs)(ek,{children:[(0,s.jsxs)(N.V9,{className:e_.headerPadding,sx:{marginBottom:0},children:[(0,s.jsx)(v.z,{text:"Servers"}),i&&(0,s.jsx)(eg.Z,{disabled:D,mapPreset:"delete",onClick:()=>{var e;k({actionProceedText:"Delete",content:"Are you sure you want to delete the selected server(s)? This action is not revertable.",onProceedAppend:()=>{P.Z.request({data:{serverUuids:g},method:"delete",url:"/server"}).catch(e=>{(0,T.Z)(e)})},proceedColour:"red",titleText:"Delete ".concat(g.length," server(s)?")}),null===(e=b.current.setOpen)||void 0===e||e.call(null,!0)},variant:"redcontained"}),(0,s.jsx)(eg.Z,{mapPreset:"edit",onClick:()=>c(!i),state:String(i)}),(0,s.jsx)(eg.Z,{mapPreset:"add",onClick:()=>w(!0)})]}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{className:e_.headerPadding,display:"flex",children:(0,s.jsxs)(o.Z,{flexGrow:1,className:e_.dropdown,children:[(0,s.jsx)(ev.Z,{disabled:D,onClick:e=>{r(e.currentTarget)},startIcon:(0,s.jsx)(ed.Z,{}),children:"Power"}),(0,s.jsx)(ej.Z,{muiMenuProps:{anchorEl:a,keepMounted:!0,onClose:()=>r(null)},open:!!a,children:C.current.map(e=>(0,s.jsx)(ef.Z,{onClick:()=>F(e),children:(0,s.jsx)(eN,{className:e_[e],variant:"subtitle1",children:e.replace(/^[a-z]/,e=>e.toUpperCase())})},e))})]})}),(0,s.jsxs)(o.Z,{display:"flex",children:[(0,s.jsx)(o.Z,{children:(0,s.jsx)(eu.Z,{style:{color:d.lD},color:"secondary",checked:u,onChange:()=>{A&&(u?(B([]),j([])):(B(A),j(A.map(e=>e.uuid))),p(!u))}})}),(0,s.jsx)(o.Z,{className:e_.all,children:(0,s.jsx)(v.Ac,{text:"All"})})]})]}),A?(0,s.jsx)(o.Z,{className:e_.root,children:(0,s.jsx)(x.Z,{component:"nav",children:A.map(e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ex.ZP,{button:!0,className:e_.button,component:i?"div":"a",href:"/server?uuid=".concat(e.uuid,"&server_name=").concat(e.name,"&server_state=").concat(e.state),onClick:()=>R(e.uuid),children:(0,s.jsxs)(o.Z,{display:"flex",flexDirection:"row",width:"100%",children:[i&&(0,s.jsx)(o.Z,{className:e_.checkbox,children:(0,s.jsx)(eu.Z,{style:{color:d.lD},color:"secondary",checked:void 0!==g.find(t=>t===e.uuid)})}),(0,s.jsx)(o.Z,{p:1,children:(0,s.jsx)(f.Z,{colour:ey(e.state)})}),(0,s.jsxs)(o.Z,{p:1,flexGrow:1,children:[(0,s.jsx)(v.Ac,{text:e.name}),(0,s.jsx)(v.Ac,{text:em.get(e.state)||"Not Available"})]}),(0,s.jsx)(o.Z,{display:"flex",className:e_.hostsBox,children:"shut off"!==e.state&&"crashed"!==e.state&&L.map((t,n)=>{var a;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{p:1,className:e_.hostBox,children:(0,s.jsx)(v.Ac,{text:t.host_name,selected:(null===(a=e.host)||void 0===a?void 0:a.uuid)===t.host_uuid})},t.host_uuid),n!==L.length-1&&(0,s.jsx)(m.Z,{className:"".concat(e_.divider," ").concat(e_.verticalDivider),orientation:"vertical"})]})})})]})},e.uuid),(0,s.jsx)(m.Z,{className:e_.divider})]}))})}):(0,s.jsx)(M.Z,{})]})}),(0,s.jsx)(eZ.Z,{dialogProps:{open:Z},onClose:()=>{w(!1)}}),(0,s.jsx)(ep.Z,{closeOnProceed:!0,..._,ref:b})]})};let eS="SharedStorageHost",eA={fs:"".concat(eS,"-fs"),bar:"".concat(eS,"-bar"),decoratorBox:"".concat(eS,"-decoratorBox")},eP=(0,a.ZP)("div")(()=>({["& .".concat(eA.fs)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(eA.bar)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(eA.decoratorBox)]:{paddingRight:".3em"}}));var eT=e=>{let{group:t}=e,{storage_group_free:n,storage_group_total:a}=t,r=(0,l.useMemo)(()=>BigInt(n),[n]),i=(0,l.useMemo)(()=>BigInt(a),[a]),c=(0,l.useMemo)(()=>i-r,[r,i]),d=(0,l.useMemo)(()=>Number(c*BigInt(100)/i),[c,i]);return(0,s.jsxs)(eP,{children:[(0,s.jsxs)(o.Z,{display:"flex",width:"100%",className:eA.fs,children:[(0,s.jsx)(o.Z,{flexGrow:1,children:(0,s.jsx)(v.Ac,{text:"Used: ".concat((0,et.MU)(i-r))})}),(0,s.jsx)(o.Z,{children:(0,s.jsx)(v.Ac,{text:"Free: ".concat((0,et.MU)(r))})})]}),(0,s.jsx)(o.Z,{display:"flex",width:"100%",className:eA.bar,children:(0,s.jsx)(o.Z,{flexGrow:1,children:(0,s.jsx)(H.CD,{allocated:d})})}),(0,s.jsx)(o.Z,{display:"flex",justifyContent:"center",width:"100%",children:(0,s.jsx)(v.Ac,{text:"Total Storage: ".concat((0,et.MU)(i))})})]})};let eM={root:"".concat("SharedStorage","-root")},eB=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(eM.root)]:{overflow:"auto",height:"78vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%"}}}});var eF=()=>{let{uuid:e}=(0,l.useContext)(h),{data:t,loading:n}=(0,I.Z)("/anvil/".concat(e,"/store"),{periodic:!0});return(0,s.jsx)(N.s_,{children:(0,s.jsxs)(eB,{children:[(0,s.jsx)(v.z,{text:"Shared Storage"}),n?(0,s.jsx)(M.Z,{}):(0,s.jsx)(o.Z,{className:eM.root,children:(null==t?void 0:t.storage_groups)&&t.storage_groups.map(e=>(0,s.jsxs)(N.Lg,{children:[(0,s.jsx)(N.CH,{children:(0,s.jsx)(v.Ac,{text:e.storage_group_name})}),(0,s.jsx)(eT,{group:e},e.storage_group_uuid)]},e.storage_group_uuid))})]})})},eR=()=>{let[e,t]=(0,l.useState)(void 0);return(0,l.useEffect)(()=>{let e=()=>{t(window.innerWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e};let ez="Anvil",eL={child:"".concat(ez,"-child"),server:"".concat(ez,"-server"),container:"".concat(ez,"-container")},eD=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(eL.child)]:{width:"22%",height:"100%",[t.breakpoints.down(d.li)]:{width:"50%"},[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(eL.server)]:{width:"35%",height:"100%",[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(eL.container)]:{display:"flex",flexDirection:"row",width:"100%",justifyContent:"space-between",[t.breakpoints.down("md")]:{display:"block"}}}}),eI=e=>{let{children:t}=e;return(0,l.createElement)(N.s_,{sx:{marginLeft:{xs:"1em",sm:"auto"},marginRight:{xs:"1em",sm:"auto"},marginTop:"calc(50vh - 10em)",maxWidth:{xs:void 0,sm:"60%",md:"50%",lg:"40%"},minWidth:"fit-content"}},t)},eE=(e,t)=>{let n;if(!e.isReady||!t)return"";let{anvils:s}=t,{name:a,uuid:o}=e.query;if(a?n=s.find(e=>e.anvil_name===a):o&&(n=s.find(e=>e.anvil_uuid===o)),!n){let[e={anvil_uuid:""}]=s;return e.anvil_uuid}return n.anvil_uuid},eO=e=>{let{children:t,list:n,loading:a}=e,o=(0,c.useRouter)(),{uuid:r,setAnvilUuid:i}=(0,l.useContext)(h),d=(0,l.useMemo)(()=>{let e=eE(o,n);return null==i||i.call(null,e),e},[n,o,i]);if(r)return(0,s.jsx)(s.Fragment,{children:t});let u=(0,s.jsx)(eI,{children:(0,s.jsx)(M.Z,{sx:{margin:"2em 2.4em"}})}),x=(0,s.jsx)(eI,{children:(0,s.jsx)(es.Z,{type:"warning",children:"Failed to get system summary."})});return a?u:n&&d?u:x};var eU=()=>{let e=eR(),{data:t,loading:n}=(0,I.Z)("/anvil/summary",{periodic:!0}),a=(0,l.useMemo)(()=>t&&e?e>d.li?(0,s.jsxs)(o.Z,{className:eL.container,children:[(0,s.jsxs)(o.Z,{className:eL.child,children:[(0,s.jsx)(O,{list:t}),(0,s.jsx)(ee,{anvil:t.anvils})]}),(0,s.jsx)(o.Z,{className:eL.server,children:(0,s.jsx)(eC,{anvil:t.anvils})}),(0,s.jsx)(o.Z,{className:eL.child,children:(0,s.jsx)(eF,{})}),(0,s.jsxs)(o.Z,{className:eL.child,children:[(0,s.jsx)(el,{}),(0,s.jsx)(G,{}),(0,s.jsx)(en,{})]})]}):(0,s.jsxs)(o.Z,{className:eL.container,children:[(0,s.jsxs)(o.Z,{className:eL.child,children:[(0,s.jsx)(eC,{anvil:t.anvils}),(0,s.jsx)(O,{list:t}),(0,s.jsx)(ee,{anvil:t.anvils})]}),(0,s.jsxs)(o.Z,{className:eL.child,children:[(0,s.jsx)(el,{}),(0,s.jsx)(eF,{}),(0,s.jsx)(G,{}),(0,s.jsx)(en,{})]})]}):void 0,[t,e]);return(0,s.jsxs)(eD,{children:[(0,s.jsx)(i(),{children:(0,s.jsx)("title",{children:"Anvil"})}),(0,s.jsx)(V.Z,{}),(0,s.jsx)(u,{children:(0,s.jsx)(eO,{list:t,loading:n,children:a})})]})}},11163:function(e,t,n){e.exports=n(43079)}},function(e){e.O(0,[447,256,940,245,529,436,215,888,774,179],function(){return e(e.s=72315)}),_N_E=e.O()}]);