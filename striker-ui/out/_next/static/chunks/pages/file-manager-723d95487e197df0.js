(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{91953:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/file-manager",function(){return t(6033)}])},62848:function(e,l,t){"use strict";var s=t(67294);l.Z=function(){let{actionProceedText:e="",content:l="",titleText:t="",...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.useState)({actionProceedText:e,content:l,titleText:t,...i})}},6033:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return ea}});var s=t(85893),i=t(9008),n=t.n(i),r=t(39937),a=t(54490),o=t(67294),u=t(92230);let d=[["iso",["application/x-cd-image","ISO (optical disc)"]],["other",["text/plain","Other file type"]],["script",["text/plain","Script (program)"]]],c=new Map(d);var h=t(55066),m=t(25934),p=t(4845),v=t(98484),x=t(99429),f=t(28054),g=t(50361),j=t.n(g),b=t(23279),Z=t.n(b),w=t(56903),y=t(83916),k=t(91029),C=t(23930),M=t(6189),S=t(59278),F=t(12387),O=e=>{let{anvils:l,drHosts:t,fileUuid:i,formik:n,showSyncInputGroup:r,showTypeInput:a}=e,{handleBlur:u,handleChange:c}=n,h=(0,o.useMemo)(()=>Z()(c,500),[c]),{nameChain:m,locationsChain:p,typeChain:v}=(0,o.useMemo)(()=>({nameChain:"".concat(i,".name"),locationsChain:"".concat(i,".locations"),typeChain:"".concat(i,".type")}),[i]),x=(0,o.useCallback)((e,l)=>{n.setValues(t=>{var s;let n=j()(t),r=null===(s=n[i].locations)||void 0===s?void 0:s[e];return r?(Object.keys(r).forEach(e=>{r[e].active=l}),n):t})},[n,i]),g=(0,o.useCallback)(e=>{var l;let t=null===(l=n.values[i].locations)||void 0===l?void 0:l[e];return t?{checked:Object.values(t).every(e=>{let{active:l}=e;return l}),onChange:(l,t)=>{x(e,t)}}:{}},[n.values,i,x]),b=(0,o.useCallback)((e,l)=>{var t,s,r;let a="".concat(p,".").concat(e,".").concat(l),o="".concat(a,".active");return{id:o,name:o,checked:null===(r=n.values[i].locations)||void 0===r?void 0:null===(s=r[e])||void 0===s?void 0:null===(t=s[l])||void 0===t?void 0:t.active,onBlur:u,onChange:c}},[n.values,i,u,c,p]),O=(0,o.useCallback)(e=>{var l;let t=null===(l=n.values[i].locations)||void 0===l?void 0:l[e];return t&&Object.keys(t).length>1},[n.values,i]),I=(0,o.useMemo)(()=>(0,s.jsx)(F.Z,{input:(0,s.jsx)(k.Z,{id:m,label:"File name",name:m,onBlur:u,onChange:h,value:n.values[i].name})}),[h,n.values,i,u,m]),_=(0,o.useMemo)(()=>r&&(0,s.jsx)(C.TZ,{header:"Sync with node(s)",panelProps:{mb:0,mt:0,width:"100%"},children:(0,s.jsx)(y.Z,{allowCheckAll:O("anvils"),allowCheckItem:!0,edit:!0,header:!0,listItems:l,getListCheckboxProps:()=>g("anvils"),getListItemCheckboxProps:e=>b("anvils",e),renderListItem:(e,l)=>{let{description:t,name:i}=l;return(0,s.jsxs)(S.Ac,{children:[i,": ",t]})}})}),[l,O,g,b,r]),P=(0,o.useMemo)(()=>r&&(0,s.jsx)(C.TZ,{header:"Sync with DR host(s)",panelProps:{mb:0,mt:0,width:"100%"},children:(0,s.jsx)(y.Z,{allowCheckAll:O("drHosts"),allowCheckItem:!0,edit:!0,header:!0,listItems:t,getListCheckboxProps:()=>g("drHosts"),getListItemCheckboxProps:e=>b("drHosts",e),renderListItem:(e,l)=>{let{hostName:t}=l;return(0,s.jsx)(S.Ac,{children:t})}})}),[t,O,g,b,r]),A=(0,o.useMemo)(()=>a&&(0,s.jsx)(M.Z,{id:v,label:"File type",name:v,onBlur:u,onChange:c,selectItems:d.map(e=>{let[l,[,t]]=e;return{displayValue:t,value:l}}),value:n.values[i].type}),[n.values,i,u,c,a,v]);return(0,s.jsxs)(f.Z,{sx:{"& > :not(:first-child)":{marginTop:"1em"}},children:[(0,s.jsxs)(w.Z,{sm:"row",xs:"column",children:[I,A]}),_,P]})},I=t(87196),_=t(97607),P=t(81208),A=t(16310),V=t(36026),R=t(74077);let E=A.Ry({active:A.O7().required()}),D=A.Vo(e=>A.Ry((0,V.Z)(e,E))),H=A.Vo(e=>A.Ry((0,V.Z)(e,E))),U=A.Ry({locations:A.Ry({anvils:D,drHosts:H}),name:A.Z_().required(),type:A.Z_().oneOf(["iso","other","script"]),uuid:(0,R.u)().required()}),L=A.Vo(e=>A.Ry((0,V.Z)(e,U)));var T=t(14440),N=t(40743),B=e=>{let{uploads:l}=e;return(0,s.jsx)(w.Z,{columnSpacing:".2em",children:Object.values(l).map(e=>{let{name:l,progress:t,uuid:i}=e;return(0,s.jsxs)(T.Z,{sx:{alignItems:{md:"center"},display:"flex",flexDirection:{xs:"column",md:"row"},"& > :first-child":{minWidth:100,overflow:"hidden",overflowWrap:"normal",textOverflow:"ellipsis",whiteSpace:"nowrap",width:{xs:"100%",md:200},wordBreak:"keep-all"},"& > :last-child":{flexGrow:1}},children:[(0,s.jsx)(S.Ac,{children:l}),(0,s.jsx)(N.ko,{progressPercentage:t})]},"upload-".concat(i))})})};let q=(e,l,t)=>e?(e[l].progress=t,{...e}):e;var G=e=>{let{anvils:l,drHosts:t}=e,i=(0,o.useRef)(null),n=(0,o.useRef)(null),[r,a]=(0,o.useState)(),u=(0,o.useCallback)(e=>{var l,t;return null==i?void 0:null===(t=i.current)||void 0===t?void 0:null===(l=t.setMessage)||void 0===l?void 0:l.call(null,"api",e)},[]),d=(0,h.TA)({initialValues:{},onSubmit:e=>{let l=Object.values(e);a(l.reduce((e,l)=>{let{file:t,name:s,uuid:i}=l;return t&&(e[i]={name:s,progress:0,uuid:i}),e},{})),u({children:(0,s.jsx)(s.Fragment,{children:"Closing this dialog before the upload(s) complete will cancel the upload(s)."})}),Promise.all(l.reduce((e,l)=>{let{file:t,name:s,uuid:i}=l;if(!t)return e;let n=new FormData;n.append("file",new File([t],s,{...t}));let r=v.Z.post("/file",n,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let{loaded:l,total:t=l}=e;a(e=>q(e,i,Math.round(l/t*99)))}}).then(()=>{a(e=>q(e,i,100))});return e.push(r),e},[])).then(()=>{u({children:(0,s.jsxs)(w.Z,{spacing:0,children:[(0,s.jsx)("span",{children:"Upload(s) completed; file(s) will be listed after the job(s) to sync them to other host(s) finish."}),(0,s.jsx)("span",{children:"You can close this dialog."})]})})}).catch(e=>{let l=(0,_.Z)(e);l.children=(0,s.jsxs)(s.Fragment,{children:["Failed to add file. ",l.children]}),u(l)})},validationSchema:L}),c=(0,o.useMemo)(()=>(0,I.Z)(d.errors),[d.errors]),f=(0,o.useMemo)(()=>!d.dirty||!d.isValid||d.isValidating||d.isSubmitting,[d.dirty,d.isSubmitting,d.isValid,d.isValidating]),g=(0,o.useCallback)(e=>{let{target:{files:l}}=e;if(!l)return;let t=Array.from(l).reduce((e,l)=>{let t=(0,m.Z)();return e[t]={file:l,name:l.name,uuid:t},e},{});d.setValues(t)},[d]),j=(0,o.useMemo)(()=>d.values&&Object.values(d.values).map(e=>{let{uuid:i}=e;return(0,s.jsx)(O,{anvils:l,drHosts:t,fileUuid:i,formik:d},i)}),[l,t,d]);return(0,s.jsxs)(w.Z,{children:[(0,s.jsx)(P.Z,{ref:i}),r?(0,s.jsx)(B,{uploads:r}):(0,s.jsxs)(w.Z,{component:"form",onSubmit:e=>{e.preventDefault(),d.submitForm()},children:[(0,s.jsx)("input",{id:"files",multiple:!0,name:"files",onChange:g,ref:n,style:{display:"none"},type:"file"}),(0,s.jsx)(x.Z,{onClick:()=>{var e;null===(e=n.current)||void 0===e||e.click()},children:"Browse"}),j,(0,s.jsx)(P.Z,{count:1,messages:c}),(0,s.jsx)(p.Z,{actions:[{background:"blue",children:"Add",disabled:f,type:"submit"}]})]})]})},W=t(59752),J=t(77583),X=t(33544),$=t(29535);let z=(e,l)=>{let{locations:t,name:s,type:i,uuid:n}=e;if(!t||!i)return;let r=[];return Object.entries(t.anvils).reduce((e,t)=>{let[s,{active:i}]=t,{anvils:{[s]:{locationUuids:n}}}=l,r=n.map(e=>({fileLocationUUID:e,isFileLocationActive:i}));return e.push(...r),e},r),Object.entries(t.drHosts).reduce((e,t)=>{let[s,{active:i}]=t,{hosts:{[s]:{locationUuids:n}}}=l,r=n.map(e=>({fileLocationUUID:e,isFileLocationActive:i}));return e.push(...r),e},r),{fileLocations:r,fileName:s,fileType:i,fileUUID:n}};var Y=e=>{let{anvils:l,drHosts:t,onSuccess:i,previous:n}=e,r=(0,o.useRef)({}),a=(0,o.useCallback)(e=>{var l;return null===(l=r.current.setMessage)||void 0===l?void 0:l.call(null,"api",e)},[]),u=(0,o.useMemo)(()=>{let{locations:e,name:l,type:s,uuid:i}=n;return{[i]:{locations:Object.values(e).reduce((e,l)=>{let{active:s,anvilUuid:i,hostUuid:n}=l,r="anvils",a=i;return n in t&&(r="drHosts",a=n),e[r][a]={active:s},e},{anvils:{},drHosts:{}}),name:l,type:s,uuid:i}}},[t,n]),d=(0,h.TA)({initialValues:u,onSubmit:(e,l)=>{let{setSubmitting:t}=l,r=z(e[n.uuid],n);v.Z.put("/file/".concat(n.uuid),r).then(()=>{a({children:(0,s.jsx)(s.Fragment,{children:"File updated."})}),null==i||i.call(null)}).catch(e=>{let l=(0,_.Z)(e);l.children=(0,s.jsxs)(s.Fragment,{children:["Failed to modify file. ",l.children]}),a(l)}).finally(()=>{t(!1)})},validationSchema:L}),c=(0,o.useMemo)(()=>(0,I.Z)(d.errors),[d.errors]),m=(0,o.useMemo)(()=>!d.dirty||!d.isValid||d.isValidating||d.isSubmitting,[d.dirty,d.isSubmitting,d.isValid,d.isValidating]);return(0,s.jsxs)(w.Z,{component:"form",onSubmit:e=>{e.preventDefault(),d.submitForm()},children:[(0,s.jsx)(O,{anvils:l,drHosts:t,fileUuid:n.uuid,formik:d,showSyncInputGroup:!0,showTypeInput:!0}),(0,s.jsx)(P.Z,{count:1,messages:c,ref:r}),(0,s.jsx)(p.Z,{loading:d.isSubmitting,actions:[{background:"blue",children:"Edit",disabled:m,type:"submit"}]})]})},K=t(48430),Q=t(53541),ee=t(68805),el=t(85291),et=t(62848),es=t(77510);let ei=e=>e.reduce((e,l)=>{let[t,s,i,n,r]=l;return e[t]={checksum:r,name:s,size:i,type:n,uuid:t},e},{}),en=e=>{let{0:l}=e;if(!l)return;let[t,s,i,n,r]=l;return e.reduce((e,l)=>{let{5:t,6:s,7:i,8:n,9:r,10:a,11:o,12:u}=l;e.anvils[i]||(e.anvils[i]={description:r,locationUuids:[],name:n,uuid:i}),e.hosts[a]||(e.hosts[a]={locationUuids:[],name:o,type:u,uuid:a}),"dr"===u?e.hosts[a].locationUuids.push(t):e.anvils[i].locationUuids.push(t);let d=1===Number(s);return e.locations[t]={anvilUuid:i,active:d,hostUuid:a,uuid:t},e},{anvils:{},checksum:r,hosts:{},locations:{},name:s,size:i,type:n,uuid:t})};var er=()=>{let e=(0,o.useRef)(null),l=(0,o.useRef)({}),t=(0,o.useRef)(null),i=(0,o.useRef)({}),[n,r]=(0,et.Z)(),[d,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(),[x,f]=(0,o.useState)(),{isLoading:g}=(0,K.Z)("".concat(u.Z,"/file"),{onSuccess:e=>{f(ei(e))}}),{fetch:j,loading:b}=(0,ee.Z)({onData:e=>f(ei(e)),url:"/file"}),Z=(0,o.useMemo)(()=>g||b,[b,g]),{buildDeleteDialogProps:k,checks:M,getCheck:F,hasAllChecks:O,hasChecks:I,multipleItems:_,resetChecks:A,setAllChecks:V,setCheck:R}=(0,el.Z)({list:x}),E=(0,o.useCallback)(e=>{var l;return null===(l=i.current.setMessage)||void 0===l?void 0:l.call(null,"api",e)},[]),{fetch:D,loading:H}=(0,ee.Z)({onData:e=>p(en(e)),onError:e=>{let{children:l,...t}=e;E({children:(0,s.jsxs)(s.Fragment,{children:["Failed to get file detail. ",l]}),...t})},url:"/file/"}),{data:U,loading:L}=(0,es.Z)("/anvil",{onError:e=>{E({children:(0,s.jsxs)(s.Fragment,{children:["Failed to get node list. ",e]}),type:"warning"})}}),T=(0,o.useMemo)(()=>U&&(0,W.Z)(U),[U]),{data:N,loading:B}=(0,es.Z)("/host?types=dr",{onError:e=>{E({children:(0,s.jsxs)(s.Fragment,{children:["Failed to get DR host list. ",e]}),type:"warning"})}}),q=(0,o.useMemo)(()=>(0,s.jsx)(y.Z,{allowCheckAll:_,allowEdit:!0,allowItemButton:d,disableDelete:!I,edit:d,getListCheckboxProps:()=>({checked:O,onChange:(e,l)=>{V(l)}}),getListItemCheckboxProps:e=>({checked:F(e),onChange:(l,t)=>{R(e,t)}}),header:!0,listEmpty:"No file(s) found.",listItems:x,onAdd:()=>{var l;null===(l=e.current)||void 0===l||l.setOpen(!0)},onDelete:()=>{var e;r(k({onProceedAppend:()=>{Promise.all(M.map(e=>v.Z.delete("/file/".concat(e)))).then(()=>j()),A()},getConfirmDialogTitle:e=>"Delete the following ".concat(e," file(s)?"),renderEntry:e=>{let{key:l}=e;return(0,s.jsx)(S.Ac,{children:null==x?void 0:x[l].name})}})),null===(e=l.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{h(e=>!e)},onItemClick:(e,l)=>{var s;null===(s=t.current)||void 0===s||s.setOpen(!0),D(l)},renderListItem:(e,l)=>{var t;let{checksum:i,name:n,size:r,type:o}=l;return(0,s.jsxs)(w.Z,{columnSpacing:0,fullWidth:!0,md:"row",xs:"column",children:[(0,s.jsxs)(w.Z,{spacing:0,flexGrow:1,children:[(0,s.jsxs)(w.Z,{row:!0,spacing:".5em",children:[(0,s.jsx)(S.$_,{children:n}),(0,s.jsx)($.Z,{flexItem:!0,orientation:"vertical"}),(0,s.jsx)(S.Ac,{children:null===(t=c.get(o))||void 0===t?void 0:t[1]})]}),(0,s.jsx)(S.Ac,{children:(0,a._d)(r,{toUnit:"ibyte"})})]}),(0,s.jsx)(S.$_,{children:i})]})}}),[k,M,d,x,F,D,j,O,I,_,A,V,R,r]),z=(0,o.useMemo)(()=>Z?(0,s.jsx)(Q.Z,{}):q,[Z,q]),er=(0,o.useMemo)(()=>(0,s.jsx)(P.Z,{count:1,ref:i,usePlaceholder:!1}),[]),ea=(0,o.useMemo)(()=>g||L||B,[L,B,g]),eo=(0,o.useMemo)(()=>g||L||B||H,[L,B,H,g]),eu=(0,o.useMemo)(()=>T&&N&&(0,s.jsx)(G,{anvils:T,drHosts:N}),[T,N]),ed=(0,o.useMemo)(()=>T&&N&&m&&(0,s.jsx)(Y,{anvils:T,drHosts:N,onSuccess:()=>{j()},previous:m}),[T,N,m,j]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.s_,{children:[(0,s.jsx)(C.V9,{children:(0,s.jsx)(S.z,{children:"Files"})}),er,z]}),(0,s.jsx)(X.Js,{header:"Add file(s)",loading:ea,ref:e,showClose:!0,wide:!0,children:eu}),(0,s.jsx)(X.Js,{header:"Update file ".concat(null==m?void 0:m.name),loading:eo,ref:t,showClose:!0,wide:!0,children:ed}),(0,s.jsx)(J.Z,{closeOnProceed:!0,wide:!0,...n,ref:l})]})},ea=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"File Manager"})}),(0,s.jsx)(r.Z,{}),(0,s.jsx)(er,{})]})}},function(e){e.O(0,[162,442,318,206,461,602,579,26,321,810,888,774,179],function(){return e(e.s=91953)}),_N_E=e.O()}]);