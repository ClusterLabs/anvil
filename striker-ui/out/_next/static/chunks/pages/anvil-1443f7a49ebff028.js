(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{72315:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/anvil",function(){return n(28914)}])},9968:function(e,t,n){"use strict";var o=n(85893),a=n(77527),r=n(90642),s=n(39971);let i="Decorator",c={ok:"".concat(i,"-ok"),warning:"".concat(i,"-warning"),error:"".concat(i,"-error"),off:"".concat(i,"-off")},l=(0,a.ZP)(r.Z)({borderRadius:s.n_,height:"100%",width:"1.4em",["&.".concat(c.ok)]:{backgroundColor:s.Ej},["&.".concat(c.warning)]:{backgroundColor:s.Wd},["&.".concat(c.error)]:{backgroundColor:s.hM},["&.".concat(c.off)]:{backgroundColor:s.s7}});t.Z=e=>{let{colour:t,...n}=e;return(0,o.jsx)(l,{...n,className:c[t]})}},84337:function(e,t,n){"use strict";var o=n(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:n="",...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.useState)({actionProceedText:e,content:t,titleText:n,...a})}},72094:function(e,t){"use strict";t.Z=(e,t,n)=>{let o;let{query:a}=e;if(void 0===n){let{[t]:e,...n}=a;o=n}else o={...a,[t]:n};return o}},86142:function(e,t,n){"use strict";var o=n(54743),a=n(85893);t.Z=(0,o.Z)((0,a.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert")},13539:function(e,t,n){"use strict";var o=n(63366),a=n(87462),r=n(67294),s=n(8780),i=n(94780),c=n(41796),l=n(66643),d=n(87486),h=n(29567),u=n(77527),x=n(71230),m=n(85893);let p=["className","color","edge","size","sx"],g=e=>{let{classes:t,edge:n,size:o,color:r,checked:s,disabled:c}=e,d={root:["root",n&&"edge".concat((0,l.Z)(n)),"size".concat((0,l.Z)(o))],switchBase:["switchBase","color".concat((0,l.Z)(r)),s&&"checked",c&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},h=(0,i.Z)(d,x.H,t);return(0,a.Z)({},t,h)},v=(0,u.ZP)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.edge&&t["edge".concat((0,l.Z)(n.edge))],t["size".concat((0,l.Z)(n.size))]]}})(e=>{let{ownerState:t}=e;return(0,a.Z)({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},"start"===t.edge&&{marginLeft:-8},"end"===t.edge&&{marginRight:-8},"small"===t.size&&{width:40,height:24,padding:7,["& .".concat(x.Z.thumb)]:{width:16,height:16},["& .".concat(x.Z.switchBase)]:{padding:4,["&.".concat(x.Z.checked)]:{transform:"translateX(16px)"}}})}),j=(0,u.ZP)(d.Z,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.switchBase,{["& .".concat(x.Z.input)]:t.input},"default"!==n.color&&t["color".concat((0,l.Z)(n.color))]]}})(e=>{let{theme:t}=e;return{position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:"".concat("light"===t.palette.mode?t.palette.common.white:t.palette.grey[300]),transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),["&.".concat(x.Z.checked)]:{transform:"translateX(20px)"},["&.".concat(x.Z.disabled)]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:"".concat("light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600])},["&.".concat(x.Z.checked," + .").concat(x.Z.track)]:{opacity:.5},["&.".concat(x.Z.disabled," + .").concat(x.Z.track)]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:"".concat("light"===t.palette.mode?.12:.2)},["& .".concat(x.Z.input)]:{left:"-100%",width:"300%"}}},e=>{let{theme:t,ownerState:n}=e;return(0,a.Z)({"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.action.activeChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,c.Fq)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{["&.".concat(x.Z.checked)]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n.color].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,c.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(x.Z.disabled)]:{color:t.vars?t.vars.palette.Switch["".concat(n.color,"DisabledColor")]:"".concat("light"===t.palette.mode?(0,c.$n)(t.palette[n.color].main,.62):(0,c._j)(t.palette[n.color].main,.55))}},["&.".concat(x.Z.checked," + .").concat(x.Z.track)]:{backgroundColor:(t.vars||t).palette[n.color].main}})}),f=(0,u.ZP)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(e=>{let{theme:t}=e;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:"".concat("light"===t.palette.mode?t.palette.common.black:t.palette.common.white),opacity:t.vars?t.vars.opacity.switchTrack:"".concat("light"===t.palette.mode?.38:.3)}}),Z=(0,u.ZP)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(e=>{let{theme:t}=e;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}}),b=r.forwardRef(function(e,t){let n=(0,h.Z)({props:e,name:"MuiSwitch"}),{className:r,color:i="primary",edge:c=!1,size:l="medium",sx:d}=n,u=(0,o.Z)(n,p),x=(0,a.Z)({},n,{color:i,edge:c,size:l}),b=g(x),w=(0,m.jsx)(Z,{className:b.thumb,ownerState:x});return(0,m.jsxs)(v,{className:(0,s.Z)(b.root,r),sx:d,ownerState:x,children:[(0,m.jsx)(j,(0,a.Z)({type:"checkbox",icon:w,checkedIcon:w,ref:t,ownerState:x},u,{classes:(0,a.Z)({},b,{root:b.switchBase})})),(0,m.jsx)(f,{className:b.track,ownerState:x})]})});t.Z=b},28914:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eU}});var o=n(85893),a=n(77527),r=n(90642),s=n(9008),i=n.n(s),c=n(11163),l=n(67294),d=n(39971);let h=(0,l.createContext)({uuid:""});var u=e=>{let{children:t}=e,[n,a]=(0,l.useState)("");return(0,o.jsx)(h.Provider,{value:{uuid:n,setAnvilUuid:e=>{e!==n&&a(e)}},children:t})},x=n(47407),m=n(56912),p=n(52311),g=n(57882);let v=new Map([["degraded","Degraded"],["optimal","Optimal"],["offline","Offline"]]);var j=e=>{var t;let{anvil:n}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.Ac,{text:n.anvil_name}),(0,o.jsx)(g.Ac,{text:null!==(t=v.get(n.anvilStatus.system))&&void 0!==t?t:"State unavailable"})]})},f=n(9968),Z=n(72094);let b="AnvilList",w={root:"".concat(b,"-root"),divider:"".concat(b,"-divider"),button:"".concat(b,"-button"),anvil:"".concat(b,"-anvil")},_=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(w.root)]:{width:"100%",overflow:"auto",height:"30vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(w.divider)]:{backgroundColor:d.d},["& .".concat(w.button)]:{"&:hover":{backgroundColor:d.$T},paddingLeft:0},["& .".concat(w.anvil)]:{paddingLeft:0}}}),k=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}};var y=e=>{let{list:t}=e,n=(0,c.useRouter)();return(0,o.jsx)(_,{children:(0,o.jsx)(x.Z,{component:"nav",className:w.root,"aria-label":"mailbox folders",children:t.map(e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m.Z,{className:w.divider}),(0,o.jsx)(p.Z,{className:w.button,onClick:()=>{let t=(0,Z.Z)(n,"name",e.anvil_name);n.replace({query:t},void 0,{shallow:!0})},children:(0,o.jsxs)(r.Z,{display:"flex",flexDirection:"row",width:"100%",children:[(0,o.jsx)(r.Z,{p:1,children:(0,o.jsx)(f.Z,{colour:k(e.anvilStatus.system)})}),(0,o.jsx)(r.Z,{p:1,flexGrow:1,className:w.anvil,children:(0,o.jsx)(j,{anvil:e})})]})},e.anvil_uuid)]}))})})},N=n(65375),C=n(13539),S=n(48403),A=n.n(S),P=n(66389),T=n(11100),B=n(90209),M=n(40657);let F={anvilName:"".concat("SelectedAnvil","-anvilName")},R=(0,a.ZP)(r.Z)(()=>({display:"flex",flexDirection:"row",width:"100%",["& .".concat(F.anvilName)]:{paddingLeft:0}})),D=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}},z=e=>-1!==e.hosts.findIndex(e=>{let{state:t}=e;return"offline"!==t});var L=e=>{var t;let{list:n}=e,{uuid:a}=(0,l.useContext)(h),s=(0,l.useMemo)(()=>n.findIndex(e=>e.anvil_uuid===a),[n,a]),i=n[s],{confirmDialog:c,finishConfirm:d,setConfirmDialogLoading:u,setConfirmDialogOpen:x,setConfirmDialogProps:m}=(0,M.Z)();return i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(R,{children:[(0,o.jsx)(r.Z,{p:1,children:(0,o.jsx)(f.Z,{colour:D(i.anvilStatus.system)})}),(0,o.jsxs)(r.Z,{p:1,flexGrow:1,className:F.anvilName,children:[(0,o.jsx)(g.z,{text:i.anvil_name}),(0,o.jsx)(g.z,{text:null!==(t=v.get(i.anvilStatus.system))&&void 0!==t?t:"State unavailable"})]}),(0,o.jsx)(r.Z,{p:1,children:(0,o.jsx)(C.Z,{checked:z(i),onChange:()=>{let e;let{[s]:t}=n,{anvil_name:a,anvil_uuid:r}=t,i="start",c="blue";z(t)&&(i="stop",e="Servers hosted on this node will be shut down!",c="red");let l="".concat(i,"-an"),h=A()(i);m({actionProceedText:h,content:e,onProceedAppend:()=>{u(!0),P.Z.put("/command/".concat(l,"/").concat(r)).then(()=>{d("Success",{children:(0,o.jsx)(o.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,o.jsxs)(o.Fragment,{children:["Failed to register power job. ",t.children]}),d("Error",t)})},proceedColour:c,titleText:"".concat(h," ").concat(a,"?")}),x(!0)}})})]}),c]}):(0,o.jsx)(B.Z,{})},I=n(5499);let E=e=>{let{anvil:t,anvils:n}=e;return(0,I.Z)("/anvil/".concat(t.anvil_uuid),{onSuccess:e=>{let o=n.value.findIndex(e=>e.anvil_uuid===t.anvil_uuid);if(-1===o){n.set(n=>[...n,{...t,...e}]);return}n.set(t=>{let n=[...t];return n[o]={...n[o],...e},n})},periodic:!0}),(0,o.jsx)(r.Z,{display:"none"})};var O=e=>{let{list:t}=e,[n,a]=(0,l.useState)([]),r=(0,l.useMemo)(()=>t.anvils.map(e=>(0,o.jsx)(E,{anvil:e,anvils:{set:a,value:n}},"".concat(e.anvil_uuid,"-fetcher"))),[n,t.anvils]);return(0,o.jsxs)(N.s_,{children:[r,(0,o.jsx)(L,{list:n}),(0,o.jsx)(y,{list:n})]})},G=n(5387),U=()=>{let{uuid:e}=(0,l.useContext)(h),{data:{allocated:t=0,cores:n=0,threads:a=0}={},loading:r}=(0,I.Z)("/anvil/".concat(e,"/cpu"),{periodic:!0}),s=(0,l.useMemo)(()=>r?(0,o.jsx)(B.Z,{}):(0,o.jsxs)(G.Z,{spacing:0,children:[(0,o.jsx)(g.Ac,{text:"Total Cores: ".concat(n)}),(0,o.jsx)(g.Ac,{text:"Total Threads: ".concat(a)}),(0,o.jsx)(g.Ac,{text:"Allocated Cores: ".concat(t)})]}),[t,n,r,a]);return(0,o.jsxs)(N.s_,{children:[(0,o.jsx)(N.V9,{children:(0,o.jsx)(g.z,{text:"CPU"})}),s]})},q=n(25436);let H=new Map([["message_0222","The subnode is in an unknown state."],["message_0223","The subnode is a full cluster member."],["message_0224","The subnode is coming online; the cluster resource manager is running (step 2/3)."],["message_0225","The subnode is coming online; the subnode is a consensus cluster member (step 1/3)."],["message_0226","The subnode has booted, but it is not (yet) joining the cluster."]]);var V=n(41373);let W="AnvilHost",X={state:"".concat(W,"-state"),bar:"".concat(W,"-bar"),label:"".concat(W,"-label"),decoratorBox:"".concat(W,"-decoratorBox")},$=(0,a.ZP)(r.Z)(e=>{let{theme:t}=e;return{overflow:"auto",height:"28vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"},["& .".concat(X.state)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(X.bar)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(X.label)]:{paddingTop:".3em"},["& .".concat(X.decoratorBox)]:{alignSelf:"stretch"}}}),Y=(e,t)=>{let n=e.exec(t);return n?H.get(n[0])||"Error code not recognized":"Error code not found"},J=e=>{switch(e){case"online":return"ok";case"offline":return"off";default:return"warning"}};var K=e=>{let{hosts:t}=e,n=/^[a-zA-Z]/,a=/^(message_[0-9]+)/,{confirmDialog:s,finishConfirm:i,setConfirmDialogLoading:c,setConfirmDialogOpen:l,setConfirmDialogProps:d}=(0,M.Z)();return t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)($,{children:t.map(e=>{var t;if(!e)return;let s="online"===e.state,h="offline"===e.state,u=!h;return(0,o.jsxs)(N.Lg,{children:[(0,o.jsxs)(N.CH,{children:[(0,o.jsx)(r.Z,{flexGrow:1,children:(0,o.jsx)(g.Ac,{text:e.host_name})}),(0,o.jsx)(r.Z,{className:X.decoratorBox,children:(0,o.jsx)(f.Z,{colour:J(e.state)})}),(0,o.jsx)(r.Z,{children:(0,o.jsx)(g.Ac,{text:(null==e?void 0:null===(t=e.state)||void 0===t?void 0:t.replace(n,e=>e.toUpperCase()))||"Not Available"})})]}),(0,o.jsxs)(r.Z,{display:"flex",className:X.state,children:[(0,o.jsx)(r.Z,{className:X.label,children:(0,o.jsx)(g.Ac,{text:"Power: "})}),(0,o.jsx)(r.Z,{flexGrow:1,children:(0,o.jsx)(C.Z,{checked:u,onChange:()=>{let t=u?"stop":"start",n="".concat(t,"-subnode"),a=A()(t);d({actionProceedText:a,content:"start"===t?(0,o.jsx)(g.Ac,{children:"The subnode will be powered on with IPMI commands."}):(0,o.jsxs)(G.Z,{children:[(0,o.jsx)(g.Ac,{children:"The subnode will be powered off."}),(0,o.jsx)(g.Ac,{children:e.server_count?(0,o.jsxs)(o.Fragment,{children:["All ",e.server_count," servers on this subnode will be migrated to the peer subnode if possible. Otherwise, the servers will be shut down."]}):(0,o.jsx)(o.Fragment,{children:"No servers are on this subnode."})})]}),onProceedAppend:()=>{c(!0),P.Z.put("/command/".concat(n,"/").concat(e.host_uuid)).then(()=>{i("Success",{children:(0,o.jsx)(o.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,o.jsxs)(o.Fragment,{children:["Failed to register power job. ",t.children]}),i("Error",t)})},titleText:"".concat(a," ").concat(e.host_name,"?")}),l(!0)}})}),(0,o.jsx)(r.Z,{className:X.label,children:(0,o.jsx)(g.Ac,{text:"Member: "})}),(0,o.jsx)(r.Z,{children:(0,o.jsx)(C.Z,{checked:s,disabled:h,onChange:()=>{let t=s?"leave":"join",n="".concat(t,"-an"),a=A()(t);d({actionProceedText:a,content:"leave"===t?(0,o.jsxs)(G.Z,{children:[(0,o.jsx)(g.Ac,{children:"The subnode will be withdrawn from its cluster and servers will be migrated as necessary."}),(0,o.jsx)(g.Ac,{children:"The operation is reversible. You can tell it to join the cluster again later."})]}):(0,o.jsxs)(G.Z,{children:[(0,o.jsx)(g.Ac,{children:"The subnode will join the cluster it belongs to."}),(0,o.jsx)(g.Ac,{children:"The operation is reversible. You can tell it to withdraw from the cluster again later."})]}),onProceedAppend:()=>{c(!0),P.Z.put("/command/".concat(n,"/").concat(e.host_uuid)).then(()=>{i("Success",{children:(0,o.jsx)(o.Fragment,{children:"Successfully registered cluster membership job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,o.jsxs)(o.Fragment,{children:["Failed to register cluster memebership job."," ",t.children]}),i("Error",t)})},titleText:"".concat(a," cluster on ").concat(e.host_name,"?")}),l(!0)}})})]}),!s&&u&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Z,{display:"flex",width:"100%",className:X.state,children:(0,o.jsx)(r.Z,{children:(0,o.jsx)(g.Ac,{text:Y(a,e.state_message)})})}),(0,o.jsx)(r.Z,{display:"flex",width:"100%",className:X.bar,children:(0,o.jsx)(r.Z,{flexGrow:1,children:(0,o.jsx)(V.ko,{progressPercentage:e.state_percent})})})]})]},e.host_uuid)})}),s]}):(0,o.jsx)($,{})},Q=e=>null==e?void 0:e.filter(e=>e.host_uuid),ee=e=>{let{anvil:t}=e,{uuid:n}=(0,l.useContext)(h),{data:a,loading:r}=(0,I.Z)("/anvil/".concat(n),{periodic:!0}),s=t.findIndex(e=>e.anvil_uuid===n);return(0,o.jsxs)(N.s_,{children:[(0,o.jsx)(g.z,{text:"Subnodes"}),r?(0,o.jsx)(B.Z,{}):(0,o.jsx)(o.Fragment,{children:-1!==s&&a&&(0,o.jsx)(K,{hosts:Q(t[s].hosts).reduce((e,t,n)=>{let o=a.hosts[n];return o&&e.push(o),e},[])})})]})},et=n(54490),en=e=>(0,et._d)(e,{toUnit:"ibyte"}),eo=()=>{let{uuid:e}=(0,l.useContext)(h),{data:{allocated:t="0",reserved:n="0",total:a="0"}={},loading:s}=(0,I.Z)("/anvil/".concat(e,"/memory"),{periodic:!0}),i=(0,l.useMemo)(()=>BigInt(t),[t]),c=(0,l.useMemo)(()=>BigInt(n),[n]),d=(0,l.useMemo)(()=>BigInt(a),[a]);return(0,o.jsxs)(N.s_,{children:[(0,o.jsx)(N.V9,{children:(0,o.jsx)(g.z,{text:"Memory"})}),s?(0,o.jsx)(B.Z,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(r.Z,{display:"flex",width:"100%",children:[(0,o.jsx)(r.Z,{flexGrow:1,children:(0,o.jsx)(g.Ac,{text:"Allocated: ".concat(en(i))})}),(0,o.jsx)(r.Z,{children:(0,o.jsx)(g.Ac,{text:"Free: ".concat(en(d-(c+i)))})})]}),(0,o.jsx)(r.Z,{display:"flex",width:"100%",children:(0,o.jsx)(r.Z,{flexGrow:1,children:(0,o.jsx)(V.CD,{allocated:d?Number((c+i)*BigInt(100)/d):0})})}),(0,o.jsx)(r.Z,{display:"flex",justifyContent:"center",width:"100%",children:(0,o.jsx)(g.Ac,{text:"Total: ".concat(en(d)," | Reserved: ").concat(en(c))})})]})]})},ea=n(29873),er=e=>{let t=[],n={bonds:[]};return e.hosts.forEach(e=>{e.bonds.forEach(o=>{let a=t.findIndex(e=>e===o.bond_name);-1===a?(t.push(o.bond_name),n.bonds.push({bond_name:o.bond_name,bond_uuid:o.bond_uuid,bond_speed:0,bond_state:"degraded",hosts:[{host_name:e.host_name,host_uuid:e.host_uuid,link:o.links[0].is_active?o.links[0]:o.links[1]}]})):n.bonds[a].hosts.push({host_name:e.host_name,host_uuid:e.host_uuid,link:o.links[0].is_active?o.links[0]:o.links[1]})})}),n.bonds.forEach(e=>{let t=e.hosts[0].link.link_speed>e.hosts[1].link.link_speed?1:0;e.bond_speed=e.hosts[t].link.link_speed,e.bond_state=e.hosts[t].link.link_state}),n};let es="Network",ei={container:"".concat(es,"-container"),root:"".concat(es,"-root"),noPaddingLeft:"".concat(es,"-noPaddingLeft"),divider:"".concat(es,"-divider"),verticalDivider:"".concat(es,"-verticalDivider")},ec=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(ei.container)]:{width:"100%",overflow:"auto",height:"32vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(ei.root)]:{paddingTop:".7em",paddingBottom:".7em"},["& .".concat(ei.noPaddingLeft)]:{paddingLeft:0},["& .".concat(ei.divider)]:{backgroundColor:d.d},["& .".concat(ei.verticalDivider)]:{height:"3.5em"}}}),el=e=>{switch(e){case"optimal":return"ok";case"degraded":default:return"warning";case"down":return"error"}};var ed=()=>{let{uuid:e}=(0,l.useContext)(h),[t,n]=(0,l.useState)(),{loading:a}=(0,I.Z)("/anvil/".concat(e,"/network"),{onSuccess:e=>{n(er(e))},periodic:!0});return(0,o.jsx)(N.s_,{children:(0,o.jsxs)(ec,{children:[(0,o.jsx)(g.z,{text:"Network"}),a?(0,o.jsx)(B.Z,{}):(0,o.jsx)(r.Z,{className:ei.container,children:t&&t.bonds.map(e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(r.Z,{className:ei.root,display:"flex",flexDirection:"row",width:"100%",children:[(0,o.jsx)(r.Z,{p:1,className:ei.noPaddingLeft,children:(0,o.jsx)(f.Z,{colour:el(e.bond_state)})}),(0,o.jsxs)(r.Z,{p:1,flexGrow:1,className:ei.noPaddingLeft,children:[(0,o.jsx)(g.Ac,{text:e.bond_name}),(0,o.jsx)(g.Ac,{text:"".concat(e.bond_speed,"Mbps")})]}),(0,o.jsx)(r.Z,{display:"flex",style:{paddingTop:".5em"},children:e.hosts.map((t,n)=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Z,{p:1,style:{paddingTop:0,paddingBottom:0},children:(0,o.jsxs)(r.Z,{children:[(0,o.jsx)(g.Ac,{text:t.host_name,selected:!1}),(0,o.jsx)(g.Ac,{text:t.link.link_name})]})},t.host_name),n!==e.hosts.length-1&&(0,o.jsx)(m.Z,{className:"".concat(ei.divider," ").concat(ei.verticalDivider),orientation:"vertical",flexItem:!0})]}))})]}),(0,o.jsx)(m.Z,{className:ei.divider})]}))})]})})},eh=n(86142),eu=n(96788),ex=n(73939),em=n(19304);let ep=new Map([["running","Running"],["idle","Idle"],["paused","Paused"],["in shutdown","Shutting Down"],["shut off","Off"],["crashed","Crashed"],["pmsuspended","PM Suspended"],["migrating","Migrating"],["provisioning","Provisioning"]]);var eg=n(47177),ev=n(46194),ej=n(45328),ef=n(75492),eZ=n(18766),eb=n(43267),ew=n(84337);let e_="Servers",ek={root:"".concat(e_,"-root"),divider:"".concat(e_,"-divider"),verticalDivider:"".concat(e_,"-verticalDivider"),button:"".concat(e_,"-button"),headerPadding:"".concat(e_,"-headerPadding"),hostsBox:"".concat(e_,"-hostsBox"),hostBox:"".concat(e_,"-hostBox"),checkbox:"".concat(e_,"-checkbox"),editButtonBox:"".concat(e_,"-editButtonBox"),dropdown:"".concat(e_,"-dropdown"),on:"".concat(e_,"-on"),off:"".concat(e_,"-off"),all:"".concat(e_,"-all")},ey=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(ek.root)]:{width:"100%",overflow:"auto",height:"78vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(ek.divider)]:{backgroundColor:d.d},["& .".concat(ek.verticalDivider)]:{height:"75%",paddingTop:"1em"},["& .".concat(ek.button)]:{"&:hover":{backgroundColor:d.$T},paddingLeft:0},["& .".concat(ek.headerPadding)]:{paddingLeft:".3em"},["& .".concat(ek.hostsBox)]:{padding:"1em",paddingRight:0},["& .".concat(ek.hostBox)]:{paddingTop:0},["& .".concat(ek.checkbox)]:{paddingTop:".8em"},["& .".concat(ek.editButtonBox)]:{paddingTop:".3em"},["& .".concat(ek.dropdown)]:{paddingTop:".8em",paddingBottom:".8em"},["& .".concat(ek.all)]:{paddingTop:".5em",paddingLeft:".3em"}}}),eN=e=>{switch(e){case"running":return"ok";case"shut off":return"off";case"crashed":return"error";default:return"warning"}},eC=(0,a.ZP)(eu.Z)({["&.".concat(ek.on)]:{color:d.Ej},["&.".concat(ek.off)]:{color:d.hM}});var eS=e=>{var t;let{anvil:n}=e,[a,s]=(0,l.useState)(null),[i,c]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!1),[v,j]=(0,l.useState)([]),Z=(0,l.useRef)({}),[b,w]=(0,ew.Z)(),{uuid:_}=(0,l.useContext)(h),k=(0,l.useRef)([]),{data:y}=(0,I.Z)("/server?anvilUUIDs=".concat(_),{periodic:!0}),C=(0,l.useMemo)(()=>y&&Object.values(y),[y]),S=e=>{k.current=[],e.filter(e=>"running"===e.state).length&&k.current.push("off"),e.filter(e=>"shut off"===e.state).length&&k.current.push("on")},A=e=>{s(null),v.length&&v.forEach(t=>{P.Z.put("/command".concat("on"===e?"start-server":"stop-server","/").concat(t)).catch(e=>{(0,T.Z)(e)})})},M=e=>{if(!C)return;let t=v.indexOf(e);-1===t?v.push(e):v.splice(t,1),S(C.filter(e=>-1!==v.indexOf(e.uuid))),j([...v])},F=n.findIndex(e=>e.anvil_uuid===_),R=Q(null===(t=n[F])||void 0===t?void 0:t.hosts),D=(0,l.useMemo)(()=>!v.length,[v.length]),z=(0,eb.Zd)();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(N.s_,{children:(0,o.jsxs)(ey,{children:[(0,o.jsxs)(N.V9,{className:ek.headerPadding,sx:{marginBottom:0},children:[(0,o.jsx)(g.z,{text:"Servers"}),i&&(0,o.jsx)(ej.Z,{disabled:D,mapPreset:"delete",onClick:()=>{var e;w({actionProceedText:"Delete",content:"Are you sure you want to delete the selected server(s)? This action is not revertable.",onProceedAppend:()=>{P.Z.request({data:{serverUuids:v},method:"delete",url:"/server"}).catch(e=>{(0,T.Z)(e)})},proceedColour:"red",titleText:"Delete ".concat(v.length," server(s)?")}),null===(e=Z.current.setOpen)||void 0===e||e.call(null,!0)},variant:"redcontained"}),(0,o.jsx)(ej.Z,{mapPreset:"edit",onClick:()=>c(!i),state:String(i)}),(0,o.jsx)(ej.Z,{mapPreset:"add",onClick:()=>z.setOpen(!0)})]}),i&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Z,{className:ek.headerPadding,display:"flex",children:(0,o.jsxs)(r.Z,{flexGrow:1,className:ek.dropdown,children:[(0,o.jsx)(ev.Z,{disabled:D,onClick:e=>{s(e.currentTarget)},startIcon:(0,o.jsx)(eh.Z,{}),children:"Power"}),(0,o.jsx)(ef.Z,{open:!!a,slotProps:{menu:{anchorEl:a,keepMounted:!0,onClose:()=>s(null)}},children:k.current.map(e=>(0,o.jsx)(eZ.Z,{onClick:()=>A(e),children:(0,o.jsx)(eC,{className:ek[e],variant:"subtitle1",children:e.replace(/^[a-z]/,e=>e.toUpperCase())})},e))})]})}),(0,o.jsxs)(r.Z,{display:"flex",children:[(0,o.jsx)(r.Z,{children:(0,o.jsx)(ex.Z,{style:{color:d.lD},color:"secondary",checked:u,onChange:()=>{C&&(u?(S([]),j([])):(S(C),j(C.map(e=>e.uuid))),p(!u))}})}),(0,o.jsx)(r.Z,{className:ek.all,children:(0,o.jsx)(g.Ac,{text:"All"})})]})]}),C?(0,o.jsx)(r.Z,{className:ek.root,children:(0,o.jsx)(x.Z,{component:"nav",children:C.map(e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(em.ZP,{button:!0,className:ek.button,component:i?"div":"a",href:"/server?uuid=".concat(e.uuid,"&server_name=").concat(e.name,"&server_state=").concat(e.state),onClick:()=>M(e.uuid),children:(0,o.jsxs)(r.Z,{display:"flex",flexDirection:"row",width:"100%",children:[i&&(0,o.jsx)(r.Z,{className:ek.checkbox,children:(0,o.jsx)(ex.Z,{style:{color:d.lD},color:"secondary",checked:void 0!==v.find(t=>t===e.uuid)})}),(0,o.jsx)(r.Z,{p:1,children:(0,o.jsx)(f.Z,{colour:eN(e.state)})}),(0,o.jsxs)(r.Z,{p:1,flexGrow:1,children:[(0,o.jsx)(g.Ac,{text:e.name}),(0,o.jsx)(g.Ac,{text:ep.get(e.state)||"Not Available"})]}),(0,o.jsx)(r.Z,{display:"flex",className:ek.hostsBox,children:"shut off"!==e.state&&"crashed"!==e.state&&R.map((t,n)=>{var a;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Z,{p:1,className:ek.hostBox,children:(0,o.jsx)(g.Ac,{text:t.host_name,selected:(null===(a=e.host)||void 0===a?void 0:a.uuid)===t.host_uuid})},t.host_uuid),n!==R.length-1&&(0,o.jsx)(m.Z,{className:"".concat(ek.divider," ").concat(ek.verticalDivider),orientation:"vertical"})]})})})]})},e.uuid),(0,o.jsx)(m.Z,{className:ek.divider})]}))})}):(0,o.jsx)(B.Z,{})]})}),z.dialog,(0,o.jsx)(eg.Z,{closeOnProceed:!0,...b,ref:Z})]})};let eA="SharedStorageHost",eP={fs:"".concat(eA,"-fs"),bar:"".concat(eA,"-bar"),decoratorBox:"".concat(eA,"-decoratorBox")},eT=(0,a.ZP)("div")(()=>({["& .".concat(eP.fs)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(eP.bar)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(eP.decoratorBox)]:{paddingRight:".3em"}}));var eB=e=>{let{group:t}=e,{storage_group_free:n,storage_group_total:a}=t,s=(0,l.useMemo)(()=>BigInt(n),[n]),i=(0,l.useMemo)(()=>BigInt(a),[a]),c=(0,l.useMemo)(()=>i-s,[s,i]),d=(0,l.useMemo)(()=>Number(c*BigInt(100)/i),[c,i]);return(0,o.jsxs)(eT,{children:[(0,o.jsxs)(r.Z,{display:"flex",width:"100%",className:eP.fs,children:[(0,o.jsx)(r.Z,{flexGrow:1,children:(0,o.jsx)(g.Ac,{text:"Used: ".concat(en(i-s))})}),(0,o.jsx)(r.Z,{children:(0,o.jsx)(g.Ac,{text:"Free: ".concat(en(s))})})]}),(0,o.jsx)(r.Z,{display:"flex",width:"100%",className:eP.bar,children:(0,o.jsx)(r.Z,{flexGrow:1,children:(0,o.jsx)(V.CD,{allocated:d})})}),(0,o.jsx)(r.Z,{display:"flex",justifyContent:"center",width:"100%",children:(0,o.jsx)(g.Ac,{text:"Total Storage: ".concat(en(i))})})]})};let eM={root:"".concat("SharedStorage","-root")},eF=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(eM.root)]:{overflow:"auto",height:"78vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%"}}}});var eR=()=>{let{uuid:e}=(0,l.useContext)(h),{data:t,loading:n}=(0,I.Z)("/anvil/".concat(e,"/store"),{periodic:!0});return(0,o.jsx)(N.s_,{children:(0,o.jsxs)(eF,{children:[(0,o.jsx)(g.z,{text:"Shared Storage"}),n?(0,o.jsx)(B.Z,{}):(0,o.jsx)(r.Z,{className:eM.root,children:(null==t?void 0:t.storage_groups)&&t.storage_groups.map(e=>(0,o.jsxs)(N.Lg,{children:[(0,o.jsx)(N.CH,{children:(0,o.jsx)(g.Ac,{text:e.storage_group_name})}),(0,o.jsx)(eB,{group:e},e.storage_group_uuid)]},e.storage_group_uuid))})]})})},eD=()=>{let[e,t]=(0,l.useState)(void 0);return(0,l.useEffect)(()=>{let e=()=>{t(window.innerWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e};let ez="Anvil",eL={child:"".concat(ez,"-child"),server:"".concat(ez,"-server"),container:"".concat(ez,"-container")},eI=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(eL.child)]:{width:"22%",height:"100%",[t.breakpoints.down(d.li)]:{width:"50%"},[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(eL.server)]:{width:"35%",height:"100%",[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(eL.container)]:{display:"flex",flexDirection:"row",width:"100%",justifyContent:"space-between",[t.breakpoints.down("md")]:{display:"block"}}}}),eE=e=>{let{children:t}=e;return(0,l.createElement)(N.s_,{sx:{marginLeft:{xs:"1em",sm:"auto"},marginRight:{xs:"1em",sm:"auto"},marginTop:"calc(50vh - 10em)",maxWidth:{xs:void 0,sm:"60%",md:"50%",lg:"40%"},minWidth:"fit-content"}},t)},eO=(e,t)=>{let n;if(!e.isReady||!t)return"";let{anvils:o}=t,{name:a,uuid:r}=e.query;if(a?n=o.find(e=>e.anvil_name===a):r&&(n=o.find(e=>e.anvil_uuid===r)),!n){let[e={anvil_uuid:""}]=o;return e.anvil_uuid}return n.anvil_uuid},eG=e=>{let{children:t,list:n,loading:a}=e,r=(0,c.useRouter)(),{uuid:s,setAnvilUuid:i}=(0,l.useContext)(h),d=(0,l.useMemo)(()=>{let e=eO(r,n);return null==i||i.call(null,e),e},[n,r,i]);if(s)return(0,o.jsx)(o.Fragment,{children:t});let u=(0,o.jsx)(eE,{children:(0,o.jsx)(B.Z,{sx:{margin:"2em 2.4em"}})}),x=(0,o.jsx)(eE,{children:(0,o.jsx)(ea.Z,{type:"warning",children:"Failed to get system summary."})});return a?u:n&&d?u:x};var eU=()=>{let e=eD(),{data:t,loading:n}=(0,I.Z)("/anvil/summary",{periodic:!0}),a=(0,l.useMemo)(()=>t&&e?e>d.li?(0,o.jsxs)(r.Z,{className:eL.container,children:[(0,o.jsxs)(r.Z,{className:eL.child,children:[(0,o.jsx)(O,{list:t}),(0,o.jsx)(ee,{anvil:t.anvils})]}),(0,o.jsx)(r.Z,{className:eL.server,children:(0,o.jsx)(eS,{anvil:t.anvils})}),(0,o.jsx)(r.Z,{className:eL.child,children:(0,o.jsx)(eR,{})}),(0,o.jsxs)(r.Z,{className:eL.child,children:[(0,o.jsx)(ed,{}),(0,o.jsx)(U,{}),(0,o.jsx)(eo,{})]})]}):(0,o.jsxs)(r.Z,{className:eL.container,children:[(0,o.jsxs)(r.Z,{className:eL.child,children:[(0,o.jsx)(eS,{anvil:t.anvils}),(0,o.jsx)(O,{list:t}),(0,o.jsx)(ee,{anvil:t.anvils})]}),(0,o.jsxs)(r.Z,{className:eL.child,children:[(0,o.jsx)(ed,{}),(0,o.jsx)(eR,{}),(0,o.jsx)(U,{}),(0,o.jsx)(eo,{})]})]}):void 0,[t,e]);return(0,o.jsxs)(eI,{children:[(0,o.jsx)(i(),{children:(0,o.jsx)("title",{children:"Anvil"})}),(0,o.jsx)(q.Z,{}),(0,o.jsx)(u,{children:(0,o.jsx)(eG,{list:t,loading:n,children:a})})]})}},11163:function(e,t,n){e.exports=n(43079)}},function(e){e.O(0,[537,256,202,391,848,436,622,881,888,774,179],function(){return e(e.s=72315)}),_N_E=e.O()}]);