(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[570],{20151:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r=(e,t,n)=>{let r,{query:s}=e;if(void 0===n){let{[t]:e,...n}=s;r=n}else r={...s,[t]:n};return r}},40123:(e,t,n)=>{var r=n(29934),s=n(24015),a=n(48894),o=n(93007),i=n(27136),l=n(4756),c=n(59059),d=n(82731),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(i(e)&&(o(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||d(e)||a(e)))return!e.length;var t=s(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!r(e).length;for(var n in e)if(u.call(e,n))return!1;return!0}},42116:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(14232);let s=function(){let{actionProceedText:e="",content:t="",titleText:n="",...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useState)({actionProceedText:e,content:t,titleText:n,...s})}},42658:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var r=n(37876),s=n(54773),a=n(12981),o=n(90890);let i="Decorator",l={ok:"".concat(i,"-ok"),warning:"".concat(i,"-warning"),error:"".concat(i,"-error"),off:"".concat(i,"-off")},c=(0,s.Ay)(a.A)({borderRadius:o.ax,height:"100%",width:"1.4em",["&.".concat(l.ok)]:{backgroundColor:o.ft},["&.".concat(l.warning)]:{backgroundColor:o.hr},["&.".concat(l.error)]:{backgroundColor:o.UH},["&.".concat(l.off)]:{backgroundColor:o.Qu}}),d=e=>{let{colour:t,...n}=e;return(0,r.jsx)(c,{...n,className:l[t]})}},52241:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/anvil",function(){return n(78684)}])},52627:(e,t,n)=>{"use strict";n.d(t,{A:()=>f});var r=n(37876),s=n(12981),a=n(12572),o=n(63009),i=n(40123),l=n.n(i),c=n(96043),d=n(48440),u=n(31465),h=n(51677);let m=e=>{let{entry:t}=e;return(0,r.jsx)(h.NA,{whiteSpace:"nowrap",children:String(t)})},x=e=>{let{entry:t,key:n}=e;return c.sX.test(n)?(0,r.jsx)(h.EN,{wrapper:"mono",children:String(t)}):m(e)},p=e=>{let{entry:t,hasPassword:n}=e;return l()(t)?(0,r.jsx)(h.a3,{children:"none"}):n?x(e):m(e)},v=e=>{let{depth:t,entry:n,getLabel:a,hasPassword:o,key:i,nest:l,renderValue:c}=e;return(0,r.jsxs)(u.A,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,r.jsx)(h.a3,{children:a({cap:d.A,depth:t,entry:n,hasPassword:o,key:i})}),(0,r.jsx)(s.A,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!l&&c(p,{depth:t,entry:n,hasPassword:o,key:i})})]})},g=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},j=e=>null!==e&&"object"==typeof e&&!l()(e),A=e=>{let{depth:t=0,entries:n,getEntryLabel:s,getListProps:i,getListItemProps:l,hasPassword:c,listKey:d,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:x}=e,p=[];Object.entries(n).forEach(e=>{let[n,o]=e,i="form-summary-entry-".concat(n),d=j(o),v=d?null:o,f={depth:t,entry:v,hasPassword:c,key:n};x(g,f)||p.push((0,r.jsx)(a.Ay,{sx:{paddingLeft:"".concat(t,"em")},...null==l?void 0:l.call(null,f),children:h({depth:t,entry:v,getLabel:s,hasPassword:c,key:n,nest:d,renderValue:m})},i)),d&&t<u&&p.push(A({depth:t+1,entries:o,getEntryLabel:s,hasPassword:c,listKey:n,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:x}))});let v="form-summary-list-".concat(null!=d?d:"root");return(0,r.jsx)(o.A,{dense:!0,disablePadding:!0,...null==i?void 0:i.call(null,{depth:t,entries:n,key:d}),children:p},v)},f=e=>{let{entries:t,getEntryLabel:n=e=>{let{cap:t,key:n}=e;return t(n)},getListProps:r,getListItemProps:s,hasPassword:a=!1,maxDepth:o=3,renderEntry:i=v,renderEntryValue:l=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},skip:c=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)}}=e;return A({entries:t,getEntryLabel:n,getListProps:r,getListItemProps:s,hasPassword:a,maxDepth:o,renderEntry:i,renderEntryValue:l,skip:c})}},56826:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(1e4),s=n(37876);let a=(0,r.A)((0,s.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},57212:(e,t,n)=>{"use strict";n.d(t,{A:()=>b});var r=n(14232),s=n(69241),a=n(4697),o=n(40393),i=n(80027),l=n(78457),c=n(26872),d=n(54773),u=n(29548),h=n(52196),m=n(48452),x=n(67360),p=n(37876);let v=e=>{let{classes:t,edge:n,size:r,color:s,checked:o,disabled:l}=e,c={root:["root",n&&"edge".concat((0,i.A)(n)),"size".concat((0,i.A)(r))],switchBase:["switchBase","color".concat((0,i.A)(s)),o&&"checked",l&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=(0,a.A)(c,m.n,t);return{...t,...d}},g=(0,d.Ay)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.edge&&t["edge".concat((0,i.A)(n.edge))],t["size".concat((0,i.A)(n.size))]]}})({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,["& .".concat(m.A.thumb)]:{width:16,height:16},["& .".concat(m.A.switchBase)]:{padding:4,["&.".concat(m.A.checked)]:{transform:"translateX(16px)"}}}}]}),j=(0,d.Ay)(c.A,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.switchBase,{["& .".concat(m.A.input)]:t.input},"default"!==n.color&&t["color".concat((0,i.A)(n.color))]]}})((0,u.A)(e=>{let{theme:t}=e;return{position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:"".concat("light"===t.palette.mode?t.palette.common.white:t.palette.grey[300]),transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),["&.".concat(m.A.checked)]:{transform:"translateX(20px)"},["&.".concat(m.A.disabled)]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:"".concat("light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600])},["&.".concat(m.A.checked," + .").concat(m.A.track)]:{opacity:.5},["&.".concat(m.A.disabled," + .").concat(m.A.track)]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:"".concat("light"===t.palette.mode?.12:.2)},["& .".concat(m.A.input)]:{left:"-100%",width:"300%"}}}),(0,u.A)(e=>{let{theme:t}=e;return{"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.action.activeChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,o.X4)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(t.palette).filter((0,l.A)(["light"])).map(e=>{let[n]=e;return{props:{color:n},style:{["&.".concat(m.A.checked)]:{color:(t.vars||t).palette[n].main,"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,o.X4)(t.palette[n].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(m.A.disabled)]:{color:t.vars?t.vars.palette.Switch["".concat(n,"DisabledColor")]:"".concat("light"===t.palette.mode?(0,o.a)(t.palette[n].main,.62):(0,o.e$)(t.palette[n].main,.55))}},["&.".concat(m.A.checked," + .").concat(m.A.track)]:{backgroundColor:(t.vars||t).palette[n].main}}}})]}})),A=(0,d.Ay)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})((0,u.A)(e=>{let{theme:t}=e;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:"".concat("light"===t.palette.mode?t.palette.common.black:t.palette.common.white),opacity:t.vars?t.vars.opacity.switchTrack:"".concat("light"===t.palette.mode?.38:.3)}})),f=(0,d.Ay)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})((0,u.A)(e=>{let{theme:t}=e;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}})),b=r.forwardRef(function(e,t){let n=(0,h.b)({props:e,name:"MuiSwitch"}),{className:r,color:a="primary",edge:o=!1,size:i="medium",sx:l,slots:c={},slotProps:d={},...u}=n,m={...n,color:a,edge:o,size:i},b=v(m),w={slots:c,slotProps:d},[y,k]=(0,x.A)("root",{className:(0,s.A)(b.root,r),elementType:g,externalForwardedProps:w,ownerState:m,additionalProps:{sx:l}}),[C,_]=(0,x.A)("thumb",{className:b.thumb,elementType:f,externalForwardedProps:w,ownerState:m}),N=(0,p.jsx)(C,{..._}),[S,T]=(0,x.A)("track",{className:b.track,elementType:A,externalForwardedProps:w,ownerState:m});return(0,p.jsxs)(y,{...k,children:[(0,p.jsx)(j,{type:"checkbox",icon:N,checkedIcon:N,ref:t,ownerState:m,...u,classes:{...b,root:b.switchBase},slots:{...c.switchBase&&{root:c.switchBase},...c.input&&{input:c.input}},slotProps:{...d.switchBase&&{root:"function"==typeof d.switchBase?d.switchBase(m):d.switchBase},...d.input&&{input:"function"==typeof d.input?d.input(m):d.input}}}),(0,p.jsx)(S,{...T})]})})},78684:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>e5});var r=n(37876),s=n(54773),a=n(12981),o=n(77328),i=n.n(o),l=n(89099),c=n(14232),d=n(90890);let u=(0,c.createContext)({uuid:""}),h=e=>{let{children:t}=e,[n,s]=(0,c.useState)(""),a=(0,c.useMemo)(()=>({uuid:n,setAnvilUuid:e=>{e!==n&&s(e)}}),[n]);return(0,r.jsx)(u.Provider,{value:a,children:t})};var m=n(63009),x=n(71538),p=n(12398);let v=new Map([["degraded","Degraded"],["optimal","Optimal"],["offline","Offline"]]);var g=n(51677);let j=e=>{var t;let{anvil:n}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.a3,{text:n.anvil_name}),(0,r.jsx)(g.a3,{text:null!=(t=v.get(n.anvilStatus.system))?t:"State unavailable"})]})};var A=n(42658),f=n(20151);let b="AnvilList",w={root:"".concat(b,"-root"),divider:"".concat(b,"-divider"),button:"".concat(b,"-button"),anvil:"".concat(b,"-anvil")},y=(0,s.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(w.root)]:{width:"100%",overflow:"auto",height:"30vh",paddingRight:".3em",[t.breakpoints.down(d.NF)]:{height:"100%",overflow:"hidden"}},["& .".concat(w.divider)]:{backgroundColor:d.eT},["& .".concat(w.button)]:{"&:hover":{backgroundColor:d.l6},paddingLeft:0},["& .".concat(w.anvil)]:{paddingLeft:0}}}),k=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}},C=e=>{let{list:t}=e,n=(0,l.useRouter)();return(0,r.jsx)(y,{children:(0,r.jsx)(m.A,{component:"nav",className:w.root,"aria-label":"mailbox folders",children:t.map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.A,{className:w.divider}),(0,r.jsx)(p.A,{className:w.button,onClick:()=>{let t=(0,f.A)(n,"name",e.anvil_name);n.replace({query:t},void 0,{shallow:!0})},children:(0,r.jsxs)(a.A,{display:"flex",flexDirection:"row",width:"100%",children:[(0,r.jsx)(a.A,{p:1,children:(0,r.jsx)(A.A,{colour:k(e.anvilStatus.system)})}),(0,r.jsx)(a.A,{p:1,flexGrow:1,className:w.anvil,children:(0,r.jsx)(j,{anvil:e})})]})},e.anvil_uuid)]}))})})};var _=n(23437),N=n(57212),S=n(52076),T=n.n(S),F=n(23934),M=n(5806),P=n(79982),O=n(30764);let B={anvilName:"".concat("SelectedAnvil","-anvilName")},z=(0,s.Ay)(a.A)(()=>({display:"flex",flexDirection:"row",width:"100%",["& .".concat(B.anvilName)]:{paddingLeft:0}})),D=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}},G=e=>-1!==e.hosts.findIndex(e=>{let{state:t}=e;return"offline"!==t}),R=e=>{var t;let{list:n}=e,{uuid:s}=(0,c.useContext)(u),o=(0,c.useMemo)(()=>n.findIndex(e=>e.anvil_uuid===s),[n,s]),i=n[o],{confirmDialog:l,finishConfirm:d,setConfirmDialogLoading:h,setConfirmDialogOpen:m,setConfirmDialogProps:x}=(0,O.A)();return i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(z,{children:[(0,r.jsx)(a.A,{p:1,children:(0,r.jsx)(A.A,{colour:D(i.anvilStatus.system)})}),(0,r.jsxs)(a.A,{p:1,flexGrow:1,className:B.anvilName,children:[(0,r.jsx)(g.HM,{text:i.anvil_name}),(0,r.jsx)(g.HM,{text:null!=(t=v.get(i.anvilStatus.system))?t:"State unavailable"})]}),(0,r.jsx)(a.A,{p:1,children:(0,r.jsx)(N.A,{checked:G(i),onChange:()=>{let e,{[o]:t}=n,{anvil_name:s,anvil_uuid:a}=t,i="start",l="blue";G(t)&&(i="stop",e="Servers hosted on this node will be shut down!",l="red");let c="".concat(i,"-an"),u=T()(i);x({actionProceedText:u,content:e,onProceedAppend:()=>{h(!0),F.A.put("/command/".concat(c,"/").concat(a)).then(()=>{d("Success",{children:(0,r.jsx)(r.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,M.A)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register power job. ",t.children]}),d("Error",t)})},proceedColour:l,titleText:"".concat(u," ").concat(s,"?")}),m(!0)}})})]}),l]}):(0,r.jsx)(P.A,{})};var L=n(59664);let I=e=>{let{anvil:t,anvils:n}=e;return(0,L.A)("/anvil/".concat(t.anvil_uuid),{onSuccess:e=>{let r=n.value.findIndex(e=>e.anvil_uuid===t.anvil_uuid);if(-1===r)return void n.set(n=>[...n,{...t,...e}]);n.set(t=>{let n=[...t];return n[r]={...n[r],...e},n})},periodic:!0}),(0,r.jsx)(a.A,{display:"none"})},E=e=>{let{list:t}=e,[n,s]=(0,c.useState)([]),a=(0,c.useMemo)(()=>t.anvils.map(e=>(0,r.jsx)(I,{anvil:e,anvils:{set:s,value:n}},"".concat(e.anvil_uuid,"-fetcher"))),[n,t.anvils]);return(0,r.jsxs)(_.Zk,{children:[a,(0,r.jsx)(R,{list:n}),(0,r.jsx)(C,{list:n})]})};var U=n(31465);let Z=()=>{let{uuid:e}=(0,c.useContext)(u),{data:{allocated:t=0,cores:n=0,threads:s=0}={},loading:a}=(0,L.A)("/anvil/".concat(e,"/cpu"),{periodic:!0}),o=(0,c.useMemo)(()=>a?(0,r.jsx)(P.A,{}):(0,r.jsxs)(U.A,{spacing:0,children:[(0,r.jsx)(g.a3,{text:"Total Cores: ".concat(n)}),(0,r.jsx)(g.a3,{text:"Total Threads: ".concat(s)}),(0,r.jsx)(g.a3,{text:"Allocated Cores: ".concat(t)})]}),[t,n,a,s]);return(0,r.jsxs)(_.Zk,{children:[(0,r.jsx)(_.aO,{children:(0,r.jsx)(g.HM,{text:"CPU"})}),o]})};var H=n(86732);let W=new Map([["message_0222","The subnode is in an unknown state."],["message_0223","The subnode is a full cluster member."],["message_0224","The subnode is coming online; the cluster resource manager is running (step 2/3)."],["message_0225","The subnode is coming online; the subnode is a consensus cluster member (step 1/3)."],["message_0226","The subnode has booted, but it is not (yet) joining the cluster."]]);var X=n(64632);let q="AnvilHost",$={state:"".concat(q,"-state"),bar:"".concat(q,"-bar"),label:"".concat(q,"-label"),decoratorBox:"".concat(q,"-decoratorBox")},V=(0,s.Ay)(a.A)(e=>{let{theme:t}=e;return{overflow:"auto",height:"28vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.NF)]:{height:"100%",overflow:"hidden"},["& .".concat($.state)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat($.bar)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat($.label)]:{paddingTop:".3em"},["& .".concat($.decoratorBox)]:{alignSelf:"stretch"}}}),Y=(e,t)=>{let n=e.exec(t);return n?W.get(n[0])||"Error code not recognized":"Error code not found"},J=e=>{switch(e){case"online":return"ok";case"offline":return"off";default:return"warning"}},K=e=>{let{hosts:t}=e,n=/^[a-zA-Z]/,s=/^(message_[0-9]+)/,{confirmDialog:o,finishConfirm:i,setConfirmDialogLoading:l,setConfirmDialogOpen:c,setConfirmDialogProps:d}=(0,O.A)();return t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(V,{children:t.map(e=>{var t;if(!e)return;let o="online"===e.state,u="offline"===e.state,h=!u;return(0,r.jsxs)(_.t$,{children:[(0,r.jsxs)(_.WJ,{children:[(0,r.jsx)(a.A,{flexGrow:1,children:(0,r.jsx)(g.a3,{text:e.host_name})}),(0,r.jsx)(a.A,{className:$.decoratorBox,children:(0,r.jsx)(A.A,{colour:J(e.state)})}),(0,r.jsx)(a.A,{children:(0,r.jsx)(g.a3,{text:(null==e||null==(t=e.state)?void 0:t.replace(n,e=>e.toUpperCase()))||"Not Available"})})]}),(0,r.jsxs)(a.A,{display:"flex",className:$.state,children:[(0,r.jsx)(a.A,{className:$.label,children:(0,r.jsx)(g.a3,{text:"Power: "})}),(0,r.jsx)(a.A,{flexGrow:1,children:(0,r.jsx)(N.A,{checked:h,onChange:()=>{let t,n=h?"stop":"start",s="".concat(n,"-subnode"),a=T()(n);d({actionProceedText:a,content:"start"===n?(0,r.jsx)(g.a3,{children:"The subnode will be powered on with IPMI commands."}):(0,r.jsxs)(U.A,{children:[(0,r.jsx)(g.a3,{children:"The subnode will be powered off."}),(0,r.jsx)(g.a3,{children:e.server_count?(0,r.jsxs)(r.Fragment,{children:["All ",e.server_count," servers on this subnode will be migrated to the peer subnode if possible. Otherwise, the servers will be shut down."]}):(0,r.jsx)(r.Fragment,{children:"No servers are on this subnode."})})]}),onProceedAppend:()=>{l(!0),F.A.put("/command/".concat(s,"/").concat(e.host_uuid)).then(()=>{i("Success",{children:(0,r.jsx)(r.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,M.A)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register power job. ",t.children]}),i("Error",t)})},titleText:"".concat(a," ").concat(e.host_name,"?")}),c(!0)}})}),(0,r.jsx)(a.A,{className:$.label,children:(0,r.jsx)(g.a3,{text:"Member: "})}),(0,r.jsx)(a.A,{children:(0,r.jsx)(N.A,{checked:o,disabled:u,onChange:()=>{let t,n=o?"leave":"join",s="".concat(n,"-an"),a=T()(n);d({actionProceedText:a,content:"leave"===n?(0,r.jsxs)(U.A,{children:[(0,r.jsx)(g.a3,{children:"The subnode will be withdrawn from its cluster and servers will be migrated as necessary."}),(0,r.jsx)(g.a3,{children:"The operation is reversible. You can tell it to join the cluster again later."})]}):(0,r.jsxs)(U.A,{children:[(0,r.jsx)(g.a3,{children:"The subnode will join the cluster it belongs to."}),(0,r.jsx)(g.a3,{children:"The operation is reversible. You can tell it to withdraw from the cluster again later."})]}),onProceedAppend:()=>{l(!0),F.A.put("/command/".concat(s,"/").concat(e.host_uuid)).then(()=>{i("Success",{children:(0,r.jsx)(r.Fragment,{children:"Successfully registered cluster membership job."})})}).catch(e=>{let t=(0,M.A)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register cluster memebership job."," ",t.children]}),i("Error",t)})},titleText:"".concat(a," cluster on ").concat(e.host_name,"?")}),c(!0)}})})]}),!o&&h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{display:"flex",width:"100%",className:$.state,children:(0,r.jsx)(a.A,{children:(0,r.jsx)(g.a3,{text:Y(s,e.state_message)})})}),(0,r.jsx)(a.A,{display:"flex",width:"100%",className:$.bar,children:(0,r.jsx)(a.A,{flexGrow:1,children:(0,r.jsx)(X.z2,{progressPercentage:e.state_percent})})})]})]},e.host_uuid)})}),o]}):(0,r.jsx)(V,{})},Q=e=>null==e?void 0:e.filter(e=>e.host_uuid),ee=e=>{let{anvil:t}=e,{uuid:n}=(0,c.useContext)(u),{data:s,loading:a}=(0,L.A)("/anvil/".concat(n),{periodic:!0}),o=t.findIndex(e=>e.anvil_uuid===n);return(0,r.jsxs)(_.Zk,{children:[(0,r.jsx)(g.HM,{text:"Subnodes"}),a?(0,r.jsx)(P.A,{}):-1!==o&&s&&(0,r.jsx)(K,{hosts:Q(t[o].hosts).reduce((e,t,n)=>{let r=s.hosts[n];return r&&e.push(r),e},[])})]})};var et=n(69647);let en=e=>(0,et.zz)(e,{toUnit:"ibyte"}),er=()=>{let{uuid:e}=(0,c.useContext)(u),{data:{allocated:t="0",reserved:n="0",total:s="0"}={},loading:o}=(0,L.A)("/anvil/".concat(e,"/memory"),{periodic:!0}),i=(0,c.useMemo)(()=>BigInt(t),[t]),l=(0,c.useMemo)(()=>BigInt(n),[n]),d=(0,c.useMemo)(()=>BigInt(s),[s]);return(0,r.jsxs)(_.Zk,{children:[(0,r.jsx)(_.aO,{children:(0,r.jsx)(g.HM,{text:"Memory"})}),o?(0,r.jsx)(P.A,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.A,{display:"flex",width:"100%",children:[(0,r.jsx)(a.A,{flexGrow:1,children:(0,r.jsx)(g.a3,{text:"Allocated: ".concat(en(i))})}),(0,r.jsx)(a.A,{children:(0,r.jsx)(g.a3,{text:"Free: ".concat(en(d-(l+i)))})})]}),(0,r.jsx)(a.A,{display:"flex",width:"100%",children:(0,r.jsx)(a.A,{flexGrow:1,children:(0,r.jsx)(X.kv,{allocated:d?Number((l+i)*BigInt(100)/d):0})})}),(0,r.jsx)(a.A,{display:"flex",justifyContent:"center",width:"100%",children:(0,r.jsx)(g.a3,{text:"Total: ".concat(en(d)," | Reserved: ").concat(en(l))})})]})]})};var es=n(5755);let ea=e=>{let t=[],n={bonds:[]};return e.hosts.forEach(e=>{e.bonds.forEach(r=>{let s=t.findIndex(e=>e===r.bond_name);-1===s?(t.push(r.bond_name),n.bonds.push({bond_name:r.bond_name,bond_uuid:r.bond_uuid,bond_speed:0,bond_state:"degraded",hosts:[{host_name:e.host_name,host_uuid:e.host_uuid,link:r.links[0].is_active?r.links[0]:r.links[1]}]})):n.bonds[s].hosts.push({host_name:e.host_name,host_uuid:e.host_uuid,link:r.links[0].is_active?r.links[0]:r.links[1]})})}),n.bonds.forEach(e=>{let t=+(e.hosts[0].link.link_speed>e.hosts[1].link.link_speed);e.bond_speed=e.hosts[t].link.link_speed,e.bond_state=e.hosts[t].link.link_state}),n},eo="Network",ei={container:"".concat(eo,"-container"),root:"".concat(eo,"-root"),noPaddingLeft:"".concat(eo,"-noPaddingLeft"),divider:"".concat(eo,"-divider"),verticalDivider:"".concat(eo,"-verticalDivider")},el=(0,s.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(ei.container)]:{width:"100%",overflow:"auto",height:"32vh",paddingRight:".3em",[t.breakpoints.down(d.NF)]:{height:"100%",overflow:"hidden"}},["& .".concat(ei.root)]:{paddingTop:".7em",paddingBottom:".7em"},["& .".concat(ei.noPaddingLeft)]:{paddingLeft:0},["& .".concat(ei.divider)]:{backgroundColor:d.eT},["& .".concat(ei.verticalDivider)]:{height:"3.5em"}}}),ec=e=>{switch(e){case"optimal":return"ok";case"degraded":default:return"warning";case"down":return"error"}},ed=()=>{let{uuid:e}=(0,c.useContext)(u),[t,n]=(0,c.useState)(),{loading:s}=(0,L.A)("/anvil/".concat(e,"/network"),{onSuccess:e=>{n(ea(e))},periodic:!0});return(0,r.jsx)(_.Zk,{children:(0,r.jsxs)(el,{children:[(0,r.jsx)(g.HM,{text:"Network"}),s?(0,r.jsx)(P.A,{}):(0,r.jsx)(a.A,{className:ei.container,children:t&&t.bonds.map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.A,{className:ei.root,display:"flex",flexDirection:"row",width:"100%",children:[(0,r.jsx)(a.A,{p:1,className:ei.noPaddingLeft,children:(0,r.jsx)(A.A,{colour:ec(e.bond_state)})}),(0,r.jsxs)(a.A,{p:1,flexGrow:1,className:ei.noPaddingLeft,children:[(0,r.jsx)(g.a3,{text:e.bond_name}),(0,r.jsx)(g.a3,{text:"".concat(e.bond_speed,"Mbps")})]}),(0,r.jsx)(a.A,{display:"flex",style:{paddingTop:".5em"},children:e.hosts.map((t,n)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{p:1,style:{paddingTop:0,paddingBottom:0},children:(0,r.jsxs)(a.A,{children:[(0,r.jsx)(g.a3,{text:t.host_name,selected:!1}),(0,r.jsx)(g.a3,{text:t.link.link_name})]})},t.host_name),n!==e.hosts.length-1&&(0,r.jsx)(x.A,{className:"".concat(ei.divider," ").concat(ei.verticalDivider),orientation:"vertical",flexItem:!0})]}))})]}),(0,r.jsx)(x.A,{className:ei.divider})]}))})]})})};var eu=n(56826),eh=n(77018),em=n(99846);let ex=new Map([["running","Running"],["idle","Idle"],["paused","Paused"],["in shutdown","Shutting Down"],["shut off","Off"],["crashed","Crashed"],["pmsuspended","PM Suspended"],["migrating","Migrating"],["provisioning","Provisioning"]]);var ep=n(75925),ev=n(53198),eg=n(22481),ej=n(74503),eA=n(72015),ef=n(64830),eb=n(42116);let ew="Servers",ey={root:"".concat(ew,"-root"),divider:"".concat(ew,"-divider"),verticalDivider:"".concat(ew,"-verticalDivider"),button:"".concat(ew,"-button"),headerPadding:"".concat(ew,"-headerPadding"),hostsBox:"".concat(ew,"-hostsBox"),hostBox:"".concat(ew,"-hostBox"),checkbox:"".concat(ew,"-checkbox"),editButtonBox:"".concat(ew,"-editButtonBox"),dropdown:"".concat(ew,"-dropdown"),on:"".concat(ew,"-on"),off:"".concat(ew,"-off"),all:"".concat(ew,"-all")},ek=(0,s.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(ey.root)]:{width:"100%",overflow:"auto",height:"78vh",paddingRight:".3em",[t.breakpoints.down(d.NF)]:{height:"100%",overflow:"hidden"}},["& .".concat(ey.divider)]:{backgroundColor:d.eT},["& .".concat(ey.verticalDivider)]:{height:"75%",paddingTop:"1em"},["& .".concat(ey.button)]:{"&:hover":{backgroundColor:d.l6},paddingLeft:0},["& .".concat(ey.headerPadding)]:{paddingLeft:".3em"},["& .".concat(ey.hostsBox)]:{padding:"1em",paddingRight:0},["& .".concat(ey.hostBox)]:{paddingTop:0},["& .".concat(ey.checkbox)]:{paddingTop:".8em"},["& .".concat(ey.editButtonBox)]:{paddingTop:".3em"},["& .".concat(ey.dropdown)]:{paddingTop:".8em",paddingBottom:".8em"},["& .".concat(ey.all)]:{paddingTop:".5em",paddingLeft:".3em"}}}),eC=e=>{switch(e){case"running":return"ok";case"shut off":return"off";case"crashed":return"error";default:return"warning"}},e_=(0,s.Ay)(eh.A)({["&.".concat(ey.on)]:{color:d.ft},["&.".concat(ey.off)]:{color:d.UH}}),eN=e=>{var t;let{anvil:n}=e,[s,o]=(0,c.useState)(null),[i,l]=(0,c.useState)(!1),[h,v]=(0,c.useState)(!1),[j,f]=(0,c.useState)([]),b=(0,c.useRef)({}),[w,y]=(0,eb.A)(),{uuid:k}=(0,c.useContext)(u),C=(0,c.useRef)([]),{data:N}=(0,L.A)("/server?anvilUUIDs=".concat(k),{periodic:!0}),S=(0,c.useMemo)(()=>N&&Object.values(N),[N]),T=e=>{C.current=[],e.filter(e=>"running"===e.state).length&&C.current.push("off"),e.filter(e=>"shut off"===e.state).length&&C.current.push("on")},O=e=>{o(null),j.length&&j.forEach(t=>{F.A.put("/command".concat("on"===e?"start-server":"stop-server","/").concat(t)).catch(e=>{(0,M.A)(e)})})},B=e=>{if(!S)return;let t=j.indexOf(e);-1===t?j.push(e):j.splice(t,1),T(S.filter(e=>-1!==j.indexOf(e.uuid))),f([...j])},z=n.findIndex(e=>e.anvil_uuid===k),D=Q(null==(t=n[z])?void 0:t.hosts),G=(0,c.useMemo)(()=>!j.length,[j.length]),R=(0,ef.kL)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.Zk,{children:(0,r.jsxs)(ek,{children:[(0,r.jsxs)(_.aO,{className:ey.headerPadding,sx:{marginBottom:0},children:[(0,r.jsx)(g.HM,{text:"Servers"}),i&&(0,r.jsx)(eg.A,{disabled:G,mapPreset:"delete",onClick:()=>{var e;y({actionProceedText:"Delete",content:"Are you sure you want to delete the selected server(s)? This action is not revertable.",onProceedAppend:()=>{F.A.request({data:{serverUuids:j},method:"delete",url:"/server"}).catch(e=>{(0,M.A)(e)})},proceedColour:"red",titleText:"Delete ".concat(j.length," server(s)?")}),null==(e=b.current.setOpen)||e.call(null,!0)},variant:"redcontained"}),(0,r.jsx)(eg.A,{mapPreset:"edit",onClick:()=>l(!i),state:String(i)}),(0,r.jsx)(eg.A,{mapPreset:"add",onClick:()=>R.setOpen(!0)})]}),i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{className:ey.headerPadding,display:"flex",children:(0,r.jsxs)(a.A,{flexGrow:1,className:ey.dropdown,children:[(0,r.jsx)(ev.A,{disabled:G,onClick:e=>{o(e.currentTarget)},startIcon:(0,r.jsx)(eu.A,{}),children:"Power"}),(0,r.jsx)(ej.A,{open:!!s,slotProps:{menu:{anchorEl:s,keepMounted:!0,onClose:()=>o(null)}},children:C.current.map(e=>(0,r.jsx)(eA.A,{onClick:()=>O(e),children:(0,r.jsx)(e_,{className:ey[e],variant:"subtitle1",children:e.replace(/^[a-z]/,e=>e.toUpperCase())})},e))})]})}),(0,r.jsxs)(a.A,{display:"flex",children:[(0,r.jsx)(a.A,{children:(0,r.jsx)(em.A,{style:{color:d.a$},color:"secondary",checked:h,onChange:()=>{S&&(h?(T([]),f([])):(T(S),f(S.map(e=>e.uuid))),v(!h))}})}),(0,r.jsx)(a.A,{className:ey.all,children:(0,r.jsx)(g.a3,{text:"All"})})]})]}),S?(0,r.jsx)(a.A,{className:ey.root,children:(0,r.jsx)(m.A,{component:"nav",children:S.map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.A,{className:ey.button,component:i?"div":"a",href:"/server?uuid=".concat(e.uuid,"&server_name=").concat(e.name,"&server_state=").concat(e.state),onClick:()=>B(e.uuid),children:(0,r.jsxs)(a.A,{display:"flex",flexDirection:"row",width:"100%",children:[i&&(0,r.jsx)(a.A,{className:ey.checkbox,children:(0,r.jsx)(em.A,{style:{color:d.a$},color:"secondary",checked:void 0!==j.find(t=>t===e.uuid)})}),(0,r.jsx)(a.A,{p:1,children:(0,r.jsx)(A.A,{colour:eC(e.state)})}),(0,r.jsxs)(a.A,{p:1,flexGrow:1,children:[(0,r.jsx)(g.a3,{text:e.name}),(0,r.jsx)(g.a3,{text:ex.get(e.state)||"Not Available"})]}),(0,r.jsx)(a.A,{display:"flex",className:ey.hostsBox,children:"shut off"!==e.state&&"crashed"!==e.state&&D.map((t,n)=>{var s;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{p:1,className:ey.hostBox,children:(0,r.jsx)(g.a3,{text:t.host_name,selected:(null==(s=e.host)?void 0:s.uuid)===t.host_uuid})},t.host_uuid),n!==D.length-1&&(0,r.jsx)(x.A,{className:"".concat(ey.divider," ").concat(ey.verticalDivider),orientation:"vertical"})]})})})]})},e.uuid),(0,r.jsx)(x.A,{className:ey.divider})]}))})}):(0,r.jsx)(P.A,{})]})}),R.dialog,(0,r.jsx)(ep.A,{closeOnProceed:!0,...w,ref:b})]})};var eS=n(19121),eT=n(57547),eF=n(64410);let eM=e=>{let{formDialogRef:t,storages:n,target:s,uuid:a}=e,{[a]:o}=n.storageGroups,{name:i}=o,l=(0,c.useMemo)(()=>{var e;return null!=(e=(0,et.zz)(o.free,{toUnit:"ibyte"}))?e:"none"},[o.free]),d=(0,c.useMemo)(()=>{var e;return null!=(e=(0,et.zz)(o.size,{toUnit:"ibyte"}))?e:"none"},[o.size]),u=(0,c.useMemo)(()=>{var e;return null!=(e=(0,et.zz)(o.used,{toUnit:"ibyte"}))?e:"none"},[o.used]),h=(0,c.useMemo)(()=>Object.values(o.members),[o.members]),m=(0,c.useMemo)(()=>h.map(e=>{var t,s;let{volumeGroup:a}=e,{[a]:o}=n.volumeGroups,{[o.host]:i}=n.hosts,l=null!=(t=(0,et.zz)(o.free,{toUnit:"ibyte"}))?t:"none",c=null!=(s=(0,et.zz)(o.size,{toUnit:"ibyte"}))?s:"none";return(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(eF.Ay,{container:!0,children:[(0,r.jsx)(eF.Ay,{item:!0,xs:!0,children:(0,r.jsx)(g.a3,{variant:"caption",children:i.short})}),(0,r.jsx)(eF.Ay,{item:!0,textAlign:"right",children:(0,r.jsxs)(g.a3,{variant:"caption",children:["Free",(0,r.jsx)(g.kp,{children:l}),"/",(0,r.jsx)(g.kp,{children:c})]})}),(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsx)(X.Fn,{thin:!0,volumeGroup:o})})]})},e.uuid)}),[h,n.hosts,n.volumeGroups]);return(0,r.jsxs)(_.t$,{children:[(0,r.jsxs)(_.WJ,{children:[(0,r.jsx)(g.a3,{children:i}),(0,r.jsx)(eg.A,{mapPreset:"edit",onClick:()=>{var e;s.set(a),null==(e=t.current)||e.setOpen(!0)},size:"small",state:"false"})]}),(0,r.jsx)(_.BF,{children:(0,r.jsxs)(eF.Ay,{container:!0,rowSpacing:"1em",children:[(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(eF.Ay,{container:!0,children:[(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(eF.Ay,{container:!0,children:[(0,r.jsx)(eF.Ay,{item:!0,children:(0,r.jsxs)(g.a3,{children:["Used ",(0,r.jsx)(g.kp,{children:u})]})}),(0,r.jsx)(eF.Ay,{item:!0,xs:!0}),(0,r.jsx)(eF.Ay,{item:!0,textAlign:"right",children:(0,r.jsxs)(g.a3,{children:["Free",(0,r.jsx)(g.kp,{children:l}),"/",(0,r.jsx)(g.kp,{children:d})]})})]})}),(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsx)(X.Fn,{storageGroup:o})})]})}),...m]})})]})};var eP=n(63190),eO=n(52627),eB=n(71401),ez=n(69267),eD=n(91408),eG=n(45566);let eR=eD.Ik({vg:(0,eG.ZC)().required().nullable()});var eL=n(2062);let eI=(e,t)=>{let{storageGroups:n}=e,{[t]:r}=n,s=Object.values(n);r&&(s=s.filter(e=>e.name!==r.name));let a=s.map(e=>e.name);return eD.Ik({hosts:eD.RZ(e=>eD.Ik((0,eL.A)(e,eR))),name:eD.Yj().required().notOneOf(a,"${path} already exists")})};var eE=n(60282),eU=n(57763);let eZ=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{formikUtils:a,host:o,storages:i}=s,{[o]:l}=i.hosts,{changeFieldValue:d,formik:u}=a,h=(0,c.useMemo)(()=>({vg:"hosts.".concat(o,".vg")}),[o]),m=(0,c.useMemo)(()=>Object.values(i.volumeGroups).filter(e=>e.host===o).map(e=>e.uuid),[o,i.volumeGroups]);return(0,r.jsxs)(eF.Ay,{alignItems:"center",container:!0,spacing:"1em",children:[(0,r.jsx)(eF.Ay,{item:!0,xs:!0,children:(0,r.jsx)(eU.A,{filterOptions:(0,eE.Z)({stringify:e=>{let{[e]:t}=i.volumeGroups;return"".concat(t.name,"\n").concat(t.internalUuid)}}),getOptionDisabled:e=>{let t=!i.unusedVolumeGroups.includes(e),n=u.initialValues.hosts[o].vg!==e;return t&&n},getOptionLabel:e=>{let{[e]:t}=i.volumeGroups;return t.name},id:h.vg,label:"".concat(l.short," volume group"),noOptionsText:"No volume group(s) available",onChange:(e,t)=>{d(h.vg,t,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{var n,s;let{[t]:a}=i.volumeGroups,o=null!=(n=(0,et.zz)(a.free,{toUnit:"ibyte"}))?n:"none",l=null!=(s=(0,et.zz)(a.size,{toUnit:"ibyte"}))?s:"none";return(0,c.createElement)("li",{...e,key:"vg-".concat(t)},(0,r.jsxs)(eF.Ay,{container:!0,rowSpacing:"0.4em",children:[(0,r.jsxs)(eF.Ay,{alignItems:"center",container:!0,spacing:"0.5em",children:[(0,r.jsx)(eF.Ay,{item:!0,xs:!0,children:(0,r.jsx)(g.a3,{inheritColour:!0,noWrap:!0,children:a.name})}),(0,r.jsx)(eF.Ay,{item:!0,children:(0,r.jsxs)(g.a3,{inheritColour:!0,noWrap:!0,variant:"caption",children:["Free",(0,r.jsx)(g.kp,{inheritColour:!0,children:o}),"/",(0,r.jsx)(g.kp,{inheritColour:!0,children:l})]})})]}),(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsx)(X.Fn,{thin:!0,volumeGroup:a})}),(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsx)(g.xF,{inheritColour:!0,monospaced:!0,noWrap:!0,children:a.internalUuid})})]}))},value:u.values.hosts[o].vg})}),(0,r.jsx)(eF.Ay,{item:!0,children:(0,r.jsx)(eg.A,{mapPreset:"delete",onClick:()=>{d(h.vg,null,!0)},size:"small"})})]})};var eH=n(4064),eW=n(71986);let eX=(e,t,n)=>{let{[t]:r}=e.storageGroups,s=n.reduce((e,t)=>(e[t]={vg:null},e),{}),a={hosts:s,name:""};return r&&(a.name=r.name,Object.values(r.members).forEach(t=>{let{[t.volumeGroup]:n}=e.volumeGroups,{host:r,uuid:a}=n;s[r].vg=a})),a},eq=(e,t,n,r)=>{var s;let{[r]:a}=n.storageGroups,o={add:[],name:null!=(s=null==a?void 0:a.name)?s:e.name,remove:[]};a&&e.name!==a.name&&(o.rename=e.name);let{volumeGroups:i}=n;return Object.keys(e.hosts).forEach(n=>{let{[n]:r}=t.hosts,{[n]:s}=e.hosts;if(r.vg!==s.vg){if(r.vg){let{[r.vg]:e}=i;o.remove.push(e.internalUuid)}if(s.vg){let{[s.vg]:e}=i;o.add.push(e.internalUuid)}}}),o},e$=e=>{let{anvil:t,confirm:n,storages:s,uuid:a=""}=e,{[a]:o}=s.storageGroups,i=(0,c.useContext)(eT.MV),l=(0,c.useMemo)(()=>"/anvil/".concat(t,"/storage"),[t]),d=(0,c.useMemo)(()=>Object.keys(s.hosts),[s.hosts]),u=(0,c.useMemo)(()=>eX(s,a,d),[d,a,s]),h=(0,c.useMemo)(()=>o?"Save":"Add",[o]),m=(0,eW.A)({initialValues:u,onSubmit:(e,t)=>{var c;let d,h,{setSubmitting:m}=t;o?(d="Update",h="put"):(d="Add",h="post");let x=eq(e,u,s,a);n.setConfirmDialogProps({actionProceedText:d,content:(0,r.jsx)(eO.A,{entries:x,skip:(e,t)=>"name"===t.key}),onCancelAppend:()=>m(!1),onProceedAppend:()=>{n.setConfirmDialogLoading(!0),F.A.request({data:x,method:h,url:l}).then(()=>{n.finishConfirm("Success",{children:(0,r.jsxs)(r.Fragment,{children:[d," storage group job registered."]})}),null==i||i.setOpen(!1)}).catch(e=>{let t=(0,M.A)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to ",d.toLocaleLowerCase()," storage group."," ",t.children]}),n.finishConfirm("Error",t),m(!1)})},titleText:"".concat(d," ").concat(null!=(c=null==o?void 0:o.name)?c:e.name," with the following?")}),n.setConfirmDialogOpen(!0)},validationSchema:eI(s,a)}),{disabledSubmit:x,formik:p,formikErrors:v,handleChange:j}=m,A=(0,c.useMemo)(()=>({name:"name"}),[]);return(0,r.jsxs)(eF.Ay,{component:"form",container:!0,onSubmit:e=>{e.preventDefault(),p.handleSubmit(e)},spacing:"1em",children:[(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(eF.Ay,{alignItems:"center",container:!0,spacing:"1em",children:[(0,r.jsx)(eF.Ay,{item:!0,xs:!0,children:(0,r.jsx)(eH.A,{input:(0,r.jsx)(ez.A,{id:A.name,label:"Storage group name",name:A.name,onChange:j,value:p.values.name})})}),(0,r.jsx)(eF.Ay,{item:!0,children:(0,r.jsx)(eg.A,{disabled:!o,mapPreset:"delete",onClick:()=>{p.setSubmitting(!0),n.setConfirmDialogProps({actionProceedText:"Delete",content:(0,r.jsx)(g.a3,{children:"This operation will remove the storage group and its relationships to volume groups. It will not remove the actual volume groups."}),onCancelAppend:()=>p.setSubmitting(!1),onProceedAppend:()=>{n.setConfirmDialogLoading(!0);let e={name:null==o?void 0:o.name};F.A.request({data:e,method:"delete",url:l}).then(()=>{n.finishConfirm("Success",{children:(0,r.jsx)(r.Fragment,{children:"Delete storage group job registered."})}),null==i||i.setOpen(!1)}).catch(e=>{let t=(0,M.A)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to delete storage group. ",t.children]}),n.finishConfirm("Error",t),p.setSubmitting(!1)})},proceedColour:"red",titleText:"Delete ".concat(null==o?void 0:o.name,"?")}),n.setConfirmDialogOpen(!0)},size:"small",variant:"redcontained"})})]})}),d.map(e=>(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsx)(eZ,{formikUtils:m,host:e,storages:s})},"member-on-host-".concat(e))),(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsx)(eB.A,{count:1,messages:v})}),(0,r.jsx)(eF.Ay,{item:!0,width:"100%",children:(0,r.jsx)(eP.A,{actions:[{background:"blue",children:h,disabled:x,type:"submit"}]})})]})},eV={root:"".concat("SharedStorage","-root")},eY=(0,s.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(eV.root)]:{overflow:"auto",height:"78vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.NF)]:{height:"100%"}}}}),eJ=e=>{let{anvil:t,confirm:n,error:s,formDialogRef:o,loading:i,storages:l,target:d}=e;return(0,c.useMemo)(()=>{if(i)return(0,r.jsx)(P.A,{});if(!l){let e;return s?(e=(0,M.A)(s)).children=(0,r.jsxs)(r.Fragment,{children:["Failed to get storage information. ",e.children]}):e={children:(0,r.jsx)(r.Fragment,{children:"Cannot find storage information."}),type:"warning"},(0,r.jsx)(es.A,{...e})}let{confirmDialog:e}=n,c=Object.values(l.storageGroups),u="Add storage group";if(d.value){let{[d.value]:e}=l.storageGroups;e&&(u="Update ".concat(e.name))}return(0,r.jsxs)(eY,{children:[(0,r.jsx)(a.A,{className:eV.root,children:c.map(e=>{let{uuid:t}=e;return(0,r.jsx)(eM,{formDialogRef:o,storages:l,target:d,uuid:t},t)})}),(0,r.jsx)(eT.K_,{header:u,onTransitionExited:()=>{d.set()},ref:o,showClose:!0,wide:!0,children:(0,r.jsx)(e$,{anvil:t,confirm:n,storages:l,uuid:d.value})}),e]})},[t,n,s,o,i,l,d])},eK=()=>{let{uuid:e}=(0,c.useContext)(u),t=(0,c.useRef)(null),n=(0,O.A)(),[s,a]=(0,c.useState)(),{altData:o,error:i,loading:l}=(0,L.A)("/anvil/".concat(e,"/storage"),{mod:eS.A,periodic:!0});return(0,r.jsxs)(_.Zk,{children:[(0,r.jsxs)(_.aO,{children:[(0,r.jsx)(g.HM,{children:"Shared Storage"}),(0,r.jsx)(eg.A,{mapPreset:"add",onClick:()=>{var e;a(void 0),null==(e=t.current)||e.setOpen(!0)}})]}),(0,r.jsx)(eJ,{anvil:e,confirm:n,error:i,formDialogRef:t,loading:l,storages:o,target:{set:a,value:s}})]})},eQ=()=>{let[e,t]=(0,c.useState)(void 0);return(0,c.useEffect)(()=>{let e=()=>{t(window.innerWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e},e0="Anvil",e1={child:"".concat(e0,"-child"),server:"".concat(e0,"-server"),container:"".concat(e0,"-container")},e2=(0,s.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(e1.child)]:{width:"22%",height:"100%",[t.breakpoints.down(d.NF)]:{width:"50%"},[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(e1.server)]:{width:"35%",height:"100%",[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(e1.container)]:{display:"flex",flexDirection:"row",width:"100%",justifyContent:"space-between",[t.breakpoints.down("md")]:{display:"block"}}}}),e3=e=>{let{children:t}=e;return(0,c.createElement)(_.Zk,{sx:{marginLeft:{xs:"1em",sm:"auto"},marginRight:{xs:"1em",sm:"auto"},marginTop:"calc(50vh - 10em)",maxWidth:{xs:void 0,sm:"60%",md:"50%",lg:"40%"},minWidth:"fit-content"}},t)},e7=(e,t)=>{let n;if([e.isReady,t].some(e=>!e))return"";let{anvils:r}=t,{name:s,uuid:a}=e.query;if(s?n=r.find(e=>e.anvil_name===s):a&&(n=r.find(e=>e.anvil_uuid===a)),n)return n.anvil_uuid;let[o={anvil_uuid:""}]=r;return o.anvil_uuid},e6=e=>{let{children:t,list:n,loading:s}=e,a=(0,l.useRouter)(),{uuid:o,setAnvilUuid:i}=(0,c.useContext)(u),d=(0,c.useMemo)(()=>{let e=e7(a,n);return null==i||i.call(null,e),e},[n,a,i]);if(o)return(0,r.jsx)(r.Fragment,{children:t});let h=(0,r.jsx)(e3,{children:(0,r.jsx)(P.A,{sx:{margin:"2em 2.4em"}})}),m=(0,r.jsx)(e3,{children:(0,r.jsx)(es.A,{type:"warning",children:"Failed to get system summary."})});return s||n&&d?h:m},e5=()=>{let e=eQ(),{data:t,loading:n}=(0,L.A)("/anvil/summary",{periodic:!0}),s=(0,c.useMemo)(()=>{if(t&&e)return e>d.NF?(0,r.jsxs)(a.A,{className:e1.container,children:[(0,r.jsxs)(a.A,{className:e1.child,children:[(0,r.jsx)(E,{list:t}),(0,r.jsx)(ee,{anvil:t.anvils})]}),(0,r.jsx)(a.A,{className:e1.server,children:(0,r.jsx)(eN,{anvil:t.anvils})}),(0,r.jsx)(a.A,{className:e1.child,children:(0,r.jsx)(eK,{})}),(0,r.jsxs)(a.A,{className:e1.child,children:[(0,r.jsx)(ed,{}),(0,r.jsx)(Z,{}),(0,r.jsx)(er,{})]})]}):(0,r.jsxs)(a.A,{className:e1.container,children:[(0,r.jsxs)(a.A,{className:e1.child,children:[(0,r.jsx)(eN,{anvil:t.anvils}),(0,r.jsx)(E,{list:t}),(0,r.jsx)(ee,{anvil:t.anvils})]}),(0,r.jsxs)(a.A,{className:e1.child,children:[(0,r.jsx)(ed,{}),(0,r.jsx)(eK,{}),(0,r.jsx)(Z,{}),(0,r.jsx)(er,{})]})]})},[t,e]);return(0,r.jsxs)(e2,{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:"Anvil"})}),(0,r.jsx)(H.A,{}),(0,r.jsx)(h,{children:(0,r.jsx)(e6,{list:t,loading:n,children:s})})]})}},89099:(e,t,n)=>{e.exports=n(48253)}},e=>{var t=t=>e(e.s=t);e.O(0,[559,3,208,925,623,133,732,341,876,636,593,792],()=>t(52241)),_N_E=e.O()}]);