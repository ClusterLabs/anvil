(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(71585)}])},82777:function(e,t,n){"use strict";var r=n(85893),s=n(67294),i=n(99514),c=n(14440);t.Z=e=>{let{calculateItemBreakpoints:t=()=>({xs:1}),layout:n,wrapperBoxProps:a,...l}=e,o=(0,s.useMemo)(()=>Object.entries(n).map((e,n)=>{let[r,c]=e;return c?(0,s.createElement)(i.ZP,{...t(n,r),key:r,item:!0,...c}):void 0}),[t,n]);return(0,r.jsx)(c.Z,{...a,children:(0,r.jsx)(i.ZP,{container:!0,...l,children:o})})}},86549:function(e,t,n){"use strict";var r=n(85893),s=n(11632),i=n(77574),c=n(77831),a=n(56903);t.Z=e=>{let{children:t,sx:n,...l}=e;return(0,r.jsx)(i.Z,{underline:"hover",variant:"subtitle1",...l,sx:{color:c.lD,textDecorationColor:c.s7,...n},children:(0,r.jsxs)(a.Z,{row:!0,children:[t,(0,r.jsx)(s.Z,{sx:{marginLeft:".3em"}})]})})}},77510:function(e,t,n){"use strict";var r=n(67294),s=n(8100),i=n(92230),c=n(54120);t.Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{baseUrl:n=i.Z,fetcher:a=c.Z,mod:l,...o}=t,{data:d,error:h,mutate:x}=(0,s.ZP)("".concat(n).concat(e),a,o),u=(0,r.useMemo)(()=>l&&d&&l(d),[d,l]),m=!h&&!d;return{altData:u,data:d,error:h,mutate:x,loading:m}}},59752:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=e=>e.reduce((e,t)=>{let{hostName:n,hostType:r,hostUUID:s}=t;return e[s]={name:n,type:r,uuid:s},e},{}),s=e=>e.reduce((e,t)=>{let{anvilDescription:n,anvilName:s,anvilUUID:i,hosts:c}=t;return e[i]={description:n,hosts:r(c),name:s,uuid:i},e},{})},71585:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Q}});var r=n(85893),s=n(31530),i=n(99514),c=n(14440),a=n(59505),l=n(9008),o=n.n(l),d=n(67294),h=n(92230),x=n(77831),u=n(84501),m=n(54490),j=e=>{let{anvil_name:t,anvil_state:n,anvil_uuid:r,hosts:s}=e;return{hosts:s.reduce((e,t)=>{let{host_name:n,host_uuid:r,maintenance_mode:s,server_count:i,state:c,state_percent:a}=t;return e[r]={name:n,maintenance:s,serverCount:i,state:c,stateProgress:a,uuid:r},e},{}),name:t,state:n,uuid:r}},v=e=>{let{allocated:t,reserved:n,total:r}=e;return{allocated:BigInt(t),reserved:BigInt(n),total:BigInt(r)}},Z=e=>{let{storage_groups:t,total_free:n,total_size:r}=e,s=BigInt(n),i=BigInt(r);return t.reduce((e,t)=>{let{storage_group_free:n,storage_group_name:r,storage_group_total:s,storage_group_uuid:i}=t,c=BigInt(n),a=BigInt(s);return e.storageGroups[i]={free:c,name:r,size:a,uuid:i},e},{storageGroups:{},totalFree:s,totalSize:i})},g=n(29535),p=n(56903),_=n(53541),f=n(38196),P=n(59278),w=n(77510);let S=BigInt(100),b={degraded:x.hM,not_ready:x.Wd,optimal:x.Ej},y={offline:x.Wd,online:x.Ej};var C=e=>{let{anvilUuid:t,refreshInterval:n=5e3}=e,{data:s,loading:c}=(0,w.Z)("/anvil/".concat(t),{refreshInterval:n}),a=(0,d.useMemo)(()=>s&&j(s),[s]),{data:l,loading:o}=(0,w.Z)("/anvil/".concat(t,"/cpu"),{refreshInterval:n}),h=(0,d.useMemo)(()=>l&&Object.values(l.hosts),[l]),{data:C,loading:I}=(0,w.Z)("/anvil/".concat(t,"/memory"),{refreshInterval:n}),M=(0,d.useMemo)(()=>C&&v(C),[C]),{data:A,loading:U}=(0,w.Z)("/anvil/".concat(t,"/store"),{refreshInterval:n}),B=(0,d.useMemo)(()=>A&&Z(A),[A]),E=(0,d.useMemo)(()=>[c,o,I,U].some(e=>e),[c,o,I,U]),N=(0,d.useMemo)(()=>a&&(0,r.jsx)(P.$_,{inheritColour:!0,color:b[a.state],children:a.state}),[a]),D=(0,d.useMemo)(()=>a&&(0,r.jsx)(i.ZP,{alignItems:"center",columns:20,columnSpacing:"0.5em",container:!0,sx:{["& > .".concat(u.Z.item,":nth-child(-n + 4)")]:{marginBottom:"-.6em"}},children:Object.values(a.hosts).map(e=>{var t;let n;let{name:s,serverCount:c,state:a,stateProgress:l,uuid:o}=e,d=null!==(t=y[a])&&void 0!==t?t:x.s7,h=a;return["offline","online"].includes(a)?n=(0,r.jsx)(P.$_,{variant:"caption",children:c}):h="".concat(l,"%"),[(0,r.jsx)(i.ZP,{item:!0,xs:7,children:(0,r.jsx)(P.Ac,{variant:"caption",whiteSpace:"nowrap",children:s})},"".concat(o,"-state-label")),(0,r.jsx)(i.ZP,{item:!0,xs:5,children:(0,r.jsx)(P.$_,{inheritColour:!0,color:d,children:h})},"".concat(o,"-state")),(0,r.jsx)(i.ZP,{item:!0,xs:!0,children:(0,r.jsx)(g.Z,{sx:{marginBottom:"-.4em"}})},"".concat(o,"-divider")),(0,r.jsx)(i.ZP,{item:!0,width:"2.2em",children:n&&(0,r.jsx)(P.Ac,{variant:"caption",children:"Servers"})},"".concat(o,"-server-label")),(0,r.jsx)(i.ZP,{display:"flex",item:!0,justifyContent:"flex-end",width:"2em",children:n},"".concat(o,"-server-count"))]})}),[a]),k=(0,d.useMemo)(()=>l&&h&&(0,r.jsxs)(p.Z,{row:!0,spacing:".5em",children:[(0,r.jsx)(p.Z,{spacing:0,children:(0,r.jsxs)(P.Ac,{variant:"caption",whiteSpace:"nowrap",children:["Vendor"," ",(0,r.jsx)(P.Q0,{sx:{paddingRight:0},children:h[0].vendor})]})}),(0,r.jsx)(g.Z,{sx:{flexGrow:1}}),(0,r.jsxs)(i.ZP,{alignItems:"center",columns:2,container:!0,sx:{width:"3.7em",["& > .".concat(u.Z.item,":nth-child(-n + 2)")]:{marginBottom:"-.6em"}},children:[(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{variant:"caption",children:"Cores"})}),(0,r.jsx)(i.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,r.jsx)(P.$_,{variant:"caption",children:l.cores})}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{variant:"caption",children:"Threads"})}),(0,r.jsx)(i.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,r.jsx)(P.$_,{variant:"caption",children:l.threads})})]})]}),[l,h]),O=(0,d.useMemo)(()=>M&&(0,r.jsxs)(p.Z,{spacing:0,children:[(0,r.jsx)(p.Z,{row:!0,justifyContent:"flex-end",children:(0,r.jsxs)(P.Ac,{mb:"-.3em",variant:"caption",children:["Free",(0,r.jsx)(P.Q0,{children:(0,m._d)(M.total-(M.reserved+M.allocated),{toUnit:"ibyte"})}),"/",(0,r.jsx)(P.Q0,{sx:{paddingRight:0},children:(0,m._d)(M.total,{toUnit:"ibyte"})})]})}),(0,r.jsx)(f.Z,{thin:!0,value:{reserved:{value:Number(M.reserved*S/M.total)},allocated:{value:Number((M.reserved+M.allocated)*S/M.total),colour:{0:x.Ej,70:x.Wd,90:x.hM}}}})]}),[M]),T=(0,d.useMemo)(()=>B&&(0,r.jsxs)(p.Z,{spacing:0,children:[(0,r.jsx)(p.Z,{row:!0,justifyContent:"flex-end",children:(0,r.jsxs)(P.Ac,{mb:"-.3em",variant:"caption",children:["Total free",(0,r.jsx)(P.Q0,{children:(0,m._d)(B.totalFree,{toUnit:"ibyte"})}),"/",(0,r.jsx)(P.Q0,{sx:{paddingRight:0},children:(0,m._d)(B.totalSize,{toUnit:"ibyte"})})]})}),(0,r.jsx)(f.Z,{thin:!0,value:{allocated:{value:Number((B.totalSize-B.totalFree)*S/B.totalSize),colour:{0:x.Ej,70:x.Wd,90:x.hM}}}})]}),[B]);return E?(0,r.jsx)(_.Z,{mt:0}):(0,r.jsxs)(i.ZP,{alignItems:"center",columns:4,container:!0,sx:{["& > .".concat(u.Z.item,":nth-child(odd)")]:{alignItems:"center",display:"flex",height:"2.2em"}},children:[(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Node"})}),(0,r.jsx)(i.ZP,{item:!0,xs:3,children:N}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Subnodes"})}),(0,r.jsx)(i.ZP,{item:!0,xs:3,children:D}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"CPU"})}),(0,r.jsx)(i.ZP,{item:!0,xs:3,children:k}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Memory"})}),(0,r.jsx)(i.ZP,{item:!0,xs:3,children:O}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Storage"})}),(0,r.jsx)(i.ZP,{item:!0,xs:3,children:T})]})},I=n(59752),M=n(82777),A=n(23930),U=e=>{let{refreshInterval:t=5e3}=e,{data:n,loading:s}=(0,w.Z)("/anvil",{refreshInterval:t}),i=(0,d.useMemo)(()=>n&&(0,I.Z)(n),[n]),c=(0,d.useMemo)(()=>i&&(0,r.jsx)(M.Z,{columns:{xs:1,sm:2,md:3,xl:4},layout:Object.values(i).reduce((e,n)=>{let{description:s,name:i,uuid:c}=n;return e["anvil-".concat(c)]={children:(0,r.jsxs)(A.Lg,{height:"100%",mv:0,children:[(0,r.jsx)(A.CH,{children:(0,r.jsxs)(P.Ac,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:[i,": ",s]})}),(0,r.jsx)(A.bc,{children:(0,r.jsx)(C,{anvilUuid:c,refreshInterval:t})})]})},e},{}),spacing:"1em",sx:{alignContent:"stretch",["& > .".concat(u.Z.item)]:{minWidth:"20em"}}}),[i,t]);return(0,r.jsxs)(A.s_,{children:[(0,r.jsx)(A.V9,{children:(0,r.jsx)(P.z,{children:"Nodes"})}),s?(0,r.jsx)(_.Z,{}):c]})},B=n(93016),E=n(54120),N=n(39937),D=n(65895),k=n(86549),O=n(15627),T=n(48430),W=n(56466),$=n(41021);let z=e=>(0,r.jsx)(i.ZP,{alignContent:"stretch",columns:{xs:1,sm:2,md:3,xl:4},container:!0,spacing:"1em",children:e.map(e=>{let{anvilName:t,anvilUUID:n,isScreenshotStale:s,loading:c,screenshot:a,serverName:l,serverState:o,serverUUID:d,timestamp:h}=e;return(0,r.jsx)(i.ZP,{item:!0,sx:{minWidth:"20em","& > div":{height:"100%",marginBottom:0,marginTop:0}},xs:1,children:(0,r.jsx)(B.M,{externalPreview:a,externalTimestamp:h,headerEndAdornment:[(0,r.jsx)(k.Z,{href:"/server?uuid=".concat(d,"&server_name=").concat(l,"&server_state=").concat(o),children:l},"server_list_to_server_".concat(d)),(0,r.jsx)(k.Z,{href:"/anvil?anvil_uuid=".concat(n),sx:{opacity:.7},children:t},"server_list_server_".concat(d,"_to_anvil_").concat(n))],hrefPreview:"/server?uuid=".concat(d,"&server_name=").concat(l,"&server_state=").concat(o,"&vnc=1"),isExternalLoading:c,isExternalPreviewStale:s,isFetchPreview:!1,isShowControls:!1,isUseInnerPanel:!0,serverState:o,serverUUID:d})},"".concat(d,"-preview"))})}),F=(e,t)=>""===t?{exclude:e,include:[]}:e.reduce((e,n)=>{let{serverName:r}=n;return r.includes(t)?e.include.push(n):e.exclude.push(n),e},{exclude:[],include:[]});var Q=()=>{let[e,t]=(0,d.useState)([]),[n,i]=(0,d.useState)([]),[l,u]=(0,d.useState)([]),[m,j]=(0,d.useState)(""),[v,Z]=(0,d.useState)(!1),g=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let{exclude:r,include:s}=F(...t);i(r),u(s)},{isLoading:p}=(0,T.Z)("".concat(h.Z,"/server"),{onSuccess:function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=n.map(n=>{var s;let{serverUUID:i}=n,c=(null===(s=e.find(e=>{let{serverUUID:t}=e;return t===i}))||void 0===s?void 0:s.screenshot)||"",a={...n,loading:!0,screenshot:c,timestamp:0};return(0,E.Z)("".concat(h.Z,"/server/").concat(i,"?ss=1")).then(e=>{let{screenshot:n,timestamp:s}=e;0!==n.length&&(a.isScreenshotStale=!(0,$.Z$)(s,300),a.loading=!1,a.screenshot=n,a.timestamp=s,t([...r]))}).catch(()=>{a.isScreenshotStale=!0}).finally(()=>{a.loading=!1}),a});t(r),g(r,m)},refreshInterval:6e4});return(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(o(),{children:(0,r.jsx)("title",{children:"Dashboard"})}),(0,r.jsx)(N.Z,{}),(0,r.jsx)(A.s_,{children:p?(0,r.jsx)(_.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(A.V9,{sx:{marginBottom:"2em"},children:[(0,r.jsx)(P.z,{children:"Servers"}),(0,r.jsx)(D.Z,{onClick:()=>Z(!0),children:(0,r.jsx)(s.Z,{})}),(0,r.jsx)(O.Z,{placeholder:"Search by server name",onChange:t=>{let{target:{value:n}}=t;j(n),g(e,n)},sx:{minWidth:"16em"},value:m})]}),z(l),l.length>0&&(0,r.jsx)(a.Z,{sx:{backgroundColor:x.d}}),z(n)]})}),(0,r.jsx)(U,{}),(0,r.jsx)(W.Z,{dialogProps:{open:v},onClose:()=>{Z(!1)}})]})}}},function(e){e.O(0,[162,442,318,206,74,715,26,133,23,16,888,774,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);