(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[738],{24944:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(14232);let s=()=>{let e=(0,r.useRef)(!0);return e.current?(e.current=!1,!0):e.current}},40663:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var r=n(37876),s=n(54773),a=n(35656),l=n(57212),o=n(14232),i=n(90890),c=n(46316),d=n(51677);let u=(0,s.Ay)(a.A)({height:"3.5em",marginLeft:0,width:"100%"}),m=e=>{let{baseInputProps:t,checked:n,formControlLabelProps:s,id:a,label:m,name:h,onChange:p,switchProps:x}=e,f=(0,o.useMemo)(()=>(0,c.A)(m,d.a3,{color:"".concat(i.Qu,"AF"),inheritColour:!0}),[m]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u,{control:(0,r.jsx)(l.A,{checked:n,edge:"end",name:h,onChange:p,...x}),label:f,labelPlacement:"start",slotProps:{typography:{flexGrow:1}},...s}),(0,r.jsx)("input",{checked:n,hidden:!0,id:a,readOnly:!0,type:"checkbox",...t})]})}},42116:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(14232);let s=function(){let{actionProceedText:e="",content:t="",titleText:n="",...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useState)({actionProceedText:e,content:t,titleText:n,...s})}},57212:(e,t,n)=>{"use strict";n.d(t,{A:()=>b});var r=n(14232),s=n(69241),a=n(4697),l=n(40393),o=n(80027),i=n(78457),c=n(26872),d=n(54773),u=n(29548),m=n(52196),h=n(48452),p=n(67360),x=n(37876);let f=e=>{let{classes:t,edge:n,size:r,color:s,checked:l,disabled:i}=e,c={root:["root",n&&"edge".concat((0,o.A)(n)),"size".concat((0,o.A)(r))],switchBase:["switchBase","color".concat((0,o.A)(s)),l&&"checked",i&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=(0,a.A)(c,h.n,t);return{...t,...d}},j=(0,d.Ay)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.edge&&t["edge".concat((0,o.A)(n.edge))],t["size".concat((0,o.A)(n.size))]]}})({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,["& .".concat(h.A.thumb)]:{width:16,height:16},["& .".concat(h.A.switchBase)]:{padding:4,["&.".concat(h.A.checked)]:{transform:"translateX(16px)"}}}}]}),g=(0,d.Ay)(c.A,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.switchBase,{["& .".concat(h.A.input)]:t.input},"default"!==n.color&&t["color".concat((0,o.A)(n.color))]]}})((0,u.A)(e=>{let{theme:t}=e;return{position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:"".concat("light"===t.palette.mode?t.palette.common.white:t.palette.grey[300]),transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),["&.".concat(h.A.checked)]:{transform:"translateX(20px)"},["&.".concat(h.A.disabled)]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:"".concat("light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600])},["&.".concat(h.A.checked," + .").concat(h.A.track)]:{opacity:.5},["&.".concat(h.A.disabled," + .").concat(h.A.track)]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:"".concat("light"===t.palette.mode?.12:.2)},["& .".concat(h.A.input)]:{left:"-100%",width:"300%"}}}),(0,u.A)(e=>{let{theme:t}=e;return{"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.action.activeChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,l.X4)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(t.palette).filter((0,i.A)(["light"])).map(e=>{let[n]=e;return{props:{color:n},style:{["&.".concat(h.A.checked)]:{color:(t.vars||t).palette[n].main,"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,l.X4)(t.palette[n].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(h.A.disabled)]:{color:t.vars?t.vars.palette.Switch["".concat(n,"DisabledColor")]:"".concat("light"===t.palette.mode?(0,l.a)(t.palette[n].main,.62):(0,l.e$)(t.palette[n].main,.55))}},["&.".concat(h.A.checked," + .").concat(h.A.track)]:{backgroundColor:(t.vars||t).palette[n].main}}}})]}})),A=(0,d.Ay)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})((0,u.A)(e=>{let{theme:t}=e;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:"".concat("light"===t.palette.mode?t.palette.common.black:t.palette.common.white),opacity:t.vars?t.vars.opacity.switchTrack:"".concat("light"===t.palette.mode?.38:.3)}})),v=(0,d.Ay)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})((0,u.A)(e=>{let{theme:t}=e;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}})),b=r.forwardRef(function(e,t){let n=(0,m.b)({props:e,name:"MuiSwitch"}),{className:r,color:a="primary",edge:l=!1,size:o="medium",sx:i,slots:c={},slotProps:d={},...u}=n,h={...n,color:a,edge:l,size:o},b=f(h),w={slots:c,slotProps:d},[y,k]=(0,p.A)("root",{className:(0,s.A)(b.root,r),elementType:j,externalForwardedProps:w,ownerState:h,additionalProps:{sx:i}}),[M,I]=(0,p.A)("thumb",{className:b.thumb,elementType:v,externalForwardedProps:w,ownerState:h}),S=(0,x.jsx)(M,{...I}),[C,P]=(0,p.A)("track",{className:b.track,elementType:A,externalForwardedProps:w,ownerState:h});return(0,x.jsxs)(y,{...k,children:[(0,x.jsx)(g,{type:"checkbox",icon:S,checkedIcon:S,ref:t,ownerState:h,...u,classes:{...b,root:b.switchBase},slots:{...c.switchBase&&{root:c.switchBase},...c.input&&{input:c.input}},slotProps:{...d.switchBase&&{root:"function"==typeof d.switchBase?d.switchBase(h):d.switchBase},...d.input&&{input:"function"==typeof d.input?d.input(h):d.input}}}),(0,x.jsx)(C,{...P})]})})},60801:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(37876),s=n(14232),a=n(75925);let l=(0,s.forwardRef)((e,t)=>{let{children:n,contentContainerProps:l,dialogProps:o,onSubmitAppend:i,proceedButtonProps:c,scrollBoxProps:d,scrollContent:u,...m}=e,h=(0,s.useMemo)(()=>({...l,component:"form",onSubmit:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[r]=t;r.preventDefault(),null==i||i.call(null,...t)}}),[l,i]),p=(0,s.useMemo)(()=>({...d,sx:u?{overflowX:"hidden",paddingTop:".6em",...null==d?void 0:d.sx}:null==d?void 0:d.sx}),[d,u]);return(0,r.jsx)(a.A,{dialogProps:o,contentContainerProps:h,proceedButtonProps:{...c,type:"submit"},scrollContent:u,scrollBoxProps:p,wide:!0,...m,ref:t,children:n})});l.displayName="FormDialog";let o=l},85611:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>tK});var r=n(37876),s=n(77328),a=n.n(s),l=n(89099),o=n(14232),i=n(99955),c=n(86732),d=n(64410),u=n(96043),m=n(19603),h=n(12981),p=n(52076),x=n.n(p),f=n(63190),j=n(23934),g=n(57763);let A=(e,t)=>{let n;return"boolean"===t?e?"1":"":String(e)};var v=n(22430),b=n(48171),w=n(69267),y=n(65873),k=n(40663),M=n(51677),I=n(4064);let S=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{formikUtils:a,id:l,parameter:i,required:c}=s,{content_type:d,default:m,description:p,options:x=[]}=i,{changeFieldValue:f,formik:j,handleChange:g}=a,A="parameters.".concat(l,".value"),S=(0,o.useMemo)(()=>{let e;if("boolean"===d){let e=!!j.values.parameters[l].value;return(0,r.jsx)(k.A,{checked:e,id:A,label:l,name:A,onChange:(e,t)=>{f(A,t,!0)}})}let t=String(j.values.parameters[l].value);return"select"===d?(0,r.jsx)(y.A,{id:A,label:l,name:A,onChange:j.handleChange,required:c,selectItems:x,selectProps:{onClearIndicatorClick:()=>{f(A,"",!0)}},value:t}):(u.sX.test(l)?e=b.A.password:"string"!==d&&(e=b.A.number),(0,r.jsx)(I.A,{input:(0,r.jsx)(w.A,{disableAutofill:!0,id:A,inputProps:{placeholder:m},label:l,name:A,onChange:g,required:c,type:e,value:t})}))},[A,f,j,g,l,x,m,d,c]);return(0,o.useMemo)(()=>(0,r.jsx)(v.A,{disableInteractive:!0,placement:"top-start",slotProps:{tooltip:{sx:{maxWidth:{md:"63em"}}}},title:(0,r.jsx)(M.a3,{children:p}),children:(0,r.jsx)(h.A,{children:S})},"".concat(l,"-tooltip")),[p,l,S])};var C=n(52627);let P=(e,t)=>{let n=!1;return[/plug|port/i.test(e),Number(t.deprecated),t.replacement].some(e=>!!e)?n=!1:1===Number(t.required)&&(n=!0),n},N=e=>{let t={optional:{},required:{}};if(!e)return t;let{parameters:n}=e;return Object.entries(n).sort((e,t)=>{let[n]=e,[r]=t;return n.localeCompare(r)}).reduce((e,t)=>{let[n,r]=t;return e[P(n,r)?"required":"optional"][n]=r,e},t)};var F=n(5806),T=n(71401),U=n(23437),O=n(91408);let q=(e,t)=>{let n=Object.values(t);e&&(n=n.filter(t=>t.fenceUUID!==e));let r=n.map(e=>e.fenceName);return O.Yj().min(1).max(32).notOneOf(r,"${path} already exists")},R=["integer","second"],B=(e,t)=>{let n,{content_type:r,options:s}=t;return n="boolean"===r?O.zM():R.includes(r)?O.ai():O.Yj(),P(e,t)&&(n=n.required()),s&&(n=n.oneOf(s)),n};var D=n(2062);let E=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Object.keys(t);return O.Ik({agent:O.Yj().required().oneOf(r),name:q(n,e).required(),parameters:O.RZ((e,n)=>{var r;let{context:s}=n,a=null!=(r=null==s?void 0:s.agent)?r:"",l=(0,D.A)(e,e=>{let{[a]:n}=t;if(!n)return O.Ik({value:O.gl()});let{[e]:r}=n.parameters,s=B(e,r);return O.Ik({value:s})});return O.Ik(l)})})};var H=n(71986);let _=(e,t)=>Object.entries(e.parameters).reduce((e,n)=>{var r,s;let a,[l,o]=n,{content_type:i}=o,c=null!=(s=null!=(r=null==t?void 0:t.fenceParameters[l])?r:o.default)?s:"";return a="boolean"===i?["1","on"].some(e=>e===c):String(c),e[l]={value:a},e},{}),z=(e,t)=>{let n={agent:null,name:"",parameters:{},uuid:""};if(t){let{fenceAgent:r,fenceName:s,fenceUUID:a}=t;n.agent=r,n.name=s,n.parameters=_(e[r],t),n.uuid=a}return n},L=(e,t,n)=>Object.entries(t).reduce((t,s)=>{let[a,l]=s,{deprecated:o,replacement:i}=l;return Number(o)||i||t.push((0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(S,{formikUtils:e,id:a,parameter:l,required:n})},"".concat(a,"-parameter-input"))),t},[]),V=e=>{let{fence:t,fences:n,template:s,tools:a}=e,l=void 0!==t,i=(0,o.useMemo)(()=>{let e,n,r,s;return l?(n="put",r="/fence/".concat(t.fenceUUID),s="update"):(n="post",r="/fence",s="add"),{capped:x()(s),method:n,url:r,value:s}},[l,null==t?void 0:t.fenceUUID]),c=(0,o.useMemo)(()=>Object.keys(s).sort((e,t)=>e.localeCompare(t)),[s]),u=(0,o.useMemo)(()=>z(s,t),[t,s]),m=(0,H.A)({initialValues:u,onSubmit:(e,t)=>{let{setSubmitting:n}=t,{name:o,parameters:c}=e,d=String(e.agent),u={agent:d,name:o,parameters:Object.entries(c).reduce((e,t)=>{let[n,{value:r}]=t,{[d]:a}=s;if(!a)return e;let{[n]:o}=a.parameters,i=A(r,o.content_type);return(l||i)&&i!==o.default&&(e[n]=i),e},{})};a.confirm.prepare({actionProceedText:i.capped,content:(0,r.jsx)(C.A,{entries:u,hasPassword:!0,getEntryLabel:e=>{let{cap:t,depth:n,key:r}=e;return n?r:t(r)}}),onCancelAppend:()=>n(!1),onProceedAppend:()=>{a.confirm.loading(!0),j.A.request({data:u,method:i.method,url:i.url}).then(()=>{a.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:[i.capped,"ed fence device ",o]})}),a.add.open(!1)}).catch(e=>{let t=(0,F.A)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to ",i.value," fence device. ",t.children]}),a.confirm.finish("Error",t),n(!1)})},titleText:"".concat(i.capped," fence device with the following?")}),a.confirm.open()},validationSchema:E(n,s,null==t?void 0:t.fenceUUID)}),{disabledSubmit:p,formik:v,formikErrors:b,handleChange:y}=m,k=(0,o.useMemo)(()=>({agent:"agent",name:"name",parameters:"parameters"}),[]),S=(0,o.useMemo)(()=>{let e;return v.values.agent&&({[v.values.agent]:e}=s),N(e)},[v.values.agent,s]),P=(0,o.useMemo)(()=>L(m,S.optional),[m,S.optional]),O=(0,o.useMemo)(()=>L(m,S.required,!0),[m,S.required]);return(0,r.jsxs)(d.Ay,{component:"form",container:!0,onSubmit:e=>{e.preventDefault(),v.submitForm()},rowSpacing:"1em",children:[(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(d.Ay,{container:!0,maxHeight:"50vh",overflow:"scroll",rowSpacing:"1em",children:[(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(g.A,{disabled:l,id:k.agent,label:"Fence device type",noOptionsText:"No matching fence device type",onChange:(e,n)=>{let r={...v.values,agent:n};if(n){let{[n]:e}=s;r.parameters=_(e,t)}v.setValues(r,!0)},openOnFocus:!0,options:c,renderOption:(e,t)=>{let{[t]:n}=s,a="string"==typeof n.description?n.description:"None";return(0,o.createElement)("li",{...e,key:"fence-agent-".concat(t)},(0,r.jsxs)(h.A,{children:[(0,r.jsx)(M.a3,{inheritColour:!0,children:t}),(0,r.jsx)(M.a3,{selected:!1,children:a})]}))},required:!0,value:v.values.agent})}),v.values.agent&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(U.l8,{expandInitially:!0,header:"Required parameters",panelProps:{mv:0},children:(0,r.jsxs)(d.Ay,{container:!0,rowSpacing:"0.6em",children:[(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(I.A,{input:(0,r.jsx)(w.A,{id:k.name,label:"Fence device name",name:k.name,onChange:y,required:!0,value:v.values.name})})}),O]})})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(U.l8,{header:"Optional parameters",panelProps:{mv:0},children:(0,r.jsx)(d.Ay,{container:!0,rowSpacing:"0.6em",children:P})})})]})]})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(T.A,{count:1,messages:b})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(f.A,{actions:[{background:"blue",children:i.capped,disabled:p,type:"submit"}]})})]})};var W=n(59664);let Z=()=>{let{data:e,loading:t}=(0,W.A)("/fence/template");return(0,r.jsx)(m.A,{addHeader:"Add a fence device",editHeader:e=>(0,r.jsxs)(M.HM,{children:["Update fence device"," ",(0,r.jsx)(M.kp,{fontSize:"inherit",children:null==e?void 0:e.fenceName})," ","parameters"]}),entriesUrl:"/fence",formDialogProps:{common:{wide:!0}},getAddLoading:e=>e||t,getEditLoading:e=>e||t,getDeleteErrorMessage:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return{...n,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete fence device(s). ",e]})}},getDeleteHeader:e=>"Delete ".concat(e," fence device(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted fence device(s)"})}),listEmpty:"No fence device(s) found.",onItemClick:(e,t)=>{let{args:n,entry:r,tools:s}=t,[a]=n;r.set(a),s.edit.open(!0)},renderAddForm:(t,n)=>n&&e&&(0,r.jsx)(V,{fences:n,template:e,tools:t}),renderDeleteItem:(e,t)=>{let{key:n}=t,s=null==e?void 0:e[n];return(0,r.jsx)(M.a3,{children:null==s?void 0:s.fenceName})},renderEditForm:(t,n,s)=>s&&e&&(0,r.jsx)(V,{fence:n,fences:s,template:e,tools:t}),renderListItem:(e,t)=>{let{fenceAgent:n,fenceName:s,fenceParameters:a}=t;return(0,r.jsxs)(d.Ay,{columnSpacing:"1em",container:!0,children:[(0,r.jsx)(d.Ay,{item:!0,children:(0,r.jsx)(M.a3,{children:s})}),(0,r.jsx)(d.Ay,{item:!0,xs:!0,children:(0,r.jsx)(M.a3,{noWrap:!0,children:Object.entries(a).sort((e,t)=>{let[n]=e,[r]=t;return n.localeCompare(r)}).reduce((e,t)=>{let[n,s]=t,a=(0,r.jsxs)(r.Fragment,{children:[n,'="']});return a=u.sX.test(n)?(0,r.jsxs)(r.Fragment,{children:[a,(0,r.jsx)(M.EN,{wrapper:"mono",wrapperProps:{noWrap:!0},children:s})]}):(0,r.jsxs)(r.Fragment,{children:[a,s]}),(0,r.jsxs)(r.Fragment,{children:[e," ",a,'"']})},n)})})]})}})},X=()=>(0,r.jsxs)(U.Zk,{children:[(0,r.jsx)(U.aO,{children:(0,r.jsx)(M.HM,{children:"Manage fence devices"})}),(0,r.jsx)(Z,{})]});var $=n(58085),G=n(30198),Y=n(88824),J=n(2126),K=n(90890),Q=n(65832),ee=n(98927);let et=e=>{let{list:t,setValue:n,value:s}=e;return 0===t.length?(0,r.jsx)(M.a3,{children:"No host(s) found."}):(0,r.jsx)(ee.A,{centered:!0,onChange:(e,t)=>{n(t)},orientation:"vertical",value:s,children:t.map(e=>{let{hostConfigured:t,hostStatus:n,hostType:s,hostUUID:a,shortHostName:l}=e,o=s.replace("dr","DR").replace("node","Subnode");return(0,r.jsx)(Q.A,{label:(0,r.jsxs)(Y.A,{columnSpacing:"1em",container:!0,sx:{width:"100%",["& > .".concat(J.A.root,":not(:first-child)")]:{borderLeft:"thin solid ".concat(K.eT),paddingLeft:"1em"}},children:[(0,r.jsx)(Y.A,{size:"grow",children:(0,r.jsx)(M.a3,{noWrap:!0,children:o})}),(0,r.jsx)(Y.A,{size:"grow",children:(0,r.jsx)(M.NA,{noWrap:!0,children:l})}),(0,r.jsx)(Y.A,{size:"grow",children:(0,r.jsxs)(M.a3,{noWrap:!0,children:[n,t?", configured":""]})})]}),sx:{textAlign:"left"},value:a},"host-".concat(a))})})};var en=n(40123),er=n.n(en),es=n(86149),ea=n(89275);let el=O.Ik({hostName:O.Yj().required(),networkInit:ea.hJ}),eo=e=>{let{values:t}=e;return(0,r.jsxs)(d.Ay,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.a3,{children:"Host name"})}),(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.NA,{children:t.hostName})}),(0,r.jsx)(ea.Sf,{...e})]})};var ei=n(588);let ec=e=>{let{dns:t="",gateway:n="",networks:r,ntp:s=""}=e.netconf,a={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"},defaultifn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"},defaultsn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"sn"},defaultmn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"mn"}};er()(r)||(a=(0,ei.A)(r));let{name:l}=e;return{hostName:l,mini:!1,networkInit:{dns:t,gateway:n,networks:a,ntp:s}}},ed=e=>{let{detail:t,tools:n,uuid:s}=e,a=(0,o.useRef)(null),l=(0,H.A)({initialValues:ec(t),onSubmit:(e,s)=>{let{setSubmitting:l}=s,o=(0,es.A)(e,a.current);n.confirm.prepare({actionProceedText:"Prepare network",content:a.current&&(0,r.jsx)(eo,{gatewayIface:o.gatewayInterface,ifaces:a.current,values:e}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{n.confirm.loading(!0),j.A.put("/host/".concat(t.uuid,"?handler=subnode-network"),o).then(()=>{n.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started network config on ",t.short]})})}).catch(e=>{let s=(0,F.A)(e);s.children=(0,r.jsxs)(r.Fragment,{children:["Failed to prepare network on ",t.short,". ",s.children]}),n.confirm.finish("Error",s),l(!1)})},titleText:"Prepare network on ".concat(t.short," with the following?")}),n.confirm.open()},validationSchema:el}),{disabledSubmit:i,formik:c,formikErrors:u,handleChange:m}=l,h=(0,o.useMemo)(()=>t.type.replace("node","subnode"),[t.type]),{parentSequence:p,sequence:x}=(0,o.useMemo)(()=>{let[e,n]=t.short.replace(/^.*a(\d+).*(?:n|dr)(\d+)$/,"$1,$2").split(",",2);return{parentSequence:Number(e),sequence:Number(n)}},[t.short]),g=(0,o.useMemo)(()=>({hostName:"hostName",mini:"mini",networks:"networkInit.networks"}),[]);return(0,r.jsxs)(d.Ay,{columns:{xs:1,sm:2,md:3,lg:4},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),c.handleSubmit(e)},spacing:"1em",children:[(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(I.A,{input:(0,r.jsx)(w.A,{id:g.hostName,label:"Host name",name:g.hostName,onChange:m,required:!0,value:c.values.hostName})})}),(0,r.jsx)(d.Ay,{display:{xs:"none",md:"initial"},flexGrow:1,item:!0}),(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(k.A,{id:g.mini,label:"Minimal config",name:g.mini,onChange:(e,t)=>{if(t){let{defaultbcn:e}=c.values.networkInit.networks;c.setFieldValue(g.networks,{defaultbcn:e},!0)}else c.resetForm();c.handleChange(e)},checked:c.values.mini})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(ea.VT,{formikUtils:l,host:{parentSequence:p,sequence:x,type:h,uuid:s},onFetchSuccess:e=>{a.current=e}})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(T.A,{count:1,messages:u})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(f.A,{actions:[{background:"blue",children:"Prepare network",disabled:i,type:"submit"}]})})]})};var eu=n(79982),em=n(30764);let eh=e=>{let{uuid:t}=e,{confirmDialog:n,finishConfirm:s,setConfirmDialogLoading:a,setConfirmDialogOpen:l,setConfirmDialogProps:i}=(0,em.A)({initial:{scrollContent:!0,wide:!0}}),c=(0,o.useMemo)(()=>({add:{open:()=>null},confirm:{finish:s,loading:a,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return l(e)},prepare:i},edit:{open:()=>null}}),[s,a,l,i]),{data:d}=(0,W.A)("/host/".concat(t));return d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ed,{detail:d,tools:c,uuid:t}),n]}):(0,r.jsx)(eu.A,{mt:0})};var ep=n(19383);let ex=()=>{let[e,t]=(0,o.useState)(!1),{data:n}=(0,W.A)("/host?type=dr&type=subnode"),s=(0,o.useMemo)(()=>n&&Object.values(n),[n]);return s?(0,r.jsxs)(U.Zk,{children:[(0,r.jsx)(et,{list:s,setValue:t,value:e}),e&&(0,r.jsx)(G.A,{sx:{margin:"2em 0"}}),s.map(t=>(0,r.jsx)(ep.A,{changingTabId:e,tabId:t.hostUUID,children:(0,r.jsx)(eh,{uuid:t.hostUUID})},"cell-".concat(t.hostUUID)))]}):(0,r.jsx)(U.Zk,{children:(0,r.jsx)(eu.A,{})})};var ef=n(40143),ej=n(31465),eg=n(667),eA=n(94091),ev=n(5755),eb=n(33852);let ew="an-host-input",ey="".concat(ew,"-cell"),ek="IPMI IP",eM={fence:(e,t)=>{let{dataset:{hostId:n="",fenceId:r="",fenceName:s=""},value:a}=t,{hostConfig:{hosts:{[n]:l}}}=e,{fences:o={}}=l;o[r]={fenceName:s,fencePort:a},l.fences=o},host:(e,t)=>{let{dataset:{hostId:n="",hostNumber:r="",hostType:s=""}}=t,a=Number.parseInt(r,10);e.hostConfig.hosts[n]={hostNumber:a,hostType:s}},ipmi:(e,t)=>{let{dataset:{hostId:n=""},value:r}=t,{hostConfig:{hosts:{[n]:s}}}=e;s.ipmiIp=r},network:(e,t)=>{let{dataset:{hostId:n="",networkId:r="",networkNumber:s="",networkType:a=""},value:l}=t,{hostConfig:{hosts:{[n]:o}}}=e,{networks:i={}}=o,c=Number.parseInt(s,10);i[r]={networkIp:l,networkNumber:c,networkType:a},o.networks=i},ups:(e,t)=>{let{checked:n,dataset:{hostId:r="",upsId:s="",upsName:a=""}}=t,{hostConfig:{hosts:{[r]:l}}}=e,{upses:o={}}=l;o[s]={isUsed:n,upsName:a},l.upses=o}},eI={xs:1,sm:2,md:3},eS=(e,t)=>"".concat(ew,"-").concat(e,"-").concat(t,"-port"),eC=e=>"".concat(ew,"-").concat(e,"-ipmi-ip"),eP=(e,t)=>"".concat(ew,"-").concat(e,"-").concat(t,"-ip"),eN=(e,t)=>"".concat(ew,"-").concat(e,"-").concat(t,"-power-host"),eF=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{formUtils:{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:l,buildInputUnmountFunction:i,setMessage:c},hostId:d,hostNumber:u,hostType:m,previous:{fences:h={},ipmiIp:p,networks:x={},upses:f={}}={},hostLabel:j="".concat(m.replace("node","subnode")," ").concat(u)}=s,g=(0,o.useMemo)(()=>Object.entries(h),[h]),A=(0,o.useMemo)(()=>Object.entries(x),[x]),v=(0,o.useMemo)(()=>Object.entries(f),[f]),b=(0,o.useMemo)(()=>!!v.length,[v.length]),y=(0,o.useMemo)(()=>"".concat(ew,"-").concat(d),[d]),I=(0,o.useMemo)(()=>eC(d),[d]),S=(0,o.useMemo)(()=>"".concat(ey,"-").concat(d,"-ipmi-ip"),[d]),C=(0,o.useMemo)(()=>g.reduce((e,t)=>{let[n,{fenceName:s,fencePort:o}]=t,i="".concat(ey,"-").concat(d,"-").concat(n,"-port"),u=eS(d,n),m="Plug on ".concat(s);return e[i]={children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{baseInputProps:{"data-handler":"fence","data-host-id":d,"data-fence-id":n,"data-fence-name":s},id:u,label:m,value:o}),inputTestBatch:(0,eb.rn)("".concat(d," ").concat(m),()=>{c(u)},{onFinishBatch:a(u)},e=>{c(u,{children:e})}),onFirstRender:l(u)})},e},{}),[a,l,g,d,c]),P=(0,o.useMemo)(()=>A.reduce((e,t)=>{let[n,{networkIp:s,networkNumber:o,networkType:u}]=t,m="".concat(ey,"-").concat(d,"-").concat(n,"-ip"),h=eP(d,n),p="".concat(u.toUpperCase()," ").concat(o," IP");return e[m]={children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{baseInputProps:{"data-handler":"network","data-host-id":d,"data-network-id":n,"data-network-number":o,"data-network-type":u},id:h,label:p,value:s}),inputTestBatch:(0,eb._P)("".concat(d," ").concat(p),()=>{c(h)},{onFinishBatch:a(h)},e=>{c(h,{children:e})}),onFirstRender:l(h),onUnmount:i(h),required:!0})},e},{}),[A,d,a,l,i,c]),N=(0,o.useMemo)(()=>v.reduce((e,t)=>{let[n,{isUsed:s,upsName:a}]=t,l="".concat(ey,"-").concat(d,"-").concat(n,"-power-host"),o=eN(d,n),i="Uses ".concat(a);return e[l]={children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(k.A,{baseInputProps:{"data-handler":"ups","data-host-id":d,"data-ups-id":n,"data-ups-name":a},checked:s,id:o,label:i}),valueType:"boolean"})},e},{}),[d,v]),F=(0,o.useMemo)(()=>b&&(0,r.jsx)(eg.A,{columns:eI,layout:N,spacing:"1em"}),[b,N]);return(0,r.jsxs)(U.t$,{mv:0,children:[(0,r.jsx)(U.WJ,{children:(0,r.jsx)(M.a3,{children:j})}),(0,r.jsxs)(U.BF,{children:[(0,r.jsx)("input",{hidden:!0,id:y,readOnly:!0,"data-handler":"host","data-host-id":d,"data-host-number":u,"data-host-type":m}),(0,r.jsxs)(ej.A,{children:[(0,r.jsx)(eg.A,{columns:eI,layout:{"fence-message":{children:(0,r.jsx)(ev.A,{children:"It is recommended to provide at least 1 fence device plug."}),width:"100%",xs:0},...P,[S]:{children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{baseInputProps:{"data-handler":"ipmi","data-host-id":d},id:I,label:ek,value:p}),inputTestBatch:(0,eb._P)("".concat(d," ").concat(ek),()=>{c(I)},{onFinishBatch:a(I)},e=>{c(I,{children:e})}),onFirstRender:l(I),onUnmount:i(I)})},...C},spacing:"1em"}),F]})]})]})},eT="".concat("".concat("an-host-config-input","-group"),"-cell"),eU={node1:{hostNumber:1,hostType:"node"},node2:{hostNumber:2,hostType:"node"}},eO=e=>{let{anSeq:t,minIp:n,offset3:r=10,step3:s=2,subnetMask:a,subSeq:l}=e;try{let e=new ef.Netmask("".concat(n,"/").concat(a));if(16!==e.bitmask)return"".concat(e.base.replace(/\.0/g,""),".");return n.replace(/^((\d+\.){2})\d+\.\d+$/,"$1".concat((t-1)*s+r,".").concat(l))}catch(e){return""}},eq=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{anSequence:a,formUtils:l,knownFences:i={},knownUpses:c={},networkListEntries:d,previous:{hosts:u=eU}={}}=s,m=(0,o.useMemo)(()=>Object.entries(u),[u]),h=(0,o.useMemo)(()=>Object.values(i),[i]),p=(0,o.useMemo)(()=>Object.values(c),[c]),x=(0,o.useMemo)(()=>m.reduce((e,t)=>{let[n,s]=t,{fences:o={},hostNumber:i,hostType:c,ipmiIp:u,networks:m={},upses:x={}}=s,f=u,j=h.reduce((e,t)=>{let{fenceName:n}=t,{[n]:{fencePort:r=""}={}}=o;return e[n]={fenceName:n,fencePort:r},e},{}),g=d.reduce((e,t)=>{let[n,{networkMinIp:r,networkNumber:s,networkSubnetMask:l,networkType:o}]=t,{[n]:{networkIp:c=""}={}}=m;return c||(c=eO({anSeq:a,minIp:r,subnetMask:l,subSeq:i})),f||"bcn"!==o||1!==s||(f=eO({anSeq:a,minIp:r,offset3:11,subnetMask:l,subSeq:i})),e[n]={networkIp:c,networkNumber:s,networkType:o},e},{}),A=p.reduce((e,t)=>{let{upsName:n}=t,{[n]:{isUsed:r=!0}={}}=x;return e[n]={isUsed:r,upsName:n},e},{});return e["".concat(eT,"-").concat(n)]={children:(0,r.jsx)(eF,{formUtils:l,hostId:n,hostNumber:i,hostType:c,previous:{fences:j,ipmiIp:f,networks:g,upses:A}}),md:3,sm:2},e},{}),[a,l,m,h,p,d]);return(0,r.jsx)(eg.A,{columns:{xs:1,sm:2,md:3},layout:x,spacing:"1em"})};var eR=n(4917),eB=n.n(eR);let eD="an-id-input",eE="".concat(eD,"-domain"),eH="".concat(eD,"-prefix"),e_="".concat(eD,"-sequence"),ez="Domain name",eL="Prefix",eV="Sequence",eW=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{debounceWait:a=500,formUtils:{buildFinishInputTestBatchFunction:l,buildInputFirstRenderFunction:i,setMessage:c},onSequenceChange:d,previous:{domain:u,prefix:m,sequence:h}={}}=s,p=(0,o.useMemo)(()=>d&&eB()(d,a),[a,d]);return(0,r.jsx)(eg.A,{columns:{xs:1,sm:2,md:3},layout:{"an-id-input-cell-prefix":{children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{id:eH,label:eL,value:m}),inputTestBatch:(0,eb.rn)(eL,()=>{c(eH)},{onFinishBatch:l(eH)},e=>{c(eH,{children:e})}),onFirstRender:i(eH),required:!0})},"an-id-input-cell-domain":{children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{id:eE,label:ez,value:u}),inputTestBatch:(0,eb.rn)(ez,()=>{c(eE)},{onFinishBatch:l(eE)},e=>{c(eE,{children:e})}),onFirstRender:i(eE),required:!0})},"an-id-input-cell-sequence":{children:(0,r.jsx)(eA.A,{createInputOnChangeHandlerOptions:{postSet:p},input:(0,r.jsx)(w.A,{id:e_,label:eV,value:h}),inputTestBatch:(0,eb.go)(eV,()=>{c(e_)},{onFinishBatch:l(e_)},e=>{c(e_,{children:e})}),onFirstRender:i(e_),required:!0,valueType:"number"})}},spacing:"1em"})};var eZ=n(91423),eX=n(61057),e$=n(22481);let eG="an-network-input",eY="".concat(eG,"-cell"),eJ={gateway:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkGateway=r},minip:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkMinIp=r},network:(e,t)=>{let{dataset:{networkId:n="",networkNumber:r="",networkType:s=""}}=t,{networkConfig:{networks:a}}=e,l=Number.parseInt(r,10);a[n]={networkNumber:l,networkType:s}},subnetmask:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkSubnetMask=r}},eK=e=>"".concat(eG,"-").concat(e,"-gateway"),eQ=e=>"".concat(eG,"-").concat(e,"-min-ip"),e0=e=>"".concat(eG,"-").concat(e,"-network-type"),e1=e=>"".concat(eG,"-").concat(e,"-subnet-mask"),e2=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{debounceWait:a=500,formUtils:{buildFinishInputTestBatchFunction:l,buildInputFirstRenderFunction:i,buildInputUnmountFunction:c,setMessage:d},inputGatewayLabel:u="Gateway",inputMinIpLabel:m="IP address",inputSubnetMaskLabel:h="Subnet mask",networkId:p,networkNumber:x,networkType:f,networkTypeOptions:j,onClose:g,onNetworkGatewayChange:A,onNetworkMinIpChange:v,onNetworkSubnetMaskChange:b,onNetworkTypeChange:k,previous:{gateway:M,minIp:I,subnetMask:S}={},readonlyNetworkName:C,showCloseButton:P,showGateway:N}=s,F=(0,o.useMemo)(()=>"".concat(eX.A[f]," ").concat(x),[x,f]),T=(0,o.useMemo)(()=>"".concat(eY,"-").concat(p,"-gateway"),[p]),O=(0,o.useMemo)(()=>"".concat(eY,"-").concat(p,"-ip"),[p]),q=(0,o.useMemo)(()=>"".concat(eY,"-").concat(p,"-subnet-mask"),[p]),R=(0,o.useMemo)(()=>"".concat(eG,"-").concat(p),[p]),B=(0,o.useMemo)(()=>eK(p),[p]),D=(0,o.useMemo)(()=>eQ(p),[p]),E=(0,o.useMemo)(()=>e0(p),[p]),H=(0,o.useMemo)(()=>e1(p),[p]),_=(0,o.useMemo)(()=>N?void 0:"none",[N]),z=(0,o.useMemo)(()=>A&&eB()(A,a),[a,A]),L=(0,o.useMemo)(()=>v&&eB()(v,a),[a,v]),V=(0,o.useMemo)(()=>b&&eB()(b,a),[a,b]),W=(0,o.useMemo)(()=>P&&(0,r.jsx)(e$.A,{mapPreset:"close",iconProps:{fontSize:"small"},onClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==g||g.call(null,{networkId:p,networkType:f},...t)},sx:{padding:".2em",position:"absolute",right:"-.6rem",top:"-.2rem"}}),[P,p,f,g]),Z=(0,o.useMemo)(()=>{let e;return N&&B&&(e=(0,r.jsx)(eA.A,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==z?void 0:z.call(null,{networkId:p,networkType:f},...t)}},input:(0,r.jsx)(w.A,{baseInputProps:{"data-handler":"gateway","data-network-id":p},id:B,label:u,value:M}),inputTestBatch:(0,eb._P)("".concat(F," ").concat(u),()=>{d(B)},{onFinishBatch:l(B)},e=>{d(B,{children:e})}),onFirstRender:i(B),onUnmount:c(B),required:N})),e},[N,B,p,u,M,F,l,i,c,z,f,d]);return(0,r.jsxs)(U.t$,{mv:0,children:[(0,r.jsxs)(U.WJ,{children:[(0,r.jsx)(eA.A,{input:(0,r.jsx)(y.A,{id:E,isReadOnly:C,onChange:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==k||k.call(null,{networkId:p,networkType:f},...t)},selectItems:j,selectProps:{renderValue:()=>F},value:f})}),W]}),(0,r.jsxs)(U.BF,{children:[(0,r.jsx)("input",{hidden:!0,id:R,readOnly:!0,"data-handler":"network","data-network-id":p,"data-network-number":x,"data-network-type":f}),(0,r.jsx)(eg.A,{columns:{xs:1,sm:2,md:3},layout:{[O]:{children:(0,r.jsx)(eA.A,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==L?void 0:L.call(null,{networkId:p,networkType:f},...t)}},input:(0,r.jsx)(w.A,{baseInputProps:{"data-handler":"minip","data-network-id":p},id:D,label:m,value:I}),inputTestBatch:(0,eb._P)("".concat(F," ").concat(m),()=>{d(D)},{onFinishBatch:l(D)},e=>{d(D,{children:e})}),onFirstRender:i(D),onUnmount:c(D),required:!0})},[q]:{children:(0,r.jsx)(eA.A,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==V?void 0:V.call(null,{networkId:p,networkType:f},...t)}},input:(0,r.jsx)(w.A,{baseInputProps:{"data-handler":"subnetmask","data-network-id":p},id:H,label:h,value:S}),inputTestBatch:(0,eb._P)("".concat(F," ").concat(h),()=>{d(H)},{onFinishBatch:l(H)},e=>{d(H,{children:e})}),onFirstRender:i(H),onUnmount:c(H),required:!0})},[T]:{children:Z,display:_}},spacing:"1em"})]})]})};var e3=n(12698);let e6="an-network-config-input",e5="".concat(e6,"-cell"),e4="".concat(e6,"-dns"),e8="".concat(e6,"-ntp"),e7=Object.entries(eX.A),e9={bcn:{base:"10.201.0.0",mask:"255.255.0.0"},mn:{base:"10.199.0.0",mask:"255.255.0.0"},sn:{base:"10.101.0.0",mask:"255.255.0.0"}},te=e=>"ifn"===e,tt=e=>"mn"===e,tn=e=>{let{entries:t,type:n}=e,r=t.filter(e=>{let[,{networkType:t}]=e;return t===n}).sort((e,t)=>{let[,{networkNumber:n}]=e,[,{networkNumber:r}]=t;return n>r?1:-1}).pop();if(!r){var s;return null!=(s=e9[n])?s:{}}let[,{networkMinIp:a,networkSubnetMask:l}]=r;try{let{base:e,mask:t}=new ef.Netmask("".concat(a,"/").concat(l)).next();return{base:e,mask:t}}catch(e){return{}}},tr=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{formUtils:a,networkListEntries:l,previous:{dnsCsv:i="8.8.8.8,8.8.4.4",ntpCsv:c}={},setNetworkList:d}=s,{buildFinishInputTestBatchFunction:u,buildInputFirstRenderFunction:m,setMessage:h,setMessageRe:p,setValidity:x}=a,f=(0,o.useCallback)(function(e){let{input:t=l,end:n=l.length}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n-1,s=0;return t.every((t,n)=>{let[,{networkType:a}]=t;return a===e&&(s+=1),n<r}),s},[l]),j=(0,o.useMemo)(()=>e7.map(e=>{let[t,n]=e;return{displayValue:n,value:t}}),[]),g=(0,o.useCallback)(function(){let{networkMinIp:e="",networkSubnetMask:t="",networkType:n=l.some(e=>{let[,{networkType:t}]=e;return tt(t)})?"ifn":"mn",networkGateway:r=te(n)?"":void 0,networkNumber:s=f(n)+1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{base:a=e,mask:o=t}=tn({entries:l,type:n});return{network:{networkGateway:r,networkMinIp:a,networkNumber:s,networkSubnetMask:o,networkType:n},networkId:(0,eZ.A)()}},[f,l]),A=(0,o.useCallback)((e,t)=>d((0,e3.Ay)(e,t)),[d]),v=(0,o.useCallback)((e,t,n)=>d(r=>{let s={...r},{[e]:a}=s;return a&&(a[t]=n),s}),[d]),b=(0,o.useCallback)((e,t)=>{let{networkId:n,networkType:r}=e,{target:{value:s}}=t,a=String(s),o=!1,i=0;d(l.reduce((e,t)=>{let[s,c]=t,{networkNumber:d,networkType:u,networkMinIp:m,networkSubnetMask:h,...x}=c,f=d,j=u;s===n&&(o=!0,j=a,p(RegExp(s)));let g=j===a;if(g&&(i+=1),o){g?f=i:j===r&&(f-=1);let{base:t=m,mask:n=h}=tn({entries:l,type:j});e[s]={...x,networkMinIp:t,networkSubnetMask:n,networkNumber:f,networkType:j}}else e[s]=c;return e},{}))},[l,p,d]),y=(0,o.useCallback)(e=>{let{networkId:t,networkType:n}=e,r=!1,s=0;d(l.reduce((e,a)=>{let[l,o]=a;if(l===t)return r=!0,e;let{networkType:i}=o,c=i===n;return c&&(s+=1),e[l]=r&&c?{...o,networkNumber:s}:o,e},{}))},[l,d]),k=(0,o.useMemo)(()=>{let e={};return l.reduce((e,t)=>{let[n,{networkGateway:s,networkMinIp:l,networkNumber:o,networkSubnetMask:i,networkType:c}]=t,d="".concat(e5,"-").concat(n),u=1===o,m=te(c),h=tt(c)||!u;return e[d]={children:(0,r.jsx)(e2,{formUtils:a,networkId:n,networkNumber:o,networkType:c,networkTypeOptions:j,onClose:y,onNetworkMinIpChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return v(n,"networkMinIp",r)},onNetworkSubnetMaskChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return v(n,"networkSubnetMask",r)},onNetworkTypeChange:b,previous:{gateway:s,minIp:l,subnetMask:i},readonlyNetworkName:!h,showCloseButton:h,showGateway:m}),md:3,sm:2},e},e)},[l,a,j,y,b,v]);return(0,r.jsx)(eg.A,{columns:{xs:1,sm:2,md:3},layout:{...k,"an-network-config-cell-add-network":{children:(0,r.jsx)(e$.A,{mapPreset:"add",onClick:()=>{let{network:e,networkId:t}=g();A(t,e)}}),display:"flex",justifyContent:"center",md:3,sm:2},"an-network-config-input-cell-dns":{children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{id:e4,label:"DNS",value:i}),inputTestBatch:(0,eb.ql)("DNS",()=>{h(e4)},{onFinishBatch:u(e4)},e=>{h(e4,{children:e})}),onFirstRender:m(e4),required:!0})},"an-network-config-input-cell-ntp":{children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{id:e8,label:"NTP",value:c}),onFirstRender:()=>{x(e8,!0)}})}},spacing:"1em"})},ts={bcn1:{networkMinIp:"10.201.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"bcn"},sn1:{networkMinIp:"10.101.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"sn"},ifn1:{networkMinIp:"",networkNumber:1,networkSubnetMask:"",networkType:"ifn"}},ta=function(){for(var e,t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];let[a]=n,{formUtils:l,knownFences:i,knownUpses:c,previous:{hostConfig:d,networkConfig:u={},...m}={}}=a,{networks:h=ts}=u,[p,x]=(0,o.useState)(null!=(e=null==m?void 0:m.sequence)?e:0),[f,j]=(0,o.useState)(h),g=(0,o.useMemo)(()=>Object.entries(f),[f]);return(0,r.jsxs)(ej.A,{children:[(0,r.jsx)(eW,{formUtils:l,onSequenceChange:e=>{let{target:{value:t}}=e;x(Number(t))},previous:m}),(0,r.jsx)(tr,{formUtils:l,networkListEntries:g,previous:u,setNetworkList:j}),(0,r.jsx)(eq,{anSequence:p,formUtils:l,knownFences:i,knownUpses:c,networkListEntries:g,previous:d})]})};var tl=n(75925),to=n(57547);let ti=e=>{let{formUtils:t,knownFences:n,knownUpses:s,previous:a}=e;return(0,r.jsx)(ta,{formUtils:t,knownFences:n,knownUpses:s,previous:a})};var tc=n(60801),td=n(74799),tu=n(72649),tm=n.n(tu),th=n(79232),tp=n(45566);let tx=O.Ik({name:O.Yj().required(),uuid:(0,tp.ZC)().required()}),tf=O.Ik({anvil:O.RZ(e=>void 0!==e?tx:O.gl().optional()),number:O.ai(),type:O.Yj(),uuid:(0,tp.ZC)().required()}),tj=O.Yj().when(["rerun"],(e,t)=>e[0]?t.optional():t.required()),tg=O.Ik({confirmPassword:tj.oneOf([O.KR("password")]),description:tj,hosts:O.RZ(e=>O.Ik((0,D.A)(e,tf))),password:tj,rerun:O.zM().required(),reuseHosts:O.zM().when(["hosts"],(e,t)=>{let n=e[0];return n&&Object.values(n).some(e=>!!e.anvil)?t.isTrue():t.isFalse()})}),tA=e=>{let{detail:t,knownFences:n,knownHosts:s,knownUpses:a,onSubmitSuccess:l,tools:i}=e,{anvil:c,domain:u,hostConfig:m,networkConfig:h}=t,{hosts:p}=m,{dnsCsv:x,networks:g,ntpCsv:A}=h,v=(0,o.useMemo)(()=>Object.entries(p),[p]),k=(0,o.useMemo)(()=>Object.entries(g),[g]),S=(0,o.useMemo)(()=>Object.entries(n),[n]),P=(0,o.useMemo)(()=>Object.entries(s),[s]),N=(0,o.useMemo)(()=>Object.entries(a),[a]),U=(0,o.useMemo)(()=>P.map(e=>{let[,{anvil:t,hostName:n,hostUUID:s}]=e;return{displayValue:(0,r.jsxs)(ej.A,{spacing:0,children:[(0,r.jsx)(M.a3,{inverted:!0,children:n}),(0,r.jsx)(M.xF,{inverted:!0,children:t?"Used by ".concat(t.name):"Ready"})]}),value:s}}),[P]),{disabledSubmit:O,formik:q,formikErrors:R,handleChange:B}=(0,H.A)({initialValues:{confirmPassword:"",description:"",hosts:v.reduce((e,t)=>{let n,[r,{hostName:a,hostNumber:l,hostType:o}]=t,i="";if(c){let{hosts:{[l]:{uuid:e}}}=c;i=e;let t=s[e];t&&(n=t.anvil)}else if(a){let e=P.find(e=>{let[,{shortHostName:t}]=e;return t===a});if(e){let[,t]=e;n=t.anvil,i=t.hostUUID}}return e[r]={anvil:n,number:l,type:o,uuid:i},e},{}),password:"",rerun:!!c,reuseHosts:!1},onSubmit:(e,n)=>{let{setSubmitting:a}=n,{confirmPassword:o,rerun:c,reuseHosts:d,hosts:m,...h}=e,x={...c?null:h,hosts:Object.values(m).reduce((e,t)=>{let{number:n,type:r,uuid:a}=t,l="".concat(r).concat(n);return e["".concat(r.replace("node","Subnode")," ").concat(n)]={useHost:s[a].hostName,renameTo:"".concat(p[l].hostName,".").concat(u)},e},{})};i.confirm.prepare({actionProceedText:"Run",content:(0,r.jsx)(C.A,{entries:x,hasPassword:!0}),onCancelAppend:()=>a(!1),onProceedAppend:()=>{i.confirm.loading(!0),j.A.put("/command/run-manifest/".concat(t.uuid),e).then(()=>{i.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started installing ",t.name]})}),null==l||l.call(null),i.edit.open(!1)}).catch(e=>{let t=(0,F.A)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to run install manifest. ",t.children]}),i.confirm.finish("Error",t),a(!1)})},titleText:"Run install manifest ".concat(t.name," with the following?")}),i.confirm.open()},validationSchema:tg}),D=(0,o.useMemo)(()=>"confirmPassword",[]),E=(0,o.useMemo)(()=>"description",[]),_=(0,o.useMemo)(()=>"hosts",[]),z=(0,o.useMemo)(()=>"password",[]),L=(0,o.useMemo)(()=>"reuseHosts",[]),V=(0,o.useMemo)(()=>v.reduce((e,t)=>{let[n,{hostNumber:a,hostType:l}]=t,o="".concat(_,".").concat(n),i="".concat(o,".uuid"),c="".concat(l.replace("node","Subnode")," ").concat(a);return e.push((0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(y.A,{id:i,label:c,name:i,onChange:e=>{let{target:{value:t}}=e,{[t]:{anvil:r}}=s,o=tm()(q.values.hosts),i=Object.entries(o).find(e=>{let[r,{uuid:s}]=e;return r!==n&&s===t});if(i){let[e,t]=i,{number:r,type:s}=t;o[e]={...o[n],number:r,type:s}}return o[n]={anvil:r,number:a,type:l,uuid:t},q.setFieldValue(_,o)},required:!0,selectItems:U,selectProps:{renderValue:e=>{let{[e]:{hostName:t}}=s;return t}},value:q.values.hosts[n].uuid})},"".concat(n,"-selector"))),e},[(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.a3,{children:"Use host"})},"host-selector-header")]),[q,v,U,_,s]),W=(0,o.useMemo)(()=>v.reduce((e,t)=>{let[n,{hostName:s}]=t;return e.push((0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsxs)(M.NA,{noWrap:!0,children:[s,".",u]})},"".concat(n,"-rename"))),e},[(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.a3,{children:"New hostname"})},"host-rename-header")]),[v,u]),Z=(0,o.useMemo)(()=>k.reduce((e,t)=>{let[n,s]=t,{networkNumber:a,networkType:l}=s,o="".concat(l.toLocaleUpperCase()).concat(a),i=v.map(e=>{let[t,{networks:s}]=e,a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.NA,{children:e})},"".concat(n,"-").concat(t,"-ip"))};if(!s)return a();let{[n]:l}=s;if(!l)return a();let{networkIp:o}=l;return a(o)});return e.push((0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.a3,{children:o})},"".concat(n,"-header")),...i),e},[]),[v,k]),X=(0,o.useMemo)(()=>S.reduce((e,t)=>{let[n,s]=t,{fenceName:a}=s,l=v.map(e=>{let[t,{fences:s}]=e,l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.NA,{children:e})},"".concat(n,"-").concat(t,"-port"))};if(!s)return l();let{[a]:o}=s;if(!o)return l();let{fencePort:i}=o;return l(i)});return e.push((0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsxs)(M.a3,{children:["Plug on ",a]})},"".concat(n,"-header")),...l),e},[]),[v,S]),$=(0,o.useMemo)(()=>N.reduce((e,t)=>{let[n,s]=t,{upsName:a}=s,l=v.map(e=>{let[t,{upses:s}]=e,l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.NA,{children:e})},"".concat(n,"-").concat(t,"-used"))};if(!s)return l();let{[a]:o}=s;if(!o)return l();let{isUsed:i}=o;return l(i?"yes":"no")});return e.push((0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsxs)(M.a3,{children:["Uses ",a]})},"".concat(n,"-header")),...l),e},[]),[v,N]),G=(0,o.useMemo)(()=>{let e,t=k.find(e=>{let{1:{networkGateway:t}}=e;return!!t}),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.NA,{justifyContent:"end",children:e})},"gateway-value")};if(t){let[,{networkGateway:r}]=t;e=r&&r.length>0?n(r):n()}else e=n();return[(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.a3,{children:"Gateway"})},"gateway-header"),e]},[k]),Y=(0,o.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.NA,{justifyContent:"end",children:e})},"dns-value")},t=x&&x.length>0?e(x):e();return[(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.a3,{children:"DNS"})},"dns-header"),t]},[x]),J=(0,o.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.NA,{justifyContent:"end",children:e})},"ntp-value")},t=A&&A.length>0?e(A):e();return[(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(M.a3,{children:"NTP"})},"ntp-header"),t]},[A]),K=(0,o.useMemo)(()=>{let e=Object.values(q.values.hosts).filter(e=>!!e.anvil);if(0===e.length)return null;let t=e.slice(1).reduce((e,t)=>"".concat(e,", ").concat(s[t.uuid].shortHostName),s[e[0].uuid].shortHostName);return(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(ev.A,{children:[(0,r.jsx)(th.A,{id:L,invert:!0,name:L,onChange:q.handleChange,required:!0,sx:{marginRight:".5em"},thinPadding:!0,value:q.values.reuseHosts}),"Confirm reusing host(s): ",t,"."]})})},[q,s,L]);return(0,r.jsxs)(d.Ay,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),q.submitForm()},spacing:"1em",children:[c?(0,r.jsxs)(d.Ay,{item:!0,width:"100%",children:[(0,r.jsx)(M.a3,{children:"Description"}),(0,r.jsx)(M.a3,{children:c.description})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(I.A,{input:(0,r.jsx)(w.A,{id:E,label:"Description",name:E,onChange:B,required:!0,value:q.values.description})})}),(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(I.A,{input:(0,r.jsx)(w.A,{disableAutofill:!0,id:z,label:"Password",name:z,onChange:B,required:!0,type:b.A.password,value:q.values.password})})}),(0,r.jsx)(d.Ay,{item:!0,xs:1,children:(0,r.jsx)(I.A,{input:(0,r.jsx)(w.A,{disableAutofill:!0,id:D,label:"Confirm password",name:D,onChange:B,required:!0,type:b.A.password,value:q.values.confirmPassword})})})]}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(d.Ay,{alignItems:"center",columns:v.length+1,columnSpacing:"1em",container:!0,rowSpacing:".6em",children:[...V,...W,...Z,...X,...$]})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsxs)(d.Ay,{columns:2,container:!0,spacing:".6em",children:[...G,...Y,...J]})}),K,(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(T.A,{count:1,messages:R})}),(0,r.jsx)(d.Ay,{item:!0,width:"100%",children:(0,r.jsx)(f.A,{actions:[{background:"blue",children:"Run",disabled:O,type:"submit"}]})})]})};var tv=n(57656),tb=n(42116),tw=n(44193);let ty=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[{target:r}]=t,{elements:s}=r,{value:a}=s.namedItem(eE),{value:l}=s.namedItem(eH),{value:o}=s.namedItem(e_),{value:i}=s.namedItem(e4),{value:c}=s.namedItem(e8),d=Number.parseInt(o,10);return Object.values(s).reduce((e,t)=>{var n,r;let{id:s}=t;if(RegExp("^".concat(ew)).test(s)){let{dataset:{handler:r=""}}=t;null==(n=eM[r])||n.call(null,e,t)}else if(RegExp("^".concat(eG)).test(s)){let{dataset:{handler:n=""}}=t;null==(r=eJ[n])||r.call(null,e,t)}return e},{domain:a,hostConfig:{hosts:{}},networkConfig:{dnsCsv:i,networks:{},ntpCsv:c},prefix:l,sequence:d})},tk=()=>{let e=(0,o.useRef)({}),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)(null),a=(0,o.useRef)({}),[l,i]=(0,tb.A)(),[c,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!0),[h,p]=(0,o.useState)(),{data:x,loading:f,mutate:g}=(0,W.A)("/manifest",{refreshInterval:1e4}),{data:A,loading:v,mutate:b}=(0,W.A)("/manifest/template"),{data:w,loading:y,mutate:k}=(0,W.A)("/host?type=subnode"),I=(0,tw.A)([eE,eH,e_,e4,e8],a),{isFormInvalid:S,isFormSubmitting:P,submitForm:N}=I,{buildDeleteDialogProps:O,checks:q,getCheck:R,hasChecks:B,resetChecks:D,setCheck:E}=(0,tv.A)({list:x}),{name:H,uuid:_}=(0,o.useMemo)(()=>null!=h?h:{},[h]),{domain:z,fences:L,prefix:V,sequence:Z,upses:X}=(0,o.useMemo)(()=>null!=A?A:{},[A]),$=(0,o.useCallback)(e=>{let{hostConfig:{hosts:t}}=e,n=Object.values(t).reduce((e,t)=>{let{fences:n,hostType:r,hostNumber:s}=t,a="".concat(r.replace(/node/,"subnode")).concat(s);return n?e[a]=Object.values(n).reduce((e,t)=>{let{fencePort:n}=t;return e+ +!!n.length},0):e[a]=0,e},{}),s=Object.entries(n).map(e=>{let[t,n]=e;return!n&&(0,r.jsxs)(ev.A,{children:["No fence device port specified for ",t,"."]},"".concat(t,"-no-fence-port-message"))});return{counts:n,messages:s}},[]),G=(0,o.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(ta,{formUtils:I,knownFences:L,knownUpses:X,previous:{domain:z,prefix:V,sequence:Z}}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),a=0;a<n;a++)s[a]=arguments[a];let l=ty(...s),{messages:o}=$(l);i({actionProceedText:"Add",content:(0,r.jsx)(C.A,{entries:l,maxDepth:6}),onProceedAppend:()=>{N({body:l,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add install manifest. ",e]}),method:"post",onSuccess:()=>g(),successMsg:"Successfully added install manifest",url:"/manifest"})},preActionArea:(0,r.jsx)(ej.A,{spacing:".3em",children:o}),titleText:"Add install manifest?"}),null==(t=e.current.setOpen)||t.call(null,!0)},titleText:"Add an install manifest"}),[$,I,g,L,X,z,V,Z,i,N]),Y=(0,o.useMemo)(()=>({actionProceedText:"Update",content:(0,r.jsx)(ti,{formUtils:I,knownFences:L,knownUpses:X,previous:h}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),a=0;a<n;a++)s[a]=arguments[a];let l=ty(...s),{messages:o}=$(l);i({actionProceedText:"Update",content:(0,r.jsx)(C.A,{entries:l,maxDepth:6}),onProceedAppend:()=>{N({body:l,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update install manifest. ",e]}),method:"put",onSuccess:()=>g(),successMsg:"Successfully updated install manifest ".concat(H),url:"/manifest/".concat(_)})},preActionArea:(0,r.jsx)(ej.A,{spacing:".3em",children:o}),titleText:"Update install manifest ".concat(H,"?")}),null==(t=e.current.setOpen)||t.call(null,!0)},loading:u,titleText:"Update install manifest ".concat(H)}),[$,I,g,u,L,X,h,H,_,i,N]),J=(0,o.useCallback)((e,t)=>{m(!0),j.A.get("manifest/".concat(e)).then(t=>{let{data:n}=t;n.uuid=e,p(n)}).catch(e=>{(0,F.A)(e)}).finally(()=>{m(!1),null==t||t.call(null)})},[m,p]),K=(0,o.useMemo)(()=>(0,r.jsx)(td.A,{allowEdit:!0,allowItemButton:c,disableDelete:!B,edit:c,header:!0,listEmpty:"No manifest(s) registered.",listItems:x,onAdd:()=>{var e;null==(e=t.current.setOpen)||e.call(null,!0)},onDelete:()=>{var t;i(O({onProceedAppend:()=>{N({body:{uuids:q},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Delete manifest(s) failed. ",e]}),method:"delete",onSuccess:()=>{g(),D()},url:"/manifest"})},getConfirmDialogTitle:e=>"Delete ".concat(e," manifest(s)?"),renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(M.a3,{children:null==x?void 0:x[t].manifestName})}})),null==(t=e.current.setOpen)||t.call(null,!0)},onEdit:()=>{d(e=>!e)},onItemCheckboxChange:(e,t,n)=>{E(e,n)},onItemClick:e=>{var t;let{manifestName:r,manifestUUID:s}=e;p({name:r,uuid:s}),null==(t=n.current.setOpen)||t.call(null,!0),J(s)},renderListItemCheckboxState:e=>R(e),renderListItem:(e,t)=>{let{manifestName:n}=t;return(0,r.jsxs)(ej.A,{fullWidth:!0,row:!0,children:[(0,r.jsx)(e$.A,{disabled:c,mapPreset:"play",onClick:()=>{var t;null==(t=s.current)||t.setOpen(!0),J(e)},variant:"normal"}),(0,r.jsx)(M.a3,{children:n})]})}}),[O,q,R,J,g,B,c,x,D,E,i,p,N]),Q=(0,o.useMemo)(()=>y||v||f?(0,r.jsx)(eu.A,{}):K,[y,f,v,K]),ee=(0,o.useMemo)(()=>(0,r.jsx)(T.A,{count:1,defaultMessageType:"warning",ref:a}),[]),{confirmDialog:et,finishConfirm:en,setConfirmDialogLoading:er,setConfirmDialogOpen:es,setConfirmDialogProps:ea}=(0,em.A)({initial:{scrollContent:!0,wide:!0}}),el=(0,o.useMemo)(()=>({add:{open:()=>null},confirm:{finish:en,loading:er,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return es(e)},prepare:ea},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==s||null==(e=s.current)?void 0:e.setOpen(t)}}}),[en,er,es,ea]),eo=(0,o.useMemo)(()=>v||u||y,[y,u,v]),ei=(0,o.useMemo)(()=>h&&L&&w&&X&&(0,r.jsx)(tA,{detail:h,knownFences:L,knownHosts:w,knownUpses:X,onSubmitSuccess:()=>{b(),k()},tools:el}),[el,k,b,w,L,X,h]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(U.Zk,{children:[(0,r.jsx)(U.aO,{children:(0,r.jsx)(M.HM,{children:"Manage manifests"})}),Q]}),(0,r.jsx)(tc.A,{...G,disableProceed:S,loadingAction:P,preActionArea:ee,ref:t,scrollContent:!0,showClose:!0}),(0,r.jsx)(tc.A,{...Y,disableProceed:S,loadingAction:P,preActionArea:ee,ref:n,scrollContent:!0,showClose:!0}),(0,r.jsx)(to.K_,{header:"".concat((null==h?void 0:h.anvil)?"Rerun":"Run"," install manifest ").concat(null==h?void 0:h.name),loading:eo,ref:s,showClose:!0,wide:!0,children:ei}),(0,r.jsx)(tl.A,{closeOnProceed:!0,...l,ref:e,scrollContent:!0,wide:!0}),et]})},tM="common-ups-input-ip-address",tI="common-ups-input-host-name",tS="IP address",tC="Host name",tP=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{formUtils:{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:l,setMessage:o},previous:{upsIPAddress:i,upsName:c}={}}=s;return(0,r.jsx)(eg.A,{columns:{xs:1,sm:2},layout:{"common-ups-input-cell-host-name":{children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{id:tI,label:tC,value:c}),inputTestBatch:(0,eb.rn)(tC,()=>{o(tI)},{onFinishBatch:a(tI)},e=>{o(tI,{children:e})}),onFirstRender:l(tI),required:!0})},"common-ups-input-cell-ip-address":{children:(0,r.jsx)(eA.A,{input:(0,r.jsx)(w.A,{id:tM,label:tS,value:i}),inputTestBatch:(0,eb._P)(tS,()=>{o(tM)},{onFinishBatch:a(tM)},e=>{o(tM,{children:e})}),onFirstRender:l(tM),required:!0})}},spacing:"1em"})};var tN=n(19659),tF=n(24944);let tT="add-ups-select-ups-type-id",tU=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{formUtils:a,loading:l,previous:i={},upsTemplate:c}=s,{buildInputFirstRenderFunction:d,setValidity:u}=a,{upsTypeId:m=""}=i,h=(0,tF.A)(),[p,x]=(0,o.useState)(m),f=(0,o.useMemo)(()=>c?Object.entries(c).map(e=>{let t,[n,{brand:s,description:a,links:{0:l}}]=e;if(l){let{linkHref:e,linkLabel:n}=l;t=(0,r.jsx)(tN.A,{href:e,onClick:e=>{e.stopPropagation()},sx:{display:"inline-flex",color:K.Uv},target:"_blank",children:n})}return{displayValue:(0,r.jsxs)(ej.A,{spacing:0,children:[(0,r.jsx)(M.a3,{inverted:!0,children:s}),(0,r.jsxs)(M.a3,{inverted:!0,children:[a," (",t,")"]})]}),value:n}}):[],[c]),j=(0,o.useMemo)(()=>c&&(0,r.jsx)(y.A,{formControlProps:{sx:{marginTop:".3em"}},id:tT,label:"UPS type",onChange:e=>{let{target:{value:t}}=e,n=String(t);u(tT,!0),x(n)},required:!0,selectItems:f,selectProps:{onClearIndicatorClick:()=>{u(tT,!1),x("")},renderValue:e=>{let{brand:t}=c[String(e)];return t}},value:p}),[c,f,p,u]),g=(0,o.useMemo)(()=>l?(0,r.jsx)(eu.A,{}):(0,r.jsxs)(ej.A,{children:[j,p&&(0,r.jsx)(tP,{formUtils:a,previous:i})]}),[a,p,l,j,i]);return(0,o.useEffect)(()=>{h&&d(tT)({isValid:!!p})},[d,p,h]),g},tO="edit-ups-input-ups-uuid",tq=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t,{formUtils:a,loading:l,previous:i,upsTemplate:c,upsUUID:d}=s;return(0,o.useMemo)(()=>l?(0,r.jsx)(eu.A,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tU,{formUtils:a,previous:i,upsTemplate:c}),(0,r.jsx)("input",{hidden:!0,id:tO,readOnly:!0,value:d})]}),[a,l,i,c,d])},tR=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[{target:s}]=n,{elements:a}=s,{value:l}=a.namedItem(tI),{value:o}=a.namedItem(tM),i=a.namedItem(tT),c="",d="",u="";i&&({value:u}=i,{agent:c,brand:d}=e[u]);let m=a.namedItem(tO),h="";return m&&({value:h}=m),{agent:c,brand:d,ipAddress:o,name:l,typeId:u,uuid:h}},tB=e=>{let{brand:t,ipAddress:n,name:s,uuid:a}=e;return(0,r.jsx)(td.A,{listItems:{"ups-brand":{label:"Brand",value:t},"ups-name":{label:"Host name",value:s},"ups-ip-address":{label:"IP address",value:n}},listItemProps:{sx:{padding:0}},renderListItem:(e,t)=>{let{label:n,value:s}=t;return(0,r.jsxs)(ej.A,{fullWidth:!0,growFirst:!0,row:!0,children:[(0,r.jsx)(M.a3,{children:n}),(0,r.jsx)(M.NA,{children:s})]},"confirm-ups-".concat(a,"-").concat(e))}})},tD=()=>{let e=(0,tF.A)(),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)({}),[a,l]=(0,tb.A)(),[i,c]=(0,tb.A)(),[d,u]=(0,o.useState)(!1),[m,h]=(0,o.useState)(!0),[p,x]=(0,o.useState)(),{data:f,loading:g}=(0,W.A)("/ups",{refreshInterval:6e4}),A=(0,tw.A)([tM,tI,tT],s),{isFormInvalid:v,isFormSubmitting:b,submitForm:w}=A,{buildDeleteDialogProps:y,checks:k,getCheck:I,hasChecks:S,setCheck:C}=(0,tv.A)({list:f}),P=(0,o.useCallback)(e=>{var n,s;let{upsAgent:a,upsIPAddress:o,upsName:i,upsUUID:c}=e,d=null!=(s=null==(n=Object.entries(null!=p?p:{}).find(e=>{let[,{agent:t}]=e;return a===t}))?void 0:n[0])?s:"";return{actionProceedText:"Update",content:(0,r.jsx)(tq,{formUtils:A,previous:{upsIPAddress:o,upsName:i,upsTypeId:d},upsTemplate:p,upsUUID:c}),onSubmitAppend:e=>{var n;if(!p)return;let s=tR(p,e),{name:a}=s;l({actionProceedText:"Update",content:tB(s),onProceedAppend:()=>{w({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update UPS. ",e]}),method:"put",successMsg:"Successfully updated UPS ".concat(i),url:"/ups/".concat(c)})},titleText:(0,r.jsxs)(M.HM,{children:["Update"," ",(0,r.jsx)(M.kp,{fontSize:"inherit",children:a})," ","with the following data?"]})}),null==(n=t.current.setOpen)||n.call(null,!0)},titleText:(0,r.jsxs)(M.HM,{children:["Update UPS"," ",(0,r.jsx)(M.kp,{fontSize:"inherit",children:i})]})}},[A,l,w,p]),N=(0,o.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(tU,{formUtils:A,upsTemplate:p}),onSubmitAppend:e=>{var n;if(!p)return;let s=tR(p,e),{brand:a,name:o}=s;l({actionProceedText:"Add",content:tB(s),onProceedAppend:()=>{w({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add UPS. ",e]}),method:"post",successMsg:"Successfully added UPS ".concat(o),url:"/ups"})},titleText:(0,r.jsxs)(M.HM,{children:["Add a"," ",(0,r.jsx)(M.kp,{fontSize:"inherit",children:a})," UPS with the following data?"]})}),null==(n=t.current.setOpen)||n.call(null,!0)},titleText:"Add a UPS"}),[A,l,w,p]),O=(0,o.useMemo)(()=>(0,r.jsx)(td.A,{allowEdit:!0,allowItemButton:d,disableDelete:!S,edit:d,header:!0,listEmpty:"No Ups(es) registered.",listItems:f,onAdd:()=>{var e;c(N),null==(e=n.current.setOpen)||e.call(null,!0)},onDelete:()=>{var e;l(y({getConfirmDialogTitle:e=>"Delete ".concat(e," UPSes?"),onProceedAppend:()=>{w({body:{uuids:k},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to delete UPS(es). ",e]}),method:"delete",url:"/ups"})},renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(M.a3,{children:null==f?void 0:f[t].upsName})}})),null==(e=t.current.setOpen)||e.call(null,!0)},onEdit:()=>{u(e=>!e)},onItemCheckboxChange:(e,t,n)=>{C(e,n)},onItemClick:e=>{var t;c(P(e)),null==(t=n.current.setOpen)||t.call(null,!0)},renderListItemCheckboxState:e=>I(e),renderListItem:(e,t)=>{let{upsAgent:n,upsIPAddress:s,upsName:a}=t;return(0,r.jsxs)(ej.A,{fullWidth:!0,row:!0,children:[(0,r.jsx)(M.a3,{children:a}),(0,r.jsxs)(M.a3,{children:['agent="',n,'"']}),(0,r.jsxs)(M.a3,{children:['ip="',s,'"']})]})}}),[N,y,P,k,I,S,d,C,l,c,w,f]),q=(0,o.useMemo)(()=>m||g?(0,r.jsx)(eu.A,{}):O,[m,g,O]),R=(0,o.useMemo)(()=>(0,r.jsx)(T.A,{count:1,defaultMessageType:"warning",ref:s}),[]);return e&&j.A.get("/ups/template").then(e=>{let{data:t}=e;x(t)}).catch(e=>{(0,F.A)(e)}).finally(()=>{h(!1)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(U.Zk,{children:[(0,r.jsx)(U.aO,{children:(0,r.jsx)(M.HM,{children:"Manage UPSes"})}),q]}),(0,r.jsx)(tc.A,{...i,disableProceed:v,loadingAction:b,preActionArea:R,ref:n,showClose:!0}),(0,r.jsx)(tl.A,{closeOnProceed:!0,...a,ref:t})]})};var tE=n(87986);let tH="prepare-host",t_="prepare-network",tz="manage-fence",tL="manage-ups",tV="manage-manifest",tW={[tH]:"Prepare Host",[t_]:"Prepare Network",[tz]:"Manage Fence Devices",[tL]:"Manage UPSes",[tV]:"Manage Manifests"},tZ="Loading",tX=()=>(0,r.jsx)(tE.A,{children:(0,r.jsx)($.g,{})}),t$=()=>(0,r.jsx)(tE.A,{children:(0,r.jsx)(ex,{})}),tG=()=>(0,r.jsx)(tE.A,{children:(0,r.jsx)(X,{})}),tY=()=>(0,r.jsx)(tE.A,{children:(0,r.jsx)(tD,{})}),tJ=()=>(0,r.jsx)(tE.A,{children:(0,r.jsx)(tk,{})}),tK=()=>{let{isReady:e,push:t,query:n}=(0,l.useRouter)(),[s,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)(tZ);return(0,o.useEffect)(()=>{if(!e)return;let{step:r}=n,a=(0,i.A)(r,{fallbackValue:tH});tW[a]||(a=tH),t({query:{...n,step:a}},void 0,{shallow:!0}),u===tZ&&m(tW[a]),s||d(a)},[e]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{children:(0,r.jsx)("title",{children:u})}),(0,r.jsx)(c.A,{}),(0,r.jsx)(U.Zk,{children:(0,r.jsxs)(ee.A,{onChange:(e,r)=>{d(r),m(tW[r]),t({query:{...n,step:r}},void 0,{shallow:!0})},orientation:{xs:"vertical",sm:"horizontal"},value:s,children:[(0,r.jsx)(Q.A,{label:"Prepare host",value:tH}),(0,r.jsx)(Q.A,{label:"Prepare network",value:t_}),(0,r.jsx)(Q.A,{label:"Manage fence devices",value:tz}),(0,r.jsx)(Q.A,{label:"Manage UPSes",value:tL}),(0,r.jsx)(Q.A,{label:"Manage manifests",value:tV})]})}),(0,r.jsx)(ep.A,{changingTabId:s,tabId:tH,children:(0,r.jsx)(tX,{})}),(0,r.jsx)(ep.A,{changingTabId:s,tabId:t_,children:(0,r.jsx)(t$,{})}),(0,r.jsx)(ep.A,{changingTabId:s,tabId:tz,children:(0,r.jsx)(tG,{})}),(0,r.jsx)(ep.A,{changingTabId:s,tabId:tL,children:(0,r.jsx)(tY,{})}),(0,r.jsx)(ep.A,{changingTabId:s,tabId:tV,children:(0,r.jsx)(tJ,{})})]})}},88851:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-element",function(){return n(85611)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[559,3,208,925,623,296,664,443,923,901,133,732,341,821,603,392,314,636,593,792],()=>t(88851)),_N_E=e.O()}]);