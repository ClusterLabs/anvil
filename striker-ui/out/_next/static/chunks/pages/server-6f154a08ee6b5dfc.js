(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257],{15421:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/server",function(){return r(42690)}])},19383:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(37876),i=r(12981),n=r(14232);let l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[l]=t,{changingTabId:a,children:o,retain:d=!1,tabId:c}=l,u=(0,n.useMemo)(()=>a===c,[a,c]),h=(0,n.useMemo)(()=>d?(0,s.jsx)(i.A,{sx:{display:u?"initial":"none"},children:o}):u&&o,[o,u,d]);return(0,s.jsx)(s.Fragment,{children:h})}},20151:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(e,t,r)=>{let s,{query:i}=e;if(void 0===r){let{[t]:e,...r}=i;s=r}else s={...i,[t]:r};return s}},27341:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,h:()=>d});var s=r(50174),i=r(54638),n=r(54773),l=r(29296),a=r(34637),o=r(90890);let d={draggable:"".concat("DragDataGrid","-draggable")},c=(0,n.Ay)(l.z)({color:o.Qu,["& .".concat(d.draggable)]:{"&:hover":{cursor:"grab",["& .".concat(a.x.cell)]:{["& .".concat(i.A.root)]:{cursor:"auto"}}}},["& .".concat(a.x.columnHeader)]:{"&:focus":{outline:"none"}},["& .".concat(a.x.cell)]:{"&:focus":{outline:"none"},"&:focus-within":{outline:"none"}},["& .".concat(a.x["container--top"])]:{'& [role="row"]':{backgroundColor:"transparent"}},["& .".concat(s.A.root)]:{color:"inherit"}})},40663:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var s=r(37876),i=r(35656),n=r(57212),l=r(54773),a=r(14232),o=r(90890),d=r(46316),c=r(51677);let u=(0,l.Ay)(i.A)({height:"3.5em",marginLeft:0,width:"100%"}),h=e=>{let{baseInputProps:t,checked:r,formControlLabelProps:i,id:l,label:h,name:m,onChange:x,switchProps:j}=e,v=(0,a.useMemo)(()=>(0,d.A)(h,c.a3,{color:"".concat(o.Qu,"AF"),inheritColour:!0}),[h]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u,{control:(0,s.jsx)(n.A,{checked:r,edge:"end",name:m,onChange:x,...j}),label:v,labelPlacement:"start",slotProps:{typography:{flexGrow:1}},...i}),(0,s.jsx)("input",{checked:r,hidden:!0,id:l,readOnly:!0,type:"checkbox",...t})]})}},42690:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>e5});var s=r(37876),i=r(12981),n=r(54773),l=r(77328),a=r.n(l),o=r(89099),d=r(14232),c=r(2690),u=r(57890),h=r(99955),m=r(86732),x=r(88824),j=r(30198),v=r(23437),g=r(64410),p=r(52076),A=r.n(p),f=r(31465),b=r(31771),y=r(17838),w=r(22481);let k=(0,d.forwardRef)((e,t)=>{let{formikUtils:r,slotProps:i}=e,{formik:n}=r,[l,a]=(0,d.useState)(),o=(0,d.useMemo)(()=>({order:"order"}),[]),c=(0,d.useMemo)(()=>void 0===l?-1:n.values.order.indexOf(l),[n.values.order,l]),u=(0,d.useMemo)(()=>c<1,[c]),h=(0,d.useMemo)(()=>{let e=n.values.order.length-1;return c<0||c>=e},[n.values.order.length,c]);return(0,d.useImperativeHandle)(t,()=>({selectedId:l,setSelectedId:a}),[l]),(0,s.jsxs)(f.A,{spacing:".6em",...null==i?void 0:i.box,children:[(0,s.jsx)(w.A,{disabled:u,onClick:()=>{let{order:e}=n.values;if(u)return;let t=c-1,{[t]:r,[c]:s}=e,i=[...e];i.splice(t,2,s,r),n.setFieldValue(o.order,i,!0)},children:(0,s.jsx)(y.A,{fontSize:"small"})}),(0,s.jsx)(w.A,{disabled:h,onClick:()=>{let{order:e}=n.values;if(h)return;let t=c+1,{[c]:r,[t]:s}=e,i=[...e];i.splice(c,2,s,r),n.setFieldValue(o.order,i,!0)},children:(0,s.jsx)(b.A,{fontSize:"small"})})]})});k.displayName="ServerBootOrderControlBox";var S=r(34637),C=r(90890),M=r(27341);let I=(0,n.Ay)(M.A)({["& .".concat(S.x.cell)]:{'&[data-colindex="0"]':{borderLeft:"thick solid ".concat(C.Qu)}},["& .".concat(S.x.row)]:{"&:hover":{cursor:"pointer"}},"& .Mui-selected":{["& .".concat(S.x.cell)]:{'&[data-colindex="0"]':{borderLeft:"thick solid ".concat(C.ft)}}}}),z=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[i]=t,{children:n,formik:l,...a}=i;return(0,s.jsx)(g.Ay,{columns:{xs:1,sm:2,md:3},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),l.handleSubmit(e)},spacing:"1em",...a,children:n})};var O=r(63190),F=r(79982),D=r(59664);let V=e=>{let{dangerous:t,detail:r,formDisabled:i,label:n}=e,{data:l}=(0,D.A)("/job?name=".concat(r.uuid,"::update"),{refreshInterval:2e3}),a=(0,d.useMemo)(()=>!l||i||Object.keys(l).length>0,[i,l]),o=(0,d.useMemo)(()=>t?"red":"blue",[t]);return l?(0,s.jsx)(O.A,{actions:[{background:o,children:n,disabled:a,type:"submit"}]}):(0,s.jsx)(F.A,{mt:0})};var N=r(51677),R=r(23934),W=r(52627),U=r(5806);let P=function(e,t,r,i,n){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},{setSubmitting:a}=t,{buildRequestBody:o,buildSummary:d,onSuccess:c}=l,u=null==d?void 0:d.call(null,e);r.confirm.prepare({actionProceedText:"Save",content:(0,s.jsx)(W.A,{entries:null!=u?u:e}),onCancelAppend:()=>a(!1),onProceedAppend:()=>{var t;r.confirm.loading(!0);let n=null==o?void 0:o.call(null,e,u);R.A.put(i(),null!=(t=null!=n?n:u)?t:e).then(()=>{r.confirm.finish("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered server update job"})}),null==c||c.call(null),r.add.open(!1),r.edit.open(!1)}).catch(e=>{let t=(0,U.A)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register server update job. ",t.children]}),r.confirm.finish("Error",t),a(!1)})},titleText:n()}),r.confirm.open(!0)};var T=r(71986);let q=(0,n.Ay)("div")({display:"flex",flexDirection:"column",width:"100%"}),L=e=>{let{detail:t,tools:r}=e,i=(0,d.useRef)(null),n=(0,d.useMemo)(()=>{let[,...e]=t.devices.diskOrderBy.boot;return e},[t.devices.diskOrderBy.boot]),l=(0,T.A)({initialValues:{order:n},onSubmit:(e,s)=>{P(e,s,r,()=>"/server/".concat(t.uuid,"/set-boot-order"),()=>"Set boot order?",{buildSummary:e=>({order:e.order.map(e=>{let{[e]:{target:{dev:r}}}=t.devices.disks;return r})})})}}),{disabledSubmit:a,formik:o}=l,c=(0,d.useMemo)(()=>o.values.order.map(e=>{let{[e]:{device:r,source:{dev:{path:s=""},file:{path:i=""}},target:{dev:n}}}=t.devices.disks;return{dev:n,index:e,name:r,source:s||i}}),[t.devices.disks,o.values.order]),u=(0,d.useMemo)(()=>[{field:"name",flex:0,headerName:"Name",renderCell:e=>{let{value:t=""}=e,r=t;return/cdrom/.test(t)&&(r="optical"),r=A()(r)},sortable:!1},{field:"dev",flex:0,headerName:"Device",renderCell:e=>{let{value:t}=e;return(0,s.jsx)(N.NA,{noWrap:!0,children:t})},sortable:!1},{field:"source",flex:1,headerName:"Source",renderCell:e=>{let{value:t}=e;return(0,s.jsx)(N.NA,{noWrap:!0,textOverflow:"ellipsis",children:t})},sortable:!1}],[]);return(0,s.jsxs)(z,{formik:o,children:[(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(f.A,{row:!0,spacing:"1em",children:[(0,s.jsx)(k,{formikUtils:l,ref:e=>{i.current=e}}),(0,s.jsx)(q,{children:(0,s.jsx)(I,{columns:u,disableColumnMenu:!0,getRowId:e=>e.index,hideFooter:!0,onRowSelectionModelChange:e=>{var t;let[r]=e;null==(t=i.current)||t.setSelectedId(Number(r))},rows:c})})]})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:t,formDisabled:a,label:"Save"})})]})};var B=r(71401),H=r(69267),E=r(91408),_=r(64830),G=r(45566);let Y=E.Ik({file:(0,G.ZC)().nullable()}),K=E.Ik({cores:E.ai().min(1).required(),sockets:E.ai().min(1).required()}),Z=E.Ik({lvmVgUuid:E.Yj().required("Volume group is required."),protocol:E.Yj().required().oneOf(["long-throw","short-throw","sync"])}),Q=E.Ik({after:E.Yj(),delay:E.ai().min(0)});var X=r(4064);let $=e=>{let{cpu:t,detail:r,tools:i}=e,{topology:n}=r.cpu,{disabledSubmit:l,formik:a,formikErrors:o,handleChange:c}=(0,T.A)({initialValues:{clusters:String(n.clusters),cores:String(n.cores),dies:String(n.dies),sockets:String(n.sockets),threads:String(n.threads)},onSubmit:(e,t)=>{P(e,t,i,()=>"/server/".concat(r.uuid,"/set-cpu"),()=>"Set CPU?",{buildSummary:e=>({cores:Number(e.cores),sockets:Number(e.sockets)})})},validationSchema:K}),u=(0,d.useMemo)(()=>({cores:"cores",sockets:"sockets"}),[]);return(0,s.jsxs)(z,{formik:a,children:[(0,s.jsxs)(g.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(N.a3,{children:["Model: ",Object.values(t.hosts)[0].model]}),(0,s.jsxs)(N.a3,{children:["Available cores: ",t.cores]})]}),(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(H.A,{id:u.cores,label:"Cores",name:u.cores,onChange:c,required:!0,value:a.values.cores})})}),(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(H.A,{id:u.sockets,label:"Sockets",name:u.sockets,onChange:c,required:!0,value:a.values.sockets})})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:o})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:r,formDisabled:l,label:"Save"})})]})},J=e=>{let{detail:t}=e,{data:r}=(0,D.A)("/anvil/".concat(t.anvil.uuid,"/cpu"),{refreshInterval:5e3});return r?(0,s.jsx)($,{cpu:r,...e}):(0,s.jsx)(F.A,{mt:0})};var ee=r(14e3),et=r(46274);let er=e=>{let{detail:t,tools:r}=e,i=(0,ee.useRouter)(),{disabledSubmit:n,formik:l,handleChange:a}=(0,T.A)({initialValues:{name:""},onSubmit:(e,n)=>{(0,et.A)(r,"/server/".concat(t.uuid),"Delete server ".concat(t.name,"?"),{description:(0,s.jsxs)(N.a3,{children:["Are you sure you want to delete the server ",t.name,"? This action is not reversible!"]}),dangerous:!0,method:"delete",messages:{fail:(0,s.jsx)(s.Fragment,{children:"Failed to register server deletion job."}),proceed:"Delete",success:(0,s.jsx)(s.Fragment,{children:"Successfully registered server deletion job"})},onCancel:()=>{n.setSubmitting(!1)},onFail:()=>{n.setSubmitting(!1)},onSuccess:()=>{i.replace("/")}})},validationSchema:E.Ik({name:E.Yj().required().oneOf([t.name])})}),o=(0,d.useMemo)(()=>({name:"name"}),[]);return(0,s.jsxs)(z,{formik:l,justifyContent:"center",children:[(0,s.jsxs)(g.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(N.a3,{children:["Deleting ",(0,s.jsx)(N.kp,{children:t.name})," will remove all of its data, including its configurations and storage volume(s)."]}),(0,s.jsx)(N.a3,{children:"Please type the server name to ensure the correct server gets deleted."})]}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(H.A,{id:o.name,label:"Server name",name:o.name,onChange:a,value:l.values.name})})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{dangerous:!0,detail:t,formDisabled:n,label:"Delete"})})]})};var es=r(23435),ei=r(87768),en=r(57547),el=r(10110),ea=r(5755),eo=r(95339),ed=r(69647),ec=r(22073),eu=r(19121),eh=r(64632),em=r(75242),ex=r(65873);let ej=[...ec.W,{displayValue:"%",value:"percent"}],ev=e=>{var t;let{device:r,detail:i,tools:n}=e,l=(0,d.useMemo)(()=>i.devices.disks.find(e=>e.target.dev===r),[i.devices.disks,r]),{altData:a}=(0,D.A)("/anvil/".concat(i.anvil.uuid,"/storage"),{mod:eu.A,refreshInterval:5e3}),{disabledSubmit:o,formik:c,formikErrors:u,handleChange:h}=(0,T.A)({initialValues:{size:{unit:"GiB",value:"0"},storage:null!=(t=null==l?void 0:l.source.dev.sg)?t:""},onSubmit:(e,t)=>{P(e,t,n,()=>"/server/".concat(i.uuid,"/").concat(r?"grow-disk":"add-disk"),()=>"Add disk on ".concat(null==a?void 0:a.storageGroups[e.storage].name,"?"),{buildSummary:e=>{let{size:t,storage:s}=e,{unit:i,value:n}=t,l=/percent/i.test(i)?"%":i;return r?{device:r,size:"".concat(n).concat(l)}:{size:"".concat(n).concat(l),storage:null==a?void 0:a.storageGroups[s].name}},buildRequestBody:(e,t)=>((null==t?void 0:t.storage)&&(t.storage=e.storage),t)})},validationSchema:(e=>E.Ik({size:E.gl().when(["storage"],(t,r)=>{let[s]=t,i=null==e?void 0:e.storageGroups[s];return i?(0,_._0)(i.free):r}),storage:(0,G.ZC)()}))(a)}),m=(0,d.useMemo)(()=>{let e="size";return{size:e,storage:"storage",unit:"".concat(e,".unit"),value:"".concat(e,".value")}},[]),x=(0,d.useMemo)(()=>a&&Object.values(a.storageGroups).map(e=>({displayValue:e.name,value:e.uuid})),[a]),j=(0,d.useMemo)(()=>{if(a)return a.storageGroups[c.values.storage]},[c.values,a]),v=(0,d.useMemo)(()=>{let{unit:e}=c.values.size;return"percent"===e?"GiB":e},[c.values.size]),p=(0,d.useMemo)(()=>{if(!j)return;let e={toUnit:v};return{free:(0,ed.zz)(j.free,e),size:(0,ed.zz)(j.size,e),used:(0,ed.zz)(j.used,e)}},[v,j]),A=(0,d.useMemo)(()=>{if(!l)return;let{name:e="",size:t}=l.source.dev.lv;if(t)return{name:e,size:(0,ed.zz)(t,{toUnit:v}),zero:/_0$/.test(e)}},[v,l]),f=(0,d.useMemo)(()=>"shut off"!==i.state&&(null==A?void 0:A.zero)||o,[i.state,null==A?void 0:A.zero,o]),b=(0,d.useMemo)(()=>{if("shut off"!==i.state&&(null==A?void 0:A.zero))return(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ea.A,{children:"A server must be shut off in order to grow its disk 0."})})},[i.state,null==A?void 0:A.zero]),y=(0,d.useMemo)(()=>p&&a&&(0,s.jsxs)(g.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(N.a3,{children:["Storage group: ",(0,s.jsx)(N.kp,{noWrap:!0,children:null==j?void 0:j.name})]}),(0,s.jsx)(eh.Fn,{storages:a,target:c.values.storage}),(0,s.jsxs)(g.Ay,{container:!0,children:[(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsxs)(N.a3,{children:["Used: ",p.used]})}),(0,s.jsx)(g.Ay,{item:!0,textAlign:"center",xs:!0,children:(0,s.jsxs)(N.a3,{fontWeight:400,children:["Free: ",p.free]})}),(0,s.jsx)(g.Ay,{item:!0,textAlign:"right",children:(0,s.jsxs)(N.a3,{children:["Total: ",p.size]})})]})]}),[p,c.values.storage,null==j?void 0:j.name,a]),w=(0,d.useMemo)(()=>r&&(0,s.jsx)(g.Ay,{item:!0,textAlign:"center",width:{xs:"100%",sm:"fit-content"},children:(0,s.jsx)(eo.A,{sx:{color:C.Qu}})}),[r]);return x?(0,s.jsxs)(z,{alignItems:"center",formik:c,children:[b,y,(0,s.jsx)(g.Ay,{item:!0,sm:!0,xs:1,children:r?(0,s.jsxs)(g.Ay,{alignItems:"center",container:!0,children:[(0,s.jsxs)(g.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(N.a3,{children:["Disk: ",(0,s.jsx)(N.kp,{noWrap:!0,children:r})]}),(0,s.jsxs)(N.a3,{children:["(",(0,s.jsxs)(N.kp,{children:["volume=",null==A?void 0:A.name]}),")"]})]}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(N.a3,{fontWeight:400,noWrap:!0,children:null==A?void 0:A.size})})]}):(0,s.jsx)(ex.A,{id:m.storage,label:"Storage group",name:m.storage,onChange:c.handleChange,selectItems:x,selectProps:{disabled:!!r},value:c.values.storage})}),w,(0,s.jsx)(g.Ay,{item:!0,sm:!0,xs:1,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(em.A,{id:"server-disk-input",label:"Disk size",inputWithLabelProps:{id:m.value,inputProps:{disabled:!c.values.storage},name:m.value},onChange:h,selectItems:ej,selectWithLabelProps:{id:m.unit,name:m.unit,onChange:e=>{let t=e.target.value,{unit:r,value:s}=c.values.size;if([t,r].includes("percent"))return void c.setFieldValue(m.size,{unit:t,value:"0"},!0);let i=(0,ed.u7)(s,{fromUnit:r,precision:"B"===t?0:void 0,toUnit:t});if(!i)return;let{value:n}=i;c.setFieldValue(m.size,{unit:t,value:n},!0)},selectProps:{disabled:!c.values.storage},value:c.values.size.unit},value:c.values.size.value})})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:u})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:i,formDisabled:f,label:"Save"})})]}):(0,s.jsx)(F.A,{mt:0})};var eg=r(75641),ep=r(57763);let eA=e=>{let{fileUuid:t}=e,{data:r}=(0,D.A)("/file/".concat(t));if(!r)return(0,s.jsx)(F.A,{mt:0});let{checksum:n,path:l,size:a}=r;return(0,s.jsxs)(i.A,{children:[(0,s.jsx)(N.NA,{children:l.full}),(0,s.jsx)(N.NA,{children:(0,ed.zz)(a,{toUnit:"ibyte"})}),(0,s.jsxs)(N.NA,{children:["md5: ",n]})]})},ef=e=>{var t;let{detail:r,device:i,tools:n}=e,l=(0,d.useMemo)(()=>r.devices.disks.find(e=>e.target.dev===i),[r.devices.disks,i]),{data:a}=(0,D.A)("/file?name=".concat(r.anvil.name,"&type=iso"),{refreshInterval:5e3}),{disabledSubmit:o,formik:c,formikErrors:u}=(0,T.A)({initialValues:{file:null!=(t=null==l?void 0:l.source.file.uuid)?t:null},onSubmit:(e,t)=>{P(e,t,n,()=>"/server/".concat(r.uuid,"/change-iso"),()=>"".concat(e.file?"Insert":"Eject"," ISO?"),{buildSummary:e=>{var t;let{file:r}=e,s=null==l?void 0:l.target.dev;return r?{device:s,iso:null==a||null==(t=a[r])?void 0:t.name}:{device:s}},buildRequestBody:(e,t)=>((null==t?void 0:t.iso)&&e.file&&(t.iso=e.file),t)})},validationSchema:Y}),h=(0,d.useMemo)(()=>({file:"file"}),[]),m=(0,d.useMemo)(()=>a&&Object.values(a),[a]),x=(0,d.useMemo)(()=>{if(!a)return;let{file:e}=c.values;if(e)return a[e]},[c.values,a]);return m?(0,s.jsxs)(z,{formik:c,children:[(0,s.jsx)(g.Ay,{item:!0,xs:!0,children:(0,s.jsx)(ep.A,{disableClearable:!0,extendRenderInput:e=>{e.inputLabelProps={...e.inputLabelProps,shrink:!0},e.inputProps={...e.inputProps,notched:!0,placeholder:"Empty slot"}},getOptionLabel:e=>e.name,id:h.file,isOptionEqualToValue:(e,t)=>e.uuid===(null==t?void 0:t.uuid),label:"ISO (optical disk)",noOptionsText:"No matching ISO",onChange:(e,t)=>{c.setFieldValue(h.file,t?t.uuid:null,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{let{name:r,uuid:i}=t;return(0,d.createElement)("li",{...e,key:"iso-op-".concat(i)},(0,s.jsx)(N.a3,{inheritColour:!0,children:r}))},value:x})}),(0,s.jsx)(g.Ay,{item:!0,alignSelf:"center",children:(0,s.jsx)(w.A,{onClick:()=>{c.setFieldValue(h.file,null,!0)},size:"small",children:(0,s.jsx)(eg.A,{})})}),c.values.file&&(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eA,{fileUuid:c.values.file})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:u})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:r,formDisabled:o,label:"Save"})})]}):(0,s.jsx)(F.A,{mt:0})},eb=e=>{let{detail:t,tools:r}=e,i=(0,d.useRef)(null),n=(0,d.useRef)(null),l=(0,d.useRef)(null),[a,o]=(0,d.useState)(),c=(0,d.useMemo)(()=>t.devices.disks.reduce((e,t)=>(e[t.target.dev]=t,e),{}),[t.devices.disks]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(g.Ay,{container:!0,spacing:"1em",children:[(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ea.A,{children:'Disk operations "shrink" or "delete" must be done through commands to avoid data loss.'})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(el.A,{allowAddItem:!0,header:!0,listEmpty:"No disk(s) found.",listItems:c,onAdd:()=>{o(void 0),r.add={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=i.current)?void 0:e.setOpen(t)}},r.add.open(!0)},renderListItem:(e,t)=>{let{device:i,source:{dev:{path:a=""},file:{path:d=""}},target:{dev:c}}=t,u=i;return/cd/.test(i)&&(u="optical"),(0,s.jsxs)(g.Ay,{alignItems:"center",columnGap:"1em",container:!0,children:[(0,s.jsxs)(g.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(f.A,{columnSpacing:0,row:!0,rowSpacing:".5em",children:[(0,s.jsxs)(N.a3,{noWrap:!0,children:[A()(u),":"]})," ",(0,s.jsx)(N.NA,{noWrap:!0,children:e})]}),(0,s.jsx)(N.NA,{noWrap:!0,children:a||d})]}),"optical"===u&&(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(w.A,{onClick:()=>{o(c),r.edit={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=l.current)?void 0:e.setOpen(t)}},r.edit.open(!0)},size:"small",children:(0,s.jsx)(es.A,{})})}),"disk"===u&&(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(w.A,{onClick:()=>{o(c),r.edit={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=n.current)?void 0:e.setOpen(t)}},r.edit.open(!0)},size:"small",children:(0,s.jsx)(ei.A,{sx:{rotate:"90deg"}})})})]})}})})]}),(0,s.jsx)(en.K_,{header:"Add disk",ref:i,showClose:!0,wide:!0,children:(0,s.jsx)(ev,{...e})}),(0,s.jsx)(en.K_,{header:"".concat(a,": grow disk"),ref:n,showClose:!0,wide:!0,children:a&&(0,s.jsx)(ev,{device:a,...e})}),(0,s.jsx)(en.K_,{header:"".concat(a,": insert or eject ISO"),ref:l,showClose:!0,wide:!0,children:a&&(0,s.jsx)(ef,{device:a,...e})})]})};var ey=r(57212),ew=r(75629);let ek={mac:"auto",model:"e1000e"},eS=e=>{let{detail:t,tools:r}=e,{disabledSubmit:i,formik:n,formikErrors:l,handleChange:a}=(0,T.A)({initialValues:{bridge:"",mac:"",model:ek.model},onSubmit:(e,s)=>{P(e,s,r,()=>"/server/".concat(t.uuid,"/add-interface"),()=>"Add interface?",{buildSummary:e=>{let t={...e};return t.mac||(t.mac=ek.mac),t},buildRequestBody:(e,t)=>{let r={};return(null==t?void 0:t.bridge)&&(r.bridge=t.bridge),(null==t?void 0:t.mac)&&t.mac!==ek.mac&&(r.mac=t.mac),(null==t?void 0:t.model)&&t.model!==ek.model&&(r.model=t.model),r}})},validationSchema:(e=>E.Ik({bridge:E.Yj().required(),mac:(0,G.By)().notOneOf([...e.devices.interfaces.map(e=>e.mac.address),...Object.values(e.bridges).map(e=>e.mac)],"${path} already exists"),model:E.Yj().nullable()}))(t)}),o=(0,d.useMemo)(()=>({bridge:"bridge",mac:"mac",model:"model"}),[]),c=(0,d.useMemo)(()=>Object.values(Object.values(t.bridges).reduce((e,t)=>{let{name:r}=t;return r in e||(e[r]={value:r}),e},{})),[t.bridges]);return(0,s.jsxs)(z,{formik:n,children:[(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(ex.A,{id:o.bridge,label:"Bridge",name:o.bridge,onChange:n.handleChange,required:!0,selectItems:c,value:n.values.bridge})}),(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(H.A,{id:o.mac,inputLabelProps:{shrink:!0},inputProps:{notched:!0,placeholder:"Auto generated"},label:"Mac address",name:o.mac,onChange:a,value:n.values.mac})})}),(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(ep.A,{id:o.model,label:"Model",noOptionsText:"No matching model",onChange:(e,t)=>{n.setFieldValue(o.model,t,!0)},openOnFocus:!0,options:t.libvirt.nicModels,value:n.values.model})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:l})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:t,formDisabled:i,label:"Save"})})]})},eC={down:"plug-in",up:"unplug"},eM={down:"unplugged",up:"plugged-in"},eI=e=>{let{detail:t,tools:r}=e,i=(0,d.useRef)(null),[n,l]=(0,d.useState)(0),[a,o]=(0,d.useState)(!1),c=(0,d.useMemo)(()=>t.devices.interfaces.reduce((e,t)=>(e[t.mac.address]=t,e),{}),[t.devices.interfaces]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(g.Ay,{container:!0,children:[(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(el.A,{allowAddItem:!0,header:!0,listEmpty:"No server network interface(s) found.",listItems:c,onAdd:()=>{r.add={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=i.current)?void 0:e.setOpen(t)}},r.add.open(!0)},renderListItem:(e,i)=>{let{link:{state:n},model:{type:l},source:{bridge:a},target:{dev:d}}=i,c="up"===n;return(0,s.jsxs)(g.Ay,{alignItems:"center",columnGap:"1em",container:!0,children:[(0,s.jsxs)(g.Ay,{alignItems:"center",display:"flex",flexDirection:"column",item:!0,minWidth:"5em",children:[(0,s.jsx)(N.xF,{noWrap:!0,children:A()(eM[n])}),(0,s.jsx)(ey.A,{checked:c,onChange:()=>{let{[n]:i}=eC;o(!1),(0,et.A)(r,"/server/".concat(t.uuid,"/set-interface-state"),"".concat(A()(i)," ").concat(d," (").concat(e,")?"),{body:{active:!c,mac:e},messages:{proceed:A()(i),fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",i," interface job."]}),success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",i," interface job"]})},onSuccess:()=>{o(!0)}})}})]}),(0,s.jsxs)(g.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(f.A,{xs:"column",md:"row",columnSpacing:0,children:[(0,s.jsxs)(N.NA,{noWrap:!0,children:[d," (",l,")"]}),(0,s.jsx)(j.A,{flexItem:!0,orientation:"vertical"}),(0,s.jsx)(N.NA,{noWrap:!0,children:e})]}),(0,s.jsx)(N.NA,{children:a})]}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(w.A,{mapPreset:"delete",onClick:()=>{(0,et.A)(r,"/server/".concat(t.uuid,"/delete-interface"),"Delete ".concat(d," (").concat(e,")?"),{body:{mac:e},messages:{proceed:"Delete",fail:(0,s.jsx)(s.Fragment,{children:"Failed to register delete interface job."}),success:(0,s.jsx)(s.Fragment,{children:"Successfully registered delete interface job"})}})},size:"small",variant:"redcontained"})})]})}})}),a&&(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ew.A,{getLabel:e=>100===e?"Finished.":"Changing interface(s)...",names:["server::".concat(t.uuid,"::set_interface_state")],progress:{set:l,value:n}})})]}),(0,s.jsx)(en.K_,{header:"Add interface",ref:i,showClose:!0,wide:!0,children:(0,s.jsx)(eS,{...e})})]})};var ez=r(91322);let eO=e=>{var t,r;let{detail:i,memory:n,tools:l}=e,{disabledSubmit:a,formik:o,formikErrors:c,handleChange:u}=(0,T.A)({initialValues:{size:{unit:"GiB",value:null!=(r=null==(t=(0,ed.u7)(i.memory.size,{toUnit:"GiB"}))?void 0:t.value)?r:"0"}},onSubmit:(e,t)=>{P(e,t,l,()=>"/server/".concat(i.uuid,"/set-memory"),()=>"Set memory?",{buildSummary:e=>{let{unit:t,value:r}=e.size;return{size:"".concat(r).concat(t)}}})},validationSchema:(e=>{let{available:t}=e;return E.Ik({size:(0,_.Yy)(t)})})(n)}),h=(0,d.useMemo)(()=>{let e="size";return{size:e,unit:"".concat(e,".unit"),value:"".concat(e,".value")}},[]),m=(0,d.useMemo)(()=>{let e={toUnit:o.values.size.unit},t=(0,ed.zz)(n.allocated,e),r=(0,ed.zz)(n.available,e);return{allocated:t,available:r,reserved:(0,ed.zz)(n.reserved,e),total:(0,ed.zz)(n.total,e)}},[o.values.size.unit,n.allocated,n.available,n.reserved,n.total]);return(0,s.jsxs)(z,{formik:o,children:[(0,s.jsxs)(g.Ay,{item:!0,width:"100%",children:[(0,s.jsx)(eh.jk,{memory:n}),(0,s.jsxs)(g.Ay,{container:!0,children:[(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsxs)(N.a3,{children:["Allocated: ",m.allocated]})}),(0,s.jsx)(g.Ay,{item:!0,textAlign:"center",xs:!0,children:(0,s.jsxs)(N.a3,{fontWeight:400,children:["Available: ",m.available]})}),(0,s.jsxs)(g.Ay,{item:!0,textAlign:"right",children:[(0,s.jsxs)(N.a3,{children:["System: ",m.reserved]}),(0,s.jsxs)(N.a3,{children:["Total: ",m.total]})]})]})]}),(0,s.jsx)(g.Ay,{item:!0,sm:"auto",xs:1,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(em.A,{id:"server-memory-input",label:"Memory",inputWithLabelProps:{id:h.value,name:h.value},onChange:u,selectItems:ec.W,selectWithLabelProps:{id:h.unit,name:h.unit,onChange:e=>{let t=e.target.value,{value:r,unit:s}=o.values.size,i=(0,ed.u7)(r,{fromUnit:s,precision:"B"===t?0:void 0,toUnit:t});if(!i)return;let{value:n}=i;o.setFieldValue(h.size,{value:n,unit:t},!0)},value:o.values.size.unit},value:o.values.size.value})})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:c})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:i,formDisabled:a,label:"Save"})})]})},eF=e=>{let{detail:t}=e,{altData:r}=(0,D.A)("/anvil/".concat(t.anvil.uuid,"/memory"),{mod:ez.A,refreshInterval:5e3});return r?(0,s.jsx)(eO,{memory:r,...e}):(0,s.jsx)(F.A,{mt:0})};var eD=r(53198);let eV=e=>{let{detail:t,tools:r}=e,{altData:i}=(0,D.A)("/host?type=subnode",{mod:e=>Object.values(e).find(e=>{var r,s;return(null==(r=e.anvil)?void 0:r.uuid)===t.anvil.uuid&&e.shortHostName!==(null==(s=t.host)?void 0:s.short)})});return i?t.host?(0,s.jsxs)(g.Ay,{container:!0,spacing:"1em",children:[(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(N.a3,{children:["Running on: ",t.host.short]})}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsxs)(eD.A,{onClick:()=>{(0,et.A)(r,"/server/".concat(t.uuid,"/migrate"),"Migrate ".concat(t.name," to ").concat(i.shortHostName,"?"),{body:{target:i.shortHostName},messages:{fail:(0,s.jsx)(s.Fragment,{children:"Failed to register migration job."}),proceed:"Migrate",success:(0,s.jsx)(s.Fragment,{children:"Successfully registered migration job"})}})},children:["Migrate to ",i.shortHostName]})})]}):(0,s.jsx)(ea.A,{children:"Cannot migrate a shut off server."}):(0,s.jsx)(F.A,{mt:0})};var eN=r(65795),eR=r.n(eN),eW=r(40663),eU=r(44981);let eP=e=>Object.values(e).reduce((e,t)=>{let{uuid:r}=t;return e[r]=(0,eU.A)(t),e},{});var eT=r(53909),eq=r(71603);let eL=BigInt(0),eB={"short-throw":{displayValue:(0,s.jsxs)(i.A,{children:[(0,s.jsx)(N.a3,{inheritColour:!0,children:"Async (short-throw)"}),(0,s.jsx)(N.a3,{selected:!1,children:"Replication writes are considered done when the data is in the active node's network transmit buffer."})]}),inputValue:"Async (short-throw)",value:"short-throw"},sync:{displayValue:(0,s.jsxs)(i.A,{children:[(0,s.jsx)(N.a3,{inheritColour:!0,children:"Sync"}),(0,s.jsx)(N.a3,{selected:!1,children:"Replication writes are considered done when the data is written to disk on the DR host."})]}),value:"sync"}},eH=Object.values(eB),eE=e=>{let{detail:t,drs:r,tools:i}=e,[n,l]=(0,d.useState)(0),[a,o]=(0,d.useState)(!1),c=(0,d.useMemo)(()=>a&&n<100,[a,n]),u=(0,d.useMemo)(()=>"/server/".concat(t.uuid,"/set-protect"),[t.uuid]),h=(0,d.useMemo)(()=>Object.values(r).reduce((e,t)=>(Object.values(t.storage.volumeGroups).forEach(t=>{e[t.internalUuid]=t}),e),{}),[r]),m=(0,d.useMemo)(()=>Object.values(h).map(e=>e.internalUuid),[h]),x=(0,d.useMemo)(()=>Object.values(t.devices.disks).reduce((e,t)=>{let{lv:r}=t.source.dev;return r.uuid&&(e[r.uuid]=r),e},{}),[t.devices.disks]),j=(0,d.useMemo)(()=>Object.values(t.protect)[0],[t.protect]),v=(0,d.useMemo)(()=>Object.values(x).map(e=>{let{size:t}=e;if(!t)return eL;try{return BigInt(t)}catch(e){return eL}}).reduce((e,t)=>e+t,eL),[x]),{changeFieldValue:p,disabledSubmit:f,formik:b,formikErrors:y}=(0,T.A)({initialValues:{lvmVgUuid:null,protocol:"short-throw"},onSubmit:(e,t)=>{o(!1),P(e,t,i,()=>u,()=>"Update server protect config?",{buildSummary:e=>{let{lvmVgUuid:t,protocol:s}=e;if(!t)return{};let{[t]:i}=h,{[i.host]:n}=r;return{drHost:n.short,volumeGroup:"".concat(i.name," (").concat(i.internalUuid,")"),protocol:s}},buildRequestBody:e=>{let{lvmVgUuid:t,protocol:r}=e,s={operation:"protect"};return t&&(s.lvmVgUuid=t),r&&(s.protocol=r),s},onSuccess:()=>{o(!0)}})},validationSchema:Z}),w=(0,d.useMemo)(()=>({lvmVgUuid:"lvmVgUuid",protocol:"protocol"}),[]);if(j){var k,S;let e,{drUuid:o="",protocol:d,status:c}=j,{[o]:h}=r,m="connected"===c.connection;return c.maxEstimatedTimeToSync&&(e=(0,eq.KN)(c.maxEstimatedTimeToSync)),(0,s.jsxs)(g.Ay,{alignItems:"center",container:!0,spacing:"1em",children:[(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(N.a3,{children:[(0,s.jsx)(N.kp,{edge:"start",noWrap:!0,children:t.name})," ","is configured to be protected by"," ",(0,s.jsx)(N.kp,{noWrap:!0,children:h.short})," using protocol"," ",(0,s.jsx)(N.kp,{noWrap:!0,children:eR()(null!=(S=null==(k=eB[d])?void 0:k.inputValue)?S:d)}),"."]})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(N.a3,{children:["Replication status:"," ",(0,s.jsxs)(N.kp,{inheritColour:!0,color:(0,eT.Wh)(c.overall),children:[c.overall," ",e&&" (estimated ~".concat(e,")")]})," "]})}),(0,s.jsx)(g.Ay,{item:!0,xs:!0,children:(0,s.jsx)(eW.A,{checked:m,label:"Connection",onChange:(e,t)=>{let r=t?"connect":"disconnect",n=A()(r);(0,et.A)(i,u,"".concat(n," the server on the protector DR host?"),{body:{operation:r},description:(0,s.jsx)(N.a3,{children:"connect"===r?(0,s.jsx)(s.Fragment,{children:"This operation connects the server to its copy on the DR host and start streaming replication."}):(0,s.jsx)(s.Fragment,{children:"This operation disconnects the server from its copy on the DR host and stop streaming replication."})}),messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",r," resource job."]}),proceed:n,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",r," resource job"]})}})}})}),(0,s.jsx)(g.Ay,{item:!0,xs:!0,children:(0,s.jsx)(eD.A,{onClick:()=>{let e="update",t=A()(e);(0,et.A)(i,u,"".concat(t," the server on the protector DR host?"),{body:{operation:e},description:(0,s.jsx)(N.a3,{children:"This operation is a combination that connects, performs a sync, and disconnects."}),messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",e," resource job."]}),proceed:t,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",e," resource job"]})}})},sx:{width:"100%"},children:"Update"})}),(0,s.jsx)(g.Ay,{item:!0,xs:!0,children:(0,s.jsx)(eD.A,{background:"red",onClick:()=>{let e="remove",t=A()(e);(0,et.A)(i,u,"".concat(t," protection for the server on the protector DR host?"),{body:{operation:e},description:(0,s.jsx)(N.a3,{children:"This operation removes the server's copy on the DR host and thus removes the protection."}),dangerous:!0,messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",e," protection job."]}),proceed:t,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",e," protection job"]})}})},sx:{width:"100%"},children:"Remove protection"})}),a&&(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ew.A,{getLabel:e=>100===e?"Finished.":"Protecting...",names:["dr::protect"],progress:{set:l,value:n}})})]})}return(0,s.jsxs)(z,{formik:b,children:[(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(el.A,{header:"Server disk(s)",listItems:x,renderListItem:(e,t)=>(0,s.jsxs)(g.Ay,{container:!0,children:[(0,s.jsx)(g.Ay,{item:!0,xs:!0,children:(0,s.jsxs)(N.a3,{children:[(0,s.jsx)(N.kp,{edge:"start",noWrap:!0,children:t.name})," ","(",(0,s.jsx)(N.kp,{noWrap:!0,variant:"caption",children:t.uuid}),")"]})}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(N.a3,{edge:"end",noWrap:!0,children:t.size&&(0,ed.zz)(t.size,{toUnit:"ibyte"})})})]})})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(N.a3,{children:["Server total disk(s) size:"," ",(0,ed.zz)(v,{toUnit:"ibyte"})]})}),(0,s.jsx)(g.Ay,{item:!0,xs:2,children:(0,s.jsx)(ep.A,{getOptionDisabled:e=>{let{[e]:t}=h;return t.free<v},getOptionLabel:e=>{let{[e]:t}=h,{[t.host]:s}=r;return"".concat(s.short," - ").concat(t.name)},id:w.lvmVgUuid,label:"Volume group",noOptionsText:"No matching volume group",onChange:(e,t)=>{p(w.lvmVgUuid,t,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{let{[t]:i}=h,{[i.host]:n}=r,l=i.free>=v?(0,s.jsx)(s.Fragment,{children:"Sufficient space"}):(0,s.jsx)(s.Fragment,{children:"Insufficient space"});return(0,d.createElement)("li",{...e,key:"dr-op-".concat(t)},(0,s.jsxs)(g.Ay,{alignItems:"center",columnSpacing:"1em",container:!0,children:[(0,s.jsxs)(g.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(N.a3,{edge:"start",inheritColour:!0,children:[(0,s.jsx)(N.kp,{edge:"start",inheritColour:!0,noWrap:!0,children:n.short})," ","-"," ",(0,s.jsx)(N.kp,{inheritColour:!0,noWrap:!0,children:i.name})]}),(0,s.jsxs)(N.a3,{edge:"start",inheritColour:!0,children:[(0,s.jsx)(N.kp,{edge:"start",inheritColour:!0,noWrap:!0,children:(0,ed.zz)(i.free,{toUnit:"ibyte"})})," ","free"]})]}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(N.a3,{edge:"end",inheritColour:!0,noWrap:!0,children:l})})]}))},required:!0,value:b.values.lvmVgUuid})}),(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(ex.A,{id:w.protocol,label:"Protocol",name:w.protocol,onChange:b.handleChange,required:!0,selectItems:eH,selectProps:{renderValue:e=>{var t,r;return A()(null!=(r=null==(t=eB[e])?void 0:t.inputValue)?r:e)}},value:b.values.protocol})}),a&&(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ew.A,{getLabel:e=>100===e?"Finished.":"Changing config...",names:["dr::link","dr::protect","storage-group-member::add::".concat(b.values.lvmVgUuid)],progress:{set:l,value:n}})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:y})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:t,formDisabled:f||c,label:"Save"})})]})},e_=e=>{let{altData:t,error:r,loading:i}=(0,D.A)("/host?detail=1&type=dr",{mod:eP});return i?(0,s.jsx)(F.A,{mt:0}):t?(0,s.jsx)(eE,{drs:t,...e}):(0,s.jsxs)(ea.A,{type:"warning",children:["Failed to get DR hosts. ",null==r?void 0:r.message]})},eG=e=>{let{detail:t,servers:r,tools:i}=e,n=(0,ee.useRouter)(),{disabledSubmit:l,formik:a,formikErrors:o,handleChange:c}=(0,T.A)({initialValues:{name:t.name},onSubmit:(e,r)=>{P(e,r,i,()=>"/server/".concat(t.uuid,"/rename"),()=>"Rename ".concat(t.name,"?"),{onSuccess:()=>{n.replace("/")}})},validationSchema:E.Ik({name:(0,_.l9)(t.uuid,r)})}),u=(0,d.useMemo)(()=>({name:"name"}),[]),h=(0,d.useMemo)(()=>"shut off"!==t.state||l,[t.state,l]);return(0,s.jsxs)(z,{formik:a,children:["shut off"!==t.state&&(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ea.A,{children:"A server can only be renamed when it's shut off."})}),(0,s.jsx)(g.Ay,{item:!0,sm:"auto",xs:1,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(H.A,{id:u.name,label:"Server name",name:u.name,onChange:c,required:!0,value:a.values.name})})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:o})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:t,formDisabled:h,label:"Save"})})]})},eY=e=>{let{detail:t,servers:r,tools:i}=e,{disabledSubmit:n,formik:l,formikErrors:a,handleChange:o}=(0,T.A)({initialValues:{active:t.start.active,after:t.start.after||"",delay:String(t.start.delay)},onSubmit:(e,s)=>{P(e,s,i,()=>"/server/".concat(t.uuid,"/set-start-dependency"),()=>"Set start dependency?",{buildSummary:e=>{var t;let{active:s,after:i,delay:n}=e;return s?{after:null==(t=r[i])?void 0:t.name,delay:"".concat(n," second(s)")}:{"stay-off":"yes"}},buildRequestBody:e=>{let{active:t,after:r,delay:s}=e;return t&&r?{after:r,delay:Number(s)}:{active:t}}})},validationSchema:Q}),c=(0,d.useMemo)(()=>({active:"active",after:"after",delay:"delay"}),[]),u=(0,d.useMemo)(()=>Object.values(r).filter(e=>e.uuid!==t.uuid),[t.uuid,r]),h=(0,d.useMemo)(()=>u.map(e=>{let{name:t,uuid:r}=e;return{displayValue:t,value:r}}),[u]);return(0,s.jsxs)(z,{formik:l,children:[(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(ex.A,{id:c.after,label:"Start after",name:c.after,onChange:l.handleChange,selectItems:h,selectProps:{disabled:!l.values.active,onClearIndicatorClick:()=>{l.setFieldValue(c.after,"",!0)}},value:l.values.after})}),(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(X.A,{input:(0,s.jsx)(H.A,{id:c.delay,inputProps:{disabled:!l.values.active||""===l.values.after},label:"Delay (seconds)",name:c.delay,onChange:o,value:l.values.delay})})}),(0,s.jsx)(g.Ay,{item:!0,xs:1,children:(0,s.jsx)(eW.A,{checked:!l.values.active,id:c.active,label:"Stay off",name:c.active,onChange:(e,t)=>{l.setFieldValue(c.active,!t,!0)}})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(B.A,{count:1,messages:a})}),(0,s.jsx)(g.Ay,{item:!0,width:"100%",children:(0,s.jsx)(V,{detail:t,formDisabled:n,label:"Save"})})]})};var eK=r(65832),eZ=r(19383),eQ=r(98927),eX=r(30764);let e$={bootOrder:{label:"Boot order",value:"boot-order"},cpu:{label:"CPU",value:"cpu"},delete:{label:"Deletion",value:"deletion"},disks:{label:"Disks",value:"disks"},general:{label:"General",value:"general"},interfaces:{label:"Interfaces",value:"interfaces"},memory:{label:"Memory",value:"memory"},migration:{label:"Migration",value:"migration"},name:{label:"Name",value:"name"},protect:{label:"Disaster recovery",value:"protect"},startDependency:{label:"Start dependency",value:"start-dependency"}},eJ=(0,n.Ay)(c.i)(e=>{let{theme:t}=e;return{width:"100%",[t.breakpoints.up("xs")]:{height:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return"calc(".concat(e," * 0.6)")}("100vw")},[t.breakpoints.up("sm")]:{height:"6em"},[t.breakpoints.up("md")]:{height:"9em"}}}),e0=e=>{let{slotProps:t,serverUuid:r}=e,[i,n]=(0,d.useState)(e$.general.value),{data:l,mutate:a}=(0,D.A)("/server"),{data:o}=(0,D.A)("/server/".concat(r),{refreshInterval:3e3}),{confirmDialog:u,finishConfirm:h,setConfirmDialogLoading:m,setConfirmDialogOpen:g,setConfirmDialogProps:p}=(0,eX.A)({initial:{scrollContent:!0,wide:!0}}),A=(0,d.useRef)({add:{open:()=>null},confirm:{finish:h,loading:m,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return g(e)},prepare:p},edit:{open:()=>null}});return o&&l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Zk,{children:(0,s.jsxs)(x.A,{container:!0,spacing:"1em",width:"100%",children:[(0,s.jsx)(x.A,{width:{xs:"100%",sm:"14em",md:"20em"},children:(0,s.jsxs)(x.A,{container:!0,spacing:"1em",width:"100%",children:[(0,s.jsx)(x.A,{width:"100%",children:(0,s.jsx)(c.wL,{server:o,children:(0,s.jsx)(c.lN,{server:o,slots:{screenshotBox:(0,s.jsx)(eJ,{})},...null==t?void 0:t.preview})})}),(0,s.jsx)(x.A,{width:"100%",children:(0,s.jsxs)(eQ.A,{onChange:(e,t)=>{n(t),[e$.migration.value,e$.startDependency.value].includes(t)&&a()},orientation:"vertical",value:i,children:[(0,s.jsx)(eK.A,{...e$.general,label:o.name}),(0,s.jsx)(eK.A,{disabled:!0,icon:(0,s.jsx)(j.A,{orientation:"horizontal",sx:{width:"100%"}}),label:""}),(0,s.jsx)(eK.A,{...e$.bootOrder}),(0,s.jsx)(eK.A,{...e$.cpu}),(0,s.jsx)(eK.A,{...e$.disks}),(0,s.jsx)(eK.A,{...e$.interfaces}),(0,s.jsx)(eK.A,{...e$.memory}),(0,s.jsx)(eK.A,{...e$.migration}),(0,s.jsx)(eK.A,{...e$.name}),(0,s.jsx)(eK.A,{...e$.protect}),(0,s.jsx)(eK.A,{...e$.startDependency}),(0,s.jsx)(eK.A,{...e$.delete})]})})]})}),(0,s.jsx)(x.A,{display:{xs:"none",sm:"initial"},children:(0,s.jsx)(j.A,{orientation:"vertical"})}),(0,s.jsxs)(x.A,{size:"grow",children:[(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.general.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.general.label})}),(0,s.jsx)(x.A,{container:!0,rowSpacing:"0.4em",width:"100%",children:[{header:"UUID",value:o.uuid},{header:"State",value:o.state},{header:"On node",value:"".concat(o.anvil.name,": ").concat(o.anvil.description)},{header:"On host",value:o.host?o.host.short:"None"}].map(e=>{let{header:t,value:r}=e;return(0,s.jsx)(x.A,{width:"100%",children:(0,s.jsxs)(x.A,{columnSpacing:"1em",container:!0,width:"100%",children:[(0,s.jsx)(x.A,{width:"10em",children:(0,s.jsx)(N.a3,{children:t})}),(0,s.jsx)(x.A,{size:"grow",children:(0,s.jsx)(N.NA,{children:r})})]})},"general-".concat(t))})})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.bootOrder.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.bootOrder.label})}),(0,s.jsx)(L,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.cpu.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.cpu.label})}),(0,s.jsx)(J,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.delete.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.delete.label})}),(0,s.jsx)(er,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.disks.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.disks.label})}),(0,s.jsx)(eb,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.interfaces.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.interfaces.label})}),(0,s.jsx)(eI,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.memory.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.memory.label})}),(0,s.jsx)(eF,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.migration.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.migration.label})}),(0,s.jsx)(eV,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.name.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.name.label})}),(0,s.jsx)(eG,{detail:o,tools:A.current,servers:l})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.protect.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.protect.label})}),(0,s.jsx)(e_,{detail:o,tools:A.current})]}),(0,s.jsxs)(eZ.A,{changingTabId:i,tabId:e$.startDependency.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(N.HM,{children:e$.startDependency.label})}),(0,s.jsx)(eY,{detail:o,servers:l,tools:A.current})]})]})]})}),u]}):(0,s.jsx)(v.Zk,{children:(0,s.jsx)(F.A,{mt:0})})};var e1=r(87986),e3=r(20151);let e7="Server",e2={preview:"".concat(e7,"-preview"),fullView:"".concat(e7,"-fullView")},e6=(0,n.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(e2.preview)]:{width:"25%",height:"100%",[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(e2.fullView)]:{display:"flex",flexDirection:"row",width:"100%",justifyContent:"center"}}}),e5=()=>{var e;let t=(0,o.useRouter)(),{data:r,error:n,loading:l}=(0,D.A)("/server"),x=(0,d.useMemo)(()=>(0,u.A)(r,t,e=>t=>t.name===e),[t,r]),j=(0,d.useMemo)(()=>{if(!t.isReady)return"";let{view:e}=t.query;return(0,h.A)(e)},[t.isReady,t.query]);if(l)return(0,s.jsxs)("div",{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:"Loading..."})}),(0,s.jsx)(m.A,{}),(0,s.jsx)(e1.A,{children:(0,s.jsx)(v.Zk,{children:(0,s.jsx)(F.A,{mt:0})})})]});if(!x)return(0,s.jsxs)("div",{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:"Server?"})}),(0,s.jsx)(m.A,{}),(0,s.jsx)(e1.A,{children:(0,s.jsx)(v.Zk,{children:(0,s.jsxs)(ea.A,{children:["Couldn't find server ",t.query.name||t.query.uuid,". ",null==n?void 0:n.message]})})})]});let g={vnc:(0,s.jsx)(i.A,{className:e2.fullView,children:(0,s.jsx)(c.pO,{node:x.anvil,onClickCloseButton:()=>{let e=(0,e3.A)(t,"view");t.replace({query:e},void 0,{shallow:!0})},server:x})})};return(0,s.jsxs)(e6,{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:x.name})}),(0,s.jsx)(m.A,{}),null!=(e=g[j])?e:(0,s.jsx)(e1.A,{children:(0,s.jsx)(e0,{serverUuid:x.uuid,slotProps:{preview:{onClick:()=>{let e=(0,e3.A)(t,"view","vnc");t.replace({query:e},void 0,{shallow:!0})}}}})})]})}},52627:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var s=r(37876),i=r(12981),n=r(63009),l=r(12572),a=r(40123),o=r.n(a),d=r(96043),c=r(48440),u=r(31465),h=r(51677);let m=e=>{let{entry:t}=e;return(0,s.jsx)(h.NA,{whiteSpace:"nowrap",children:String(t)})},x=e=>{let{entry:t,hasPassword:r}=e;return(e=>null==e||"number"==typeof e&&!Number.isFinite(e)||"string"==typeof e&&0===e.trim().length)(t)?(0,s.jsx)(h.a3,{children:"none"}):r?(e=>{let{entry:t,key:r}=e;return d.sX.test(r)?(0,s.jsx)(h.EN,{wrapper:"mono",children:String(t)}):m(e)})(e):m(e)},j=e=>{let{depth:t,entry:r,getLabel:n,hasPassword:l,key:a,nest:o,renderValue:d}=e;return(0,s.jsxs)(u.A,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,s.jsx)(h.a3,{children:n({cap:c.A,depth:t,entry:r,hasPassword:l,key:a})}),(0,s.jsx)(i.A,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!o&&d(x,{depth:t,entry:r,hasPassword:l,key:a})})]})},v=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},g=e=>{let{depth:t=0,entries:r,getEntryLabel:i,getListProps:a,getListItemProps:d,hasPassword:c,listKey:u,maxDepth:h,renderEntry:m,renderEntryValue:x,skip:j}=e,p=[];Object.entries(r).forEach(e=>{let[r,n]=e,a="form-summary-entry-".concat(r),u=(e=>null!==e&&"object"==typeof e&&!o()(e))(n),A=u?null:n,f={depth:t,entry:A,hasPassword:c,key:r};j(v,f)||p.push((0,s.jsx)(l.Ay,{sx:{paddingLeft:"".concat(t,"em")},...null==d?void 0:d.call(null,f),children:m({depth:t,entry:A,getLabel:i,hasPassword:c,key:r,nest:u,renderValue:x})},a)),u&&t<h&&p.push(g({depth:t+1,entries:n,getEntryLabel:i,hasPassword:c,listKey:r,maxDepth:h,renderEntry:m,renderEntryValue:x,skip:j}))});let A="form-summary-list-".concat(null!=u?u:"root");return(0,s.jsx)(n.A,{dense:!0,disablePadding:!0,...null==a?void 0:a.call(null,{depth:t,entries:r,key:u}),children:p},A)},p=e=>{let{entries:t,getEntryLabel:r=e=>{let{cap:t,key:r}=e;return t(r)},getListProps:s,getListItemProps:i,hasPassword:n=!1,maxDepth:l=3,renderEntry:a=j,renderEntryValue:o=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e(...r)},skip:d=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e(...r)}}=e;return g({entries:t,getEntryLabel:r,getListProps:s,getListItemProps:i,hasPassword:n,maxDepth:l,renderEntry:a,renderEntryValue:o,skip:d})}},57890:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(99955);let i=(e,t,r)=>{let i;if(!e||!t.isReady)return;let{name:n,uuid:l}=t.query;return n?i=Object.values(e).find(r((0,s.A)(n))):l&&(i=e[(0,s.A)(l)]),i}},65832:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var s=r(37876),i=r(17138),n=r(38214),l=r(54773),a=r(14232),o=r(90890),d=r(51677);let c=(0,l.Ay)(i.A)({borderRadius:o.ax,color:o.Qu,padding:".4em .8em",textTransform:"none",["&.".concat(n.A.selected)]:{color:o.ft}}),u=e=>{let{label:t,...r}=e,i=(0,a.useMemo)(()=>"string"==typeof t?(0,s.jsx)(d.a3,{inheritColour:!0,children:t}):t,[t]);return(0,s.jsx)(c,{label:i,...r})}},75629:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var s=r(37876),i=r(64410),n=r(14232),l=r(5755),a=r(37422),o=r(79982),d=r(51677),c=r(59664),u=r(46316),h=r(71603);let m=e=>{let{commands:t,getLabel:r,names:m,progress:x,uuids:j}=e,[v,g]=(0,n.useState)(0),p=(0,n.useMemo)(()=>(0,h.tB)(),[]),A=(0,n.useMemo)(()=>{let e=new URLSearchParams;return m&&m.forEach(t=>{e.append("name",t)}),t&&t.forEach(t=>{e.append("command",t)}),e.append("start",String(p)),e.toString()},[t,p,m]),{altData:f,loading:b}=(0,c.A)("/job?".concat(A),{mod:e=>{let t,r=(t=j?j.reduce((t,r)=>{let{[r]:s}=e;return s&&t.push(s),t},[]):Object.values(e)).reduce((e,t)=>e+t.progress,0);return x.set(r/t.length),v<t.length&&g(t.length),t},refreshInterval:3e3}),y=(0,n.useMemo)(()=>(0,u.A)(null==r?void 0:r(x.value),d.a3),[r,x.value]);return b?(0,s.jsx)(o.A,{mt:0}):f?0===v?(0,s.jsx)(d.a3,{children:"Waiting for jobs to start..."}):0===f.length?null:(0,s.jsxs)(i.Ay,{alignItems:"center",columnSpacing:"0.5em",container:!0,children:[...f.map(e=>(0,s.jsx)(i.Ay,{item:!0,children:(0,s.jsx)(a.A,{error:!!e.error.count,slotProps:{pie:{size:"1em"}},value:e.progress})},"".concat(e.uuid,"-progress"))),(0,s.jsx)(i.Ay,{item:!0,xs:!0,children:y})]}):(0,s.jsx)(l.A,{type:"warning",children:"Failed to get jobs."})}},87986:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(37876),i=r(64410);let n=e=>{let{children:t}=e;return(0,s.jsxs)(i.Ay,{columns:{lg:8,xs:1},container:!0,children:[(0,s.jsx)(i.Ay,{item:!0,xs:1}),(0,s.jsx)(i.Ay,{item:!0,lg:6,xs:1,children:t}),(0,s.jsx)(i.Ay,{item:!0,xs:1})]})}},98927:(e,t,r)=>{"use strict";r.d(t,{A:()=>x});var s=r(37876),i=r(38214),n=r(58619),l=r(37892),a=r(48061),o=r(30566),d=r(54773),c=r(14232),u=r(90890);let h="1.8em",m=(0,d.Ay)(n.A)({minHeight:"1em",["&.".concat(l.A.vertical)]:{minHeight:h,["& .".concat(i.A.root)]:{alignItems:"flex-start",minHeight:h,paddingLeft:"2em"},["& .".concat(l.A.indicator)]:{right:"initial"}},["& .".concat(i.A.root)]:{minHeight:"1em"},["& .".concat(l.A.indicator)]:{backgroundColor:u.ft,borderRadius:u.ax}}),x=e=>{let{orientation:t,variant:r="fullWidth",...i}=e,n=(0,o.A)(),l=(0,c.useCallback)(e=>n.breakpoints.up(e),[n]),d=(0,a.A)(l("xs")),u=(0,a.A)(l("sm")),h=(0,a.A)(l("md")),x=(0,a.A)(l("lg")),j=(0,a.A)(l("xl")),v=(0,c.useMemo)(()=>[["xs",d],["sm",u],["md",h],["lg",x],["xl",j]],[x,h,u,j,d]),g=(0,c.useMemo)(()=>{let e;return"object"==typeof t?v.some(r=>{let[s,i]=r;return i&&t[s]&&(e=t[s]),!i}):e=t,e},[v,t]);return(0,s.jsx)(m,{orientation:g,variant:r,...i})}},99955:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=function(e){let{fallbackValue:t="",joinSeparator:r="",limit:s=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Array?e.slice(0,s).join(r):null!=e?e:t}}},e=>{e.O(0,[325,208,3,925,623,261,296,82,337,133,732,223,109,391,636,593,792],()=>e(e.s=15421)),_N_E=e.O()}]);