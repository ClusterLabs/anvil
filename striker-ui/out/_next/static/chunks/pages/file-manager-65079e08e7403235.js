(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{91953:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/file-manager",function(){return l(34059)}])},76740:function(e,t,l){"use strict";var n=l(85893),r=l(90642),s=l(19304),i=l(47407),a=l(41609),o=l.n(a),c=l(35338),u=l(44400),d=l(5387),h=l(57882);let m=e=>{let{entry:t}=e;return(0,n.jsx)(h.$_,{whiteSpace:"nowrap",children:String(t)})},v=e=>{let{entry:t,key:l}=e;return c.JW.test(l)?(0,n.jsx)(h.PJ,{wrapper:"mono",children:String(t)}):m(e)},p=e=>{let{entry:t,hasPassword:l}=e;return o()(t)?(0,n.jsx)(h.Ac,{children:"none"}):l?v(e):m(e)},f=e=>{let{depth:t,entry:l,getLabel:s,hasPassword:i,key:a,nest:o,renderValue:c}=e;return(0,n.jsxs)(d.Z,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,n.jsx)(h.Ac,{children:s({cap:u.Z,depth:t,entry:l,hasPassword:i,key:a})}),(0,n.jsx)(r.Z,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!o&&c(p,{depth:t,entry:l,hasPassword:i,key:a})})]})},x=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},j=e=>null!==e&&"object"==typeof e&&!o()(e),g=e=>{let{depth:t=0,entries:l,getEntryLabel:r,getListProps:a,getListItemProps:o,hasPassword:c,listKey:u,maxDepth:d,renderEntry:h,renderEntryValue:m,skip:v}=e,p=[];Object.entries(l).forEach(e=>{let[l,i]=e,a=j(i),u=a?null:i,f={depth:t,entry:u,hasPassword:c,key:l};v(x,f)||p.push((0,n.jsx)(s.ZP,{sx:{paddingLeft:"".concat(t,"em")},...null==o?void 0:o.call(null,f),children:h({depth:t,entry:u,getLabel:r,hasPassword:c,key:l,nest:a,renderValue:m})},"form-summary-entry-".concat(l))),a&&t<d&&p.push(g({depth:t+1,entries:i,getEntryLabel:r,hasPassword:c,listKey:l,maxDepth:d,renderEntry:h,renderEntryValue:m,skip:v}))});let f="form-summary-list-".concat(null!=u?u:"root");return(0,n.jsx)(i.Z,{dense:!0,disablePadding:!0,...null==a?void 0:a.call(null,{depth:t,entries:l,key:u}),children:p},f)};t.Z=e=>{let{entries:t,getEntryLabel:l=e=>{let{cap:t,key:l}=e;return t(l)},getListProps:n,getListItemProps:r,hasPassword:s=!1,maxDepth:i=3,renderEntry:a=f,renderEntryValue:o=function(e){for(var t=arguments.length,l=Array(t>1?t-1:0),n=1;n<t;n++)l[n-1]=arguments[n];return e(...l)},skip:c=function(e){for(var t=arguments.length,l=Array(t>1?t-1:0),n=1;n<t;n++)l[n-1]=arguments[n];return e(...l)}}=e;return g({entries:t,getEntryLabel:l,getListProps:n,getListItemProps:r,hasPassword:s,maxDepth:i,renderEntry:a,renderEntryValue:o,skip:c})}},71108:function(e,t,l){"use strict";var n=l(67294),r=l(66389),s=l(11100);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{config:t,onError:l,onData:i,url:a=""}=e,[o,c]=(0,n.useState)(!1);return{fetch:(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0,o="".concat(a).concat(e);o&&(c(!0),r.Z.get(o,{...t,...n}).then(e=>{let{data:t}=e;null==i||i.call(null,t)}).catch(e=>{let t=(0,s.Z)(e);null==l||l.call(null,t)}).finally(()=>{c(!1)}))},[a,t,i,l]),loading:o}}},81013:function(e,t,l){"use strict";var n=l(85893),r=l(67294),s=l(95996),i=l(76740);t.Z=e=>{let{list:t={}}=e,[l,a]=(0,r.useState)({}),o=(0,r.useMemo)(()=>Object.keys(t),[t]),c=(0,r.useMemo)(()=>Object.keys(l),[l]),u=(0,r.useMemo)(()=>c.length===o.length,[c.length,o.length]),d=(0,r.useMemo)(()=>c.length>0,[c.length]),h=(0,r.useMemo)(()=>o.length>1,[o.length]),m=(0,r.useCallback)(e=>{let{confirmDialogProps:t={},formSummaryProps:r={},getConfirmDialogTitle:s,onProceedAppend:a,renderEntry:o}=e;return{actionProceedText:"Delete",content:(0,n.jsx)(i.Z,{entries:l,maxDepth:0,renderEntry:o,...r}),onProceedAppend:a,proceedColour:"red",titleText:s(c.length),...t}},[l,c.length]),v=(0,r.useCallback)(e=>!!l[e],[l]);return{buildDeleteDialogProps:m,checklist:l,checks:c,getCheck:v,hasAllChecks:u,hasChecks:d,multipleItems:h,resetChecks:(0,r.useCallback)(()=>a({}),[]),setAllChecks:(0,r.useCallback)(e=>a(o.reduce((t,l)=>(e&&(t[l]=e),t),{})),[o]),setCheck:(0,r.useCallback)((e,t)=>a((0,s.ZP)(e,t||void 0)),[])}}},84337:function(e,t,l){"use strict";var n=l(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:l="",...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.useState)({actionProceedText:e,content:t,titleText:l,...r})}},39806:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var n=e=>e.reduce((e,t)=>{let{hostName:l,hostType:n,hostUUID:r,shortHostName:s}=t;return e[r]={name:l,short:s,type:n,uuid:r},e},{}),r=e=>e.reduce((e,t)=>{let{anvilDescription:l,anvilName:r,anvilUUID:s,hosts:i}=t;return e[s]={description:l,hosts:n(i),name:r,uuid:s},e},{})},95996:function(e,t,l){"use strict";l.d(t,{Um:function(){return r}});let n=function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];let[,n,r,s]=t;void 0!==s&&(n[r]=s)},r=function(e,t){let{set:l=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=>{let r={};return Object.keys(n).forEach(s=>{e.test(s)?l(n,r,s,t):r[s]=n[s]}),r}};t.ZP=function(e,t){let{guard:l=()=>!0,set:r=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=>{let{[e]:s,...i}=n,a={...i};return l(n,e,t)&&r(n,a,e,t),a}}},34059:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return er}});var n=l(85893),r=l(9008),s=l.n(r),i=l(25436),a=l(8506),o=l(54490),c=l(67294);let u=[["iso",["application/x-cd-image","ISO (optical disc)"]],["other",["text/plain","Other file type"]],["script",["text/plain","Script (program)"]]],d=new Map(u);var h=l(25934),m=l(42050),v=l(66389),p=l(46194),f=l(56894),x=l(50361),j=l.n(x),g=l(23279),Z=l.n(g),b=l(5387),y=l(18541),k=l(23852),w=l(65375),C=l(37628),S=l(57882),O=l(12823),P=e=>{let{anvils:t,drHosts:l,fileUuid:r,formik:s,showSyncInputGroup:i,showTypeInput:a}=e,{handleBlur:o,handleChange:d}=s,h=(0,c.useMemo)(()=>Z()(d,500),[d]),m=(0,c.useMemo)(()=>({locations:"".concat(r,".locations"),name:"".concat(r,".name"),type:"".concat(r,".type")}),[r]),v=(0,c.useCallback)((e,t)=>{s.setValues(l=>{var n;let s=j()(l),i=null===(n=s[r].locations)||void 0===n?void 0:n[e];return i?(Object.keys(i).forEach(e=>{i[e].active=t}),s):l})},[s,r]),p=(0,c.useCallback)(e=>{var t;let l=null===(t=s.values[r].locations)||void 0===t?void 0:t[e];return l?{checked:Object.values(l).every(e=>{let{active:t}=e;return t}),onChange:(t,l)=>{v(e,l)}}:{}},[s.values,r,v]),x=(0,c.useCallback)((e,t)=>{var l,n,i;let a="".concat(m.locations,".").concat(e,".").concat(t),c="".concat(a,".active");return{id:c,name:c,checked:null===(i=s.values[r].locations)||void 0===i?void 0:null===(n=i[e])||void 0===n?void 0:null===(l=n[t])||void 0===l?void 0:l.active,onBlur:o,onChange:d}},[m.locations,s.values,r,o,d]),g=(0,c.useCallback)(e=>{var t;let l=null===(t=s.values[r].locations)||void 0===t?void 0:t[e];return l&&Object.keys(l).length>1},[s.values,r]),P=(0,c.useMemo)(()=>(0,n.jsx)(O.Z,{input:(0,n.jsx)(k.Z,{id:m.name,label:"File name",name:m.name,onBlur:o,onChange:h,value:s.values[r].name})}),[m.name,h,s.values,r,o]),I=(0,c.useMemo)(()=>i&&(0,n.jsx)(w.TZ,{header:"Sync with node(s)",panelProps:{mb:0,mt:0,width:"100%"},children:(0,n.jsx)(y.Z,{allowCheckAll:g("anvils"),allowCheckItem:!0,edit:!0,header:!0,listItems:t,getListCheckboxProps:()=>p("anvils"),getListItemCheckboxProps:e=>x("anvils",e),renderListItem:(e,t)=>{let{description:l,name:r}=t;return(0,n.jsxs)(S.Ac,{children:[r,": ",l]})}})}),[t,g,p,x,i]),M=(0,c.useMemo)(()=>i&&(0,n.jsx)(w.TZ,{header:"Sync with DR host(s)",panelProps:{mb:0,mt:0,width:"100%"},children:(0,n.jsx)(y.Z,{allowCheckAll:g("drHosts"),allowCheckItem:!0,edit:!0,header:!0,listItems:l,getListCheckboxProps:()=>p("drHosts"),getListItemCheckboxProps:e=>x("drHosts",e),renderListItem:(e,t)=>{let{hostName:l}=t;return(0,n.jsx)(S.Ac,{children:l})}})}),[l,g,p,x,i]),A=(0,c.useMemo)(()=>a&&(0,n.jsx)(C.Z,{id:m.type,label:"File type",name:m.type,onBlur:o,onChange:d,selectItems:u.map(e=>{let[t,[,l]]=e;return{displayValue:l,value:t}}),value:s.values[r].type}),[m.type,s.values,r,o,d,a]);return(0,n.jsxs)(f.Z,{sx:{"& > :not(:first-child)":{marginTop:"1em"}},children:[(0,n.jsxs)(b.Z,{sm:"row",xs:"column",children:[P,A]}),I,M]})},I=l(11100),M=l(18050),A=l(16310),F=l(74178),U=l(48313);let _=A.Ry({active:A.O7().required()}),D=A.Vo(e=>A.Ry((0,F.Z)(e,_))),E=A.Vo(e=>A.Ry((0,F.Z)(e,_))),R=A.Ry({locations:A.Ry({anvils:D,drHosts:E}),name:A.Z_().required(),type:A.Z_().oneOf(["iso","other","script"]),uuid:(0,U.uI)().required()}),H=A.Vo(e=>A.Ry((0,F.Z)(e,R)));var L=l(90642),T=l(64236),N=e=>{let{uploads:t}=e;return(0,n.jsx)(b.Z,{columnSpacing:".2em",children:Object.values(t).map(e=>{let{name:t,progress:l,uuid:r}=e;return(0,n.jsxs)(L.Z,{sx:{alignItems:{md:"center"},display:"flex",flexDirection:{xs:"column",md:"row"},"& > :first-child":{minWidth:100,overflow:"hidden",overflowWrap:"normal",textOverflow:"ellipsis",whiteSpace:"nowrap",width:{xs:"100%",md:200},wordBreak:"keep-all"},"& > :last-child":{flexGrow:1}},children:[(0,n.jsx)(S.Ac,{children:t}),(0,n.jsx)(T.ko,{progressPercentage:l})]},"upload-".concat(r))})})},V=l(22582);let W=(e,t,l)=>e?(e[t].progress=l,{...e}):e;var B=e=>{let{anvils:t,drHosts:l}=e,r=(0,c.useRef)(null),s=(0,c.useRef)(null),[i,a]=(0,c.useState)(),o=(0,c.useCallback)(e=>{var t,l;return null==r?void 0:null===(l=r.current)||void 0===l?void 0:null===(t=l.setMessage)||void 0===t?void 0:t.call(null,"api",e)},[]),{disabledSubmit:u,formik:d,formikErrors:f}=(0,V.Z)({initialValues:{},onSubmit:e=>{let t=Object.values(e);a(t.reduce((e,t)=>{let{file:l,name:n,uuid:r}=t;return l&&(e[r]={name:n,progress:0,uuid:r}),e},{})),o({children:(0,n.jsx)(n.Fragment,{children:"Closing this dialog before the upload(s) complete will cancel the upload(s)."})}),Promise.all(t.reduce((e,t)=>{let{file:l,name:n,uuid:r}=t;if(!l)return e;let s=new FormData;s.append("file",new File([l],n,{...l}));let i=v.Z.post("/file",s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let{loaded:t,total:l=t}=e;a(e=>W(e,r,Math.round(t/l*99)))}}).then(()=>{a(e=>W(e,r,100))});return e.push(i),e},[])).then(()=>{o({children:(0,n.jsxs)(b.Z,{spacing:0,children:[(0,n.jsx)("span",{children:"Upload(s) completed; file(s) will be listed after the job(s) to sync them to other host(s) finish."}),(0,n.jsx)("span",{children:"You can close this dialog."})]})})}).catch(e=>{let t=(0,I.Z)(e);t.children=(0,n.jsxs)(n.Fragment,{children:["Failed to add file. ",t.children]}),o(t)})},validationSchema:H}),x=(0,c.useCallback)(e=>{let{target:{files:t}}=e;if(!t)return;let l=Array.from(t).reduce((e,t)=>{let l=(0,h.Z)();return e[l]={file:t,name:t.name,uuid:l},e},{});d.setValues(l,!0)},[d]),j=(0,c.useMemo)(()=>Object.values(d.values).map(e=>{let{uuid:r}=e;return(0,n.jsx)(P,{anvils:t,drHosts:l,fileUuid:r,formik:d},r)}),[t,l,d]);return(0,n.jsxs)(b.Z,{children:[(0,n.jsx)(M.Z,{ref:r}),i?(0,n.jsx)(N,{uploads:i}):(0,n.jsxs)(b.Z,{component:"form",onSubmit:e=>{e.preventDefault(),d.submitForm()},children:[(0,n.jsx)("input",{id:"files",multiple:!0,name:"files",onChange:x,ref:s,style:{display:"none"},type:"file"}),(0,n.jsx)(p.Z,{onClick:()=>{var e;null===(e=s.current)||void 0===e||e.click()},children:"Browse"}),j,(0,n.jsx)(M.Z,{count:1,messages:f}),(0,n.jsx)(m.Z,{actions:[{background:"blue",children:"Add",disabled:u,type:"submit"}]})]})]})},J=l(39806),q=l(65902),G=l(47177),X=l(45036),$=l(82092);let z=(e,t)=>{let{locations:l,name:n,type:r,uuid:s}=e;if(!l||!r)return;let i=[];return Object.entries(l.anvils).reduce((e,l)=>{let[n,{active:r}]=l,{anvils:{[n]:{locationUuids:s}}}=t,i=s.map(e=>({fileLocationUUID:e,isFileLocationActive:r}));return e.push(...i),e},i),Object.entries(l.drHosts).reduce((e,l)=>{let[n,{active:r}]=l,{hosts:{[n]:{locationUuids:s}}}=t,i=s.map(e=>({fileLocationUUID:e,isFileLocationActive:r}));return e.push(...i),e},i),{fileLocations:i,fileName:n,fileType:r,fileUUID:s}};var K=e=>{let{anvils:t,drHosts:l,onSuccess:r,previous:s}=e,i=(0,c.useRef)({}),a=(0,c.useCallback)(e=>{var t;return null===(t=i.current.setMessage)||void 0===t?void 0:t.call(null,"api",e)},[]),o=(0,c.useMemo)(()=>{let{name:e,type:n,uuid:r}=s,i={anvils:{},drHosts:{}};Object.values(t).forEach(e=>{let t=s.anvils[e.uuid].locationUuids.every(e=>s.locations[e].active);i.anvils[e.uuid]={active:t}});let a=Object.values(s.locations);return Object.values(l).forEach(e=>{let t=a.find(t=>t.hostUuid===e.hostUUID);i.drHosts[e.hostUUID]={active:!!t&&t.active}}),{[r]:{locations:i,name:e,type:n,uuid:r}}},[t,l,s]),{formik:u,disabledSubmit:d,formikErrors:h}=(0,V.Z)({initialValues:o,onSubmit:(e,t)=>{let{setSubmitting:l}=t,i=z(e[s.uuid],s);v.Z.put("/file/".concat(s.uuid),i).then(()=>{a({children:(0,n.jsx)(n.Fragment,{children:"File updated."})}),null==r||r.call(null)}).catch(e=>{let t=(0,I.Z)(e);t.children=(0,n.jsxs)(n.Fragment,{children:["Failed to modify file. ",t.children]}),a(t)}).finally(()=>{l(!1)})},validationSchema:H});return(0,n.jsxs)(b.Z,{component:"form",onSubmit:e=>{e.preventDefault(),u.submitForm()},children:[(0,n.jsx)(P,{anvils:t,drHosts:l,fileUuid:s.uuid,formik:u,showSyncInputGroup:!0,showTypeInput:!0}),(0,n.jsx)(M.Z,{count:1,messages:h,ref:i}),(0,n.jsx)(m.Z,{loading:u.isSubmitting,actions:[{background:"blue",children:"Update",disabled:d,type:"submit"}]})]})},Y=l(90209),Q=l(71108),ee=l(81013),et=l(84337),el=l(5499),en=()=>{let e=(0,c.useRef)(null),t=(0,c.useRef)({}),l=(0,c.useRef)(null),r=(0,c.useRef)({}),[s,i]=(0,et.Z)(),[u,h]=(0,c.useState)(!1),[m,p]=(0,c.useState)(),{data:f,loading:x,mutate:j}=(0,el.Z)("/file",{refreshInterval:5e3}),{buildDeleteDialogProps:g,checks:Z,getCheck:k,hasAllChecks:C,hasChecks:O,multipleItems:P,resetChecks:I,setAllChecks:A,setCheck:F}=(0,ee.Z)({list:f}),U=(0,c.useCallback)(e=>{var t;return null===(t=r.current.setMessage)||void 0===t?void 0:t.call(null,"api",e)},[]),{fetch:_,loading:D}=(0,Q.Z)({onData:e=>{U(),p(e)},onError:e=>{let{children:t,...l}=e;U({children:(0,n.jsxs)(n.Fragment,{children:["Failed to get file detail. ",t]}),...l})},url:"/file/"}),{altData:E,loading:R}=(0,el.Z)("/anvil",{mod:J.Z}),{data:H,loading:L}=(0,el.Z)("/host?type=dr"),T=(0,c.useMemo)(()=>(0,n.jsx)(y.Z,{allowCheckAll:P,allowEdit:!0,allowItemButton:u,disableDelete:!O,edit:u,getListCheckboxProps:()=>({checked:C,onChange:(e,t)=>{A(t)}}),getListItemCheckboxProps:e=>({checked:k(e),onChange:(t,l)=>{F(e,l)}}),header:!0,listEmpty:"No file(s) found.",listItems:f,onAdd:()=>{var t;null===(t=e.current)||void 0===t||t.setOpen(!0)},onDelete:()=>{var e;i(g({onProceedAppend:()=>{Promise.all(Z.map(e=>v.Z.delete("/file/".concat(e)))).then(()=>j()),I()},getConfirmDialogTitle:e=>"Delete the following ".concat(e," file(s)?"),renderEntry:e=>{let{key:t}=e;return(0,n.jsx)(S.Ac,{children:null==f?void 0:f[t].name})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{h(e=>!e)},onItemClick:(e,t)=>{var n;null===(n=l.current)||void 0===n||n.setOpen(!0),_(t)},renderListItem:(e,t)=>{var l;let{anvils:r,checksum:s,name:i,size:c,type:u}=t,h=Object.values(r).some(e=>{let{ready:t}=e;return!t});return(0,n.jsxs)(a.ZP,{container:!0,columnGap:"1em",children:[h&&(0,n.jsx)(a.ZP,{alignSelf:"center",item:!0,children:(0,n.jsx)(q.Z,{size:"1.5em",variant:"indeterminate"})}),(0,n.jsxs)(a.ZP,{item:!0,xs:!0,children:[(0,n.jsxs)(b.Z,{columnSpacing:0,rowSpacing:".5em",sm:"row",xs:"column",children:[(0,n.jsx)(S.$_,{noWrap:!0,children:i}),(0,n.jsx)($.Z,{flexItem:!0,orientation:"vertical"}),(0,n.jsx)(S.Ac,{children:null===(l=d.get(u))||void 0===l?void 0:l[1]})]}),(0,n.jsxs)(b.Z,{row:!0,spacing:".5em",children:[h&&(0,n.jsx)(S.Ac,{children:"Syncing..."}),(0,n.jsx)(S.Ac,{children:(0,o._d)(c,{toUnit:"ibyte"})})]})]}),(0,n.jsx)(a.ZP,{alignSelf:"center",item:!0,width:{xs:"100%",md:"auto"},children:(0,n.jsx)(S.$_,{noWrap:!0,children:s})})]})}}),[g,Z,u,f,k,_,j,C,O,P,I,A,F,i]),N=(0,c.useMemo)(()=>x?(0,n.jsx)(Y.Z,{}):T,[x,T]),V=(0,c.useMemo)(()=>x||R||L,[R,L,x]),W=(0,c.useMemo)(()=>x||R||L||D,[R,L,D,x]),z=(0,c.useMemo)(()=>E&&H&&(0,n.jsx)(B,{anvils:E,drHosts:H}),[E,H]),en=(0,c.useMemo)(()=>E&&H&&m&&(0,n.jsx)(K,{anvils:E,drHosts:H,onSuccess:()=>{j()},previous:m}),[E,H,m,j]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(w.s_,{children:[(0,n.jsx)(w.V9,{children:(0,n.jsx)(S.z,{children:"Files"})}),(0,n.jsx)(M.Z,{ref:r}),N]}),(0,n.jsx)(X.Js,{header:"Add file(s)",loading:V,ref:e,showClose:!0,wide:!0,children:z}),(0,n.jsx)(X.Js,{header:"Update file ".concat(null==m?void 0:m.name),loading:W,ref:l,showClose:!0,wide:!0,children:en}),(0,n.jsx)(G.Z,{closeOnProceed:!0,wide:!0,...s,ref:t})]})},er=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s(),{children:(0,n.jsx)("title",{children:"File Manager"})}),(0,n.jsx)(i.Z,{}),(0,n.jsx)(en,{})]})}},function(e){e.O(0,[537,256,711,736,215,436,590,888,774,179],function(){return e(e.s=91953)}),_N_E=e.O()}]);