(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(95911)}])},9968:function(e,n,t){"use strict";var s=t(85893),r=t(77527),i=t(90642),c=t(39971);let l="Decorator",o={ok:"".concat(l,"-ok"),warning:"".concat(l,"-warning"),error:"".concat(l,"-error"),off:"".concat(l,"-off")},a=(0,r.ZP)(i.Z)({borderRadius:c.n_,height:"100%",width:"1.4em",["&.".concat(o.ok)]:{backgroundColor:c.Ej},["&.".concat(o.warning)]:{backgroundColor:c.Wd},["&.".concat(o.error)]:{backgroundColor:c.hM},["&.".concat(o.off)]:{backgroundColor:c.s7}});n.Z=e=>{let{colour:n,...t}=e;return(0,s.jsx)(a,{...t,className:o[n]})}},91905:function(e,n,t){"use strict";var s=t(85893),r=t(67294),i=t(8506),c=t(90642);n.Z=e=>{let{calculateItemBreakpoints:n=()=>({xs:1}),layout:t,wrapperBoxProps:l,...o}=e,a=(0,r.useMemo)(()=>Object.entries(t).map((e,t)=>{let[s,c]=e;return c?(0,r.createElement)(i.ZP,{...n(t,s),key:s,item:!0,...c}):void 0}),[n,t]);return(0,s.jsx)(c.Z,{...l,children:(0,s.jsx)(i.ZP,{container:!0,...o,children:a})})}},65716:function(e,n,t){"use strict";var s=t(85893),r=t(77527),i=t(61769),c=t(39971);let l=(0,r.ZP)(i.Z)({color:c.lD,textDecorationColor:c.s7});n.Z=e=>{let{children:n,...t}=e;return(0,s.jsx)(l,{underline:"always",variant:"subtitle1",...t,children:n})}},39806:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var s=e=>e.reduce((e,n)=>{let{hostName:t,hostType:s,hostUUID:r,shortHostName:i}=n;return e[r]={name:t,short:i,type:s,uuid:r},e},{}),r=e=>e.reduce((e,n)=>{let{anvilDescription:t,anvilName:r,anvilUUID:i,hosts:c}=n;return e[i]={description:t,hosts:s(c),name:r,uuid:i},e},{})},95911:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return eh}});var s=t(85893),r=t(90642),i=t(9008),c=t.n(i),l=t(24811),o=t(67294),a=t(8506),d=t(54490),h=t(39971),x=e=>{let{anvilStatus:n,anvil_name:t,anvil_uuid:s,hosts:r}=e;return{hosts:r.reduce((e,n)=>{let{host_name:t,host_uuid:s,maintenance_mode:r,server_count:i,state:c,state_percent:l}=n;return e[s]={name:t,maintenance:r,serverCount:i,state:c,stateProgress:l,uuid:s},e},{}),name:t,status:n,uuid:s}},u=t(22700),j=t(60665),m=t(64236),Z=t(82092),p=t(5387),g=t(90209),v=t(57882),f=t(29255),P=t(5499);let w={offline:h.s7,optimal:h.Ej},b={offline:h.s7,optimal:h.Ej},_={offline:h.s7,online:h.Ej};var y=e=>{let{anvilUuid:n,refreshInterval:t=5e3}=e,{altData:r,loading:i}=(0,P.Z)("/anvil/".concat(n),{mod:x,refreshInterval:t}),{data:c,loading:y}=(0,P.Z)("/anvil/".concat(n,"/cpu"),{refreshInterval:t}),C=(0,o.useMemo)(()=>c&&Object.values(c.hosts),[c]),{altData:k,loading:A}=(0,P.Z)("/anvil/".concat(n,"/memory"),{mod:u.Z,refreshInterval:t}),{altData:S,loading:M}=(0,P.Z)("/anvil/".concat(n,"/storage"),{mod:j.Z,refreshInterval:t}),W=(0,o.useMemo)(()=>[i,y,A,M].some(e=>e),[i,y,A,M]),E=(0,o.useMemo)(()=>{var e;if(!r)return;let n=null!==(e=w[r.status.system])&&void 0!==e?e:h.Wd;return(0,s.jsx)(v.$_,{inheritColour:!0,color:n,children:r.status.system})},[r]),I=(0,o.useMemo)(()=>{var e;let n;if(!r)return;let{drbd:t}=r.status;t.estimatedTimeToSync&&(n=(0,f.F6)(t.estimatedTimeToSync));let i=null!==(e=b[r.status.drbd.status])&&void 0!==e?e:h.Wd;return(0,s.jsxs)(v.$_,{inheritColour:!0,color:i,children:[r.status.drbd.status,n&&"(needs ~".concat(n,")")]})},[r]),N=(0,o.useMemo)(()=>r&&(0,s.jsx)(a.ZP,{columns:1,container:!0,children:Object.values(r.hosts).map(e=>{var n;let{name:t,serverCount:r,state:i,stateProgress:c,uuid:l}=e,o=null!==(n=_[i])&&void 0!==n?n:h.Wd,d=i;return["offline","online"].includes(i)||(d="".concat(i," (").concat(c,"%)")),(0,s.jsxs)(a.ZP,{alignItems:"center",columnSpacing:"0.5em",container:!0,sx:{},children:[(0,s.jsx)(a.ZP,{item:!0,xs:"auto",children:(0,s.jsx)(v.Ac,{variant:"caption",whiteSpace:"nowrap",children:t})}),(0,s.jsx)(a.ZP,{item:!0,xs:"auto",children:(0,s.jsx)(v.$_,{inheritColour:!0,color:o,children:d})}),(0,s.jsx)(a.ZP,{item:!0,xs:!0,children:(0,s.jsx)(Z.Z,{})}),(0,s.jsx)(a.ZP,{item:!0,xs:"auto",children:(0,s.jsxs)(a.ZP,{alignItems:"center",columns:2,container:!0,width:"4em",children:[(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{variant:"caption",children:"Servers"})}),(0,s.jsx)(a.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(v.$_,{variant:"caption",children:r})})]})})]},"subnode-".concat(l))})}),[r]),O=(0,o.useMemo)(()=>c&&C&&(0,s.jsxs)(p.Z,{row:!0,rowSpacing:".5em",children:[(0,s.jsxs)(v.Ac,{variant:"caption",whiteSpace:"nowrap",children:["Vendor"," ",(0,s.jsx)(v.Q0,{sx:{paddingRight:0},children:C[0].vendor})]}),(0,s.jsx)(Z.Z,{sx:{flexGrow:1}}),(0,s.jsxs)(a.ZP,{alignItems:"center",columns:2,container:!0,width:"4em",children:[(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{variant:"caption",children:"Cores"})}),(0,s.jsx)(a.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(v.$_,{variant:"caption",children:c.cores})}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{variant:"caption",children:"Threads"})}),(0,s.jsx)(a.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(v.$_,{variant:"caption",children:c.threads})})]})]}),[c,C]),D=(0,o.useMemo)(()=>k&&(0,s.jsxs)(p.Z,{spacing:0,children:[(0,s.jsx)(p.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(v.Ac,{mb:"-.3em",variant:"caption",children:["Free",(0,s.jsx)(v.Q0,{children:(0,d._d)(k.available,{toUnit:"ibyte"})}),"/",(0,s.jsx)(v.Q0,{sx:{paddingRight:0},children:(0,d._d)(k.total,{toUnit:"ibyte"})})]})}),(0,s.jsx)(m._1,{memory:k,thin:!0})]}),[k]),T=(0,o.useMemo)(()=>S&&(0,s.jsxs)(p.Z,{spacing:0,children:[(0,s.jsx)(p.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(v.Ac,{mb:"-.3em",variant:"caption",children:["Total free",(0,s.jsx)(v.Q0,{children:(0,d._d)(S.totalFree,{toUnit:"ibyte"})}),"/",(0,s.jsx)(v.Q0,{sx:{paddingRight:0},children:(0,d._d)(S.totalSize,{toUnit:"ibyte"})})]})}),(0,s.jsx)(m.Tj,{storages:S,thin:!0})]}),[S]);return W?(0,s.jsx)(g.Z,{mt:0}):(0,s.jsxs)(a.ZP,{alignItems:"center",columns:4,container:!0,sx:{["& > .".concat(l.Z.item,":nth-child(odd)")]:{alignItems:"center",display:"flex",height:"2.2em"}},children:[(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{children:"Node"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:E}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{children:"Replication"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:I}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{children:"Subnodes"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:N}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{children:"CPU"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:O}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{children:"Memory"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:D}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Ac,{children:"Storage"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:T})]})},C=t(39806),k=t(91905),A=t(65716),S=t(65375),M=t(18573),W=e=>{let{refreshInterval:n=4e3}=e,{altData:t,loading:r,validating:i}=(0,P.Z)("/anvil",{mod:C.Z,refreshInterval:n}),c=(0,o.useMemo)(()=>t&&(0,s.jsx)(k.Z,{columns:{xs:1,md:2,lg:3,xl:4},layout:Object.values(t).reduce((e,t)=>{let{description:r,name:i,uuid:c}=t;return e["anvil-".concat(c)]={children:(0,s.jsxs)(S.Lg,{height:"100%",mv:0,children:[(0,s.jsxs)(S.CH,{children:[(0,s.jsx)(A.Z,{href:"/anvil?name=".concat(i),noWrap:!0,children:i}),(0,s.jsx)(v.Ac,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:r})]}),(0,s.jsx)(S.bc,{children:(0,s.jsx)(y,{anvilUuid:c,refreshInterval:n})})]})},e},{}),spacing:"1em",sx:{alignContent:"stretch",["& > .".concat(l.Z.item)]:{minWidth:"20em"}}}),[t,n]);return(0,s.jsxs)(S.s_,{children:[(0,s.jsxs)(S.V9,{children:[(0,s.jsx)(v.z,{children:"Nodes"}),(0,s.jsx)(M.Z,{syncing:i})]}),r?(0,s.jsx)(g.Z,{}):c]})},E=t(25436),I=t(86142),N=t(38855),O=t(44859),D=t(23279),T=t.n(D),U=t(46194),z=t(45328),R=t(75492),$=t(18766),F=t(29873),Q=t(43463),B=t(43267),H=t(77527),V=t(65625),L=t(48403),X=t.n(L),G=t(9968),J=t(45842),q=t(21758),K=t(64537);let Y={running:"ok","shut off":"off",crashed:"error"},ee=(0,H.ZP)(J.$x)(()=>({borderRadius:h.n_,height:"calc(".concat("3em"," * 0.8)"),width:"3em"})),en=(0,H.ZP)(J.$x)(()=>{let e="3.2em";return{height:e,margin:0,width:e}}),et=e=>{var n;return null!==(n=Y[e])&&void 0!==n?n:"warning"};var es=e=>{let n,t,i,c;let{servers:l,uuid:d}=e,h=l[d],x=(0,o.useMemo)(()=>"provisioning"===h.state,[h.state]),u=(0,o.useMemo)(()=>{let{jobs:e}=h;if(e)return(0,s.jsx)(en,{children:[...Object.values(e).map((e,n)=>{let{peer:t,progress:r,uuid:i}=e;return(0,s.jsx)(q.Z,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(2.8em - ".concat(1.5*n,"em)"),sx:{opacity:t?.6:void 0,["& .".concat(V.Z.circle)]:{strokeLinecap:"round"}},thickness:6},underline:{thickness:r?0:1}},value:r},"".concat(i,"-progress"))})]})},[h]);return x?(n=(0,s.jsx)(a.ZP,{item:!0,children:u}),i=(0,s.jsx)(v.Ac,{noWrap:!0,children:h.name}),c=(0,s.jsxs)(v.Ac,{noWrap:!0,children:[X()(h.state),"..."]})):(n=(0,s.jsx)(a.ZP,{alignSelf:"stretch",item:!0,children:(0,s.jsx)(G.Z,{colour:et(h.state)})}),t=(0,s.jsx)(J.MB,{server:h,slots:{screenshotBox:(0,s.jsx)(ee,{})},slotProps:{screenshot:{sx:{fontSize:".6em"}}}}),i=(0,s.jsx)(A.Z,{href:"/server?name=".concat(h.name),noWrap:!0,children:h.name}),c=(0,s.jsx)(v.Ac,{noWrap:!0,children:X()(h.state)})),(0,s.jsxs)(a.ZP,{alignItems:"center",container:!0,spacing:"0.5em",children:[n,(0,s.jsx)(a.ZP,{item:!0,children:t}),(0,s.jsx)(a.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(a.ZP,{container:!0,children:[(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:i}),(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:c})]})}),(0,s.jsx)(a.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(A.Z,{href:"/anvil?name=".concat(h.anvil.name),noWrap:!0,children:h.anvil.name}),h.host&&(0,s.jsx)(v.Ac,{noWrap:!0,children:h.host.short})]})}),(0,s.jsx)(a.ZP,{item:!0,children:(0,s.jsx)(K.Z,{node:h.anvil,server:h,slotProps:{button:{slotProps:{button:{icon:{size:"small"}}}}}})})]})},er=e=>{let{groups:n,servers:t}=e,{altData:r,loading:i}=(0,P.Z)("/anvil",{mod:C.Z}),c=(0,o.useMemo)(()=>r?Object.entries(n).reduce((e,n,i,c)=>{let[l,o]=n;return o.length&&(o.forEach(n=>{e.push((0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(es,{anvils:r,servers:t,uuid:n})},"".concat(n,"-summary")))}),i+1!==c.length&&e.push((0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(Z.Z,{orientation:"horizontal"})},"".concat(l,"-end")))),e},[]):[],[r,n,t]);return i?(0,s.jsx)(a.ZP,{container:!0,spacing:"1em",children:(0,s.jsx)(g.Z,{mt:0})}):(0,s.jsx)(a.ZP,{columns:{xs:1,md:2,lg:3,xl:4},container:!0,spacing:"1em",children:[...c]})};let ei=(0,H.ZP)(J.$x)(e=>{let{theme:n}=e,t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return"calc(".concat(e," * 0.6)")};return{width:"100%",[n.breakpoints.up("xs")]:{height:t("100vw")},[n.breakpoints.up("sm")]:{height:t("50vw")},[n.breakpoints.up("md")]:{height:t("100vw / 3")},[n.breakpoints.up("lg")]:{height:t("25vw")},[n.breakpoints.up("xl")]:{height:t("100vw / 6")}}}),ec=e=>(0,s.jsx)(a.ZP,{item:!0,children:(0,s.jsx)(J.bC,{getHeader:e=>{let{jobs:n,name:t}=e;return n?(0,s.jsx)(v.Ac,{noWrap:!0,children:t}):(0,s.jsx)(A.Z,{href:"/server?name=".concat(t),noWrap:!0,children:t})},server:e,showControls:!e.jobs,children:(0,s.jsx)(J.MB,{server:e,slots:{screenshotBox:(0,s.jsx)(ei,{})}})},"".concat(e.uuid,"-preview"))});var el=e=>{let{groups:n,servers:t}=e,r=(0,o.useMemo)(()=>Object.entries(n).reduce((e,n,r,i)=>{let[c,l]=n;return l.length&&(l.forEach(n=>{let r=t[n];e.push((0,s.jsx)(a.ZP,{item:!0,xs:1,children:ec(r)},"".concat(n,"-panel")))}),r+1!==i.length&&e.push((0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(Z.Z,{orientation:"horizontal"})},"".concat(c,"-end")))),e},[]),[n,t]);return(0,s.jsx)(a.ZP,{columns:{xs:1,sm:2,md:3,lg:4,xl:6},container:!0,spacing:"1em",children:r})},eo=t(12823);let ea=(e,n)=>{let t={match:[],none:[]};if(!e)return t;let s=Object.keys(e);return n?s.reduce((t,s)=>{let r=e[s],i=RegExp(n,"i"),c=JSON.stringify(r);return i.test(c)?t.match.push(s):t.none.push(s),t},t):t.none=s,t};var ed=()=>{let e;let[n,t]=(0,o.useState)(null),[i,c]=(0,o.useState)(),[l,d]=(0,o.useState)(""),{data:x,loading:u,error:j,validating:m}=(0,P.Z)("/server",{refreshInterval:4e3,onSuccess:e=>{c(ea(e,l))}}),p=(0,o.useMemo)(()=>T()(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[,s=""]=n;d(s),c(ea(...n))},500),[]),f=(0,o.useMemo)(()=>{if(l&&(null==i||!i.match.length))return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(v.Ac,{noWrap:!0,children:"No match"})}),(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(Z.Z,{orientation:"horizontal"})})]})},[null==i?void 0:i.match.length,l]),w=(0,B.Zd)();if(u)return(0,s.jsx)(S.s_,{children:(0,s.jsx)(g.Z,{mt:0})});if(!x||!i)return(0,s.jsx)(S.s_,{children:(0,s.jsxs)(F.Z,{type:"warning",children:["Couldn't get the list of servers. ",null==j?void 0:j.message]})});let b="preferences.servers.view";return e="list"===localStorage.getItem(b)?(0,s.jsx)(er,{groups:i,servers:x}):(0,s.jsx)(el,{groups:i,servers:x}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(S.s_,{children:[(0,s.jsxs)(S.V9,{children:[(0,s.jsx)(v.z,{children:"Servers"}),(0,s.jsx)(M.Z,{syncing:m}),(0,s.jsxs)(r.Z,{sx:{["&.".concat(O.Z.root)]:{marginRight:".5em"}},children:[(0,s.jsx)(U.Z,{onClick:e=>{t(e.currentTarget)},startIcon:(0,s.jsx)(I.Z,{}),sx:{lineHeight:2},children:"View"}),(0,s.jsxs)(R.Z,{open:!!n,slotProps:{menu:{anchorEl:n,keepMounted:!0,onClose:()=>t(null)}},children:[(0,s.jsx)($.Z,{onClick:()=>{localStorage.setItem(b,"previews"),t(null)},children:(0,s.jsx)(v.Ac,{inheritColour:!0,children:"Previews"})}),(0,s.jsx)($.Z,{onClick:()=>{localStorage.setItem(b,"list"),t(null)},children:(0,s.jsx)(v.Ac,{inheritColour:!0,children:"List"})})]})]}),(0,s.jsx)(z.Z,{mapPreset:"add",onClick:()=>{w.setOpen(!0)}}),(0,s.jsx)(eo.Z,{input:(0,s.jsx)(Q.Z,{onChange:e=>{let{value:n}=e.target;p(x,n)},startAdornment:(0,s.jsx)(N.Z,{sx:{color:h.d,marginRight:".4em"}}),sx:{width:"20em"}})})]}),(0,s.jsxs)(a.ZP,{container:!0,spacing:"1em",children:[f,(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:e})]})]}),w.dialog]})},eh=()=>(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(c(),{children:(0,s.jsx)("title",{children:"Dashboard"})}),(0,s.jsx)(E.Z,{}),(0,s.jsx)(ed,{}),(0,s.jsx)(W,{})]})}},function(e){e.O(0,[537,256,711,245,511,215,436,590,394,955,888,774,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);