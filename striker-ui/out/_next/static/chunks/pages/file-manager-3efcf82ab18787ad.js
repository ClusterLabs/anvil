(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[912],{4177:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>er});var n=t(37876),r=t(77328),s=t.n(r),a=t(86732),i=t(64410),o=t(69647),c=t(14232);let u=[["iso",["application/x-cd-image","ISO (optical disc)"]],["other",["text/plain","Other file type"]],["script",["text/plain","Script (program)"]]],d=new Map(u);var h=t(91423),m=t(63190),p=t(23934),v=t(53198),x=t(36085),f=t(72649),j=t.n(f),g=t(4917),A=t.n(g),b=t(31465),y=t(74799),k=t(69267),w=t(23437),C=t(65873),I=t(51677),S=t(4064);let M=e=>{let{anvils:l,drHosts:t,fileUuid:r,formik:s,showSyncInputGroup:a,showTypeInput:i}=e,{handleBlur:o,handleChange:d}=s,h=(0,c.useMemo)(()=>A()(d,500),[d]),m=(0,c.useMemo)(()=>({locations:"".concat(r,".locations"),name:"".concat(r,".name"),type:"".concat(r,".type")}),[r]),p=(0,c.useCallback)((e,l)=>{s.setValues(t=>{var n;let s=j()(t),a=null==(n=s[r].locations)?void 0:n[e];return a?(Object.keys(a).forEach(e=>{a[e].active=l}),s):t})},[s,r]),v=(0,c.useCallback)(e=>{var l;let t=null==(l=s.values[r].locations)?void 0:l[e];return t?{checked:Object.values(t).every(e=>{let{active:l}=e;return l}),onChange:(l,t)=>{p(e,t)}}:{}},[s.values,r,p]),f=(0,c.useCallback)((e,l)=>{var t,n,a;let i="".concat(m.locations,".").concat(e,".").concat(l),c="".concat(i,".active");return{id:c,name:c,checked:null==(a=s.values[r].locations)||null==(n=a[e])||null==(t=n[l])?void 0:t.active,onBlur:o,onChange:d}},[m.locations,s.values,r,o,d]),g=(0,c.useCallback)(e=>{var l;let t=null==(l=s.values[r].locations)?void 0:l[e];return t&&Object.keys(t).length>1},[s.values,r]),M=(0,c.useMemo)(()=>(0,n.jsx)(S.A,{input:(0,n.jsx)(k.A,{id:m.name,label:"File name",name:m.name,onBlur:o,onChange:h,value:s.values[r].name})}),[m.name,h,s.values,r,o]),O=(0,c.useMemo)(()=>a&&(0,n.jsx)(w.l8,{header:"Sync with node(s)",panelProps:{mb:0,mt:0,width:"100%"},children:(0,n.jsx)(y.A,{allowCheckAll:g("anvils"),allowCheckItem:!0,edit:!0,header:!0,listItems:l,getListCheckboxProps:()=>v("anvils"),getListItemCheckboxProps:e=>f("anvils",e),renderListItem:(e,l)=>{let{description:t,name:r}=l;return(0,n.jsxs)(I.a3,{children:[r,": ",t]})}})}),[l,g,v,f,a]),F=(0,c.useMemo)(()=>a&&(0,n.jsx)(w.l8,{header:"Sync with DR host(s)",panelProps:{mb:0,mt:0,width:"100%"},children:(0,n.jsx)(y.A,{allowCheckAll:g("drHosts"),allowCheckItem:!0,edit:!0,header:!0,listItems:t,getListCheckboxProps:()=>v("drHosts"),getListItemCheckboxProps:e=>f("drHosts",e),renderListItem:(e,l)=>{let{hostName:t}=l;return(0,n.jsx)(I.a3,{children:t})}})}),[t,g,v,f,a]),D=(0,c.useMemo)(()=>i&&(0,n.jsx)(C.A,{id:m.type,label:"File type",name:m.type,onBlur:o,onChange:d,selectItems:u.map(e=>{let[l,[,t]]=e;return{displayValue:t,value:l}}),value:s.values[r].type}),[m.type,s.values,r,o,d,i]);return(0,n.jsxs)(x.A,{sx:{"& > :not(:first-child)":{marginTop:"1em"}},children:[(0,n.jsxs)(b.A,{sm:"row",xs:"column",children:[M,D]}),O,F]})};var O=t(5806),F=t(71401),D=t(91408),P=t(2062),U=t(45566);let E=D.Ik({active:D.zM().required()}),_=D.RZ(e=>D.Ik((0,P.A)(e,E))),H=D.RZ(e=>D.Ik((0,P.A)(e,E))),N=D.Ik({locations:D.Ik({anvils:_,drHosts:H}),name:D.Yj().required(),type:D.Yj().oneOf(["iso","other","script"]),uuid:(0,U.ZC)().required()}),L=D.RZ(e=>D.Ik((0,P.A)(e,N)));var R=t(12981),T=t(64632);let W=e=>{let{uploads:l}=e;return(0,n.jsx)(b.A,{columnSpacing:".2em",children:Object.values(l).map(e=>{let{name:l,progress:t,uuid:r}=e;return(0,n.jsxs)(R.A,{sx:{alignItems:{md:"center"},display:"flex",flexDirection:{xs:"column",md:"row"},"& > :first-child":{minWidth:100,overflow:"hidden",overflowWrap:"normal",textOverflow:"ellipsis",whiteSpace:"nowrap",width:{xs:"100%",md:200},wordBreak:"keep-all"},"& > :last-child":{flexGrow:1}},children:[(0,n.jsx)(I.a3,{children:l}),(0,n.jsx)(T.z2,{progressPercentage:t})]},"upload-".concat(r))})})};var B=t(71986);let z=(e,l,t)=>e?(e[l].progress=t,{...e}):e,V=e=>{let{anvils:l,drHosts:t}=e,r=(0,c.useRef)(null),s=(0,c.useRef)(null),[a,i]=(0,c.useState)(),o=(0,c.useCallback)(e=>{var l,t;return null==r||null==(t=r.current)||null==(l=t.setMessage)?void 0:l.call(null,"api",e)},[]),{disabledSubmit:u,formik:d,formikErrors:x}=(0,B.A)({initialValues:{},onSubmit:e=>{let l=Object.values(e);i(l.reduce((e,l)=>{let{file:t,name:n,uuid:r}=l;return t&&(e[r]={name:n,progress:0,uuid:r}),e},{})),o({children:(0,n.jsx)(n.Fragment,{children:"Closing this dialog before the upload(s) complete will cancel the upload(s)."})}),Promise.all(l.reduce((e,l)=>{let{file:t,name:n,uuid:r}=l;if(!t)return e;let s=new FormData;s.append("file",new File([t],n,{...t}));let a=p.A.post("/file",s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let{loaded:l,total:t=l}=e;i(e=>z(e,r,Math.round(l/t*99)))}}).then(()=>{i(e=>z(e,r,100))});return e.push(a),e},[])).then(()=>{o({children:(0,n.jsxs)(b.A,{spacing:0,children:[(0,n.jsx)("span",{children:"Upload(s) completed; file(s) will be listed after the job(s) to sync them to other host(s) finish."}),(0,n.jsx)("span",{children:"You can close this dialog."})]})})}).catch(e=>{let l=(0,O.A)(e);l.children=(0,n.jsxs)(n.Fragment,{children:["Failed to add file. ",l.children]}),o(l)})},validationSchema:L}),f=(0,c.useCallback)(e=>{let{target:{files:l}}=e;if(!l)return;let t=Array.from(l).reduce((e,l)=>{let t=(0,h.A)();return e[t]={file:l,name:l.name,uuid:t},e},{});d.setValues(t,!0)},[d]),j=(0,c.useMemo)(()=>Object.values(d.values).map(e=>{let{uuid:r}=e;return(0,n.jsx)(M,{anvils:l,drHosts:t,fileUuid:r,formik:d},r)}),[l,t,d]);return(0,n.jsxs)(b.A,{children:[(0,n.jsx)(F.A,{ref:r}),a?(0,n.jsx)(W,{uploads:a}):(0,n.jsxs)(b.A,{component:"form",onSubmit:e=>{e.preventDefault(),d.submitForm()},children:[(0,n.jsx)("input",{id:"files",multiple:!0,name:"files",onChange:f,ref:s,style:{display:"none"},type:"file"}),(0,n.jsx)(v.A,{onClick:()=>{var e;null==(e=s.current)||e.click()},children:"Browse"}),j,(0,n.jsx)(F.A,{count:1,messages:x}),(0,n.jsx)(m.A,{actions:[{background:"blue",children:"Add",disabled:u,type:"submit"}]})]})]})};var Z=t(99327),X=t(35685),q=t(75925),G=t(57547),K=t(30198);let Y=(e,l)=>{let{locations:t,name:n,type:r,uuid:s}=e;if(!t||!r)return;let a=[];return Object.entries(t.anvils).reduce((e,t)=>{let[n,{active:r}]=t,{anvils:{[n]:{locationUuids:s}}}=l,a=s.map(e=>({fileLocationUUID:e,isFileLocationActive:r}));return e.push(...a),e},a),Object.entries(t.drHosts).reduce((e,t)=>{let[n,{active:r}]=t,{hosts:{[n]:{locationUuids:s}}}=l,a=s.map(e=>({fileLocationUUID:e,isFileLocationActive:r}));return e.push(...a),e},a),{fileLocations:a,fileName:n,fileType:r,fileUUID:s}},J=e=>{let{anvils:l,drHosts:t,onSuccess:r,previous:s}=e,a=(0,c.useRef)({}),i=(0,c.useCallback)(e=>{var l;return null==(l=a.current.setMessage)?void 0:l.call(null,"api",e)},[]),o=(0,c.useMemo)(()=>{let{name:e,type:n,uuid:r}=s,a={anvils:{},drHosts:{}};Object.values(l).forEach(e=>{let l=s.anvils[e.uuid].locationUuids.every(e=>s.locations[e].active);a.anvils[e.uuid]={active:l}});let i=Object.values(s.locations);return Object.values(t).forEach(e=>{let l=i.find(l=>l.hostUuid===e.hostUUID);a.drHosts[e.hostUUID]={active:!!l&&l.active}}),{[r]:{locations:a,name:e,type:n,uuid:r}}},[l,t,s]),{formik:u,disabledSubmit:d,formikErrors:h}=(0,B.A)({initialValues:o,onSubmit:(e,l)=>{let{setSubmitting:t}=l,a=Y(e[s.uuid],s);p.A.put("/file/".concat(s.uuid),a).then(()=>{i({children:(0,n.jsx)(n.Fragment,{children:"File updated."})}),null==r||r.call(null)}).catch(e=>{let l=(0,O.A)(e);l.children=(0,n.jsxs)(n.Fragment,{children:["Failed to modify file. ",l.children]}),i(l)}).finally(()=>{t(!1)})},validationSchema:L});return(0,n.jsxs)(b.A,{component:"form",onSubmit:e=>{e.preventDefault(),u.submitForm()},children:[(0,n.jsx)(M,{anvils:l,drHosts:t,fileUuid:s.uuid,formik:u,showSyncInputGroup:!0,showTypeInput:!0}),(0,n.jsx)(F.A,{count:1,messages:h,ref:a}),(0,n.jsx)(m.A,{loading:u.isSubmitting,actions:[{background:"blue",children:"Update",disabled:d,type:"submit"}]})]})};var Q=t(79982),$=t(23192),ee=t(57656),el=t(42116),et=t(59664);let en=()=>{let e=(0,c.useRef)(null),l=(0,c.useRef)({}),t=(0,c.useRef)(null),r=(0,c.useRef)({}),[s,a]=(0,el.A)(),[u,h]=(0,c.useState)(!1),[m,v]=(0,c.useState)(),{data:x,loading:f,mutate:j}=(0,et.A)("/file",{refreshInterval:5e3}),{buildDeleteDialogProps:g,checks:A,getCheck:k,hasAllChecks:C,hasChecks:S,multipleItems:M,resetChecks:O,setAllChecks:D,setCheck:P}=(0,ee.A)({list:x}),U=(0,c.useCallback)(e=>{var l;return null==(l=r.current.setMessage)?void 0:l.call(null,"api",e)},[]),{fetch:E,loading:_}=(0,$.A)({onData:e=>{U(),v(e)},onError:e=>{let{children:l,...t}=e;U({children:(0,n.jsxs)(n.Fragment,{children:["Failed to get file detail. ",l]}),...t})},url:"/file/"}),{altData:H,loading:N}=(0,et.A)("/anvil",{mod:Z.A}),{data:L,loading:R}=(0,et.A)("/host?type=dr"),T=(0,c.useMemo)(()=>(0,n.jsx)(y.A,{allowCheckAll:M,allowEdit:!0,allowItemButton:u,disableDelete:!S,edit:u,getListCheckboxProps:()=>({checked:C,onChange:(e,l)=>{D(l)}}),getListItemCheckboxProps:e=>({checked:k(e),onChange:(l,t)=>{P(e,t)}}),header:!0,listEmpty:"No file(s) found.",listItems:x,onAdd:()=>{var l;null==(l=e.current)||l.setOpen(!0)},onDelete:()=>{var e;a(g({onProceedAppend:()=>{Promise.all(A.map(e=>p.A.delete("/file/".concat(e)))).then(()=>j()),O()},getConfirmDialogTitle:e=>"Delete the following ".concat(e," file(s)?"),renderEntry:e=>{let{key:l}=e;return(0,n.jsx)(I.a3,{children:null==x?void 0:x[l].name})}})),null==(e=l.current.setOpen)||e.call(null,!0)},onEdit:()=>{h(e=>!e)},onItemClick:(e,l)=>{var n;null==(n=t.current)||n.setOpen(!0),E(l)},renderListItem:(e,l)=>{var t;let{anvils:r,checksum:s,name:a,size:c,type:u}=l,h=Object.values(r).some(e=>{let{ready:l}=e;return!l});return(0,n.jsxs)(i.Ay,{container:!0,columnGap:"1em",children:[h&&(0,n.jsx)(i.Ay,{alignSelf:"center",item:!0,children:(0,n.jsx)(X.A,{size:"1.5em",variant:"indeterminate"})}),(0,n.jsxs)(i.Ay,{item:!0,xs:!0,children:[(0,n.jsxs)(b.A,{columnSpacing:0,rowSpacing:".5em",sm:"row",xs:"column",children:[(0,n.jsx)(I.NA,{noWrap:!0,children:a}),(0,n.jsx)(K.A,{flexItem:!0,orientation:"vertical"}),(0,n.jsx)(I.a3,{children:null==(t=d.get(u))?void 0:t[1]})]}),(0,n.jsxs)(b.A,{row:!0,spacing:".5em",children:[h&&(0,n.jsx)(I.a3,{children:"Syncing..."}),(0,n.jsx)(I.a3,{children:(0,o.zz)(c,{toUnit:"ibyte"})})]})]}),(0,n.jsx)(i.Ay,{alignSelf:"center",item:!0,width:{xs:"100%",md:"auto"},children:(0,n.jsx)(I.NA,{noWrap:!0,children:s})})]})}}),[g,A,u,x,k,E,j,C,S,M,O,D,P,a]),W=(0,c.useMemo)(()=>f?(0,n.jsx)(Q.A,{}):T,[f,T]),B=(0,c.useMemo)(()=>f||N||R,[N,R,f]),z=(0,c.useMemo)(()=>f||N||R||_,[N,R,_,f]),Y=(0,c.useMemo)(()=>H&&L&&(0,n.jsx)(V,{anvils:H,drHosts:L}),[H,L]),en=(0,c.useMemo)(()=>H&&L&&m&&(0,n.jsx)(J,{anvils:H,drHosts:L,onSuccess:()=>{j()},previous:m}),[H,L,m,j]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(w.Zk,{children:[(0,n.jsx)(w.aO,{children:(0,n.jsx)(I.HM,{children:"Files"})}),(0,n.jsx)(F.A,{ref:r}),W]}),(0,n.jsx)(G.K_,{header:"Add file(s)",loading:B,ref:e,showClose:!0,wide:!0,children:Y}),(0,n.jsx)(G.K_,{header:"Update file ".concat(null==m?void 0:m.name),loading:z,ref:t,showClose:!0,wide:!0,children:en}),(0,n.jsx)(q.A,{closeOnProceed:!0,wide:!0,...s,ref:l})]})},er=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s(),{children:(0,n.jsx)("title",{children:"File Manager"})}),(0,n.jsx)(a.A,{}),(0,n.jsx)(en,{})]})},12698:(e,l,t)=>{"use strict";t.d(l,{Ay:()=>s,WT:()=>r});let n=function(){for(var e=arguments.length,l=Array(e),t=0;t<e;t++)l[t]=arguments[t];let[,n,r,s]=l;void 0!==s&&(n[r]=s)},r=function(e,l){let{set:t=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=>{let r={};return Object.keys(n).forEach(s=>{e.test(s)?t(n,r,s,l):r[s]=n[s]}),r}},s=function(e,l){let{guard:t=()=>!0,set:r=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=>{let{[e]:s,...a}=n,i={...a};return t(n,e,l)&&r(n,i,e,l),i}}},23192:(e,l,t)=>{"use strict";t.d(l,{A:()=>a});var n=t(14232),r=t(23934),s=t(5806);let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{config:l,onError:t,onData:a,url:i=""}=e,[o,c]=(0,n.useState)(!1);return{fetch:(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0,o="".concat(i).concat(e);o&&(c(!0),r.A.get(o,{...l,...n}).then(e=>{let{data:l}=e;null==a||a.call(null,l)}).catch(e=>{let l=(0,s.A)(e);null==t||t.call(null,l)}).finally(()=>{c(!1)}))},[i,l,a,t]),loading:o}}},42116:(e,l,t)=>{"use strict";t.d(l,{A:()=>r});var n=t(14232);let r=function(){let{actionProceedText:e="",content:l="",titleText:t="",...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.useState)({actionProceedText:e,content:l,titleText:t,...r})}},52627:(e,l,t)=>{"use strict";t.d(l,{A:()=>A});var n=t(37876),r=t(12981),s=t(12572),a=t(63009),i=t(40123),o=t.n(i),c=t(96043),u=t(48440),d=t(31465),h=t(51677);let m=e=>{let{entry:l}=e;return(0,n.jsx)(h.NA,{whiteSpace:"nowrap",children:String(l)})},p=e=>{let{entry:l,key:t}=e;return c.sX.test(t)?(0,n.jsx)(h.EN,{wrapper:"mono",children:String(l)}):m(e)},v=e=>{let{entry:l,hasPassword:t}=e;return o()(l)?(0,n.jsx)(h.a3,{children:"none"}):t?p(e):m(e)},x=e=>{let{depth:l,entry:t,getLabel:s,hasPassword:a,key:i,nest:o,renderValue:c}=e;return(0,n.jsxs)(d.A,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,n.jsx)(h.a3,{children:s({cap:u.A,depth:l,entry:t,hasPassword:a,key:i})}),(0,n.jsx)(r.A,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!o&&c(v,{depth:l,entry:t,hasPassword:a,key:i})})]})},f=e=>{let{key:l}=e;return/confirm|uuid/i.test(l)},j=e=>null!==e&&"object"==typeof e&&!o()(e),g=e=>{let{depth:l=0,entries:t,getEntryLabel:r,getListProps:i,getListItemProps:o,hasPassword:c,listKey:u,maxDepth:d,renderEntry:h,renderEntryValue:m,skip:p}=e,v=[];Object.entries(t).forEach(e=>{let[t,a]=e,i="form-summary-entry-".concat(t),u=j(a),x=u?null:a,A={depth:l,entry:x,hasPassword:c,key:t};p(f,A)||v.push((0,n.jsx)(s.Ay,{sx:{paddingLeft:"".concat(l,"em")},...null==o?void 0:o.call(null,A),children:h({depth:l,entry:x,getLabel:r,hasPassword:c,key:t,nest:u,renderValue:m})},i)),u&&l<d&&v.push(g({depth:l+1,entries:a,getEntryLabel:r,hasPassword:c,listKey:t,maxDepth:d,renderEntry:h,renderEntryValue:m,skip:p}))});let x="form-summary-list-".concat(null!=u?u:"root");return(0,n.jsx)(a.A,{dense:!0,disablePadding:!0,...null==i?void 0:i.call(null,{depth:l,entries:t,key:u}),children:v},x)},A=e=>{let{entries:l,getEntryLabel:t=e=>{let{cap:l,key:t}=e;return l(t)},getListProps:n,getListItemProps:r,hasPassword:s=!1,maxDepth:a=3,renderEntry:i=x,renderEntryValue:o=function(e){for(var l=arguments.length,t=Array(l>1?l-1:0),n=1;n<l;n++)t[n-1]=arguments[n];return e(...t)},skip:c=function(e){for(var l=arguments.length,t=Array(l>1?l-1:0),n=1;n<l;n++)t[n-1]=arguments[n];return e(...t)}}=e;return g({entries:l,getEntryLabel:t,getListProps:n,getListItemProps:r,hasPassword:s,maxDepth:a,renderEntry:i,renderEntryValue:o,skip:c})}},57656:(e,l,t)=>{"use strict";t.d(l,{A:()=>i});var n=t(37876),r=t(14232),s=t(12698),a=t(52627);let i=e=>{let{list:l={}}=e,[t,i]=(0,r.useState)({}),o=(0,r.useMemo)(()=>Object.keys(l),[l]),c=(0,r.useMemo)(()=>Object.keys(t),[t]),u=(0,r.useMemo)(()=>c.length===o.length,[c.length,o.length]),d=(0,r.useMemo)(()=>c.length>0,[c.length]),h=(0,r.useMemo)(()=>o.length>1,[o.length]),m=(0,r.useCallback)(e=>{let{confirmDialogProps:l={},formSummaryProps:r={},getConfirmDialogTitle:s,onProceedAppend:i,renderEntry:o}=e;return{actionProceedText:"Delete",content:(0,n.jsx)(a.A,{entries:t,maxDepth:0,renderEntry:o,...r}),onProceedAppend:i,proceedColour:"red",titleText:s(c.length),...l}},[t,c.length]),p=(0,r.useCallback)(e=>!!t[e],[t]),v=(0,r.useCallback)(()=>i({}),[]);return{buildDeleteDialogProps:m,checklist:t,checks:c,getCheck:p,hasAllChecks:u,hasChecks:d,multipleItems:h,resetChecks:v,setAllChecks:(0,r.useCallback)(e=>i(o.reduce((l,t)=>(e&&(l[t]=e),l),{})),[o]),setCheck:(0,r.useCallback)((e,l)=>i((0,s.Ay)(e,l||void 0)),[])}}},96507:(e,l,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/file-manager",function(){return t(4177)}])},99327:(e,l,t)=>{"use strict";t.d(l,{A:()=>r});let n=e=>e.reduce((e,l)=>{let{hostName:t,hostType:n,hostUUID:r,shortHostName:s}=l;return e[r]={name:t,short:s,type:n,uuid:r},e},{}),r=e=>e.reduce((e,l)=>{let{anvilDescription:t,anvilName:r,anvilUUID:s,hosts:a}=l;return e[s]={description:t,hosts:n(a),name:r,uuid:s},e},{})}},e=>{var l=l=>e(e.s=l);e.O(0,[559,3,208,925,282,133,732,341,636,593,792],()=>l(96507)),_N_E=e.O()}]);