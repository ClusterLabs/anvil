(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{41609:function(e,t,n){var r=n(280),o=n(64160),s=n(35694),i=n(1469),a=n(98612),l=n(44144),c=n(25726),d=n(36719),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(i(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||d(e)||s(e)))return!e.length;var t=o(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!r(e).length;for(var n in e)if(u.call(e,n))return!1;return!0}},72315:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/anvil",function(){return n(42163)}])},9968:function(e,t,n){"use strict";var r=n(85893),o=n(77527),s=n(90642),i=n(39971);let a="Decorator",l={ok:"".concat(a,"-ok"),warning:"".concat(a,"-warning"),error:"".concat(a,"-error"),off:"".concat(a,"-off")},c=(0,o.ZP)(s.Z)({borderRadius:i.n_,height:"100%",width:"1.4em",["&.".concat(l.ok)]:{backgroundColor:i.Ej},["&.".concat(l.warning)]:{backgroundColor:i.Wd},["&.".concat(l.error)]:{backgroundColor:i.hM},["&.".concat(l.off)]:{backgroundColor:i.s7}});t.Z=e=>{let{colour:t,...n}=e;return(0,r.jsx)(c,{...n,className:l[t]})}},76740:function(e,t,n){"use strict";var r=n(85893),o=n(90642),s=n(19304),i=n(47407),a=n(41609),l=n.n(a),c=n(35338),d=n(44400),u=n(5387),h=n(57882);let m=e=>{let{entry:t}=e;return(0,r.jsx)(h.$_,{whiteSpace:"nowrap",children:String(t)})},x=e=>{let{entry:t,key:n}=e;return c.JW.test(n)?(0,r.jsx)(h.PJ,{wrapper:"mono",children:String(t)}):m(e)},p=e=>{let{entry:t,hasPassword:n}=e;return l()(t)?(0,r.jsx)(h.Ac,{children:"none"}):n?x(e):m(e)},v=e=>{let{depth:t,entry:n,getLabel:s,hasPassword:i,key:a,nest:l,renderValue:c}=e;return(0,r.jsxs)(u.Z,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,r.jsx)(h.Ac,{children:s({cap:d.Z,depth:t,entry:n,hasPassword:i,key:a})}),(0,r.jsx)(o.Z,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!l&&c(p,{depth:t,entry:n,hasPassword:i,key:a})})]})},g=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},j=e=>null!==e&&"object"==typeof e&&!l()(e),f=e=>{let{depth:t=0,entries:n,getEntryLabel:o,getListProps:a,getListItemProps:l,hasPassword:c,listKey:d,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:x}=e,p=[];Object.entries(n).forEach(e=>{let[n,i]=e,a=j(i),d=a?null:i,v={depth:t,entry:d,hasPassword:c,key:n};x(g,v)||p.push((0,r.jsx)(s.ZP,{sx:{paddingLeft:"".concat(t,"em")},...null==l?void 0:l.call(null,v),children:h({depth:t,entry:d,getLabel:o,hasPassword:c,key:n,nest:a,renderValue:m})},"form-summary-entry-".concat(n))),a&&t<u&&p.push(f({depth:t+1,entries:i,getEntryLabel:o,hasPassword:c,listKey:n,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:x}))});let v="form-summary-list-".concat(null!=d?d:"root");return(0,r.jsx)(i.Z,{dense:!0,disablePadding:!0,...null==a?void 0:a.call(null,{depth:t,entries:n,key:d}),children:p},v)};t.Z=e=>{let{entries:t,getEntryLabel:n=e=>{let{cap:t,key:n}=e;return t(n)},getListProps:r,getListItemProps:o,hasPassword:s=!1,maxDepth:i=3,renderEntry:a=v,renderEntryValue:l=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},skip:c=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)}}=e;return f({entries:t,getEntryLabel:n,getListProps:r,getListItemProps:o,hasPassword:s,maxDepth:i,renderEntry:a,renderEntryValue:l,skip:c})}},84337:function(e,t,n){"use strict";var r=n(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:n="",...o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useState)({actionProceedText:e,content:t,titleText:n,...o})}},72094:function(e,t){"use strict";t.Z=(e,t,n)=>{let r;let{query:o}=e;if(void 0===n){let{[t]:e,...n}=o;r=n}else r={...o,[t]:n};return r}},86142:function(e,t,n){"use strict";var r=n(54743),o=n(85893);t.Z=(0,r.Z)((0,o.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert")},13539:function(e,t,n){"use strict";var r=n(63366),o=n(87462),s=n(67294),i=n(8780),a=n(94780),l=n(41796),c=n(66643),d=n(87486),u=n(29567),h=n(77527),m=n(71230),x=n(85893);let p=["className","color","edge","size","sx"],v=e=>{let{classes:t,edge:n,size:r,color:s,checked:i,disabled:l}=e,d={root:["root",n&&"edge".concat((0,c.Z)(n)),"size".concat((0,c.Z)(r))],switchBase:["switchBase","color".concat((0,c.Z)(s)),i&&"checked",l&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=(0,a.Z)(d,m.H,t);return(0,o.Z)({},t,u)},g=(0,h.ZP)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.edge&&t["edge".concat((0,c.Z)(n.edge))],t["size".concat((0,c.Z)(n.size))]]}})(e=>{let{ownerState:t}=e;return(0,o.Z)({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},"start"===t.edge&&{marginLeft:-8},"end"===t.edge&&{marginRight:-8},"small"===t.size&&{width:40,height:24,padding:7,["& .".concat(m.Z.thumb)]:{width:16,height:16},["& .".concat(m.Z.switchBase)]:{padding:4,["&.".concat(m.Z.checked)]:{transform:"translateX(16px)"}}})}),j=(0,h.ZP)(d.Z,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.switchBase,{["& .".concat(m.Z.input)]:t.input},"default"!==n.color&&t["color".concat((0,c.Z)(n.color))]]}})(e=>{let{theme:t}=e;return{position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:"".concat("light"===t.palette.mode?t.palette.common.white:t.palette.grey[300]),transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),["&.".concat(m.Z.checked)]:{transform:"translateX(20px)"},["&.".concat(m.Z.disabled)]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:"".concat("light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600])},["&.".concat(m.Z.checked," + .").concat(m.Z.track)]:{opacity:.5},["&.".concat(m.Z.disabled," + .").concat(m.Z.track)]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:"".concat("light"===t.palette.mode?.12:.2)},["& .".concat(m.Z.input)]:{left:"-100%",width:"300%"}}},e=>{let{theme:t,ownerState:n}=e;return(0,o.Z)({"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.action.activeChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,l.Fq)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{["&.".concat(m.Z.checked)]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n.color].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,l.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(m.Z.disabled)]:{color:t.vars?t.vars.palette.Switch["".concat(n.color,"DisabledColor")]:"".concat("light"===t.palette.mode?(0,l.$n)(t.palette[n.color].main,.62):(0,l._j)(t.palette[n.color].main,.55))}},["&.".concat(m.Z.checked," + .").concat(m.Z.track)]:{backgroundColor:(t.vars||t).palette[n.color].main}})}),f=(0,h.ZP)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(e=>{let{theme:t}=e;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:"".concat("light"===t.palette.mode?t.palette.common.black:t.palette.common.white),opacity:t.vars?t.vars.opacity.switchTrack:"".concat("light"===t.palette.mode?.38:.3)}}),Z=(0,h.ZP)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(e=>{let{theme:t}=e;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}}),b=s.forwardRef(function(e,t){let n=(0,u.Z)({props:e,name:"MuiSwitch"}),{className:s,color:a="primary",edge:l=!1,size:c="medium",sx:d}=n,h=(0,r.Z)(n,p),m=(0,o.Z)({},n,{color:a,edge:l,size:c}),b=v(m),w=(0,x.jsx)(Z,{className:b.thumb,ownerState:m});return(0,x.jsxs)(g,{className:(0,i.Z)(b.root,s),sx:d,ownerState:m,children:[(0,x.jsx)(j,(0,o.Z)({type:"checkbox",icon:w,checkedIcon:w,ref:t,ownerState:m},h,{classes:(0,o.Z)({},b,{root:b.switchBase})})),(0,x.jsx)(f,{className:b.track,ownerState:m})]})});t.Z=b},42163:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return e6}});var r=n(85893),o=n(77527),s=n(90642),i=n(9008),a=n.n(i),l=n(11163),c=n(67294),d=n(39971);let u=(0,c.createContext)({uuid:""});var h=e=>{let{children:t}=e,[n,o]=(0,c.useState)("");return(0,r.jsx)(u.Provider,{value:{uuid:n,setAnvilUuid:e=>{e!==n&&o(e)}},children:t})},m=n(47407),x=n(56912),p=n(52311),v=n(57882);let g=new Map([["degraded","Degraded"],["optimal","Optimal"],["offline","Offline"]]);var j=e=>{var t;let{anvil:n}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Ac,{text:n.anvil_name}),(0,r.jsx)(v.Ac,{text:null!==(t=g.get(n.anvilStatus.system))&&void 0!==t?t:"State unavailable"})]})},f=n(9968),Z=n(72094);let b="AnvilList",w={root:"".concat(b,"-root"),divider:"".concat(b,"-divider"),button:"".concat(b,"-button"),anvil:"".concat(b,"-anvil")},k=(0,o.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(w.root)]:{width:"100%",overflow:"auto",height:"30vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(w.divider)]:{backgroundColor:d.d},["& .".concat(w.button)]:{"&:hover":{backgroundColor:d.$T},paddingLeft:0},["& .".concat(w.anvil)]:{paddingLeft:0}}}),_=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}};var y=e=>{let{list:t}=e,n=(0,l.useRouter)();return(0,r.jsx)(k,{children:(0,r.jsx)(m.Z,{component:"nav",className:w.root,"aria-label":"mailbox folders",children:t.map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{className:w.divider}),(0,r.jsx)(p.Z,{className:w.button,onClick:()=>{let t=(0,Z.Z)(n,"name",e.anvil_name);n.replace({query:t},void 0,{shallow:!0})},children:(0,r.jsxs)(s.Z,{display:"flex",flexDirection:"row",width:"100%",children:[(0,r.jsx)(s.Z,{p:1,children:(0,r.jsx)(f.Z,{colour:_(e.anvilStatus.system)})}),(0,r.jsx)(s.Z,{p:1,flexGrow:1,className:w.anvil,children:(0,r.jsx)(j,{anvil:e})})]})},e.anvil_uuid)]}))})})},P=n(65375),C=n(13539),A=n(48403),S=n.n(A),N=n(66389),T=n(11100),M=n(90209),F=n(40657);let D={anvilName:"".concat("SelectedAnvil","-anvilName")},O=(0,o.ZP)(s.Z)(()=>({display:"flex",flexDirection:"row",width:"100%",["& .".concat(D.anvilName)]:{paddingLeft:0}})),G=e=>{switch(e){case"optimal":return"ok";case"degraded":return"warning";default:return"off"}},z=e=>-1!==e.hosts.findIndex(e=>{let{state:t}=e;return"offline"!==t});var B=e=>{var t;let{list:n}=e,{uuid:o}=(0,c.useContext)(u),i=(0,c.useMemo)(()=>n.findIndex(e=>e.anvil_uuid===o),[n,o]),a=n[i],{confirmDialog:l,finishConfirm:d,setConfirmDialogLoading:h,setConfirmDialogOpen:m,setConfirmDialogProps:x}=(0,F.Z)();return a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(O,{children:[(0,r.jsx)(s.Z,{p:1,children:(0,r.jsx)(f.Z,{colour:G(a.anvilStatus.system)})}),(0,r.jsxs)(s.Z,{p:1,flexGrow:1,className:D.anvilName,children:[(0,r.jsx)(v.z,{text:a.anvil_name}),(0,r.jsx)(v.z,{text:null!==(t=g.get(a.anvilStatus.system))&&void 0!==t?t:"State unavailable"})]}),(0,r.jsx)(s.Z,{p:1,children:(0,r.jsx)(C.Z,{checked:z(a),onChange:()=>{let e;let{[i]:t}=n,{anvil_name:o,anvil_uuid:s}=t,a="start",l="blue";z(t)&&(a="stop",e="Servers hosted on this node will be shut down!",l="red");let c="".concat(a,"-an"),u=S()(a);x({actionProceedText:u,content:e,onProceedAppend:()=>{h(!0),N.Z.put("/command/".concat(c,"/").concat(s)).then(()=>{d("Success",{children:(0,r.jsx)(r.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register power job. ",t.children]}),d("Error",t)})},proceedColour:l,titleText:"".concat(u," ").concat(o,"?")}),m(!0)}})})]}),l]}):(0,r.jsx)(M.Z,{})},R=n(5499);let L=e=>{let{anvil:t,anvils:n}=e;return(0,R.Z)("/anvil/".concat(t.anvil_uuid),{onSuccess:e=>{let r=n.value.findIndex(e=>e.anvil_uuid===t.anvil_uuid);if(-1===r){n.set(n=>[...n,{...t,...e}]);return}n.set(t=>{let n=[...t];return n[r]={...n[r],...e},n})},periodic:!0}),(0,r.jsx)(s.Z,{display:"none"})};var E=e=>{let{list:t}=e,[n,o]=(0,c.useState)([]),s=(0,c.useMemo)(()=>t.anvils.map(e=>(0,r.jsx)(L,{anvil:e,anvils:{set:o,value:n}},"".concat(e.anvil_uuid,"-fetcher"))),[n,t.anvils]);return(0,r.jsxs)(P.s_,{children:[s,(0,r.jsx)(B,{list:n}),(0,r.jsx)(y,{list:n})]})},I=n(5387),U=()=>{let{uuid:e}=(0,c.useContext)(u),{data:{allocated:t=0,cores:n=0,threads:o=0}={},loading:s}=(0,R.Z)("/anvil/".concat(e,"/cpu"),{periodic:!0}),i=(0,c.useMemo)(()=>s?(0,r.jsx)(M.Z,{}):(0,r.jsxs)(I.Z,{spacing:0,children:[(0,r.jsx)(v.Ac,{text:"Total Cores: ".concat(n)}),(0,r.jsx)(v.Ac,{text:"Total Threads: ".concat(o)}),(0,r.jsx)(v.Ac,{text:"Allocated Cores: ".concat(t)})]}),[t,n,s,o]);return(0,r.jsxs)(P.s_,{children:[(0,r.jsx)(P.V9,{children:(0,r.jsx)(v.z,{text:"CPU"})}),i]})},W=n(25436);let q=new Map([["message_0222","The subnode is in an unknown state."],["message_0223","The subnode is a full cluster member."],["message_0224","The subnode is coming online; the cluster resource manager is running (step 2/3)."],["message_0225","The subnode is coming online; the subnode is a consensus cluster member (step 1/3)."],["message_0226","The subnode has booted, but it is not (yet) joining the cluster."]]);var V=n(64236);let Q="AnvilHost",X={state:"".concat(Q,"-state"),bar:"".concat(Q,"-bar"),label:"".concat(Q,"-label"),decoratorBox:"".concat(Q,"-decoratorBox")},$=(0,o.ZP)(s.Z)(e=>{let{theme:t}=e;return{overflow:"auto",height:"28vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"},["& .".concat(X.state)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(X.bar)]:{paddingLeft:".7em",paddingRight:".7em"},["& .".concat(X.label)]:{paddingTop:".3em"},["& .".concat(X.decoratorBox)]:{alignSelf:"stretch"}}}),H=(e,t)=>{let n=e.exec(t);return n?q.get(n[0])||"Error code not recognized":"Error code not found"},J=e=>{switch(e){case"online":return"ok";case"offline":return"off";default:return"warning"}};var K=e=>{let{hosts:t}=e,n=/^[a-zA-Z]/,o=/^(message_[0-9]+)/,{confirmDialog:i,finishConfirm:a,setConfirmDialogLoading:l,setConfirmDialogOpen:c,setConfirmDialogProps:d}=(0,F.Z)();return t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)($,{children:t.map(e=>{var t;if(!e)return;let i="online"===e.state,u="offline"===e.state,h=!u;return(0,r.jsxs)(P.Lg,{children:[(0,r.jsxs)(P.CH,{children:[(0,r.jsx)(s.Z,{flexGrow:1,children:(0,r.jsx)(v.Ac,{text:e.host_name})}),(0,r.jsx)(s.Z,{className:X.decoratorBox,children:(0,r.jsx)(f.Z,{colour:J(e.state)})}),(0,r.jsx)(s.Z,{children:(0,r.jsx)(v.Ac,{text:(null==e?void 0:null===(t=e.state)||void 0===t?void 0:t.replace(n,e=>e.toUpperCase()))||"Not Available"})})]}),(0,r.jsxs)(s.Z,{display:"flex",className:X.state,children:[(0,r.jsx)(s.Z,{className:X.label,children:(0,r.jsx)(v.Ac,{text:"Power: "})}),(0,r.jsx)(s.Z,{flexGrow:1,children:(0,r.jsx)(C.Z,{checked:h,onChange:()=>{let t=h?"stop":"start",n="".concat(t,"-subnode"),o=S()(t);d({actionProceedText:o,content:"start"===t?(0,r.jsx)(v.Ac,{children:"The subnode will be powered on with IPMI commands."}):(0,r.jsxs)(I.Z,{children:[(0,r.jsx)(v.Ac,{children:"The subnode will be powered off."}),(0,r.jsx)(v.Ac,{children:e.server_count?(0,r.jsxs)(r.Fragment,{children:["All ",e.server_count," servers on this subnode will be migrated to the peer subnode if possible. Otherwise, the servers will be shut down."]}):(0,r.jsx)(r.Fragment,{children:"No servers are on this subnode."})})]}),onProceedAppend:()=>{l(!0),N.Z.put("/command/".concat(n,"/").concat(e.host_uuid)).then(()=>{a("Success",{children:(0,r.jsx)(r.Fragment,{children:"Successfully registered power job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register power job. ",t.children]}),a("Error",t)})},titleText:"".concat(o," ").concat(e.host_name,"?")}),c(!0)}})}),(0,r.jsx)(s.Z,{className:X.label,children:(0,r.jsx)(v.Ac,{text:"Member: "})}),(0,r.jsx)(s.Z,{children:(0,r.jsx)(C.Z,{checked:i,disabled:u,onChange:()=>{let t=i?"leave":"join",n="".concat(t,"-an"),o=S()(t);d({actionProceedText:o,content:"leave"===t?(0,r.jsxs)(I.Z,{children:[(0,r.jsx)(v.Ac,{children:"The subnode will be withdrawn from its cluster and servers will be migrated as necessary."}),(0,r.jsx)(v.Ac,{children:"The operation is reversible. You can tell it to join the cluster again later."})]}):(0,r.jsxs)(I.Z,{children:[(0,r.jsx)(v.Ac,{children:"The subnode will join the cluster it belongs to."}),(0,r.jsx)(v.Ac,{children:"The operation is reversible. You can tell it to withdraw from the cluster again later."})]}),onProceedAppend:()=>{l(!0),N.Z.put("/command/".concat(n,"/").concat(e.host_uuid)).then(()=>{a("Success",{children:(0,r.jsx)(r.Fragment,{children:"Successfully registered cluster membership job."})})}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register cluster memebership job."," ",t.children]}),a("Error",t)})},titleText:"".concat(o," cluster on ").concat(e.host_name,"?")}),c(!0)}})})]}),!i&&h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{display:"flex",width:"100%",className:X.state,children:(0,r.jsx)(s.Z,{children:(0,r.jsx)(v.Ac,{text:H(o,e.state_message)})})}),(0,r.jsx)(s.Z,{display:"flex",width:"100%",className:X.bar,children:(0,r.jsx)(s.Z,{flexGrow:1,children:(0,r.jsx)(V.ko,{progressPercentage:e.state_percent})})})]})]},e.host_uuid)})}),i]}):(0,r.jsx)($,{})},Y=e=>null==e?void 0:e.filter(e=>e.host_uuid),ee=e=>{let{anvil:t}=e,{uuid:n}=(0,c.useContext)(u),{data:o,loading:s}=(0,R.Z)("/anvil/".concat(n),{periodic:!0}),i=t.findIndex(e=>e.anvil_uuid===n);return(0,r.jsxs)(P.s_,{children:[(0,r.jsx)(v.z,{text:"Subnodes"}),s?(0,r.jsx)(M.Z,{}):(0,r.jsx)(r.Fragment,{children:-1!==i&&o&&(0,r.jsx)(K,{hosts:Y(t[i].hosts).reduce((e,t,n)=>{let r=o.hosts[n];return r&&e.push(r),e},[])})})]})},et=n(54490),en=e=>(0,et._d)(e,{toUnit:"ibyte"}),er=()=>{let{uuid:e}=(0,c.useContext)(u),{data:{allocated:t="0",reserved:n="0",total:o="0"}={},loading:i}=(0,R.Z)("/anvil/".concat(e,"/memory"),{periodic:!0}),a=(0,c.useMemo)(()=>BigInt(t),[t]),l=(0,c.useMemo)(()=>BigInt(n),[n]),d=(0,c.useMemo)(()=>BigInt(o),[o]);return(0,r.jsxs)(P.s_,{children:[(0,r.jsx)(P.V9,{children:(0,r.jsx)(v.z,{text:"Memory"})}),i?(0,r.jsx)(M.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Z,{display:"flex",width:"100%",children:[(0,r.jsx)(s.Z,{flexGrow:1,children:(0,r.jsx)(v.Ac,{text:"Allocated: ".concat(en(a))})}),(0,r.jsx)(s.Z,{children:(0,r.jsx)(v.Ac,{text:"Free: ".concat(en(d-(l+a)))})})]}),(0,r.jsx)(s.Z,{display:"flex",width:"100%",children:(0,r.jsx)(s.Z,{flexGrow:1,children:(0,r.jsx)(V.CD,{allocated:d?Number((l+a)*BigInt(100)/d):0})})}),(0,r.jsx)(s.Z,{display:"flex",justifyContent:"center",width:"100%",children:(0,r.jsx)(v.Ac,{text:"Total: ".concat(en(d)," | Reserved: ").concat(en(l))})})]})]})},eo=n(29873),es=e=>{let t=[],n={bonds:[]};return e.hosts.forEach(e=>{e.bonds.forEach(r=>{let o=t.findIndex(e=>e===r.bond_name);-1===o?(t.push(r.bond_name),n.bonds.push({bond_name:r.bond_name,bond_uuid:r.bond_uuid,bond_speed:0,bond_state:"degraded",hosts:[{host_name:e.host_name,host_uuid:e.host_uuid,link:r.links[0].is_active?r.links[0]:r.links[1]}]})):n.bonds[o].hosts.push({host_name:e.host_name,host_uuid:e.host_uuid,link:r.links[0].is_active?r.links[0]:r.links[1]})})}),n.bonds.forEach(e=>{let t=e.hosts[0].link.link_speed>e.hosts[1].link.link_speed?1:0;e.bond_speed=e.hosts[t].link.link_speed,e.bond_state=e.hosts[t].link.link_state}),n};let ei="Network",ea={container:"".concat(ei,"-container"),root:"".concat(ei,"-root"),noPaddingLeft:"".concat(ei,"-noPaddingLeft"),divider:"".concat(ei,"-divider"),verticalDivider:"".concat(ei,"-verticalDivider")},el=(0,o.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(ea.container)]:{width:"100%",overflow:"auto",height:"32vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(ea.root)]:{paddingTop:".7em",paddingBottom:".7em"},["& .".concat(ea.noPaddingLeft)]:{paddingLeft:0},["& .".concat(ea.divider)]:{backgroundColor:d.d},["& .".concat(ea.verticalDivider)]:{height:"3.5em"}}}),ec=e=>{switch(e){case"optimal":return"ok";case"degraded":default:return"warning";case"down":return"error"}};var ed=()=>{let{uuid:e}=(0,c.useContext)(u),[t,n]=(0,c.useState)(),{loading:o}=(0,R.Z)("/anvil/".concat(e,"/network"),{onSuccess:e=>{n(es(e))},periodic:!0});return(0,r.jsx)(P.s_,{children:(0,r.jsxs)(el,{children:[(0,r.jsx)(v.z,{text:"Network"}),o?(0,r.jsx)(M.Z,{}):(0,r.jsx)(s.Z,{className:ea.container,children:t&&t.bonds.map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Z,{className:ea.root,display:"flex",flexDirection:"row",width:"100%",children:[(0,r.jsx)(s.Z,{p:1,className:ea.noPaddingLeft,children:(0,r.jsx)(f.Z,{colour:ec(e.bond_state)})}),(0,r.jsxs)(s.Z,{p:1,flexGrow:1,className:ea.noPaddingLeft,children:[(0,r.jsx)(v.Ac,{text:e.bond_name}),(0,r.jsx)(v.Ac,{text:"".concat(e.bond_speed,"Mbps")})]}),(0,r.jsx)(s.Z,{display:"flex",style:{paddingTop:".5em"},children:e.hosts.map((t,n)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{p:1,style:{paddingTop:0,paddingBottom:0},children:(0,r.jsxs)(s.Z,{children:[(0,r.jsx)(v.Ac,{text:t.host_name,selected:!1}),(0,r.jsx)(v.Ac,{text:t.link.link_name})]})},t.host_name),n!==e.hosts.length-1&&(0,r.jsx)(x.Z,{className:"".concat(ea.divider," ").concat(ea.verticalDivider),orientation:"vertical",flexItem:!0})]}))})]}),(0,r.jsx)(x.Z,{className:ea.divider})]}))})]})})},eu=n(86142),eh=n(96788),em=n(73939),ex=n(19304);let ep=new Map([["running","Running"],["idle","Idle"],["paused","Paused"],["in shutdown","Shutting Down"],["shut off","Off"],["crashed","Crashed"],["pmsuspended","PM Suspended"],["migrating","Migrating"],["provisioning","Provisioning"]]);var ev=n(47177),eg=n(46194),ej=n(45328),ef=n(75492),eZ=n(18766),eb=n(43267),ew=n(84337);let ek="Servers",e_={root:"".concat(ek,"-root"),divider:"".concat(ek,"-divider"),verticalDivider:"".concat(ek,"-verticalDivider"),button:"".concat(ek,"-button"),headerPadding:"".concat(ek,"-headerPadding"),hostsBox:"".concat(ek,"-hostsBox"),hostBox:"".concat(ek,"-hostBox"),checkbox:"".concat(ek,"-checkbox"),editButtonBox:"".concat(ek,"-editButtonBox"),dropdown:"".concat(ek,"-dropdown"),on:"".concat(ek,"-on"),off:"".concat(ek,"-off"),all:"".concat(ek,"-all")},ey=(0,o.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(e_.root)]:{width:"100%",overflow:"auto",height:"78vh",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%",overflow:"hidden"}},["& .".concat(e_.divider)]:{backgroundColor:d.d},["& .".concat(e_.verticalDivider)]:{height:"75%",paddingTop:"1em"},["& .".concat(e_.button)]:{"&:hover":{backgroundColor:d.$T},paddingLeft:0},["& .".concat(e_.headerPadding)]:{paddingLeft:".3em"},["& .".concat(e_.hostsBox)]:{padding:"1em",paddingRight:0},["& .".concat(e_.hostBox)]:{paddingTop:0},["& .".concat(e_.checkbox)]:{paddingTop:".8em"},["& .".concat(e_.editButtonBox)]:{paddingTop:".3em"},["& .".concat(e_.dropdown)]:{paddingTop:".8em",paddingBottom:".8em"},["& .".concat(e_.all)]:{paddingTop:".5em",paddingLeft:".3em"}}}),eP=e=>{switch(e){case"running":return"ok";case"shut off":return"off";case"crashed":return"error";default:return"warning"}},eC=(0,o.ZP)(eh.Z)({["&.".concat(e_.on)]:{color:d.Ej},["&.".concat(e_.off)]:{color:d.hM}});var eA=e=>{var t;let{anvil:n}=e,[o,i]=(0,c.useState)(null),[a,l]=(0,c.useState)(!1),[h,p]=(0,c.useState)(!1),[g,j]=(0,c.useState)([]),Z=(0,c.useRef)({}),[b,w]=(0,ew.Z)(),{uuid:k}=(0,c.useContext)(u),_=(0,c.useRef)([]),{data:y}=(0,R.Z)("/server?anvilUUIDs=".concat(k),{periodic:!0}),C=(0,c.useMemo)(()=>y&&Object.values(y),[y]),A=e=>{_.current=[],e.filter(e=>"running"===e.state).length&&_.current.push("off"),e.filter(e=>"shut off"===e.state).length&&_.current.push("on")},S=e=>{i(null),g.length&&g.forEach(t=>{N.Z.put("/command".concat("on"===e?"start-server":"stop-server","/").concat(t)).catch(e=>{(0,T.Z)(e)})})},F=e=>{if(!C)return;let t=g.indexOf(e);-1===t?g.push(e):g.splice(t,1),A(C.filter(e=>-1!==g.indexOf(e.uuid))),j([...g])},D=n.findIndex(e=>e.anvil_uuid===k),O=Y(null===(t=n[D])||void 0===t?void 0:t.hosts),G=(0,c.useMemo)(()=>!g.length,[g.length]),z=(0,eb.Zd)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(P.s_,{children:(0,r.jsxs)(ey,{children:[(0,r.jsxs)(P.V9,{className:e_.headerPadding,sx:{marginBottom:0},children:[(0,r.jsx)(v.z,{text:"Servers"}),a&&(0,r.jsx)(ej.Z,{disabled:G,mapPreset:"delete",onClick:()=>{var e;w({actionProceedText:"Delete",content:"Are you sure you want to delete the selected server(s)? This action is not revertable.",onProceedAppend:()=>{N.Z.request({data:{serverUuids:g},method:"delete",url:"/server"}).catch(e=>{(0,T.Z)(e)})},proceedColour:"red",titleText:"Delete ".concat(g.length," server(s)?")}),null===(e=Z.current.setOpen)||void 0===e||e.call(null,!0)},variant:"redcontained"}),(0,r.jsx)(ej.Z,{mapPreset:"edit",onClick:()=>l(!a),state:String(a)}),(0,r.jsx)(ej.Z,{mapPreset:"add",onClick:()=>z.setOpen(!0)})]}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{className:e_.headerPadding,display:"flex",children:(0,r.jsxs)(s.Z,{flexGrow:1,className:e_.dropdown,children:[(0,r.jsx)(eg.Z,{disabled:G,onClick:e=>{i(e.currentTarget)},startIcon:(0,r.jsx)(eu.Z,{}),children:"Power"}),(0,r.jsx)(ef.Z,{open:!!o,slotProps:{menu:{anchorEl:o,keepMounted:!0,onClose:()=>i(null)}},children:_.current.map(e=>(0,r.jsx)(eZ.Z,{onClick:()=>S(e),children:(0,r.jsx)(eC,{className:e_[e],variant:"subtitle1",children:e.replace(/^[a-z]/,e=>e.toUpperCase())})},e))})]})}),(0,r.jsxs)(s.Z,{display:"flex",children:[(0,r.jsx)(s.Z,{children:(0,r.jsx)(em.Z,{style:{color:d.lD},color:"secondary",checked:h,onChange:()=>{C&&(h?(A([]),j([])):(A(C),j(C.map(e=>e.uuid))),p(!h))}})}),(0,r.jsx)(s.Z,{className:e_.all,children:(0,r.jsx)(v.Ac,{text:"All"})})]})]}),C?(0,r.jsx)(s.Z,{className:e_.root,children:(0,r.jsx)(m.Z,{component:"nav",children:C.map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ex.ZP,{button:!0,className:e_.button,component:a?"div":"a",href:"/server?uuid=".concat(e.uuid,"&server_name=").concat(e.name,"&server_state=").concat(e.state),onClick:()=>F(e.uuid),children:(0,r.jsxs)(s.Z,{display:"flex",flexDirection:"row",width:"100%",children:[a&&(0,r.jsx)(s.Z,{className:e_.checkbox,children:(0,r.jsx)(em.Z,{style:{color:d.lD},color:"secondary",checked:void 0!==g.find(t=>t===e.uuid)})}),(0,r.jsx)(s.Z,{p:1,children:(0,r.jsx)(f.Z,{colour:eP(e.state)})}),(0,r.jsxs)(s.Z,{p:1,flexGrow:1,children:[(0,r.jsx)(v.Ac,{text:e.name}),(0,r.jsx)(v.Ac,{text:ep.get(e.state)||"Not Available"})]}),(0,r.jsx)(s.Z,{display:"flex",className:e_.hostsBox,children:"shut off"!==e.state&&"crashed"!==e.state&&O.map((t,n)=>{var o;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{p:1,className:e_.hostBox,children:(0,r.jsx)(v.Ac,{text:t.host_name,selected:(null===(o=e.host)||void 0===o?void 0:o.uuid)===t.host_uuid})},t.host_uuid),n!==O.length-1&&(0,r.jsx)(x.Z,{className:"".concat(e_.divider," ").concat(e_.verticalDivider),orientation:"vertical"})]})})})]})},e.uuid),(0,r.jsx)(x.Z,{className:e_.divider})]}))})}):(0,r.jsx)(M.Z,{})]})}),z.dialog,(0,r.jsx)(ev.Z,{closeOnProceed:!0,...b,ref:Z})]})},eS=n(60665),eN=n(45036),eT=n(8506),eM=e=>{let{formDialogRef:t,storages:n,target:o,uuid:s}=e,{[s]:i}=n.storageGroups,{name:a}=i,l=(0,c.useMemo)(()=>{var e,t;return null!==(t=null===(e=(0,et.Gh)(i.free,{toUnit:"ibyte"}))||void 0===e?void 0:e.value)&&void 0!==t?t:"none"},[i.free]),d=(0,c.useMemo)(()=>{var e;return null!==(e=(0,et._d)(i.size,{toUnit:"ibyte"}))&&void 0!==e?e:"none"},[i.size]),u=(0,c.useMemo)(()=>{var e;return null!==(e=(0,et._d)(i.used,{toUnit:"ibyte"}))&&void 0!==e?e:"none"},[i.used]),h=(0,c.useMemo)(()=>Object.values(i.members),[i.members]),m=(0,c.useMemo)(()=>h.map(e=>{var t,o,s;let{volumeGroup:i}=e,{[i]:a}=n.volumeGroups,{[a.host]:l}=n.hosts,c=null!==(o=null===(t=(0,et.Gh)(a.free,{toUnit:"ibyte"}))||void 0===t?void 0:t.value)&&void 0!==o?o:"none",d=null!==(s=(0,et._d)(a.size,{toUnit:"ibyte"}))&&void 0!==s?s:"none";return(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(eT.ZP,{container:!0,children:[(0,r.jsx)(eT.ZP,{item:!0,xs:!0,children:(0,r.jsx)(v.Ac,{variant:"caption",children:l.short})}),(0,r.jsx)(eT.ZP,{item:!0,textAlign:"right",children:(0,r.jsxs)(v.Ac,{variant:"caption",children:["Free",(0,r.jsx)(v.Q0,{children:c}),"/",(0,r.jsx)(v.Q0,{children:d})]})}),(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsx)(V.Tj,{thin:!0,volumeGroup:a})})]})},e.uuid)}),[h,n.hosts,n.volumeGroups]);return(0,r.jsxs)(P.Lg,{children:[(0,r.jsxs)(P.CH,{children:[(0,r.jsx)(v.Ac,{children:a}),(0,r.jsx)(ej.Z,{mapPreset:"edit",onClick:()=>{var e;o.set(s),null===(e=t.current)||void 0===e||e.setOpen(!0)},size:"small",state:"false"})]}),(0,r.jsx)(P.bc,{children:(0,r.jsxs)(eT.ZP,{container:!0,rowSpacing:"1em",children:[(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(eT.ZP,{container:!0,children:[(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(eT.ZP,{container:!0,children:[(0,r.jsx)(eT.ZP,{item:!0,children:(0,r.jsxs)(v.Ac,{children:["Used ",(0,r.jsx)(v.Q0,{children:u})]})}),(0,r.jsx)(eT.ZP,{item:!0,xs:!0}),(0,r.jsx)(eT.ZP,{item:!0,textAlign:"right",children:(0,r.jsxs)(v.Ac,{children:["Free",(0,r.jsx)(v.Q0,{children:l}),"/",(0,r.jsx)(v.Q0,{children:d})]})})]})}),(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsx)(V.Tj,{storageGroup:i})})]})}),...m]})})]})},eF=n(42050),eD=n(76740),eO=n(18050),eG=n(23852),ez=n(16310),eB=n(48313);let eR=ez.Ry({vg:(0,eB.uI)().required().nullable()});var eL=n(74178),eE=(e,t)=>{let{storageGroups:n}=e,{[t]:r}=n,o=Object.values(n);r&&(o=o.filter(e=>e.name!==r.name));let s=o.map(e=>e.name);return ez.Ry({hosts:ez.Vo(e=>ez.Ry((0,eL.Z)(e,eR))),name:ez.Z_().required().notOneOf(s,"${path} already exists")})},eI=n(93362),eU=n(48801),eW=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[o]=t,{formikUtils:s,host:i,storages:a}=o,{[i]:l}=a.hosts,{changeFieldValue:d,formik:u}=s,h=(0,c.useMemo)(()=>({vg:"hosts.".concat(i,".vg")}),[i]),m=(0,c.useMemo)(()=>Object.values(a.volumeGroups).filter(e=>e.host===i).map(e=>e.uuid),[i,a.volumeGroups]);return(0,r.jsxs)(eT.ZP,{alignItems:"center",container:!0,spacing:"1em",children:[(0,r.jsx)(eT.ZP,{item:!0,xs:!0,children:(0,r.jsx)(eU.Z,{filterOptions:(0,eI.D)({stringify:e=>{let{[e]:t}=a.volumeGroups;return"".concat(t.name,"\n").concat(t.internalUuid)}}),getOptionDisabled:e=>{let t=!a.unusedVolumeGroups.includes(e),n=u.initialValues.hosts[i].vg!==e;return t&&n},getOptionLabel:e=>{let{[e]:t}=a.volumeGroups;return t.name},id:h.vg,label:"".concat(l.short," volume group"),noOptionsText:"No volume group(s) available",onChange:(e,t)=>{d(h.vg,t,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{var n,o,s;let{[t]:i}=a.volumeGroups,l=null!==(o=null===(n=(0,et.Gh)(i.free,{toUnit:"ibyte"}))||void 0===n?void 0:n.value)&&void 0!==o?o:"none",d=null!==(s=(0,et._d)(i.size,{toUnit:"ibyte"}))&&void 0!==s?s:"none";return(0,c.createElement)("li",{...e,key:"vg-".concat(t)},(0,r.jsxs)(eT.ZP,{container:!0,rowSpacing:"0.4em",children:[(0,r.jsxs)(eT.ZP,{alignItems:"center",container:!0,spacing:"0.5em",children:[(0,r.jsx)(eT.ZP,{item:!0,xs:!0,children:(0,r.jsx)(v.Ac,{inheritColour:!0,noWrap:!0,children:i.name})}),(0,r.jsx)(eT.ZP,{item:!0,children:(0,r.jsxs)(v.Ac,{inheritColour:!0,noWrap:!0,variant:"caption",children:["Free",(0,r.jsx)(v.Q0,{inheritColour:!0,children:l}),"/",(0,r.jsx)(v.Q0,{inheritColour:!0,children:d})]})})]}),(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsx)(V.Tj,{thin:!0,volumeGroup:i})}),(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsx)(v.KI,{inheritColour:!0,monospaced:!0,noWrap:!0,children:i.internalUuid})})]}))},value:u.values.hosts[i].vg})}),(0,r.jsx)(eT.ZP,{item:!0,children:(0,r.jsx)(ej.Z,{mapPreset:"delete",onClick:()=>{d(h.vg,null,!0)},size:"small"})})]})},eq=n(12823),eV=n(22582);let eQ=(e,t,n)=>{let{[t]:r}=e.storageGroups,o=n.reduce((e,t)=>(e[t]={vg:null},e),{}),s={hosts:o,name:""};return r&&(s.name=r.name,Object.values(r.members).forEach(t=>{let{[t.volumeGroup]:n}=e.volumeGroups,{host:r,uuid:s}=n;o[r].vg=s})),s},eX=(e,t,n,r)=>{var o;let{[r]:s}=n.storageGroups,i={add:[],name:null!==(o=null==s?void 0:s.name)&&void 0!==o?o:e.name,remove:[]};s&&e.name!==s.name&&(i.rename=e.name);let{volumeGroups:a}=n;return Object.keys(e.hosts).forEach(n=>{let{[n]:r}=t.hosts,{[n]:o}=e.hosts;if(r.vg!==o.vg){if(r.vg){let{[r.vg]:e}=a;i.remove.push(e.internalUuid)}if(o.vg){let{[o.vg]:e}=a;i.add.push(e.internalUuid)}}}),i};var e$=e=>{let{anvil:t,confirm:n,storages:o,uuid:s=""}=e,{[s]:i}=o.storageGroups,a=(0,c.useContext)(eN.MJ),l=(0,c.useMemo)(()=>"/anvil/".concat(t,"/storage"),[t]),d=(0,c.useMemo)(()=>Object.keys(o.hosts),[o.hosts]),u=(0,c.useMemo)(()=>eQ(o,s,d),[d,s,o]),h=(0,c.useMemo)(()=>i?"Save":"Add",[i]),m=(0,eV.Z)({initialValues:u,onSubmit:(e,t)=>{var c;let d,h,{setSubmitting:m}=t;i?(d="Update",h="put"):(d="Add",h="post");let x=eX(e,u,o,s);n.setConfirmDialogProps({actionProceedText:d,content:(0,r.jsx)(eD.Z,{entries:x,skip:(e,t)=>"name"===t.key}),onCancelAppend:()=>m(!1),onProceedAppend:()=>{n.setConfirmDialogLoading(!0),N.Z.request({data:x,method:h,url:l}).then(()=>{n.finishConfirm("Success",{children:(0,r.jsxs)(r.Fragment,{children:[d," storage group job registered."]})}),null==a||a.setOpen(!1)}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to ",d.toLocaleLowerCase()," storage group."," ",t.children]}),n.finishConfirm("Error",t),m(!1)})},titleText:"".concat(d," ").concat(null!==(c=null==i?void 0:i.name)&&void 0!==c?c:e.name," with the following?")}),n.setConfirmDialogOpen(!0)},validationSchema:eE(o,s)}),{disabledSubmit:x,formik:p,formikErrors:g,handleChange:j}=m,f=(0,c.useMemo)(()=>({name:"name"}),[]);return(0,r.jsxs)(eT.ZP,{component:"form",container:!0,onSubmit:e=>{e.preventDefault(),p.handleSubmit(e)},spacing:"1em",children:[(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(eT.ZP,{alignItems:"center",container:!0,spacing:"1em",children:[(0,r.jsx)(eT.ZP,{item:!0,xs:!0,children:(0,r.jsx)(eq.Z,{input:(0,r.jsx)(eG.Z,{id:f.name,label:"Storage group name",name:f.name,onChange:j,value:p.values.name})})}),(0,r.jsx)(eT.ZP,{item:!0,children:(0,r.jsx)(ej.Z,{disabled:!i,mapPreset:"delete",onClick:()=>{p.setSubmitting(!0),n.setConfirmDialogProps({actionProceedText:"Delete",content:(0,r.jsx)(v.Ac,{children:"This operation will remove the storage group and its relationships to volume groups. It will not remove the actual volume groups."}),onCancelAppend:()=>p.setSubmitting(!1),onProceedAppend:()=>{n.setConfirmDialogLoading(!0);let e={name:null==i?void 0:i.name};N.Z.request({data:e,method:"delete",url:l}).then(()=>{n.finishConfirm("Success",{children:(0,r.jsx)(r.Fragment,{children:"Delete storage group job registered."})}),null==a||a.setOpen(!1)}).catch(e=>{let t=(0,T.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to delete storage group. ",t.children]}),n.finishConfirm("Error",t),p.setSubmitting(!1)})},proceedColour:"red",titleText:"Delete ".concat(null==i?void 0:i.name,"?")}),n.setConfirmDialogOpen(!0)},size:"small",variant:"redcontained"})})]})}),d.map(e=>(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eW,{formikUtils:m,host:e,storages:o})},"member-on-host-".concat(e))),(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eO.Z,{count:1,messages:g})}),(0,r.jsx)(eT.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eF.Z,{actions:[{background:"blue",children:h,disabled:x,type:"submit"}]})})]})};let eH={root:"".concat("SharedStorage","-root")},eJ=(0,o.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(eH.root)]:{overflow:"auto",height:"78vh",paddingLeft:".3em",paddingRight:".3em",[t.breakpoints.down(d.li)]:{height:"100%"}}}}),eK=e=>{let{anvil:t,confirm:n,error:o,formDialogRef:i,loading:a,storages:l,target:d}=e;return(0,c.useMemo)(()=>{if(a)return(0,r.jsx)(M.Z,{});if(!l){let e;return o?(e=(0,T.Z)(o)).children=(0,r.jsxs)(r.Fragment,{children:["Failed to get storage information. ",e.children]}):e={children:(0,r.jsx)(r.Fragment,{children:"Cannot find storage information."}),type:"warning"},(0,r.jsx)(eo.Z,{...e})}let{confirmDialog:e}=n,c=Object.values(l.storageGroups),u="Add storage group";if(d.value){let{[d.value]:e}=l.storageGroups;e&&(u="Update ".concat(e.name))}return(0,r.jsxs)(eJ,{children:[(0,r.jsx)(s.Z,{className:eH.root,children:c.map(e=>{let{uuid:t}=e;return(0,r.jsx)(eM,{formDialogRef:i,storages:l,target:d,uuid:t},t)})}),(0,r.jsx)(eN.Js,{header:u,onTransitionExited:()=>{d.set()},ref:i,showClose:!0,wide:!0,children:(0,r.jsx)(e$,{anvil:t,confirm:n,storages:l,uuid:d.value})}),e]})},[t,n,o,i,a,l,d])};var eY=()=>{let{uuid:e}=(0,c.useContext)(u),t=(0,c.useRef)(null),n=(0,F.Z)(),[o,s]=(0,c.useState)(),{altData:i,error:a,loading:l}=(0,R.Z)("/anvil/".concat(e,"/storage"),{mod:eS.Z,periodic:!0});return(0,r.jsxs)(P.s_,{children:[(0,r.jsxs)(P.V9,{children:[(0,r.jsx)(v.z,{children:"Shared Storage"}),(0,r.jsx)(ej.Z,{mapPreset:"add",onClick:()=>{var e;s(void 0),null===(e=t.current)||void 0===e||e.setOpen(!0)}})]}),(0,r.jsx)(eK,{anvil:e,confirm:n,error:a,formDialogRef:t,loading:l,storages:i,target:{set:s,value:o}})]})},e0=()=>{let[e,t]=(0,c.useState)(void 0);return(0,c.useEffect)(()=>{let e=()=>{t(window.innerWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e};let e1="Anvil",e2={child:"".concat(e1,"-child"),server:"".concat(e1,"-server"),container:"".concat(e1,"-container")},e3=(0,o.ZP)("div")(e=>{let{theme:t}=e;return{["& .".concat(e2.child)]:{width:"22%",height:"100%",[t.breakpoints.down(d.li)]:{width:"50%"},[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(e2.server)]:{width:"35%",height:"100%",[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(e2.container)]:{display:"flex",flexDirection:"row",width:"100%",justifyContent:"space-between",[t.breakpoints.down("md")]:{display:"block"}}}}),e7=e=>{let{children:t}=e;return(0,c.createElement)(P.s_,{sx:{marginLeft:{xs:"1em",sm:"auto"},marginRight:{xs:"1em",sm:"auto"},marginTop:"calc(50vh - 10em)",maxWidth:{xs:void 0,sm:"60%",md:"50%",lg:"40%"},minWidth:"fit-content"}},t)},e4=(e,t)=>{let n;if(!e.isReady||!t)return"";let{anvils:r}=t,{name:o,uuid:s}=e.query;if(o?n=r.find(e=>e.anvil_name===o):s&&(n=r.find(e=>e.anvil_uuid===s)),!n){let[e={anvil_uuid:""}]=r;return e.anvil_uuid}return n.anvil_uuid},e9=e=>{let{children:t,list:n,loading:o}=e,s=(0,l.useRouter)(),{uuid:i,setAnvilUuid:a}=(0,c.useContext)(u),d=(0,c.useMemo)(()=>{let e=e4(s,n);return null==a||a.call(null,e),e},[n,s,a]);if(i)return(0,r.jsx)(r.Fragment,{children:t});let h=(0,r.jsx)(e7,{children:(0,r.jsx)(M.Z,{sx:{margin:"2em 2.4em"}})}),m=(0,r.jsx)(e7,{children:(0,r.jsx)(eo.Z,{type:"warning",children:"Failed to get system summary."})});return o?h:n&&d?h:m};var e6=()=>{let e=e0(),{data:t,loading:n}=(0,R.Z)("/anvil/summary",{periodic:!0}),o=(0,c.useMemo)(()=>t&&e?e>d.li?(0,r.jsxs)(s.Z,{className:e2.container,children:[(0,r.jsxs)(s.Z,{className:e2.child,children:[(0,r.jsx)(E,{list:t}),(0,r.jsx)(ee,{anvil:t.anvils})]}),(0,r.jsx)(s.Z,{className:e2.server,children:(0,r.jsx)(eA,{anvil:t.anvils})}),(0,r.jsx)(s.Z,{className:e2.child,children:(0,r.jsx)(eY,{})}),(0,r.jsxs)(s.Z,{className:e2.child,children:[(0,r.jsx)(ed,{}),(0,r.jsx)(U,{}),(0,r.jsx)(er,{})]})]}):(0,r.jsxs)(s.Z,{className:e2.container,children:[(0,r.jsxs)(s.Z,{className:e2.child,children:[(0,r.jsx)(eA,{anvil:t.anvils}),(0,r.jsx)(E,{list:t}),(0,r.jsx)(ee,{anvil:t.anvils})]}),(0,r.jsxs)(s.Z,{className:e2.child,children:[(0,r.jsx)(ed,{}),(0,r.jsx)(eY,{}),(0,r.jsx)(U,{}),(0,r.jsx)(er,{})]})]}):void 0,[t,e]);return(0,r.jsxs)(e3,{children:[(0,r.jsx)(a(),{children:(0,r.jsx)("title",{children:"Anvil"})}),(0,r.jsx)(W.Z,{}),(0,r.jsx)(h,{children:(0,r.jsx)(e9,{list:t,loading:n,children:o})})]})}},11163:function(e,t,n){e.exports=n(43079)}},function(e){e.O(0,[537,256,711,245,215,436,590,394,888,774,179],function(){return e(e.s=72315)}),_N_E=e.O()}]);