(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257],{15421:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/server",function(){return r(26490)}])},19383:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(37876),i=r(12981),n=r(14232);let l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[l]=t,{changingTabId:a,children:o,retain:d=!1,tabId:c}=l,u=(0,n.useMemo)(()=>a===c,[a,c]),h=(0,n.useMemo)(()=>d?(0,s.jsx)(i.A,{sx:{display:u?"initial":"none"},children:o}):u&&o,[o,u,d]);return(0,s.jsx)(s.Fragment,{children:h})}},20151:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(e,t,r)=>{let s,{query:i}=e;if(void 0===r){let{[t]:e,...r}=i;s=r}else s={...i,[t]:r};return s}},26490:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>e3});var s=r(37876),i=r(12981),n=r(54773),l=r(77328),a=r.n(l),o=r(89099),d=r(14232),c=r(2690),u=r(57890),h=r(99955),m=r(86732),x=r(64410),j=r(30198),v=r(23437),g=r(31771),A=r(17838),p=r(52076),f=r.n(p),b=r(31465),y=r(23934),k=r(52627),w=r(5806);let S=function(e,t,r,i,n){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},{setSubmitting:a}=t,{buildRequestBody:o,buildSummary:d,onSuccess:c}=l,u=null==d?void 0:d.call(null,e);r.confirm.prepare({actionProceedText:"Save",content:(0,s.jsx)(k.A,{entries:null!=u?u:e}),onCancelAppend:()=>a(!1),onProceedAppend:()=>{var t;r.confirm.loading(!0);let n=null==o?void 0:o.call(null,e,u);y.A.put(i(),null!=(t=null!=n?n:u)?t:e).then(()=>{r.confirm.finish("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered server update job"})}),null==c||c.call(null),r.add.open(!1),r.edit.open(!1)}).catch(e=>{let t=(0,w.A)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register server update job. ",t.children]}),r.confirm.finish("Error",t),a(!1)})},titleText:n()}),r.confirm.open(!0)};var C=r(22481),M=r(34637),I=r(90890),z=r(27341);let O=(0,n.Ay)(z.A)({["& .".concat(M.x.row)]:{"&:hover":{cursor:"pointer"},"&.Mui-selected":{[".".concat(M.x.cell,":first-child")]:{borderLeft:"thick solid ".concat(I.ft)}},[".".concat(M.x.cell,":first-child")]:{borderLeft:"thick solid ".concat(I.Qu)}}}),F=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[i]=t,{children:n,formik:l,...a}=i;return(0,s.jsx)(x.Ay,{columns:{xs:1,sm:2,md:3},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),l.handleSubmit(e)},spacing:"1em",...a,children:n})};var D=r(63190),V=r(79982),N=r(59664);let W=e=>{let{dangerous:t,detail:r,formDisabled:i,label:n}=e,{data:l}=(0,N.A)("/job?name=".concat(r.uuid,"::update"),{refreshInterval:2e3}),a=(0,d.useMemo)(()=>!l||i||Object.keys(l).length>0,[i,l]),o=(0,d.useMemo)(()=>t?"red":"blue",[t]);return l?(0,s.jsx)(D.A,{actions:[{background:o,children:n,disabled:a,type:"submit"}]}):(0,s.jsx)(V.A,{mt:0})};var U=r(51677),R=r(71986);let P=e=>{let{detail:t,tools:r}=e,[i,n]=(0,d.useState)(),l=(0,d.useMemo)(()=>{let[,...e]=t.devices.diskOrderBy.boot;return e},[t.devices.diskOrderBy.boot]),{disabledSubmit:a,formik:o}=(0,R.A)({initialValues:{order:l},onSubmit:(e,s)=>{S(e,s,r,()=>"/server/".concat(t.uuid,"/set-boot-order"),()=>"Set boot order?",{buildSummary:e=>({order:e.order.map(e=>{let{[e]:{target:{dev:r}}}=t.devices.disks;return r})})})}}),c=(0,d.useMemo)(()=>({order:"order"}),[]),u=(0,d.useMemo)(()=>void 0===i?-1:o.values.order.indexOf(i),[o.values.order,i]),h=(0,d.useMemo)(()=>u<1,[u]),m=(0,d.useMemo)(()=>{let e=o.values.order.length-1;return u<0||u>=e},[o.values.order.length,u]),j=(0,d.useMemo)(()=>o.values.order.map(e=>{let{[e]:{device:r,source:{dev:{path:s=""},file:{path:i=""}},target:{dev:n}}}=t.devices.disks;return{dev:n,index:e,name:r,source:s||i}}),[t.devices.disks,o.values.order]),v=(0,d.useMemo)(()=>[{field:"name",flex:0,headerName:"Name",renderCell:e=>{let{value:t=""}=e,r=t;return/cdrom/.test(t)&&(r="optical"),r=f()(r)},sortable:!1},{field:"dev",flex:0,headerName:"Device",renderCell:e=>{let{value:t}=e;return(0,s.jsx)(U.NA,{noWrap:!0,children:t})},sortable:!1},{field:"source",flex:1,headerName:"Source",renderCell:e=>{let{value:t}=e;return(0,s.jsx)(U.NA,{noWrap:!0,textOverflow:"ellipsis",children:t})},sortable:!1}],[]);return(0,s.jsxs)(F,{formik:o,children:[(0,s.jsx)(x.Ay,{item:!0,alignSelf:"center",children:(0,s.jsxs)(b.A,{spacing:".6em",children:[(0,s.jsx)(C.A,{disabled:h,onClick:()=>{let{order:e}=o.values;if(h)return;let t=u-1,{[t]:r,[u]:s}=e,i=[...e];i.splice(t,2,s,r),o.setFieldValue(c.order,i,!0)},children:(0,s.jsx)(A.A,{fontSize:"small"})}),(0,s.jsx)(C.A,{disabled:m,onClick:()=>{let{order:e}=o.values;if(m)return;let t=u+1,{[u]:r,[t]:s}=e,i=[...e];i.splice(u,2,s,r),o.setFieldValue(c.order,i,!0)},children:(0,s.jsx)(g.A,{fontSize:"small"})})]})}),(0,s.jsx)(x.Ay,{item:!0,flexGrow:1,children:(0,s.jsx)(O,{autoHeight:!0,columns:v,disableColumnMenu:!0,getRowId:e=>e.index,hideFooter:!0,onRowSelectionModelChange:e=>{let[t]=e;n(Number(t))},rows:j})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:t,formDisabled:a,label:"Save"})})]})};var T=r(71401),q=r(69267),H=r(91408),L=r(64830),B=r(45566);let E=e=>H.Ik({size:H.gl().when(["storage"],(t,r)=>{let[s]=t,i=null==e?void 0:e.storageGroups[s];return i?(0,L._0)(i.free):r}),storage:(0,B.ZC)()}),_=e=>H.Ik({bridge:H.Yj().required(),mac:(0,B.By)().notOneOf([...e.devices.interfaces.map(e=>e.mac.address),...Object.values(e.bridges).map(e=>e.mac)],"${path} already exists"),model:H.Yj().nullable()}),G=e=>H.Ik({name:H.Yj().required().oneOf([e.name])}),Y=e=>{let{available:t}=e;return H.Ik({size:(0,L.Yy)(t)})},Z=(e,t)=>H.Ik({name:(0,L.l9)(e.uuid,t)}),K=H.Ik({file:(0,B.ZC)().nullable()}),Q=H.Ik({cores:H.ai().min(1).required(),sockets:H.ai().min(1).required()}),X=H.Ik({lvmVgUuid:H.Yj().required("Volume group is required."),protocol:H.Yj().required().oneOf(["long-throw","short-throw","sync"])}),$=H.Ik({after:H.Yj(),delay:H.ai().min(0)});var J=r(4064);let ee=e=>{let{cpu:t,detail:r,tools:i}=e,{topology:n}=r.cpu,{disabledSubmit:l,formik:a,formikErrors:o,handleChange:c}=(0,R.A)({initialValues:{clusters:String(n.clusters),cores:String(n.cores),dies:String(n.dies),sockets:String(n.sockets),threads:String(n.threads)},onSubmit:(e,t)=>{S(e,t,i,()=>"/server/".concat(r.uuid,"/set-cpu"),()=>"Set CPU?",{buildSummary:e=>({cores:Number(e.cores),sockets:Number(e.sockets)})})},validationSchema:Q}),u=(0,d.useMemo)(()=>({cores:"cores",sockets:"sockets"}),[]);return(0,s.jsxs)(F,{formik:a,children:[(0,s.jsxs)(x.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(U.a3,{children:["Model: ",Object.values(t.hosts)[0].model]}),(0,s.jsxs)(U.a3,{children:["Available cores: ",t.cores]})]}),(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(q.A,{id:u.cores,label:"Cores",name:u.cores,onChange:c,required:!0,value:a.values.cores})})}),(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(q.A,{id:u.sockets,label:"Sockets",name:u.sockets,onChange:c,required:!0,value:a.values.sockets})})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:o})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:r,formDisabled:l,label:"Save"})})]})},et=e=>{let{detail:t}=e,{data:r}=(0,N.A)("/anvil/".concat(t.anvil.uuid,"/cpu"),{refreshInterval:5e3});return r?(0,s.jsx)(ee,{cpu:r,...e}):(0,s.jsx)(V.A,{mt:0})};var er=r(46274);let es=e=>{let{detail:t,tools:r}=e,{disabledSubmit:i,formik:n,handleChange:l}=(0,R.A)({initialValues:{name:""},onSubmit:(e,i)=>{(0,er.A)(r,"/server/".concat(t.uuid),"Delete server ".concat(t.name,"?"),{description:(0,s.jsxs)(U.a3,{children:["Are you sure you want to delete the server ",t.name,"? This action is not reversible!"]}),dangerous:!0,method:"delete",messages:{fail:(0,s.jsx)(s.Fragment,{children:"Failed to register server deletion job."}),proceed:"Delete",success:(0,s.jsx)(s.Fragment,{children:"Successfully registered server deletion job"})},onCancel:()=>{i.setSubmitting(!1)},onFail:()=>{i.setSubmitting(!1)},onSuccess:()=>{window.location.replace("/")}})},validationSchema:G(t)}),a=(0,d.useMemo)(()=>({name:"name"}),[]);return(0,s.jsxs)(F,{formik:n,justifyContent:"center",children:[(0,s.jsxs)(x.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(U.a3,{children:["Deleting ",(0,s.jsx)(U.kp,{children:t.name})," will remove all of its data, including its configurations and storage volume(s)."]}),(0,s.jsx)(U.a3,{children:"Please type the server name to ensure the correct server gets deleted."})]}),(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(q.A,{id:a.name,label:"Server name",name:a.name,onChange:l,value:n.values.name})})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{dangerous:!0,detail:t,formDisabled:i,label:"Delete"})})]})};var ei=r(23435),en=r(87768),el=r(57547),ea=r(74799),eo=r(5755),ed=r(95339),ec=r(69647),eu=r(22073),eh=r(19121),em=r(64632),ex=r(75242),ej=r(65873);let ev=[...eu.W,{displayValue:"%",value:"percent"}],eg=e=>{var t;let{device:r,detail:i,tools:n}=e,l=(0,d.useMemo)(()=>i.devices.disks.find(e=>e.target.dev===r),[i.devices.disks,r]),{altData:a}=(0,N.A)("/anvil/".concat(i.anvil.uuid,"/storage"),{mod:eh.A,refreshInterval:5e3}),{disabledSubmit:o,formik:c,formikErrors:u,handleChange:h}=(0,R.A)({initialValues:{size:{unit:"GiB",value:"0"},storage:null!=(t=null==l?void 0:l.source.dev.sg)?t:""},onSubmit:(e,t)=>{S(e,t,n,()=>"/server/".concat(i.uuid,"/").concat(r?"grow-disk":"add-disk"),()=>"Add disk on ".concat(null==a?void 0:a.storageGroups[e.storage].name,"?"),{buildSummary:e=>{let{size:t,storage:s}=e,{unit:i,value:n}=t,l=/percent/i.test(i)?"%":i;return r?{device:r,size:"".concat(n).concat(l)}:{size:"".concat(n).concat(l),storage:null==a?void 0:a.storageGroups[s].name}},buildRequestBody:(e,t)=>((null==t?void 0:t.storage)&&(t.storage=e.storage),t)})},validationSchema:E(a)}),m=(0,d.useMemo)(()=>{let e="size";return{size:e,storage:"storage",unit:"".concat(e,".unit"),value:"".concat(e,".value")}},[]),j=(0,d.useMemo)(()=>a&&Object.values(a.storageGroups).map(e=>({displayValue:e.name,value:e.uuid})),[a]),v=(0,d.useMemo)(()=>{if(a)return a.storageGroups[c.values.storage]},[c.values,a]),g=(0,d.useMemo)(()=>{let{unit:e}=c.values.size;return"percent"===e?"GiB":e},[c.values.size]),A=(0,d.useMemo)(()=>{if(!v)return;let e={toUnit:g};return{free:(0,ec.zz)(v.free,e),size:(0,ec.zz)(v.size,e),used:(0,ec.zz)(v.used,e)}},[g,v]),p=(0,d.useMemo)(()=>{if(!l)return;let{name:e="",size:t}=l.source.dev.lv;if(t)return{name:e,size:(0,ec.zz)(t,{toUnit:g}),zero:/_0$/.test(e)}},[g,l]),f=(0,d.useMemo)(()=>"shut off"!==i.state&&(null==p?void 0:p.zero)||o,[i.state,null==p?void 0:p.zero,o]),b=(0,d.useMemo)(()=>{if("shut off"!==i.state&&(null==p?void 0:p.zero))return(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eo.A,{children:"A server must be shut off in order to grow its disk 0."})})},[i.state,null==p?void 0:p.zero]),y=(0,d.useMemo)(()=>A&&a&&(0,s.jsxs)(x.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(U.a3,{children:["Storage group: ",(0,s.jsx)(U.kp,{noWrap:!0,children:null==v?void 0:v.name})]}),(0,s.jsx)(em.Fn,{storages:a,target:c.values.storage}),(0,s.jsxs)(x.Ay,{container:!0,children:[(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsxs)(U.a3,{children:["Used: ",A.used]})}),(0,s.jsx)(x.Ay,{item:!0,textAlign:"center",xs:!0,children:(0,s.jsxs)(U.a3,{fontWeight:400,children:["Free: ",A.free]})}),(0,s.jsx)(x.Ay,{item:!0,textAlign:"right",children:(0,s.jsxs)(U.a3,{children:["Total: ",A.size]})})]})]}),[A,c.values.storage,null==v?void 0:v.name,a]),k=(0,d.useMemo)(()=>r&&(0,s.jsx)(x.Ay,{item:!0,textAlign:"center",width:{xs:"100%",sm:"fit-content"},children:(0,s.jsx)(ed.A,{sx:{color:I.Qu}})}),[r]);return j?(0,s.jsxs)(F,{alignItems:"center",formik:c,children:[b,y,(0,s.jsx)(x.Ay,{item:!0,sm:!0,xs:1,children:r?(0,s.jsxs)(x.Ay,{alignItems:"center",container:!0,children:[(0,s.jsxs)(x.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(U.a3,{children:["Disk: ",(0,s.jsx)(U.kp,{noWrap:!0,children:r})]}),(0,s.jsxs)(U.a3,{children:["(",(0,s.jsxs)(U.kp,{children:["volume=",null==p?void 0:p.name]}),")"]})]}),(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsx)(U.a3,{fontWeight:400,noWrap:!0,children:null==p?void 0:p.size})})]}):(0,s.jsx)(ej.A,{id:m.storage,label:"Storage group",name:m.storage,onChange:c.handleChange,selectItems:j,selectProps:{disabled:!!r},value:c.values.storage})}),k,(0,s.jsx)(x.Ay,{item:!0,sm:!0,xs:1,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(ex.A,{id:"server-disk-input",label:"Disk size",inputWithLabelProps:{id:m.value,inputProps:{disabled:!c.values.storage},name:m.value},onChange:h,selectItems:ev,selectWithLabelProps:{id:m.unit,name:m.unit,onChange:e=>{let t=e.target.value,{unit:r,value:s}=c.values.size;if([t,r].includes("percent"))return void c.setFieldValue(m.size,{unit:t,value:"0"},!0);let i=(0,ec.u7)(s,{fromUnit:r,precision:"B"===t?0:void 0,toUnit:t});if(!i)return;let{value:n}=i;c.setFieldValue(m.size,{unit:t,value:n},!0)},selectProps:{disabled:!c.values.storage},value:c.values.size.unit},value:c.values.size.value})})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:u})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:i,formDisabled:f,label:"Save"})})]}):(0,s.jsx)(V.A,{mt:0})};var eA=r(75641),ep=r(57763);let ef=e=>{let{fileUuid:t}=e,{data:r}=(0,N.A)("/file/".concat(t));if(!r)return(0,s.jsx)(V.A,{mt:0});let{checksum:n,path:l,size:a}=r;return(0,s.jsxs)(i.A,{children:[(0,s.jsx)(U.NA,{children:l.full}),(0,s.jsx)(U.NA,{children:(0,ec.zz)(a,{toUnit:"ibyte"})}),(0,s.jsxs)(U.NA,{children:["md5: ",n]})]})},eb=e=>{var t;let{detail:r,device:i,tools:n}=e,l=(0,d.useMemo)(()=>r.devices.disks.find(e=>e.target.dev===i),[r.devices.disks,i]),{data:a}=(0,N.A)("/file?name=".concat(r.anvil.name,"&type=iso"),{refreshInterval:5e3}),{disabledSubmit:o,formik:c,formikErrors:u}=(0,R.A)({initialValues:{file:null!=(t=null==l?void 0:l.source.file.uuid)?t:null},onSubmit:(e,t)=>{S(e,t,n,()=>"/server/".concat(r.uuid,"/change-iso"),()=>"".concat(e.file?"Insert":"Eject"," ISO?"),{buildSummary:e=>{var t;let{file:r}=e,s=null==l?void 0:l.target.dev;return r?{device:s,iso:null==a||null==(t=a[r])?void 0:t.name}:{device:s}},buildRequestBody:(e,t)=>((null==t?void 0:t.iso)&&e.file&&(t.iso=e.file),t)})},validationSchema:K}),h=(0,d.useMemo)(()=>({file:"file"}),[]),m=(0,d.useMemo)(()=>a&&Object.values(a),[a]),j=(0,d.useMemo)(()=>{if(!a)return;let{file:e}=c.values;if(e)return a[e]},[c.values,a]);return m?(0,s.jsxs)(F,{formik:c,children:[(0,s.jsx)(x.Ay,{item:!0,xs:!0,children:(0,s.jsx)(ep.A,{disableClearable:!0,extendRenderInput:e=>{e.inputLabelProps={...e.inputLabelProps,shrink:!0},e.inputProps={...e.inputProps,notched:!0,placeholder:"Empty slot"}},getOptionLabel:e=>e.name,id:h.file,isOptionEqualToValue:(e,t)=>e.uuid===(null==t?void 0:t.uuid),label:"ISO (optical disk)",noOptionsText:"No matching ISO",onChange:(e,t)=>{c.setFieldValue(h.file,t?t.uuid:null,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{let{name:r,uuid:i}=t;return(0,d.createElement)("li",{...e,key:"iso-op-".concat(i)},(0,s.jsx)(U.a3,{inheritColour:!0,children:r}))},value:j})}),(0,s.jsx)(x.Ay,{item:!0,alignSelf:"center",children:(0,s.jsx)(C.A,{onClick:()=>{c.setFieldValue(h.file,null,!0)},size:"small",children:(0,s.jsx)(eA.A,{})})}),c.values.file&&(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ef,{fileUuid:c.values.file})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:u})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:r,formDisabled:o,label:"Save"})})]}):(0,s.jsx)(V.A,{mt:0})},ey=e=>{let{detail:t,tools:r}=e,i=(0,d.useRef)(null),n=(0,d.useRef)(null),l=(0,d.useRef)(null),[a,o]=(0,d.useState)(),c=(0,d.useMemo)(()=>t.devices.disks.reduce((e,t)=>(e[t.target.dev]=t,e),{}),[t.devices.disks]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(x.Ay,{container:!0,spacing:"1em",children:[(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eo.A,{children:'Disk operations "shrink" or "delete" must be done through commands to avoid data loss.'})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ea.A,{allowAddItem:!0,header:!0,listEmpty:"No disk(s) found.",listItems:c,onAdd:()=>{o(void 0),r.add={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=i.current)?void 0:e.setOpen(t)}},r.add.open(!0)},renderListItem:(e,t)=>{let{device:i,source:{dev:{path:a=""},file:{path:d=""}},target:{dev:c}}=t,u=i;return/cd/.test(i)&&(u="optical"),(0,s.jsxs)(x.Ay,{alignItems:"center",columnGap:"1em",container:!0,children:[(0,s.jsxs)(x.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(b.A,{columnSpacing:0,row:!0,rowSpacing:".5em",children:[(0,s.jsxs)(U.a3,{noWrap:!0,children:[f()(u),":"]})," ",(0,s.jsx)(U.NA,{noWrap:!0,children:e})]}),(0,s.jsx)(U.NA,{noWrap:!0,children:a||d})]}),"optical"===u&&(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsx)(C.A,{onClick:()=>{o(c),r.edit={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=l.current)?void 0:e.setOpen(t)}},r.edit.open(!0)},size:"small",children:(0,s.jsx)(ei.A,{})})}),"disk"===u&&(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsx)(C.A,{onClick:()=>{o(c),r.edit={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=n.current)?void 0:e.setOpen(t)}},r.edit.open(!0)},size:"small",children:(0,s.jsx)(en.A,{sx:{rotate:"90deg"}})})})]})}})})]}),(0,s.jsx)(el.K_,{header:"Add disk",ref:i,showClose:!0,wide:!0,children:(0,s.jsx)(eg,{...e})}),(0,s.jsx)(el.K_,{header:"".concat(a,": grow disk"),ref:n,showClose:!0,wide:!0,children:a&&(0,s.jsx)(eg,{device:a,...e})}),(0,s.jsx)(el.K_,{header:"".concat(a,": insert or eject ISO"),ref:l,showClose:!0,wide:!0,children:a&&(0,s.jsx)(eb,{device:a,...e})})]})};var ek=r(57212);let ew={mac:"auto",model:"e1000e"},eS=e=>{let{detail:t,tools:r}=e,{disabledSubmit:i,formik:n,formikErrors:l,handleChange:a}=(0,R.A)({initialValues:{bridge:"",mac:"",model:ew.model},onSubmit:(e,s)=>{S(e,s,r,()=>"/server/".concat(t.uuid,"/add-interface"),()=>"Add interface?",{buildSummary:e=>{let t={...e};return t.mac||(t.mac=ew.mac),t},buildRequestBody:(e,t)=>{let r={};return(null==t?void 0:t.bridge)&&(r.bridge=t.bridge),(null==t?void 0:t.mac)&&t.mac!==ew.mac&&(r.mac=t.mac),(null==t?void 0:t.model)&&t.model!==ew.model&&(r.model=t.model),r}})},validationSchema:_(t)}),o=(0,d.useMemo)(()=>({bridge:"bridge",mac:"mac",model:"model"}),[]),c=(0,d.useMemo)(()=>Object.values(Object.values(t.bridges).reduce((e,t)=>{let{name:r}=t;return r in e||(e[r]={value:r}),e},{})),[t.bridges]);return(0,s.jsxs)(F,{formik:n,children:[(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(ej.A,{id:o.bridge,label:"Bridge",name:o.bridge,onChange:n.handleChange,required:!0,selectItems:c,value:n.values.bridge})}),(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(q.A,{id:o.mac,inputLabelProps:{shrink:!0},inputProps:{notched:!0,placeholder:"Auto generated"},label:"Mac address",name:o.mac,onChange:a,value:n.values.mac})})}),(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(ep.A,{id:o.model,label:"Model",noOptionsText:"No matching model",onChange:(e,t)=>{n.setFieldValue(o.model,t,!0)},openOnFocus:!0,options:t.libvirt.nicModels,value:n.values.model})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:l})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:t,formDisabled:i,label:"Save"})})]})},eC={down:"plug-in",up:"unplug"},eM={down:"unplugged",up:"plugged-in"},eI=e=>{let{detail:t,tools:r}=e,i=(0,d.useRef)(null),n=(0,d.useMemo)(()=>t.devices.interfaces.reduce((e,t)=>(e[t.mac.address]=t,e),{}),[t.devices.interfaces]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Ay,{container:!0,children:(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ea.A,{allowAddItem:!0,header:!0,listEmpty:"No server network interface(s) found.",listItems:n,onAdd:()=>{r.add={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=i.current)?void 0:e.setOpen(t)}},r.add.open(!0)},renderListItem:(e,i)=>{let{link:{state:n},model:{type:l},source:{bridge:a},target:{dev:o}}=i,d="up"===n;return(0,s.jsxs)(x.Ay,{alignItems:"center",columnGap:"1em",container:!0,children:[(0,s.jsxs)(x.Ay,{alignItems:"center",display:"flex",flexDirection:"column",item:!0,minWidth:"5em",children:[(0,s.jsx)(U.xF,{noWrap:!0,children:f()(eM[n])}),(0,s.jsx)(ek.A,{checked:d,onChange:()=>{let{[n]:i}=eC;(0,er.A)(r,"/server/".concat(t.uuid,"/set-interface-state"),"".concat(f()(i)," ").concat(o," (").concat(e,")?"),{body:{active:!d,mac:e},messages:{proceed:f()(i),fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",i," interface job."]}),success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",i," interface job"]})}})}})]}),(0,s.jsxs)(x.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(b.A,{xs:"column",md:"row",columnSpacing:0,children:[(0,s.jsxs)(U.NA,{noWrap:!0,children:[o," (",l,")"]}),(0,s.jsx)(j.A,{flexItem:!0,orientation:"vertical"}),(0,s.jsx)(U.NA,{noWrap:!0,children:e})]}),(0,s.jsx)(U.NA,{children:a})]}),(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsx)(C.A,{mapPreset:"delete",onClick:()=>{(0,er.A)(r,"/server/".concat(t.uuid,"/delete-interface"),"Delete ".concat(o," (").concat(e,")?"),{body:{mac:e},messages:{proceed:"Delete",fail:(0,s.jsx)(s.Fragment,{children:"Failed to register delete interface job."}),success:(0,s.jsx)(s.Fragment,{children:"Successfully registered delete interface job"})}})},size:"small",variant:"redcontained"})})]})}})})}),(0,s.jsx)(el.K_,{header:"Add interface",ref:i,showClose:!0,wide:!0,children:(0,s.jsx)(eS,{...e})})]})};var ez=r(91322);let eO=e=>{var t,r;let{detail:i,memory:n,tools:l}=e,{disabledSubmit:a,formik:o,formikErrors:c,handleChange:u}=(0,R.A)({initialValues:{size:{unit:"GiB",value:null!=(r=null==(t=(0,ec.u7)(i.memory.size,{toUnit:"GiB"}))?void 0:t.value)?r:"0"}},onSubmit:(e,t)=>{S(e,t,l,()=>"/server/".concat(i.uuid,"/set-memory"),()=>"Set memory?",{buildSummary:e=>{let{unit:t,value:r}=e.size;return{size:"".concat(r).concat(t)}}})},validationSchema:Y(n)}),h=(0,d.useMemo)(()=>{let e="size";return{size:e,unit:"".concat(e,".unit"),value:"".concat(e,".value")}},[]),m=(0,d.useMemo)(()=>{let e={toUnit:o.values.size.unit},t=(0,ec.zz)(n.allocated,e),r=(0,ec.zz)(n.available,e);return{allocated:t,available:r,reserved:(0,ec.zz)(n.reserved,e),total:(0,ec.zz)(n.total,e)}},[o.values.size.unit,n.allocated,n.available,n.reserved,n.total]);return(0,s.jsxs)(F,{formik:o,children:[(0,s.jsxs)(x.Ay,{item:!0,width:"100%",children:[(0,s.jsx)(em.jk,{memory:n}),(0,s.jsxs)(x.Ay,{container:!0,children:[(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsxs)(U.a3,{children:["Allocated: ",m.allocated]})}),(0,s.jsx)(x.Ay,{item:!0,textAlign:"center",xs:!0,children:(0,s.jsxs)(U.a3,{fontWeight:400,children:["Available: ",m.available]})}),(0,s.jsxs)(x.Ay,{item:!0,textAlign:"right",children:[(0,s.jsxs)(U.a3,{children:["System: ",m.reserved]}),(0,s.jsxs)(U.a3,{children:["Total: ",m.total]})]})]})]}),(0,s.jsx)(x.Ay,{item:!0,sm:"auto",xs:1,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(ex.A,{id:"server-memory-input",label:"Memory",inputWithLabelProps:{id:h.value,name:h.value},onChange:u,selectItems:eu.W,selectWithLabelProps:{id:h.unit,name:h.unit,onChange:e=>{let t=e.target.value,{value:r,unit:s}=o.values.size,i=(0,ec.u7)(r,{fromUnit:s,precision:"B"===t?0:void 0,toUnit:t});if(!i)return;let{value:n}=i;o.setFieldValue(h.size,{value:n,unit:t},!0)},value:o.values.size.unit},value:o.values.size.value})})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:c})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:i,formDisabled:a,label:"Save"})})]})},eF=e=>{let{detail:t}=e,{altData:r}=(0,N.A)("/anvil/".concat(t.anvil.uuid,"/memory"),{mod:ez.A,refreshInterval:5e3});return r?(0,s.jsx)(eO,{memory:r,...e}):(0,s.jsx)(V.A,{mt:0})};var eD=r(53198);let eV=e=>{let{detail:t,tools:r}=e,{altData:i}=(0,N.A)("/host?type=subnode",{mod:e=>Object.values(e).find(e=>{var r,s;return(null==(r=e.anvil)?void 0:r.uuid)===t.anvil.uuid&&e.shortHostName!==(null==(s=t.host)?void 0:s.short)})});return i?t.host?(0,s.jsxs)(x.Ay,{container:!0,spacing:"1em",children:[(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(U.a3,{children:["Running on: ",t.host.short]})}),(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsxs)(eD.A,{onClick:()=>{(0,er.A)(r,"/server/".concat(t.uuid,"/migrate"),"Migrate ".concat(t.name," to ").concat(i.shortHostName,"?"),{body:{target:i.shortHostName},messages:{fail:(0,s.jsx)(s.Fragment,{children:"Failed to register migration job."}),proceed:"Migrate",success:(0,s.jsx)(s.Fragment,{children:"Successfully registered migration job"})}})},children:["Migrate to ",i.shortHostName]})})]}):(0,s.jsx)(eo.A,{children:"Cannot migrate a shut off server."}):(0,s.jsx)(V.A,{mt:0})};var eN=r(44981);let eW=e=>Object.values(e).reduce((e,t)=>{let{uuid:r}=t;return e[r]=(0,eN.A)(t),e},{});var eU=r(75629),eR=r(40663);let eP=BigInt(0),eT=[{displayValue:(0,s.jsxs)(i.A,{children:[(0,s.jsxs)(U.a3,{inheritColour:!0,children:["Async (",(0,s.jsx)(U.kp,{inheritColour:!0,noWrap:!0,children:"short-throw"}),")"]}),(0,s.jsx)(U.a3,{selected:!1,children:"Replication writes are considered done when the data is in the active node's network transmit buffer."})]}),value:"short-throw"},{displayValue:(0,s.jsxs)(i.A,{children:[(0,s.jsx)(U.a3,{inheritColour:!0,children:"Sync"}),(0,s.jsx)(U.a3,{selected:!1,children:"Replication writes are considered done when the data is written to disk on the DR host."})]}),value:"sync"}],eq=e=>{let{detail:t,drs:r,tools:i}=e,[n,l]=(0,d.useState)(0),[a,o]=(0,d.useState)(!1),c=(0,d.useMemo)(()=>a&&n<100,[a,n]),u=(0,d.useMemo)(()=>"/server/".concat(t.uuid,"/set-protect"),[t.uuid]),h=(0,d.useMemo)(()=>Object.values(r).reduce((e,t)=>(Object.values(t.storage.volumeGroups).forEach(t=>{e[t.internalUuid]=t}),e),{}),[r]),m=(0,d.useMemo)(()=>Object.values(h).map(e=>e.internalUuid),[h]),j=(0,d.useMemo)(()=>Object.values(t.devices.disks).reduce((e,t)=>{let{lv:r}=t.source.dev;return r.uuid&&(e[r.uuid]=r),e},{}),[t.devices.disks]),v=(0,d.useMemo)(()=>Object.values(t.protect)[0],[t.protect]),g=(0,d.useMemo)(()=>Object.values(j).map(e=>{let{size:t}=e;if(!t)return eP;try{return BigInt(t)}catch(e){return eP}}).reduce((e,t)=>e+t,eP),[j]),{changeFieldValue:A,disabledSubmit:p,formik:b,formikErrors:y}=(0,R.A)({initialValues:{lvmVgUuid:null,protocol:"sync"},onSubmit:(e,t)=>{o(!1),S(e,t,i,()=>u,()=>"Update server protect config?",{buildSummary:e=>{let{lvmVgUuid:t,protocol:s}=e;if(!t)return{};let{[t]:i}=h,{[i.host]:n}=r;return{drHost:n.short,volumeGroup:"".concat(i.name," (").concat(i.internalUuid,")"),protocol:s}},buildRequestBody:e=>{let{lvmVgUuid:t,protocol:r}=e,s={operation:"protect"};return t&&(s.lvmVgUuid=t),r&&(s.protocol=r),s},onSuccess:()=>{o(!0)}})},validationSchema:X}),k=(0,d.useMemo)(()=>({lvmVgUuid:"lvmVgUuid",protocol:"protocol"}),[]);if(v){let{drUuid:e="",protocol:n,status:l}=v,{[e]:a}=r,o="connected"===l.connection;return(0,s.jsxs)(x.Ay,{alignItems:"center",container:!0,spacing:"1em",children:[(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(U.a3,{children:[(0,s.jsx)(U.kp,{edge:"start",noWrap:!0,children:t.name})," ","is configured to be protected by"," ",(0,s.jsx)(U.kp,{noWrap:!0,children:a.short})," using protocol"," ",(0,s.jsx)(U.kp,{noWrap:!0,children:n}),"."]})}),(0,s.jsx)(x.Ay,{item:!0,xs:!0,children:(0,s.jsx)(eR.A,{checked:o,label:"Connection",onChange:(e,t)=>{let r=t?"connect":"disconnect",n=f()(r);(0,er.A)(i,u,"".concat(n," the server on the protector DR host?"),{body:{operation:r},description:(0,s.jsx)(U.a3,{children:"connect"===r?(0,s.jsx)(s.Fragment,{children:"This operation connects the server to its copy on the DR host and start streaming replication."}):(0,s.jsx)(s.Fragment,{children:"This operation disconnects the server from its copy on the DR host and stop streaming replication."})}),messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",r," resource job."]}),proceed:n,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",r," resource job"]})}})}})}),(0,s.jsx)(x.Ay,{item:!0,xs:!0,children:(0,s.jsx)(eD.A,{onClick:()=>{let e="update",t=f()(e);(0,er.A)(i,u,"".concat(t," the server on the protector DR host?"),{body:{operation:e},description:(0,s.jsx)(U.a3,{children:"This operation is a combination that connects, performs a sync, and disconnects."}),messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",e," resource job."]}),proceed:t,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",e," resource job"]})}})},sx:{width:"100%"},children:"Update"})}),(0,s.jsx)(x.Ay,{item:!0,xs:!0,children:(0,s.jsx)(eD.A,{background:"red",onClick:()=>{let e="remove",t=f()(e);(0,er.A)(i,u,"".concat(t," protection for the server on the protector DR host?"),{body:{operation:e},description:(0,s.jsx)(U.a3,{children:"This operation removes the server's copy on the DR host and thus removes the protection."}),dangerous:!0,messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",e," protection job."]}),proceed:t,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",e," protection job"]})}})},sx:{width:"100%"},children:"Remove protection"})})]})}return(0,s.jsxs)(F,{formik:b,children:[(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ea.A,{header:"Server disk(s)",listItems:j,renderListItem:(e,t)=>(0,s.jsxs)(x.Ay,{container:!0,children:[(0,s.jsx)(x.Ay,{item:!0,xs:!0,children:(0,s.jsxs)(U.a3,{children:[(0,s.jsx)(U.kp,{edge:"start",noWrap:!0,children:t.name})," ","(",(0,s.jsx)(U.kp,{noWrap:!0,variant:"caption",children:t.uuid}),")"]})}),(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsx)(U.a3,{edge:"end",noWrap:!0,children:t.size&&(0,ec.zz)(t.size,{toUnit:"ibyte"})})})]})})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(U.a3,{children:["Server total disk(s) size:"," ",(0,ec.zz)(g,{toUnit:"ibyte"})]})}),(0,s.jsx)(x.Ay,{item:!0,xs:2,children:(0,s.jsx)(ep.A,{getOptionDisabled:e=>{let{[e]:t}=h;return t.free<g},getOptionLabel:e=>{let{[e]:t}=h,{[t.host]:s}=r;return"".concat(s.short," - ").concat(t.name)},id:k.lvmVgUuid,label:"Volume group",noOptionsText:"No matching volume group",onChange:(e,t)=>{A(k.lvmVgUuid,t,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{let{[t]:i}=h,{[i.host]:n}=r,l=i.free>=g?(0,s.jsx)(s.Fragment,{children:"Sufficient space"}):(0,s.jsx)(s.Fragment,{children:"Insufficient space"});return(0,d.createElement)("li",{...e,key:"dr-op-".concat(t)},(0,s.jsxs)(x.Ay,{alignItems:"center",columnSpacing:"1em",container:!0,children:[(0,s.jsxs)(x.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(U.a3,{edge:"start",inheritColour:!0,children:[(0,s.jsx)(U.kp,{edge:"start",inheritColour:!0,noWrap:!0,children:n.short})," ","-"," ",(0,s.jsx)(U.kp,{inheritColour:!0,noWrap:!0,children:i.name})]}),(0,s.jsxs)(U.a3,{edge:"start",inheritColour:!0,children:[(0,s.jsx)(U.kp,{edge:"start",inheritColour:!0,noWrap:!0,children:(0,ec.zz)(i.free,{toUnit:"ibyte"})})," ","free"]})]}),(0,s.jsx)(x.Ay,{item:!0,children:(0,s.jsx)(U.a3,{edge:"end",inheritColour:!0,noWrap:!0,children:l})})]}))},required:!0,value:b.values.lvmVgUuid})}),(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(ej.A,{id:k.protocol,label:"Protocol",name:k.protocol,onChange:b.handleChange,required:!0,selectItems:eT,selectProps:{renderValue:e=>e},value:b.values.protocol})}),a&&(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eU.A,{getLabel:e=>100===e?"Config changed.":"Changing config...",names:["dr::link","dr::protect","storage-group-member::add::".concat(b.values.lvmVgUuid)],progress:{set:l,value:n}})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:y})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:t,formDisabled:p||c,label:"Save"})})]})},eH=e=>{let{altData:t,error:r,loading:i}=(0,N.A)("/host?detail=1&type=dr",{mod:eW});return i?(0,s.jsx)(V.A,{mt:0}):t?(0,s.jsx)(eq,{drs:t,...e}):(0,s.jsxs)(eo.A,{type:"warning",children:["Failed to get DR hosts. ",null==r?void 0:r.message]})},eL=e=>{let{detail:t,servers:r,tools:i}=e,{disabledSubmit:n,formik:l,formikErrors:a,handleChange:o}=(0,R.A)({initialValues:{name:t.name},onSubmit:(e,r)=>{S(e,r,i,()=>"/server/".concat(t.uuid,"/rename"),()=>"Rename ".concat(t.name,"?"))},validationSchema:Z(t,r)}),c=(0,d.useMemo)(()=>({name:"name"}),[]),u=(0,d.useMemo)(()=>"shut off"!==t.state||n,[t.state,n]);return(0,s.jsxs)(F,{formik:l,children:["shut off"!==t.state&&(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eo.A,{children:"A server can only be renamed when it's shut off."})}),(0,s.jsx)(x.Ay,{item:!0,sm:"auto",xs:1,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(q.A,{id:c.name,label:"Server name",name:c.name,onChange:o,required:!0,value:l.values.name})})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:a})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:t,formDisabled:u,label:"Save"})})]})},eB=e=>{let{detail:t,servers:r,tools:i}=e,{disabledSubmit:n,formik:l,formikErrors:a,handleChange:o}=(0,R.A)({initialValues:{active:t.start.active,after:t.start.after||"",delay:String(t.start.delay)},onSubmit:(e,s)=>{S(e,s,i,()=>"/server/".concat(t.uuid,"/set-start-dependency"),()=>"Set start dependency?",{buildSummary:e=>{var t;let{active:s,after:i,delay:n}=e;return s?{after:null==(t=r[i])?void 0:t.name,delay:"".concat(n," second(s)")}:{"stay-off":"yes"}},buildRequestBody:e=>{let{active:t,after:r,delay:s}=e;return t&&r?{after:r,delay:Number(s)}:{active:t}}})},validationSchema:$}),c=(0,d.useMemo)(()=>({active:"active",after:"after",delay:"delay"}),[]),u=(0,d.useMemo)(()=>Object.values(r).filter(e=>e.uuid!==t.uuid),[t.uuid,r]),h=(0,d.useMemo)(()=>u.map(e=>{let{name:t,uuid:r}=e;return{displayValue:t,value:r}}),[u]);return(0,s.jsxs)(F,{formik:l,children:[(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(ej.A,{id:c.after,label:"Start after",name:c.after,onChange:l.handleChange,selectItems:h,selectProps:{disabled:!l.values.active,onClearIndicatorClick:()=>{l.setFieldValue(c.after,"",!0)}},value:l.values.after})}),(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(J.A,{input:(0,s.jsx)(q.A,{id:c.delay,inputProps:{disabled:!l.values.active||""===l.values.after},label:"Delay (seconds)",name:c.delay,onChange:o,value:l.values.delay})})}),(0,s.jsx)(x.Ay,{item:!0,xs:1,children:(0,s.jsx)(eR.A,{checked:!l.values.active,id:c.active,label:"Stay off",name:c.active,onChange:(e,t)=>{l.setFieldValue(c.active,!t,!0)}})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(T.A,{count:1,messages:a})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(W,{detail:t,formDisabled:n,label:"Save"})})]})};var eE=r(65832),e_=r(19383),eG=r(98927),eY=r(30764);let eZ={bootOrder:{label:"Boot order",value:"boot-order"},cpu:{label:"CPU",value:"cpu"},delete:{label:"Deletion",value:"deletion"},disks:{label:"Disks",value:"disks"},general:{label:"General",value:"general"},interfaces:{label:"Interfaces",value:"interfaces"},memory:{label:"Memory",value:"memory"},migration:{label:"Migration",value:"migration"},name:{label:"Name",value:"name"},protect:{label:"Disaster recovery",value:"protect"},startDependency:{label:"Start dependency",value:"start-dependency"}},eK=(0,n.Ay)(c.i)(e=>{let{theme:t}=e;return{width:"100%",[t.breakpoints.up("xs")]:{height:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return"calc(".concat(e," * 0.6)")}("100vw")},[t.breakpoints.up("sm")]:{height:"6em"},[t.breakpoints.up("md")]:{height:"9em"}}}),eQ=e=>{let{slotProps:t,serverUuid:r}=e,[i,n]=(0,d.useState)(eZ.general.value),{data:l,mutate:a}=(0,N.A)("/server"),{data:o}=(0,N.A)("/server/".concat(r),{refreshInterval:3e3}),{confirmDialog:u,finishConfirm:h,setConfirmDialogLoading:m,setConfirmDialogOpen:g,setConfirmDialogProps:A}=(0,eY.A)({initial:{scrollContent:!0,wide:!0}}),p=(0,d.useRef)({add:{open:()=>null},confirm:{finish:h,loading:m,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return g(e)},prepare:A},edit:{open:()=>null}});return o&&l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Zk,{children:(0,s.jsxs)(x.Ay,{container:!0,spacing:"1em",children:[(0,s.jsx)(x.Ay,{item:!0,width:{xs:"100%",sm:"14em",md:"20em"},children:(0,s.jsxs)(x.Ay,{columns:1,container:!0,spacing:"1em",children:[(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsx)(c.wL,{server:o,children:(0,s.jsx)(c.lN,{server:o,slots:{screenshotBox:(0,s.jsx)(eK,{})},...null==t?void 0:t.preview})})}),(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(eG.A,{onChange:(e,t)=>{n(t),[eZ.migration.value,eZ.startDependency.value].includes(t)&&a()},orientation:"vertical",value:i,children:[(0,s.jsx)(eE.A,{...eZ.general,label:o.name}),(0,s.jsx)(eE.A,{disabled:!0,icon:(0,s.jsx)(j.A,{orientation:"horizontal",sx:{width:"100%"}}),label:""}),(0,s.jsx)(eE.A,{...eZ.bootOrder}),(0,s.jsx)(eE.A,{...eZ.cpu}),(0,s.jsx)(eE.A,{...eZ.disks}),(0,s.jsx)(eE.A,{...eZ.interfaces}),(0,s.jsx)(eE.A,{...eZ.memory}),(0,s.jsx)(eE.A,{...eZ.migration}),(0,s.jsx)(eE.A,{...eZ.name}),(0,s.jsx)(eE.A,{...eZ.protect}),(0,s.jsx)(eE.A,{...eZ.startDependency}),(0,s.jsx)(eE.A,{...eZ.delete})]})})]})}),(0,s.jsx)(x.Ay,{display:{xs:"none",sm:"initial"},item:!0,children:(0,s.jsx)(j.A,{orientation:"vertical"})}),(0,s.jsxs)(x.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.general.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.general.label})}),(0,s.jsx)(x.Ay,{container:!0,rowSpacing:"0.4em",children:[{header:"UUID",value:o.uuid},{header:"State",value:o.state},{header:"On node",value:"".concat(o.anvil.name,": ").concat(o.anvil.description)},{header:"On host",value:o.host?o.host.short:"None"}].map(e=>{let{header:t,value:r}=e;return(0,s.jsx)(x.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(x.Ay,{columnSpacing:"1em",container:!0,children:[(0,s.jsx)(x.Ay,{item:!0,width:"10em",children:(0,s.jsx)(U.a3,{children:t})}),(0,s.jsx)(x.Ay,{item:!0,xs:!0,children:(0,s.jsx)(U.NA,{children:r})})]})},"general-".concat(t))})})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.bootOrder.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.bootOrder.label})}),(0,s.jsx)(P,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.cpu.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.cpu.label})}),(0,s.jsx)(et,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.delete.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.delete.label})}),(0,s.jsx)(es,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.disks.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.disks.label})}),(0,s.jsx)(ey,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.interfaces.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.interfaces.label})}),(0,s.jsx)(eI,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.memory.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.memory.label})}),(0,s.jsx)(eF,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.migration.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.migration.label})}),(0,s.jsx)(eV,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.name.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.name.label})}),(0,s.jsx)(eL,{detail:o,tools:p.current,servers:l})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.protect.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.protect.label})}),(0,s.jsx)(eH,{detail:o,tools:p.current})]}),(0,s.jsxs)(e_.A,{changingTabId:i,tabId:eZ.startDependency.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(U.HM,{children:eZ.startDependency.label})}),(0,s.jsx)(eB,{detail:o,servers:l,tools:p.current})]})]})]})}),u]}):(0,s.jsx)(v.Zk,{children:(0,s.jsx)(V.A,{mt:0})})};var eX=r(87986),e$=r(20151);let eJ="Server",e0={preview:"".concat(eJ,"-preview"),fullView:"".concat(eJ,"-fullView")},e1=(0,n.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(e0.preview)]:{width:"25%",height:"100%",[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(e0.fullView)]:{display:"flex",flexDirection:"row",width:"100%",justifyContent:"center"}}}),e3=()=>{var e;let t=(0,o.useRouter)(),{data:r,error:n,loading:l}=(0,N.A)("/server"),x=(0,d.useMemo)(()=>(0,u.A)(r,t,e=>t=>t.name===e),[t,r]),j=(0,d.useMemo)(()=>{if(!t.isReady)return"";let{view:e}=t.query;return(0,h.A)(e)},[t.isReady,t.query]);if(l)return(0,s.jsxs)("div",{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:"Loading..."})}),(0,s.jsx)(m.A,{}),(0,s.jsx)(eX.A,{children:(0,s.jsx)(v.Zk,{children:(0,s.jsx)(V.A,{mt:0})})})]});if(!x)return(0,s.jsxs)("div",{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:"Server?"})}),(0,s.jsx)(m.A,{}),(0,s.jsx)(eX.A,{children:(0,s.jsx)(v.Zk,{children:(0,s.jsxs)(eo.A,{children:["Couldn't find server ",t.query.name||t.query.uuid,". ",null==n?void 0:n.message]})})})]});let g={vnc:(0,s.jsx)(i.A,{className:e0.fullView,children:(0,s.jsx)(c.pO,{node:x.anvil,onClickCloseButton:()=>{let e=(0,e$.A)(t,"view");t.replace({query:e},void 0,{shallow:!0})},server:x})})};return(0,s.jsxs)(e1,{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:x.name})}),(0,s.jsx)(m.A,{}),null!=(e=g[j])?e:(0,s.jsx)(eX.A,{children:(0,s.jsx)(eQ,{serverUuid:x.uuid,slotProps:{preview:{onClick:()=>{let e=(0,e$.A)(t,"view","vnc");t.replace({query:e},void 0,{shallow:!0})}}}})})]})}},27341:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,h:()=>o});var s=r(50174),i=r(54773),n=r(29296),l=r(34637),a=r(90890);let o={draggable:"".concat("DragDataGrid","-draggable")},d=(0,i.Ay)(n.z)({color:a.Qu,[".".concat(l.x.columnHeader)]:{"&:focus":{outline:"none"}},[".".concat(l.x.columnHeaders)]:{[".".concat(l.x["row--borderBottom"])]:{backgroundColor:"inherit"}},["& .".concat(s.A.root)]:{color:"inherit"},["& .".concat(l.x.cell)]:{"&:focus":{outline:"none"},"&:focus-within":{outline:"none"}},["& .".concat(l.x.row)]:{["&.".concat(o.draggable,":hover")]:{cursor:"grab",["& .".concat(l.x.cell," p")]:{cursor:"auto"}}}})},40663:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var s=r(37876),i=r(35656),n=r(57212),l=r(54773),a=r(14232),o=r(90890),d=r(46316),c=r(51677);let u=(0,l.Ay)(i.A)({height:"3.5em",marginLeft:0,width:"100%"}),h=e=>{let{baseInputProps:t,checked:r,formControlLabelProps:i,id:l,label:h,name:m,onChange:x,switchProps:j}=e,v=(0,a.useMemo)(()=>(0,d.A)(h,c.a3,{color:"".concat(o.Qu,"AF"),inheritColour:!0}),[h]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u,{control:(0,s.jsx)(n.A,{checked:r,edge:"end",name:m,onChange:x,...j}),label:v,labelPlacement:"start",slotProps:{typography:{flexGrow:1}},...i}),(0,s.jsx)("input",{checked:r,hidden:!0,id:l,readOnly:!0,type:"checkbox",...t})]})}},52627:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var s=r(37876),i=r(12981),n=r(63009),l=r(12572),a=r(40123),o=r.n(a),d=r(96043),c=r(48440),u=r(31465),h=r(51677);let m=e=>null==e||"number"==typeof e&&!Number.isFinite(e)||"string"==typeof e&&0===e.trim().length,x=e=>{let{entry:t}=e;return(0,s.jsx)(h.NA,{whiteSpace:"nowrap",children:String(t)})},j=e=>{let{entry:t,key:r}=e;return d.sX.test(r)?(0,s.jsx)(h.EN,{wrapper:"mono",children:String(t)}):x(e)},v=e=>{let{entry:t,hasPassword:r}=e;return m(t)?(0,s.jsx)(h.a3,{children:"none"}):r?j(e):x(e)},g=e=>{let{depth:t,entry:r,getLabel:n,hasPassword:l,key:a,nest:o,renderValue:d}=e;return(0,s.jsxs)(u.A,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,s.jsx)(h.a3,{children:n({cap:c.A,depth:t,entry:r,hasPassword:l,key:a})}),(0,s.jsx)(i.A,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!o&&d(v,{depth:t,entry:r,hasPassword:l,key:a})})]})},A=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},p=e=>null!==e&&"object"==typeof e&&!o()(e),f=e=>{let{depth:t=0,entries:r,getEntryLabel:i,getListProps:a,getListItemProps:o,hasPassword:d,listKey:c,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:x}=e,j=[];Object.entries(r).forEach(e=>{let[r,n]=e,a="form-summary-entry-".concat(r),c=p(n),v=c?null:n,g={depth:t,entry:v,hasPassword:d,key:r};x(A,g)||j.push((0,s.jsx)(l.Ay,{sx:{paddingLeft:"".concat(t,"em")},...null==o?void 0:o.call(null,g),children:h({depth:t,entry:v,getLabel:i,hasPassword:d,key:r,nest:c,renderValue:m})},a)),c&&t<u&&j.push(f({depth:t+1,entries:n,getEntryLabel:i,hasPassword:d,listKey:r,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:x}))});let v="form-summary-list-".concat(null!=c?c:"root");return(0,s.jsx)(n.A,{dense:!0,disablePadding:!0,...null==a?void 0:a.call(null,{depth:t,entries:r,key:c}),children:j},v)},b=e=>{let{entries:t,getEntryLabel:r=e=>{let{cap:t,key:r}=e;return t(r)},getListProps:s,getListItemProps:i,hasPassword:n=!1,maxDepth:l=3,renderEntry:a=g,renderEntryValue:o=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e(...r)},skip:d=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e(...r)}}=e;return f({entries:t,getEntryLabel:r,getListProps:s,getListItemProps:i,hasPassword:n,maxDepth:l,renderEntry:a,renderEntryValue:o,skip:d})}},57890:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(99955);let i=(e,t,r)=>{let i;if(!e||!t.isReady)return;let{name:n,uuid:l}=t.query;return n?i=Object.values(e).find(r((0,s.A)(n))):l&&(i=e[(0,s.A)(l)]),i}},65832:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var s=r(37876),i=r(17138),n=r(38214),l=r(54773),a=r(14232),o=r(90890),d=r(51677);let c=(0,l.Ay)(i.A)({borderRadius:o.ax,color:o.Qu,padding:".4em .8em",textTransform:"none",["&.".concat(n.A.selected)]:{color:o.ft}}),u=e=>{let{label:t,...r}=e,i=(0,a.useMemo)(()=>"string"==typeof t?(0,s.jsx)(d.a3,{inheritColour:!0,children:t}):t,[t]);return(0,s.jsx)(c,{label:i,...r})}},75629:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var s=r(37876),i=r(64410),n=r(14232),l=r(5755),a=r(37422),o=r(79982),d=r(46316),c=r(51677),u=r(59664);let h=e=>{let{commands:t,getLabel:r,names:h,progress:m,uuids:x}=e,j=(0,n.useMemo)(()=>{let e=new URLSearchParams;return h&&h.forEach(t=>{e.append("name",t)}),t&&t.forEach(t=>{e.append("command",t)}),e.toString()},[t,h]),{altData:v,loading:g}=(0,u.A)("/job?".concat(j),{mod:e=>{let t,r=(t=x?x.reduce((t,r)=>{let{[r]:s}=e;return s&&t.push(s),t},[]):Object.values(e)).reduce((e,t)=>e+t.progress,0);return m.set(r/t.length),t},refreshInterval:3e3}),A=(0,n.useMemo)(()=>(0,d.A)(null==r?void 0:r.call(null,m.value),c.a3),[r,m.value]);return g?(0,s.jsx)(o.A,{mt:0}):v?v.length?(0,s.jsxs)(i.Ay,{alignItems:"center",columnSpacing:"0.5em",container:!0,children:[...v.map(e=>(0,s.jsx)(i.Ay,{item:!0,children:(0,s.jsx)(a.A,{error:!!e.error.count,slotProps:{pie:{size:"1em"}},value:e.progress})},"".concat(e.uuid,"-progress"))),(0,s.jsx)(i.Ay,{item:!0,xs:!0,children:A})]}):null:(0,s.jsx)(l.A,{type:"warning",children:"Failed to get jobs."})}},87986:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(37876),i=r(64410);let n=e=>{let{children:t}=e;return(0,s.jsxs)(i.Ay,{columns:{lg:8,xs:1},container:!0,children:[(0,s.jsx)(i.Ay,{item:!0,xs:1}),(0,s.jsx)(i.Ay,{item:!0,lg:6,xs:1,children:t}),(0,s.jsx)(i.Ay,{item:!0,xs:1})]})}},98927:(e,t,r)=>{"use strict";r.d(t,{A:()=>x});var s=r(37876),i=r(38214),n=r(58619),l=r(37892),a=r(48061),o=r(30566),d=r(54773),c=r(14232),u=r(90890);let h="1.8em",m=(0,d.Ay)(n.A)({minHeight:"1em",["&.".concat(l.A.vertical)]:{minHeight:h,["& .".concat(i.A.root)]:{alignItems:"flex-start",minHeight:h,paddingLeft:"2em"},["& .".concat(l.A.indicator)]:{right:"initial"}},["& .".concat(i.A.root)]:{minHeight:"1em"},["& .".concat(l.A.indicator)]:{backgroundColor:u.ft,borderRadius:u.ax}}),x=e=>{let{orientation:t,variant:r="fullWidth",...i}=e,n=(0,o.A)(),l=(0,c.useCallback)(e=>n.breakpoints.up(e),[n]),d=(0,a.A)(l("xs")),u=(0,a.A)(l("sm")),h=(0,a.A)(l("md")),x=(0,a.A)(l("lg")),j=(0,a.A)(l("xl")),v=(0,c.useMemo)(()=>[["xs",d],["sm",u],["md",h],["lg",x],["xl",j]],[x,h,u,j,d]),g=(0,c.useMemo)(()=>{let e;return"object"==typeof t?v.some(r=>{let[s,i]=r;return i&&t[s]&&(e=t[s]),!i}):e=t,e},[v,t]);return(0,s.jsx)(m,{orientation:g,variant:r,...i})}},99955:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=function(e){let{fallbackValue:t="",joinSeparator:r="",limit:s=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Array?e.slice(0,s).join(r):null!=e?e:t}}},e=>{var t=t=>e(e.s=t);e.O(0,[325,208,3,925,623,296,82,192,133,732,223,876,215,636,593,792],()=>t(15421)),_N_E=e.O()}]);