(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[870],{9982:(e,n,r)=>{"use strict";r.d(n,{A:()=>w});var t=r(14232),i=r(69241),a=r(19770),s=r(4697),l=r(97369),o=r(98428),c=r(35268),u=r(66703),d=r(42259),m=r(55818),h=r(77573),x=r(92003),p=r(47951),A=r(45879);function j(e){return(0,A.Ay)("MuiLink",e)}let f=(0,p.A)("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var g=r(47170),y=r(37876);let b={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},v=(0,c.Ay)(x.A,{name:"MuiLink",slot:"Root",overridesResolver:(e,n)=>{let{ownerState:r}=e;return[n.root,n["underline".concat((0,o.A)(r.underline))],"button"===r.component&&n.button]}})((0,d.A)(e=>{let{theme:n}=e;return{variants:[{props:{underline:"none"},style:{textDecoration:"none"}},{props:{underline:"hover"},style:{textDecoration:"none","&:hover":{textDecoration:"underline"}}},{props:{underline:"always"},style:{textDecoration:"underline","&:hover":{textDecorationColor:"inherit"}}},{props:e=>{let{underline:n,ownerState:r}=e;return"always"===n&&"inherit"!==r.color},style:{textDecorationColor:"var(--Link-underlineColor)"}},...Object.entries(n.palette).filter((0,m.A)()).map(e=>{let[r]=e;return{props:{underline:"always",color:r},style:{"--Link-underlineColor":n.vars?"rgba(".concat(n.vars.palette[r].mainChannel," / 0.4)"):(0,a.X4)(n.palette[r].main,.4)}}}),{props:{underline:"always",color:"textPrimary"},style:{"--Link-underlineColor":n.vars?"rgba(".concat(n.vars.palette.text.primaryChannel," / 0.4)"):(0,a.X4)(n.palette.text.primary,.4)}},{props:{underline:"always",color:"textSecondary"},style:{"--Link-underlineColor":n.vars?"rgba(".concat(n.vars.palette.text.secondaryChannel," / 0.4)"):(0,a.X4)(n.palette.text.secondary,.4)}},{props:{underline:"always",color:"textDisabled"},style:{"--Link-underlineColor":(n.vars||n).palette.text.disabled}},{props:{component:"button"},style:{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},["&.".concat(f.focusVisible)]:{outline:"auto"}}}]}})),w=t.forwardRef(function(e,n){let r=(0,h.b)({props:e,name:"MuiLink"}),c=(0,u.A)(),{className:d,color:m="primary",component:x="a",onBlur:p,onFocus:A,TypographyClasses:f,underline:w="always",variant:k="inherit",sx:C,...N}=r,[P,S]=t.useState(!1),z={...r,color:m,component:x,focusVisible:P,underline:w,variant:k},L=(e=>{let{classes:n,component:r,focusVisible:t,underline:i}=e,a={root:["root","underline".concat((0,o.A)(i)),"button"===r&&"button",t&&"focusVisible"]};return(0,s.A)(a,j,n)})(z);return(0,y.jsx)(v,{color:m,className:(0,i.A)(L.root,d),classes:f,component:x,onBlur:e=>{(0,l.A)(e.target)||S(!1),p&&p(e)},onFocus:e=>{(0,l.A)(e.target)&&S(!0),A&&A(e)},ref:n,ownerState:z,variant:k,...N,sx:[...void 0===b[m]?[{color:m}]:[],...Array.isArray(C)?C:[C]],style:{...N.style,..."always"===w&&"inherit"!==m&&!b[m]&&{"--Link-underlineColor":(e=>{let{theme:n,ownerState:r}=e,t=r.color,i=(0,g.Yn)(n,"palette.".concat(t,".main"),!1)||(0,g.Yn)(n,"palette.".concat(t),!1)||r.color,s=(0,g.Yn)(n,"palette.".concat(t,".mainChannel"))||(0,g.Yn)(n,"palette.".concat(t,"Channel"));return"vars"in n&&s?"rgba(".concat(s," / 0.4)"):(0,a.X4)(i,.4)})({theme:c,ownerState:z})}}})})},61931:(e,n,r)=>{"use strict";r.d(n,{A:()=>l});var t=r(37876),i=r(14232),a=r(89848),s=r(39294);let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initial:{actionProceedText:n="",content:r="",titleText:l="",...o}={}}=e,c=(0,i.useRef)(null),[u,d]=(0,i.useState)({actionProceedText:n,content:r,titleText:l}),m=(0,i.useCallback)(e=>d(n=>{let{loading:r,...t}=n;return{...t,loading:e}}),[]),h=(0,i.useCallback)(e=>{var n,r;return null==c||null==(r=c.current)||null==(n=r.setOpen)?void 0:n.call(r,e)},[]),x=(0,i.useCallback)((e,n)=>{var r,t;null==c||null==(t=c.current)||null==(r=t.setOpen)||r.call(t,!1);let i=/error/i.test(String(e))?"error":"success";a.oR[i](n.children)},[]);return{confirmDialog:(0,i.useMemo)(()=>(0,t.jsx)(s.A,{...o,...u,ref:c}),[u,o]),confirmDialogRef:c,setConfirmDialogLoading:m,setConfirmDialogOpen:h,setConfirmDialogProps:d,finishConfirm:x}}},71495:(e,n,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/init",function(){return r(73497)}])},73497:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>F});var t=r(37876),i=r(4903),a=r(14232),s=r(35755),l=r(11457),o=r(41316),c=r(11910),u=r(48937),d=r(28850),m=r(68872),h=r(74235),x=r(99308),p=r(67820),A=r(69146),j=r(95968),f=r(91408);let g=f.Ik({adminPassword:f.Yj().required(),confirmAdminPassword:f.Yj().oneOf([f.KR("adminPassword")]).required(),domainName:f.Yj().required(),hostName:f.Yj().required(),hostNumber:f.ai().required(),organizationName:f.Yj().required(),organizationPrefix:f.Yj().min(1).max(5).required(),networkInit:x.hJ});var y=r(20795);let b=e=>{let{values:n}=e;return(0,t.jsxs)(o.Ay,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.a3,{children:"Organization name"})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.NA,{children:n.organizationName})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.a3,{children:"Organization prefix"})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.NA,{children:n.organizationPrefix})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.a3,{children:"Striker number"})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.NA,{children:n.hostNumber})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.a3,{children:"Domain name"})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.NA,{children:n.domainName})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.a3,{children:"Host name"})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(y.NA,{children:n.hostName})}),(0,t.jsx)(x.Sf,{...e})]})};var v=r(6759),w=r(88259),k=r(93647);let C=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=e.split(/\s+/).filter(e=>!/^(?:and|of)$/.test(e)).slice(0,n),t="";return r.length>1?t=r.map(e=>e.substring(0,1).toLocaleLowerCase()).join(""):1===r.length&&(t=r[0].substring(0,n).toLocaleLowerCase()),t},N=e=>{let{detail:n,ipRef:r,onSubmitSuccess:i,tools:s}=e,l=(0,a.useRef)(null),f=(0,k.A)({initialValues:(e=>{let n="",r="",t="",i="",a="",s={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"},defaultifn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"}},l="",o="",c="";if(e){({domain:n="",organization:o="",prefix:c=""}=e.variables),r=e.name;let{sequence:u}=e.variables;t=u?String(u):"",{dns:i="",gateway:a="",ntp:l=""}=e.netconf;let{networks:d={}}=e.netconf;s=(0,v.A)(d)}return{adminPassword:"",confirmAdminPassword:"",domainName:n,hostName:r,hostNumber:t,networkInit:{dns:i,gateway:a,networks:s,ntp:l},organizationName:o,organizationPrefix:c}})(n),onSubmit:(e,n)=>{let{setSubmitting:a}=n,o=(0,m.A)(e,l.current);r&&o.networks.forEach(e=>{let{ipAddress:n,sequence:t,type:i}=e;"".concat(i).concat(t)===o.gatewayInterface&&(r.current=n)}),s.confirm.prepare({actionProceedText:"Initialize",content:l.current&&(0,t.jsx)(b,{gatewayIface:o.gatewayInterface,ifaces:l.current,values:e}),onCancelAppend:()=>a(!1),onProceedAppend:()=>{s.confirm.loading(!0),d.A.put("/init",o).then(e=>{null==i||i.call(null,e.data),s.confirm.finish("Success",{children:(0,t.jsx)(t.Fragment,{children:"Successfully registered striker initialization job."})})}).catch(e=>{let n=(0,h.A)(e);n.children=(0,t.jsxs)(t.Fragment,{children:["Failed to register striker initialization job. ",n.children]}),s.confirm.finish("Error",n),a(!1)})},titleText:"Initialize ".concat(e.hostName," with the following?")}),s.confirm.open()},validationSchema:g}),{disabledSubmit:y,formik:N,formikErrors:P,getFieldChanged:S,handleChange:z}=f,L=(0,a.useMemo)(()=>"adminPassword",[]),R=(0,a.useMemo)(()=>"confirmAdminPassword",[]),q=(0,a.useMemo)(()=>"domainName",[]),M=(0,a.useMemo)(()=>"hostName",[]),D=(0,a.useMemo)(()=>"hostNumber",[]),I=(0,a.useMemo)(()=>"organizationName",[]),O=(0,a.useMemo)(()=>"organizationPrefix",[]),T=(0,a.useCallback)(e=>n=>{if(S(M))return;let{target:{value:r}}=n,{values:{domainName:t,hostNumber:i,organizationPrefix:a}}=N;switch(e){case q:t=r;break;case D:i=r;break;case O:a=r}let s=((e,n,r)=>[e,n,r].every(e=>e.length>0)?"".concat(e,"-striker").concat((0,j.A)(n),".").concat(r):"")(a,i,t);N.setFieldValue(M,s)},[q,N,S,M,D,O]);return(0,t.jsxs)(o.Ay,{columns:{xs:1,sm:2,md:3},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),N.handleSubmit(e)},spacing:"1em",children:[(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsxs)(o.Ay,{columns:2,container:!0,spacing:"1em",children:[(0,t.jsx)(o.Ay,{item:!0,width:"100%",children:(0,t.jsx)(w.A,{input:(0,t.jsx)(A.A,{id:I,label:"Organization Name",name:I,onBlur:e=>{if(S(O))return;let{target:{value:n}}=e,r=C(n);N.setFieldValue(O,r)},onChange:z,required:!0,value:N.values.organizationName})})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(w.A,{input:(0,t.jsx)(A.A,{baseInputProps:{maxLength:5},id:O,label:"Prefix",name:O,onBlur:T(O),onChange:z,required:!0,value:N.values.organizationPrefix})})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(w.A,{input:(0,t.jsx)(A.A,{id:D,label:"Striker #",name:D,onBlur:T(D),onChange:z,required:!0,value:N.values.hostNumber})})})]})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsxs)(o.Ay,{columns:1,container:!0,spacing:"1em",children:[(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(w.A,{input:(0,t.jsx)(A.A,{id:q,label:"Domain name",name:q,onBlur:T(q),onChange:z,required:!0,value:N.values.domainName})})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(w.A,{input:(0,t.jsx)(A.A,{disableAutofill:!0,id:M,label:"Host name",name:M,onChange:z,required:!0,value:N.values.hostName})})})]})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,sm:2,md:1,children:(0,t.jsxs)(o.Ay,{columns:{xs:1,sm:2,md:1},container:!0,spacing:"1em",children:[(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(w.A,{input:(0,t.jsx)(A.A,{disableAutofill:!0,id:L,label:"Admin password",name:L,onChange:z,required:!0,type:c.A.password,value:N.values.adminPassword})})}),(0,t.jsx)(o.Ay,{item:!0,xs:1,children:(0,t.jsx)(w.A,{input:(0,t.jsx)(A.A,{disableAutofill:!0,id:R,label:"Confirm admin password",name:R,onChange:z,required:!0,type:c.A.password,value:N.values.confirmAdminPassword})})})]})}),(0,t.jsx)(o.Ay,{item:!0,width:"100%",children:(0,t.jsx)(x.VT,{formikUtils:f,host:{parentSequence:NaN,sequence:Number(N.values.hostNumber),type:"striker",uuid:"local"},onFetchSuccess:e=>{l.current=e}})}),(0,t.jsx)(o.Ay,{item:!0,width:"100%",children:(0,t.jsx)(p.A,{count:1,messages:P})}),(0,t.jsx)(o.Ay,{item:!0,width:"100%",children:(0,t.jsx)(u.A,{actions:[{background:"blue",children:"Initialize",disabled:y,type:"submit"}]})})]})};var P=r(89099),S=r(98496),z=r(34318),L=r(56014),R=r(7525),q=r(79692),M=r(61931),D=r(30827),I=r(13886),O=r(20525);let T=e=>{let{children:n}=e;return(0,t.jsx)(s.Zk,{sx:{marginLeft:{xs:"1em",sm:"auto"},marginRight:{xs:"1em",sm:"auto"},marginTop:"calc(50vh - 30vh - 6em)",width:{xs:void 0,sm:"90vw",md:"80vw",lg:"70vw",xl:"60vw"}},children:n})},Y=e=>{let{ipRef:n,jobUuid:r,reinit:i}=e,c=(0,P.useRouter)(),u=(0,a.useRef)(0),d=(0,a.useRef)(null),m=(0,M.A)(),h=(0,a.useMemo)(()=>{let e="login",r="/login";return i&&(e="striker config",r="/config"),(null==n?void 0:n.current)&&(e+=" (at ".concat(n.current,")")),{label:e,path:r}},[n,i]),x=(0,O.A)({follow:!0}),{data:p}=(0,D.A)("/init/job/".concat(r),{onError:()=>{u.current+=1,(null==n?void 0:n.current)&&u.current>2&&(m.setConfirmDialogProps({actionProceedText:"Try to redirect",actionCancelText:"Change URL manually",content:(0,t.jsxs)(z.A,{children:[(0,t.jsx)(y.a3,{children:"Lost connection to the striker, which will happen if you changed its IFN IP address."}),(0,t.jsx)(y.a3,{children:"You can try the auto-redirect option, which will fail if you're taking additional steps in connecting, i.e., port fowarding. Otherwise, please manually change the URL in your browser accordingly."})]}),onProceedAppend:()=>{m.setConfirmDialogLoading(!0),c.replace("http://".concat(n.current).concat(h.path))},titleText:"Lost connection, try redirecting to ".concat(h.label,"?")}),m.setConfirmDialogOpen(!0))},onSuccess:e=>{u.current=0;let{progress:n}=e;null===d.current&&100===n&&(d.current=setTimeout(e=>{c.replace(e)},3e3,h.path))},refreshInterval:2e3}),A=(0,I.A)(null==p?void 0:p.status);return p?(0,t.jsxs)(T,{children:[(0,t.jsxs)(o.Ay,{columns:1,container:!0,rowGap:".6em",children:[(0,t.jsx)(o.Ay,{item:!0,width:"100%",children:(0,t.jsxs)(y.a3,{children:["You will be auto redirected to ",h.label," after initialization completes. If not, you can manually access"," ",(0,t.jsx)(L.A,{display:"inline-flex",href:h.path,children:h.label})," ","after completion."]})}),(0,t.jsx)(o.Ay,{item:!0,width:"100%",children:(0,t.jsx)(S.z2,{progressPercentage:p.progress})}),(0,t.jsx)(o.Ay,{item:!0,width:"100%",children:(0,t.jsxs)(s.t$,{mb:0,mt:0,children:[(0,t.jsx)(s.WJ,{children:(0,t.jsx)(y.a3,{children:"Status"})}),(0,t.jsx)(s.BF,{children:(0,t.jsx)(q.A,{height:"60vh",lineHeight:"2",ref:x.callbackRef,children:(0,t.jsx)(R.A,{children:A.string})},"status")})]})})]}),m.confirmDialog]}):(0,t.jsx)(T,{children:(0,t.jsx)(l.A,{mt:0})})},_=()=>{let e=(0,a.useRef)(""),[n,r]=(0,a.useState)(),{confirmDialog:i,finishConfirm:o,setConfirmDialogLoading:c,setConfirmDialogOpen:u,setConfirmDialogProps:d}=(0,M.A)({initial:{scrollContent:!0,wide:!0}}),m=(0,a.useMemo)(()=>({add:{open:()=>null},confirm:{finish:o,loading:c,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return u(e)},prepare:d},edit:{open:()=>null}}),[o,c,u,d]),{data:h,loading:x}=(0,D.A)("/host/local");return x?(0,t.jsx)(s.Zk,{children:(0,t.jsx)(l.A,{})}):n?(0,t.jsx)(Y,{ipRef:e,jobUuid:n,reinit:!!h}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.Zk,{children:[(0,t.jsx)(s.aO,{children:(0,t.jsxs)(y.HM,{children:[h?"Rei":"I","nitialize striker"]})}),(0,t.jsx)(N,{detail:h,ipRef:e,onSubmitSuccess:e=>{r(e.jobUuid)},tools:m})]}),i]})},F=()=>(0,t.jsx)(i.A,{children:(0,t.jsx)(_,{})})}},e=>{e.O(0,[347,766,107,422,238,847,337,466,960,636,593,792],()=>e(e.s=71495)),_N_E=e.O()}]);