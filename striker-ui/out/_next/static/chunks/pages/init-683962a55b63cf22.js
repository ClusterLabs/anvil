(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[464],{45844:function(e,i,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/init",function(){return n(80449)}])},80449:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return T}});var s=n(85893),r=n(92214),t=n(67294),a=n(65375),l=n(90209),o=n(8506),c=n(46315),d=n(42050),u=n(66389),m=n(66859),x=n(11100),h=n(19306),j=n(18050),Z=n(23852),f=n(98717),g=n(16310);let p=g.Ry({adminPassword:g.Z_().required(),confirmAdminPassword:g.Z_().oneOf([g.iH("adminPassword")]).required(),domainName:g.Z_().required(),hostName:g.Z_().required(),hostNumber:g.Rx().required(),organizationName:g.Z_().required(),organizationPrefix:g.Z_().min(1).max(5).required(),networkInit:h.PC});var P=n(57882),b=e=>{let{values:i}=e;return(0,s.jsxs)(o.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Organization name"})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.$_,{children:i.organizationName})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Organization prefix"})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.$_,{children:i.organizationPrefix})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Striker number"})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.$_,{children:i.hostNumber})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Domain name"})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.$_,{children:i.domainName})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.Ac,{children:"Host name"})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(P.$_,{children:i.hostName})}),(0,s.jsx)(h.e2,{...e})]})},w=n(93666),v=n(12823),N=n(22582);let _=e=>{let i="",n="",s="",r="",t="",a={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"},defaultifn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"}},l="",o="";if(e){({dns:r="",domain:i="",gateway:t="",hostName:n="",sequence:s="",organization:l="",prefix:o=""}=e);let{networks:c={}}=e;a=(0,w.Z)(c)}return{adminPassword:"",confirmAdminPassword:"",domainName:i,hostName:n,hostNumber:s,networkInit:{dns:r,gateway:t,networks:a},organizationName:l,organizationPrefix:o}},k=(e,i,n)=>[e,i,n].every(e=>e.length>0)?"".concat(e,"-striker").concat((0,f.Z)(i),".").concat(n):"",z=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=e.split(/\s+/).filter(e=>!/^(?:and|of)$/.test(e)).slice(0,i),s="";return n.length>1?s=n.map(e=>e.substring(0,1).toLocaleLowerCase()).join(""):1===n.length&&(s=n[0].substring(0,i).toLocaleLowerCase()),s};var q=e=>{let{detail:i,onSubmitSuccess:n,tools:r}=e,a=(0,t.useRef)(null),l=(0,N.Z)({initialValues:_(i),onSubmit:(e,i)=>{let{setSubmitting:t}=i,l=(0,m.Z)(e,a.current);r.confirm.prepare({actionProceedText:"Initialize",content:a.current&&(0,s.jsx)(b,{gatewayIface:l.gatewayInterface,ifaces:a.current,values:e}),onCancelAppend:()=>t(!1),onProceedAppend:()=>{r.confirm.loading(!0),u.Z.put("/init",l).then(e=>{null==n||n.call(null,e.data),r.confirm.finish("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered striker initialization job."})})}).catch(e=>{let i=(0,x.Z)(e);i.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register striker initialization job. ",i.children]}),r.confirm.finish("Error",i),t(!1)})},titleText:"Initialize ".concat(e.hostName," with the following?")}),r.confirm.open()},validationSchema:p}),{disabledSubmit:f,formik:g,formikErrors:P,getFieldChanged:w,handleChange:q}=l,A=(0,t.useMemo)(()=>"adminPassword",[]),C=(0,t.useMemo)(()=>"confirmAdminPassword",[]),S=(0,t.useMemo)(()=>"domainName",[]),y=(0,t.useMemo)(()=>"hostName",[]),I=(0,t.useMemo)(()=>"hostNumber",[]),M=(0,t.useMemo)(()=>"organizationName",[]),F=(0,t.useMemo)(()=>"organizationPrefix",[]),L=(0,t.useCallback)(e=>i=>{if(w(y))return;let{target:{value:n}}=i,{values:{domainName:s,hostNumber:r,organizationPrefix:t}}=g;switch(e){case S:s=n;break;case I:r=n;break;case F:t=n}let a=k(t,r,s);g.setFieldValue(y,a)},[S,g,w,y,I,F]);return(0,s.jsxs)(o.ZP,{columns:{xs:1,sm:2,md:3},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),g.handleSubmit(e)},spacing:"1em",children:[(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsxs)(o.ZP,{columns:2,container:!0,spacing:"1em",children:[(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(v.Z,{input:(0,s.jsx)(Z.Z,{id:M,label:"Organization Name",name:M,onBlur:e=>{if(w(F))return;let{target:{value:i}}=e,n=z(i);g.setFieldValue(F,n)},onChange:q,required:!0,value:g.values.organizationName})})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Z,{input:(0,s.jsx)(Z.Z,{baseInputProps:{maxLength:5},id:F,label:"Prefix",name:F,onBlur:L(F),onChange:q,required:!0,value:g.values.organizationPrefix})})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Z,{input:(0,s.jsx)(Z.Z,{id:I,label:"Striker #",name:I,onBlur:L(I),onChange:q,required:!0,value:g.values.hostNumber})})})]})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsxs)(o.ZP,{columns:1,container:!0,spacing:"1em",children:[(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Z,{input:(0,s.jsx)(Z.Z,{id:S,label:"Domain name",name:S,onBlur:L(S),onChange:q,required:!0,value:g.values.domainName})})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Z,{input:(0,s.jsx)(Z.Z,{disableAutofill:!0,id:y,label:"Host name",name:y,onChange:q,required:!0,value:g.values.hostName})})})]})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,sm:2,md:1,children:(0,s.jsxs)(o.ZP,{columns:{xs:1,sm:2,md:1},container:!0,spacing:"1em",children:[(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Z,{input:(0,s.jsx)(Z.Z,{disableAutofill:!0,id:A,label:"Admin password",name:A,onChange:q,required:!0,type:c.Z.password,value:g.values.adminPassword})})}),(0,s.jsx)(o.ZP,{item:!0,xs:1,children:(0,s.jsx)(v.Z,{input:(0,s.jsx)(Z.Z,{disableAutofill:!0,id:C,label:"Confirm admin password",name:C,onChange:q,required:!0,type:c.Z.password,value:g.values.confirmAdminPassword})})})]})}),(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(h.rQ,{formikUtils:l,host:{parentSequence:NaN,sequence:Number(g.values.hostNumber),type:"striker",uuid:"local"},onFetchSuccess:e=>{a.current=e}})}),(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{count:1,messages:P})}),(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(d.Z,{actions:[{background:"blue",children:"Initialize",disabled:f,type:"submit"}]})})]})},A=n(64236),C=n(65716),S=n(91469),y=n(28192),I=n(5499),M=n(5048),F=n(1699);let L=e=>{let{children:i}=e;return(0,s.jsx)(a.s_,{sx:{marginLeft:{xs:"1em",sm:"auto"},marginRight:{xs:"1em",sm:"auto"},marginTop:"calc(50vh - 30vh - 6em)",width:{xs:void 0,sm:"90vw",md:"80vw",lg:"70vw",xl:"60vw"}},children:i})};var R=e=>{let{jobUuid:i,reinit:n}=e,r=(0,t.useRef)(null),c=(0,t.useMemo)(()=>{let e="login",i="/login";return n&&(e="striker config",i="/config"),{label:e,path:i}},[n]),d=(0,F.Z)({follow:!0}),{data:u}=(0,I.Z)("/init/job/".concat(i),{onSuccess:e=>{let{progress:i}=e;null===r.current&&100===i&&(r.current=setTimeout(e=>{window.location.replace(e)},3e3,c.path))},refreshInterval:2e3}),m=(0,M.Z)(null==u?void 0:u.status);return u?(0,s.jsx)(L,{children:(0,s.jsxs)(o.ZP,{columns:1,container:!0,rowGap:".6em",children:[(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsxs)(P.Ac,{children:["You will be auto redirected to ",c.label," after initialization completes. If not, you can manually access"," ",(0,s.jsx)(C.Z,{display:"inline-flex",href:c.path,children:c.label})," ","after completion."]})}),(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsx)(A.ko,{progressPercentage:u.progress})}),(0,s.jsx)(o.ZP,{item:!0,width:"100%",children:(0,s.jsxs)(a.Lg,{mb:0,mt:0,children:[(0,s.jsx)(a.CH,{children:(0,s.jsx)(P.Ac,{children:"Status"})}),(0,s.jsx)(a.bc,{children:(0,s.jsx)(y.Z,{height:"60vh",lineHeight:"2",ref:d.callbackRef,children:(0,s.jsx)(S.Z,{children:m.string})},"status")})]})})]})}):(0,s.jsx)(L,{children:(0,s.jsx)(l.Z,{mt:0})})},E=n(40657),O=()=>{let[e,i]=(0,t.useState)(),{confirmDialog:n,finishConfirm:r,setConfirmDialogLoading:o,setConfirmDialogOpen:c,setConfirmDialogProps:d}=(0,E.Z)({initial:{scrollContent:!0,wide:!0}}),u=(0,t.useMemo)(()=>({add:{open:()=>null},confirm:{finish:r,loading:o,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return c(e)},prepare:d},edit:{open:()=>null}}),[r,o,c,d]),{data:m,loading:x}=(0,I.Z)("/host/local");return x?(0,s.jsx)(a.s_,{children:(0,s.jsx)(l.Z,{})}):e?(0,s.jsx)(R,{jobUuid:e,reinit:!!m}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a.s_,{children:[(0,s.jsx)(a.V9,{children:(0,s.jsxs)(P.z,{children:[m?"Rei":"I","nitialize striker"]})}),(0,s.jsx)(q,{detail:m,onSubmitSuccess:e=>{i(e.jobUuid)},tools:u})]}),n]})},T=()=>(0,s.jsx)(r.Z,{children:(0,s.jsx)(O,{})})}},function(e){e.O(0,[537,711,245,548,48,975,215,590,340,888,774,179],function(){return e(e.s=45844)}),_N_E=e.O()}]);