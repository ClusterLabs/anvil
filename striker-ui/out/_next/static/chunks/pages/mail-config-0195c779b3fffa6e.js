(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[249],{24084:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mail-config",function(){return t(95954)}])},48801:function(e,n,t){"use strict";var r=t(85893),l=t(21640),i=t(93454),a=t(77527),s=t(4989),o=t(1142),u=t(58219),d=t(35562),c=t(90642),m=t(96245),h=t(82492),p=t.n(h),g=t(67294),v=t(39971),x=t(17512),f=t(23852);let j=e=>(0,r.jsx)(l.Z,{in:!0,children:(0,r.jsx)(i.Z,{...e})}),Z=(0,a.ZP)("ul")({padding:0}),y=s.Z;n.Z=e=>{let{componentsProps:n,extendRenderInput:t,getGroupLabel:l,label:i,ListboxProps:a,messageBoxProps:s,renderGroup:h,renderInput:b,required:C,sx:A,...w}=e,P=(0,g.useMemo)(()=>p()({paper:{sx:{backgroundColor:v.s7,["& .".concat(o.Z.groupLabel)]:{backgroundColor:v.s7}}}},n),[n]),M=(0,g.useMemo)(()=>p()({sx:{["& .".concat(o.Z.option)]:{'&[aria-selected="true"]':{backgroundColor:v.lD,["&.".concat(o.Z.focused)]:{backgroundColor:v.lD}},["&.".concat(o.Z.focused)]:{backgroundColor:v.lD}}}},a),[a]),O=(0,g.useMemo)(()=>h||l&&(e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(y,{component:"div",className:o.Z.groupLabel,children:l(e.group)}),(0,r.jsx)(Z,{className:o.Z.groupUl,children:e.children})]},e.key)),[l,h]),k=(0,g.useMemo)(()=>null!=b?b:e=>{let{fullWidth:n,InputProps:l,InputLabelProps:a,inputProps:s}=e,o={formControlProps:{fullWidth:n,ref:l.ref},inputLabelProps:a,inputProps:{className:l.className,endAdornment:l.endAdornment,inputProps:s,startAdornment:l.startAdornment,sx:{["& .".concat(u.Z.input)]:{margin:0}}},label:i,required:C};return null==t||t.call(null,o,e),(0,r.jsx)(f.Z,{...o})},[t,i,b,C]),S=(0,g.useMemo)(()=>p()({["& .".concat(u.Z.root," .").concat(o.Z.endAdornment)]:{right:"7px",["& .".concat(d.Z.root)]:{color:v.s7}}},A),[A]);return(0,r.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,r.jsx)(m.Z,{autoHighlight:!0,autoSelect:!0,PaperComponent:j,...w,ListboxProps:M,renderGroup:O,renderInput:k,slotProps:P,sx:S}),(0,r.jsx)(x.Z,{...s})]})}},73846:function(e,n,t){"use strict";var r=t(85893),l=t(67294),i=t(66389),a=t(45036),s=t(11100),o=t(18541),u=t(71108),d=t(81013),c=t(40657),m=t(5499);let h=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return"function"==typeof e?e(...t):e};n.Z=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[p]=n,{addHeader:g,editHeader:v,entriesUrl:x,formDialogProps:f,getAddLoading:j,getDeleteErrorMessage:Z,getDeleteHeader:y,getDeletePromiseChain:b=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return e(...t)},getDeleteSuccessMessage:C,getEditLoading:A=e=>e,listEmpty:w,listProps:P,onItemClick:M=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return e(...t)},onValidateEntriesChange:O,refreshInterval:k=5e3,renderAddForm:S,renderDeleteItem:F,renderEditForm:I,renderListItem:D,entryUrlPrefix:V=x}=p,E=(0,l.useRef)(null),_=(0,l.useRef)(null),{confirmDialog:U,finishConfirm:N,setConfirmDialogLoading:q,setConfirmDialogOpen:R,setConfirmDialogProps:T}=(0,c.Z)({initial:{scrollContent:!0}}),[L,H]=(0,l.useState)(!1),[W,K]=(0,l.useState)(),{data:J,mutate:X,loading:z,validating:G}=(0,m.Z)(x,{refreshInterval:k}),{fetch:B,loading:$}=(0,u.Z)({onData:e=>K(e),url:V});(0,l.useEffect)(()=>{null==O||O.call(null,G)},[O,G]);let Q=(0,l.useMemo)(()=>h(g),[g]),Y=(0,l.useMemo)(()=>h(v,W),[W,v]),ee=(0,l.useMemo)(()=>({add:{open:function(){var e;let n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==E?void 0:null===(e=E.current)||void 0===e?void 0:e.setOpen(n)}},confirm:{finish:N,loading:q,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return R(e)},prepare:T},edit:{open:function(){var e;let n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==_?void 0:null===(e=_.current)||void 0===e?void 0:e.setOpen(n)}}}),[N,q,R,T]),{buildDeleteDialogProps:en,checks:et,getCheck:er,hasAllChecks:el,hasChecks:ei,multipleItems:ea,resetChecks:es,setAllChecks:eo,setCheck:eu}=(0,d.Z)({list:J});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{allowCheckAll:ea,allowEdit:!0,allowItemButton:L,disableDelete:!ei,edit:L,getListCheckboxProps:()=>({checked:el,onChange:(e,n)=>eo(n)}),getListItemCheckboxProps:e=>({checked:er(e),onChange:(n,t)=>eu(e,t)}),header:!0,listEmpty:w,listItems:J,loading:z,onAdd:()=>{var e;return null==E?void 0:null===(e=E.current)||void 0===e?void 0:e.setOpen(!0)},onDelete:()=>{T(en({onProceedAppend:()=>{q(!0),Promise.all(b((e,n)=>e.map(e=>i.Z.delete("".concat(n,"/").concat(e))),et,x)).then(()=>{N("Success",C()),X()}).catch(e=>{N("Error",Z((0,s.Z)(e)))}).finally(()=>{es()})},getConfirmDialogTitle:y,renderEntry:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return F(J,...n)}})),R(!0)},onEdit:()=>H(e=>!e),onItemClick:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return M((e,n)=>{var t;null==_||null===(t=_.current)||void 0===t||t.setOpen(!0),B("/".concat(n))},...n)},renderListItem:D,...P}),(0,r.jsx)(a.Js,{header:Q,loading:null==j?void 0:j.call(null),ref:E,showClose:!0,...null==f?void 0:f.common,...null==f?void 0:f.add,children:S(ee)}),(0,r.jsx)(a.Js,{header:Y,loading:A($),ref:_,showClose:!0,...null==f?void 0:f.common,...null==f?void 0:f.edit,children:I(ee,W)}),U]})}},76740:function(e,n,t){"use strict";var r=t(85893),l=t(90642),i=t(19304),a=t(47407),s=t(35338),o=t(44400),u=t(5387),d=t(57882);let c=e=>{let{entry:n}=e;return(0,r.jsx)(d.$_,{whiteSpace:"nowrap",children:String(n)})},m=e=>{let{entry:n,key:t}=e;return s.JW.test(t)?(0,r.jsx)(d.PJ,{wrapper:"mono",children:String(n)}):c(e)},h=e=>{let{entry:n,hasPassword:t}=e;return["",null,void 0].some(e=>n===e)||Number.isNaN(n)?(0,r.jsx)(d.Ac,{children:"none"}):t?m(e):c(e)},p=e=>{let{depth:n,entry:t,getLabel:i,hasPassword:a,key:s,nest:c,renderValue:m}=e;return(0,r.jsxs)(u.Z,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,r.jsx)(d.Ac,{children:i({cap:o.Z,depth:n,entry:t,hasPassword:a,key:s})}),(0,r.jsx)(l.Z,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!c&&m(h,{depth:n,entry:t,hasPassword:a,key:s})})]})},g=e=>{let{key:n}=e;return/confirm|uuid/i.test(n)},v=e=>{let{depth:n=0,entries:t,getEntryLabel:l,getListProps:s,getListItemProps:o,hasPassword:u,listKey:d,maxDepth:c,renderEntry:m,renderEntryValue:h,skip:p}=e,x=[];Object.entries(t).forEach(e=>{let[t,a]=e,s=null!==a&&"object"==typeof a,d=s?null:a,f={depth:n,entry:d,hasPassword:u,key:t};p(g,f)||x.push((0,r.jsx)(i.ZP,{sx:{paddingLeft:"".concat(n,"em")},...null==o?void 0:o.call(null,f),children:m({depth:n,entry:d,getLabel:l,hasPassword:u,key:t,nest:s,renderValue:h})},"form-summary-entry-".concat(t))),s&&n<c&&x.push(v({depth:n+1,entries:a,getEntryLabel:l,hasPassword:u,listKey:t,maxDepth:c,renderEntry:m,renderEntryValue:h,skip:p}))});let f="form-summary-list-".concat(null!=d?d:"root");return(0,r.jsx)(a.Z,{dense:!0,disablePadding:!0,...null==s?void 0:s.call(null,{depth:n,entries:t,key:d}),children:x},f)};n.Z=e=>{let{entries:n,getEntryLabel:t=e=>{let{cap:n,key:t}=e;return n(t)},getListProps:r,getListItemProps:l,hasPassword:i=!1,maxDepth:a=3,renderEntry:s=p,renderEntryValue:o=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return e(...t)},skip:u=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return e(...t)}}=e;return v({entries:n,getEntryLabel:t,getListProps:r,getListItemProps:l,hasPassword:i,maxDepth:a,renderEntry:s,renderEntryValue:o,skip:u})}},71108:function(e,n,t){"use strict";var r=t(67294),l=t(66389),i=t(11100);n.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{config:n,onError:t,onData:a,url:s=""}=e,[o,u]=(0,r.useState)(!1);return{fetch:(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,o="".concat(s).concat(e);o&&(u(!0),l.Z.get(o,{...n,...r}).then(e=>{let{data:n}=e;null==a||a.call(null,n)}).catch(e=>{let n=(0,i.Z)(e);null==t||t.call(null,n)}).finally(()=>{u(!1)}))},[s,n,a,t]),loading:o}}},81013:function(e,n,t){"use strict";var r=t(85893),l=t(67294),i=t(95996),a=t(76740);n.Z=e=>{let{list:n={}}=e,[t,s]=(0,l.useState)({}),o=(0,l.useMemo)(()=>Object.keys(n),[n]),u=(0,l.useMemo)(()=>Object.keys(t),[t]),d=(0,l.useMemo)(()=>u.length===o.length,[u.length,o.length]),c=(0,l.useMemo)(()=>u.length>0,[u.length]),m=(0,l.useMemo)(()=>o.length>1,[o.length]),h=(0,l.useCallback)(e=>{let{confirmDialogProps:n={},formSummaryProps:l={},getConfirmDialogTitle:i,onProceedAppend:s,renderEntry:o}=e;return{actionProceedText:"Delete",content:(0,r.jsx)(a.Z,{entries:t,maxDepth:0,renderEntry:o,...l}),onProceedAppend:s,proceedColour:"red",titleText:i(u.length),...n}},[t,u.length]),p=(0,l.useCallback)(e=>!!t[e],[t]);return{buildDeleteDialogProps:h,checklist:t,checks:u,getCheck:p,hasAllChecks:d,hasChecks:c,multipleItems:m,resetChecks:(0,l.useCallback)(()=>s({}),[]),setAllChecks:(0,l.useCallback)(e=>s(o.reduce((n,t)=>(e&&(n[t]=e),n),{})),[o]),setCheck:(0,l.useCallback)((e,n)=>s((0,i.ZP)(e,n||void 0)),[])}}},40657:function(e,n,t){"use strict";var r=t(85893),l=t(67294),i=t(47177),a=t(29873);n.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initial:{actionProceedText:n="",content:t="",titleText:s="",...o}={}}=e,u=(0,l.useRef)(null),[d,c]=(0,l.useState)({actionProceedText:n,content:t,titleText:s}),m=(0,l.useCallback)(e=>c(n=>{let{loading:t,...r}=n;return{...r,loading:e}}),[]),h=(0,l.useCallback)(e=>{var n,t;return null==u?void 0:null===(t=u.current)||void 0===t?void 0:null===(n=t.setOpen)||void 0===n?void 0:n.call(null,e)},[]),p=(0,l.useCallback)((e,n)=>c({actionProceedText:"",content:(0,r.jsx)(a.Z,{...n}),showActionArea:!1,showClose:!0,titleText:e}),[]);return{confirmDialog:(0,l.useMemo)(()=>(0,r.jsx)(i.Z,{...o,...d,ref:u}),[d,o]),confirmDialogRef:u,setConfirmDialogLoading:m,setConfirmDialogOpen:h,setConfirmDialogProps:c,finishConfirm:p}}},2094:function(e,n,t){"use strict";t.d(n,{Z:function(){return x}});var r=t(20512),l=t(18446),i=t.n(l),a=t(13218),s=t.n(a),o=t(47037),u=t.n(o),d=t(67294),c=t(16310),m=t(23279),h=t.n(m),p=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{wait:t=500,...r}=n;return h()(e,t,r)},g=t(46671);let v=(e,n,t)=>{let[r,...l]=u()(n)?n.split("."):n;if(!(r in e))return!1;let a=e[r],o=t[r];return s()(a)&&s()(o)&&l.length?v(a,l,o):!i()(a,o)};var x=e=>{let n=(0,d.useRef)({}),t=(0,d.useCallback)(e=>(0,r.u9)(n.current,e),[]),l=(0,d.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.current=(0,r.tP)(n.current,e,t)},[]),[i,a]=(0,d.useState)(!1),s=(0,r.TA)({...e}),o=(0,d.useCallback)(async function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[r]=n;l(r,!0),await s.setFieldValue(...n)},[s.setFieldValue,l]),m=(0,d.useCallback)(e=>v(s.values,e,s.initialValues),[s.initialValues,s.values]),h=(0,d.useMemo)(()=>{let e=p(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];s.handleChange(...n),a(!1)});return function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];a(!0);let[i]=t;u()(i)||l((i.target?i.target:i.currentTarget).name,!0),e(...t)}},[s.handleChange,l]),x=(0,d.useMemo)(()=>i||!s.dirty||!s.isValid||s.isValidating||s.isSubmitting,[i,s.dirty,s.isSubmitting,s.isValid,s.isValidating]),f=(0,d.useMemo)(()=>(0,g.Z)(s.errors,{skip:e=>!t(e)}),[s.errors,t]);return{changeFieldValue:o,disabledSubmit:x,formik:s,formikErrors:f,getFieldChanged:t,getFieldIsDiff:m,handleChange:h,setFieldChanged:l,validationSchemaHelpers:(0,d.useMemo)(()=>{if(!c.nN(e.validationSchema))return;let n=e.validationSchema.describe();return{description:n,required:e=>{if(!("fields"in n))return;let t=n.fields[e];if(t&&"optional"in t)return!t.optional}}},[e.validationSchema])}}},39806:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var r=e=>e.reduce((e,n)=>{let{hostName:t,hostType:r,hostUUID:l,shortHostName:i}=n;return e[l]={name:t,short:i,type:r,uuid:l},e},{}),l=e=>e.reduce((e,n)=>{let{anvilDescription:t,anvilName:l,anvilUUID:i,hosts:a}=n;return e[i]={description:t,hosts:r(a),name:l,uuid:i},e},{})},95996:function(e,n,t){"use strict";t.d(n,{Um:function(){return l}});let r=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[,r,l,i]=n;void 0!==i&&(r[l]=i)},l=function(e,n){let{set:t=r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=>{let l={};return Object.keys(r).forEach(i=>{e.test(i)?t(r,l,i,n):l[i]=r[i]}),l}};n.ZP=function(e,n){let{guard:t=()=>!0,set:l=r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=>{let{[e]:i,...a}=r,s={...a};return t(r,e,n)&&l(r,s,e,n),s}}},95954:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Q}});var r=t(85893),l=t(8506),i=t(9008),a=t.n(i),s=t(25436),o=t(37906),u=t(67294),d=t(25934),c=t(42050),m=t(66389),h=t(5387),p=t(76740),g=t(11100),v=t(16310),x=t(74178),f=t(48313);let j=v.Rx().oneOf([0,1,2,3,4]),Z=v.Ry({delete:v.O7().optional(),level:j.required(),target:v.Ry({type:v.Z_().oneOf(["node","subnode"]).required(),uuid:(0,f.uI)().required()}),uuid:(0,f.uI)().optional()}),y=v.Vo(e=>v.Ry((0,x.Z)(e,Z))),b=v.Ry({alertOverrides:y,email:v.Z_().email().required(),language:v.Z_().oneOf(["en_CA"]).optional(),level:j.required(),name:v.Z_().required(),uuid:(0,f.uI)().optional()}),C=v.Vo(e=>v.Ry((0,x.Z)(e,b)));var A=t(48801),w=t(45328),P=t(37628),M=t(57882),O=t(12823);let k=[{displayValue:"Ignore",value:0},{displayValue:"Critical",value:1},{displayValue:"Warning",value:2},{displayValue:"Notice",value:3},{displayValue:"Info",value:4}];var S=e=>{let{alertOverrideTargetOptions:n,alertOverrideValueId:t,mailRecipientUuid:i,formikUtils:a}=e,s=(0,u.useMemo)(()=>null!=t?t:(0,d.Z)(),[t]),{formik:o}=a,{values:{[i]:c}}=o,{alertOverrides:{[s]:m}}=c,p=(0,u.useMemo)(()=>"".concat(i,".alertOverrides.").concat(s),[s,i]),g=(0,u.useMemo)(()=>"".concat(p,".remove"),[p]),v=(0,u.useMemo)(()=>"".concat(p,".target"),[p]),x=(0,u.useMemo)(()=>"".concat(p,".level"),[p]);return(0,r.jsxs)(l.ZP,{alignItems:"center",columns:{xs:1,sm:10},container:!0,justifyContent:"stretch",spacing:"1em",children:[(0,r.jsx)(l.ZP,{item:!0,xs:6,children:(0,r.jsx)(A.Z,{getOptionLabel:e=>e.name,id:v,isOptionEqualToValue:(e,n)=>e.uuid===n.uuid,label:"Target",noOptionsText:"No node or subnode found.",onChange:(e,n)=>o.setFieldValue(v,n,!0),openOnFocus:!0,options:n,renderOption:(e,n)=>(0,u.createElement)("li",{...e,key:"".concat(n.node,"-").concat(n.uuid)},"node"===n.type?(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(M.Ac,{inheritColour:!0,children:n.name}),(0,r.jsx)(M.KI,{inheritColour:!0,children:n.description})]}):(0,r.jsx)(M.Ac,{inheritColour:!0,paddingLeft:".6em",children:n.name})),value:m.target})}),(0,r.jsx)(l.ZP,{item:!0,flexGrow:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(P.Z,{id:x,label:"Alert level",name:x,onChange:o.handleChange,selectItems:k,value:m.level})})}),(0,r.jsx)(l.ZP,{item:!0,width:"min-content",children:(0,r.jsx)(w.Z,{mapPreset:"delete",onClick:()=>{m.uuids?o.setFieldValue(g,!0,!0):o.setValues(e=>{let n={...e},{[i]:t}=n,{[s]:r,...l}=t.alertOverrides;return t.alertOverrides={...l},n})},size:"small"})})]})},F=t(18541),I=e=>{let{alertOverrideTargetOptions:n,formikUtils:t,mailRecipientUuid:l}=e,{formik:i}=t,{values:{[l]:a}}=i,{alertOverrides:s}=a;return(0,r.jsx)(F.Z,{allowAddItem:!0,edit:!0,header:"Alert override rules",listEmpty:"No alert overrides(s)",listItems:s,onAdd:()=>{let e=(0,d.Z)();i.setValues(n=>{let t={...n},{[l]:r}=t;return r.alertOverrides={...r.alertOverrides,[e]:{level:2,target:null}},t})},renderListItem:(e,i)=>!i.remove&&(0,r.jsx)(S,{alertOverrideTargetOptions:n,alertOverrideValueId:e,formikUtils:t,mailRecipientUuid:l})})},D=t(18050),V=t(23852),E=t(2094);let _=[{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(M.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Critical"}),(0,r.jsx)(M.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that could lead to imminent service interruption or unexpected loss of redundancy."})]}),value:1},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(M.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Warning"}),(0,r.jsx)(M.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that require attention from administrators, such as redundancy loss due to load shedding, hardware in pre-failure, input power loss, temperature anomalies, etc."})]}),value:2},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(M.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Notice"}),(0,r.jsx)(M.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that are generally safe to ignore, but might provide early warnings of developing issues or insight into system behaviour."})]}),value:3},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(M.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Info"}),(0,r.jsx)(M.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that are almost always safe to ignore, but may be useful in testing and debugging."})]}),value:4}],U={1:"Critical",2:"Warning",3:"Notice",4:"Info"},N=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/alert-override",{uuid:r}=e;return r?Object.values(e.alertOverrides).reduce((e,n)=>{let{remove:l,level:i,target:a,uuids:s}=n;if(s&&e.push(...Object.keys(s).map(e=>({method:"delete",url:"".concat(t,"/").concat(e)}))),a&&!l){var o;let n=null!==(o=a.subnodes)&&void 0!==o?o:[a.uuid];e.push(...n.map(e=>({body:{hostUuid:e,level:i,mailRecipientUuid:r},method:"post",url:t})))}return e},[]):[]};var q=e=>{let{alertOverrideTargetOptions:n,mailRecipientUuid:t,previousFormikValues:i,tools:a}=e,s=(0,u.useMemo)(()=>null!=t?t:(0,d.Z)(),[t]),h=(0,E.Z)({initialValues:null!=i?i:{[s]:{alertOverrides:{},email:"",language:"en_CA",level:2,name:""}},onSubmit:(e,n)=>{let{setSubmitting:t}=n,{[s]:l}=e,o="Add",u=(0,r.jsx)(r.Fragment,{children:"Failed to add mail recipient."}),d="post",c=(0,r.jsx)(r.Fragment,{children:"Mail recipient added."}),h="Add mail recipient with the following?",v="/mail-recipient";i&&(o="Update",u=(0,r.jsx)(r.Fragment,{children:"Failed to update mail server."}),d="put",c=(0,r.jsx)(r.Fragment,{children:"Mail recipient updated."}),h="Update ".concat(l.name," with the following?"),v+="/".concat(s));let{alertOverrides:x,uuid:f,...j}=l;a.confirm.prepare({actionProceedText:o,content:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{entries:j}),(0,r.jsx)(p.Z,{entries:{alertOverrides:Object.entries(x).reduce((e,n)=>{let[t,r]=n;return r.remove||!r.target||(e[t]={level:r.level,name:r.target.name}),e},{})}})]}),onCancelAppend:()=>t(!1),onProceedAppend:async()=>{a.confirm.loading(!0);let e=e=>{let n=(0,g.Z)(e);n.children=(0,r.jsxs)(r.Fragment,{children:[u," ",n.children]}),a.confirm.finish("Error",n),t(!1)};m.Z[d](v,j).then(n=>{let{data:t}=n,r={...l};t&&(r.uuid=t.uuid),Promise.all(N(r,i&&i[s]).map(e=>m.Z[e.method](e.url,e.body))).then(()=>{a.confirm.finish("Success",{children:c}),a["post"===d?"add":"edit"].open(!1)}).catch(e)}).catch(e)},titleText:h}),a.confirm.open(!0)},validationSchema:C}),{disabledSubmit:v,formik:x,formikErrors:f,handleChange:j}=h,Z=(0,u.useMemo)(()=>"".concat(s,".email"),[s]),y=(0,u.useMemo)(()=>"".concat(s,".level"),[s]),b=(0,u.useMemo)(()=>"".concat(s,".name"),[s]);return(0,r.jsxs)(l.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),x.submitForm()},spacing:"1em",children:[(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{id:b,label:"Recipient name",name:b,onChange:j,required:!0,value:x.values[s].name})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{id:Z,label:"Recipient email",name:Z,onChange:j,required:!0,value:x.values[s].email})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(P.Z,{id:y,label:"Alert level",name:y,onChange:x.handleChange,required:!0,selectItems:_,selectProps:{MenuProps:{sx:{["& .".concat(o.Z.paper)]:{maxWidth:{md:"60%",lg:"40%"}}}},renderValue:e=>U[e]},value:x.values[s].level})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(I,{alertOverrideTargetOptions:n,formikUtils:h,mailRecipientUuid:s})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(D.Z,{count:1,messages:f})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(c.Z,{actions:[{background:"blue",children:i?"Update":"Add",disabled:v,type:"submit"}]})})]})},R=t(39806),T=t(73846),L=e=>(0,r.jsx)(q,{...e}),H=t(71108),W=t(5499),K=()=>{let[e,n]=(0,u.useState)(),{altData:t,loading:l}=(0,W.Z)("/anvil",{mod:R.Z}),i=(0,u.useMemo)(()=>t&&Object.values(t).sort((e,n)=>e.name.localeCompare(n.name)).reduce((e,n)=>{let t={description:n.description,name:n.name,node:n.uuid,subnodes:[],type:"node",uuid:n.uuid},r=Object.values(n.hosts).sort((e,n)=>e.name.localeCompare(n.name)).reduce((e,r)=>{var l;return"dr"===r.type||(e.push({name:r.name,node:n.uuid,type:"subnode",uuid:r.uuid}),null===(l=t.subnodes)||void 0===l||l.push(r.uuid)),e},[]);return e.push(t,...r),e},[]),[t]),{fetch:a,loading:s}=(0,H.Z)({onData:e=>n(e),url:"/alert-override"}),o=(0,u.useMemo)(()=>{if(t&&e)return Object.entries(Object.values(e).reduce((e,n)=>{let{node:{uuid:t}}=n;return e[t]?e[t].push(n):e[t]=[n],e},{})).reduce((e,n)=>{let[r,l]=n,[i,...a]=l;if(l.length>1&&a.every(e=>{let{level:n}=e;return n===i.level})){let{0:{level:n}}=l,{[r]:i}=t;e[r]={level:n,target:{description:i.description,name:i.name,node:i.uuid,subnodes:l.map(e=>{let{subnode:{uuid:n}}=e;return n}),type:"node",uuid:i.uuid},uuids:l.reduce((e,n)=>{let{subnode:t,uuid:r}=n;return e[r]=t.uuid,e},{})}}else l.forEach(n=>{let{level:t,node:r,subnode:l,uuid:i}=n;e[l.uuid]={level:t,target:{name:l.name,node:r.uuid,type:"subnode",uuid:l.uuid},uuids:{[i]:l.uuid}}});return e},{})},[e,t]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(T.Z,{addHeader:"Add mail recipient",editHeader:e=>"Update ".concat(null==e?void 0:e.name),entriesUrl:"/mail-recipient",getAddLoading:e=>e||l,getDeleteErrorMessage:e=>{let{children:n,...t}=e;return{...t,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete mail recipient(s). ",n]})}},getDeleteHeader:e=>"Delete the following ".concat(e," mail recipient(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted mail recipient(s)."})}),getEditLoading:e=>e||s,listEmpty:"No mail recipient(s) found.",onItemClick:function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];let[,l]=t;e(...t),a(void 0,{params:{"mail-recipient":l}})},renderAddForm:e=>i&&(0,r.jsx)(q,{alertOverrideTargetOptions:i,tools:e}),renderDeleteItem:(e,n)=>{let{key:t}=n,l=null==e?void 0:e[t];return(0,r.jsx)(M.Ac,{children:null==l?void 0:l.name})},renderEditForm:(e,n)=>i&&n&&o&&(0,r.jsx)(L,{alertOverrideTargetOptions:i,mailRecipientUuid:n.uuid,previousFormikValues:{[n.uuid]:{alertOverrides:o,...n}},tools:e}),renderListItem:(e,n)=>{let{name:t}=n;return(0,r.jsx)(M.Ac,{children:t})}})})};let J=v.Ry({address:v.Z_().required(),authentication:v.Z_().oneOf(["none","plain-text","encrypted"]),confirmPassword:v.Z_().when("password",(e,n)=>String(e).length>0?n.required().oneOf([v.iH("password")]):n.optional()),heloDomain:v.Z_().required(),password:v.Z_().optional(),port:v.Rx().required(),security:v.Z_().oneOf(["none","starttls","tls-ssl"]),username:v.Z_().optional(),uuid:(0,f.uI)().required()}),X=v.Vo(e=>v.Ry((0,x.Z)(e,J)));var z=e=>{let{localhostDomain:n="",mailServerUuid:t,previousFormikValues:i,tools:a}=e,s=(0,u.useMemo)(()=>null!=t?t:(0,d.Z)(),[t]),{disabledSubmit:o,formik:h,formikErrors:v,handleChange:x}=(0,E.Z)({initialValues:null!=i?i:{[s]:{address:"",authentication:"none",heloDomain:n,port:587,security:"none",uuid:s}},onSubmit:(e,n)=>{let{setSubmitting:t}=n,{[s]:l}=e,o="Add",u=(0,r.jsx)(r.Fragment,{children:"Failed to add mail server."}),d="post",c=(0,r.jsx)(r.Fragment,{children:"Mail server added."}),h="Add mail server with the following?",v="/mail-server";i&&(o="Update",u=(0,r.jsx)(r.Fragment,{children:"Failed to update mail server."}),d="put",c=(0,r.jsx)(r.Fragment,{children:"Mail server updated."}),h="Update ".concat(l.address,":").concat(l.port," with the following?"),v+="/".concat(s));let{confirmPassword:x,uuid:f,...j}=l;a.confirm.prepare({actionProceedText:o,content:(0,r.jsx)(p.Z,{entries:j,hasPassword:!0}),onCancelAppend:()=>t(!1),onProceedAppend:()=>{a.confirm.loading(!0),m.Z[d](v,l).then(()=>{a.confirm.finish("Success",{children:c}),a["post"===d?"add":"edit"].open(!1)}).catch(e=>{let n=(0,g.Z)(e);n.children=(0,r.jsxs)(r.Fragment,{children:[u," ",n.children]}),a.confirm.finish("Error",n),t(!1)})},titleText:h}),a.confirm.open(!0)},validationSchema:X}),f=(0,u.useMemo)(()=>"".concat(s,".address"),[s]),j=(0,u.useMemo)(()=>"".concat(s,".authentication"),[s]),Z=(0,u.useMemo)(()=>"".concat(s,".confirmPassword"),[s]),y=(0,u.useMemo)(()=>"".concat(s,".heloDomain"),[s]),b=(0,u.useMemo)(()=>"".concat(s,".password"),[s]),C=(0,u.useMemo)(()=>"".concat(s,".port"),[s]),A=(0,u.useMemo)(()=>"".concat(s,".security"),[s]),w=(0,u.useMemo)(()=>"".concat(s,".username"),[s]);return(0,r.jsxs)(l.ZP,{component:"form",onSubmit:e=>{e.preventDefault(),h.submitForm()},container:!0,columns:{xs:1,sm:2},spacing:"1em",children:[(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{id:f,label:"Server address",name:f,onChange:x,required:!0,value:h.values[s].address})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{id:C,label:"Server port",name:C,onChange:x,required:!0,type:"number",value:h.values[s].port})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(P.Z,{id:A,label:"Server security type",name:A,onChange:x,required:!0,selectItems:["none","starttls","tls-ssl"],value:h.values[s].security})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(P.Z,{id:j,label:"Server authentication method",name:j,onChange:x,required:!0,selectItems:["none","plain-text","encrypted"],value:h.values[s].authentication})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{id:y,label:"HELO domain",name:y,onChange:x,required:!0,value:h.values[s].heloDomain})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:w,label:"Server username",name:w,onChange:x,value:h.values[s].username})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:b,label:"Server password",name:b,onChange:x,type:"password",value:h.values[s].password})})}),(0,r.jsx)(l.ZP,{display:{xs:"none",sm:"initial"},item:!0,sm:1}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(O.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:Z,label:"Confirm password",name:Z,onChange:x,type:"password",value:h.values[s].confirmPassword})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(D.Z,{count:1,messages:v})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(c.Z,{actions:[{background:"blue",children:i?"Update":"Add",disabled:o,type:"submit"}]})})]})},G=e=>(0,r.jsx)(z,{...e}),B=()=>{let{data:e,loading:n}=(0,W.Z)("/host/local");return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(T.Z,{addHeader:"Add mail server",editHeader:e=>"Update ".concat(null==e?void 0:e.address,":").concat(null==e?void 0:e.port),entriesUrl:"/mail-server",getAddLoading:e=>e||n,getDeleteErrorMessage:e=>{let{children:n,...t}=e;return{...t,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete mail server(s). ",n]})}},getDeleteHeader:e=>"Delete the following ".concat(e," mail server(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted mail server(s)."})}),listEmpty:"No mail server(s) found",renderAddForm:n=>e&&(0,r.jsx)(z,{localhostDomain:e.domain,tools:n}),renderDeleteItem:(e,n)=>{let{key:t}=n,l=null==e?void 0:e[t];return(0,r.jsxs)(M.Ac,{children:[null==l?void 0:l.address,":",null==l?void 0:l.port]})},renderEditForm:(e,n)=>n&&(0,r.jsx)(G,{mailServerUuid:n.uuid,previousFormikValues:{[n.uuid]:n},tools:e}),renderListItem:(e,n)=>{let{address:t,port:l}=n;return(0,r.jsxs)(M.Ac,{children:[t,":",l]})}})})},$=t(65375),Q=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{children:(0,r.jsx)("title",{children:"Mail Config"})}),(0,r.jsx)(s.Z,{}),(0,r.jsxs)(l.ZP,{container:!0,columns:{xs:1,md:6,lg:4},children:[(0,r.jsx)(l.ZP,{item:!0,xs:1}),(0,r.jsx)(l.ZP,{item:!0,xs:1,md:4,lg:2,children:(0,r.jsxs)($.s_,{children:[(0,r.jsx)($.V9,{children:(0,r.jsx)(M.z,{children:"Mail config"})}),(0,r.jsx)($.TZ,{expandInitially:!0,header:"Manage mail servers",children:(0,r.jsx)(B,{})}),(0,r.jsx)($.TZ,{expandInitially:!0,header:"Manage mail recipients",children:(0,r.jsx)(K,{})})]})})]})]})}},function(e){e.O(0,[995,256,202,391,126,436,622,888,774,179],function(){return e(e.s=24084)}),_N_E=e.O()}]);