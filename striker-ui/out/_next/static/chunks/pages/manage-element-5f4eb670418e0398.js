(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[808],{29582:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-element",function(){return n(82657)}])},73846:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(28937),i=n(45036),o=n(11100),a=n(18541),c=n(71108),d=n(81013),u=n(40657),h=n(5499);let m=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"==typeof e?e(...n):e};t.Z=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[p]=t,{addHeader:x,editHeader:f,entriesUrl:j,formDialogProps:g,getAddLoading:v,getDeleteErrorMessage:Z,getDeleteHeader:b,getDeletePromiseChain:w=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},getDeleteSuccessMessage:k,getEditLoading:y=e=>e,listEmpty:P,listProps:M,onItemClick:C=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},onValidateEntriesChange:S,refreshInterval:I=5e3,renderAddForm:A,renderDeleteItem:F,renderEditForm:T,renderListItem:U,entryUrlPrefix:O=j}=p,N=(0,s.useRef)(null),R=(0,s.useRef)(null),{confirmDialog:q,finishConfirm:E,setConfirmDialogLoading:D,setConfirmDialogOpen:_,setConfirmDialogProps:B}=(0,u.Z)({initial:{scrollContent:!0}}),[H,L]=(0,s.useState)(!1),[V,z]=(0,s.useState)(),{data:$,mutate:W,loading:G,validating:J}=(0,h.Z)(j,{refreshInterval:I}),{fetch:Q,loading:K}=(0,c.Z)({onData:e=>z(e),url:O});(0,s.useEffect)(()=>{null==S||S.call(null,J)},[S,J]);let X=(0,s.useMemo)(()=>m(x),[x]),Y=(0,s.useMemo)(()=>m(f,V),[V,f]),ee=(0,s.useMemo)(()=>({add:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==N?void 0:null===(e=N.current)||void 0===e?void 0:e.setOpen(t)}},confirm:{finish:E,loading:D,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return _(e)},prepare:B},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==R?void 0:null===(e=R.current)||void 0===e?void 0:e.setOpen(t)}}}),[E,D,_,B]),{buildDeleteDialogProps:et,checks:en,getCheck:er,hasAllChecks:es,hasChecks:el,multipleItems:ei,resetChecks:eo,setAllChecks:ea,setCheck:ec}=(0,d.Z)({list:$});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{allowCheckAll:ei,allowEdit:!0,allowItemButton:H,disableDelete:!el,edit:H,getListCheckboxProps:()=>({checked:es,onChange:(e,t)=>ea(t)}),getListItemCheckboxProps:e=>({checked:er(e),onChange:(t,n)=>ec(e,n)}),header:!0,listEmpty:P,listItems:$,loading:G,onAdd:()=>{var e;return null==N?void 0:null===(e=N.current)||void 0===e?void 0:e.setOpen(!0)},onDelete:()=>{B(et({onProceedAppend:()=>{D(!0),Promise.all(w((e,t)=>e.map(e=>l.Z.delete("".concat(t,"/").concat(e))),en,j)).then(()=>{E("Success",k()),W()}).catch(e=>{E("Error",Z((0,o.Z)(e)))}).finally(()=>{eo()})},getConfirmDialogTitle:b,renderEntry:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return F($,...t)}})),_(!0)},onEdit:()=>L(e=>!e),onItemClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return C((e,t)=>{var n;null==R||null===(n=R.current)||void 0===n||n.setOpen(!0),Q("/".concat(t))},...t)},renderListItem:U,...M}),(0,r.jsx)(i.Js,{header:X,loading:null==v?void 0:v.call(null),ref:N,showClose:!0,...null==g?void 0:g.common,...null==g?void 0:g.add,children:A(ee)}),(0,r.jsx)(i.Js,{header:Y,loading:y(K),ref:R,showClose:!0,...null==g?void 0:g.common,...null==g?void 0:g.edit,children:T(ee,V)}),q]})}},18950:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(47177);let i=(0,s.forwardRef)((e,t)=>{let{children:n,contentContainerProps:i,dialogProps:o,onSubmitAppend:a,proceedButtonProps:c,scrollBoxProps:d,scrollContent:u,...h}=e,m=(0,s.useMemo)(()=>({...i,component:"form",onSubmit:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[r]=t;r.preventDefault(),null==a||a.call(null,...t)}}),[i,a]),p=(0,s.useMemo)(()=>({...d,sx:u?{overflowX:"hidden",paddingTop:".6em",...null==d?void 0:d.sx}:null==d?void 0:d.sx}),[d,u]);return(0,r.jsx)(l.Z,{dialogProps:o,contentContainerProps:m,proceedButtonProps:{...c,type:"submit"},scrollContent:u,scrollBoxProps:p,wide:!0,...h,ref:t,children:n})});i.displayName="FormDialog",t.Z=i},76740:function(e,t,n){"use strict";var r=n(85893),s=n(90642),l=n(19304),i=n(47407),o=n(35338),a=n(44400),c=n(5387),d=n(57882);let u=e=>{let{entry:t}=e;return(0,r.jsx)(d.$_,{whiteSpace:"nowrap",children:String(t)})},h=e=>{let{entry:t,key:n}=e;return o.JW.test(n)?(0,r.jsx)(d.PJ,{wrapper:"mono",children:String(t)}):u(e)},m=e=>{let{entry:t,hasPassword:n}=e;return["",null,void 0].some(e=>t===e)||Number.isNaN(t)?(0,r.jsx)(d.Ac,{children:"none"}):n?h(e):u(e)},p=e=>{let{depth:t,entry:n,getLabel:l,hasPassword:i,key:o,nest:u,renderValue:h}=e;return(0,r.jsxs)(c.Z,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,r.jsx)(d.Ac,{children:l({cap:a.Z,depth:t,entry:n,hasPassword:i,key:o})}),(0,r.jsx)(s.Z,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!u&&h(m,{depth:t,entry:n,hasPassword:i,key:o})})]})},x=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},f=e=>{let{depth:t=0,entries:n,getEntryLabel:s,getListProps:o,getListItemProps:a,hasPassword:c,listKey:d,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:p}=e,j=[];Object.entries(n).forEach(e=>{let[n,i]=e,o=null!==i&&"object"==typeof i,d=o?null:i,g={depth:t,entry:d,hasPassword:c,key:n};p(x,g)||j.push((0,r.jsx)(l.ZP,{sx:{paddingLeft:"".concat(t,"em")},...null==a?void 0:a.call(null,g),children:h({depth:t,entry:d,getLabel:s,hasPassword:c,key:n,nest:o,renderValue:m})},"form-summary-entry-".concat(n))),o&&t<u&&j.push(f({depth:t+1,entries:i,getEntryLabel:s,hasPassword:c,listKey:n,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:p}))});let g="form-summary-list-".concat(null!=d?d:"root");return(0,r.jsx)(i.Z,{dense:!0,disablePadding:!0,...null==o?void 0:o.call(null,{depth:t,entries:n,key:d}),children:j},g)};t.Z=e=>{let{entries:t,getEntryLabel:n=e=>{let{cap:t,key:n}=e;return t(n)},getListProps:r,getListItemProps:s,hasPassword:l=!1,maxDepth:i=3,renderEntry:o=p,renderEntryValue:a=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},skip:c=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)}}=e;return f({entries:t,getEntryLabel:n,getListProps:r,getListItemProps:s,hasPassword:l,maxDepth:i,renderEntry:o,renderEntryValue:a,skip:c})}},16562:function(e,t,n){"use strict";var r=n(85893),s=n(77527),l=n(50385),i=n(13539),o=n(67294),a=n(39971),c=n(57882);let d=(0,s.ZP)(l.Z)({height:"3.5em",marginLeft:0,width:"100%"});t.Z=e=>{let{baseInputProps:t,checked:n,formControlLabelProps:s,id:l,label:u,name:h,onChange:m,switchProps:p}=e,x=(0,o.useMemo)(()=>"string"==typeof u?(0,r.jsx)(c.Ac,{inheritColour:!0,color:"".concat(a.s7,"AF"),children:u}):(0,r.jsx)(r.Fragment,{children:u}),[u]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d,{componentsProps:{typography:{flexGrow:1}},control:(0,r.jsx)(i.Z,{checked:n,edge:"end",name:h,onChange:m,...p}),label:x,labelPlacement:"start",...s}),(0,r.jsx)("input",{checked:n,hidden:!0,id:l,readOnly:!0,...t})]})}},19166:function(e,t,n){"use strict";var r=n(85893),s=n(77527),l=n(58918),i=n(80483),o=n(67294),a=n(39971),c=n(57882);let d=(0,s.ZP)(l.Z)({borderRadius:a.n_,color:a.s7,padding:".4em .8em",textTransform:"none",["&.".concat(i.Z.selected)]:{color:a.Ej}});t.Z=e=>{let{label:t,...n}=e,s=(0,o.useMemo)(()=>"string"==typeof t?(0,r.jsx)(c.Ac,{inheritColour:!0,children:t}):t,[t]);return(0,r.jsx)(d,{label:s,...n})}},17428:function(e,t,n){"use strict";var r=n(85893),s=n(90642),l=n(67294);t.Z=e=>{let{changingTabId:t,children:n,retain:i=!1,tabId:o}=e,a=(0,l.useMemo)(()=>t===o,[t,o]),c=(0,l.useMemo)(()=>i?(0,r.jsx)(s.Z,{sx:{display:a?"initial":"none"},children:n}):a&&n,[n,a,i]);return(0,r.jsx)(r.Fragment,{children:c})}},22143:function(e,t,n){"use strict";var r=n(85893),s=n(77527),l=n(14221),i=n(93465),o=n(80483),a=n(18745),c=n(89540),d=n(67294),u=n(39971);let h="1.8em",m=(0,s.ZP)(l.Z)({minHeight:"1em",["&.".concat(i.Z.vertical)]:{minHeight:h,["& .".concat(o.Z.root)]:{alignItems:"flex-start",minHeight:h,paddingLeft:"2em"},["& .".concat(i.Z.indicator)]:{right:"initial"}},["& .".concat(o.Z.root)]:{minHeight:"1em"},["& .".concat(i.Z.indicator)]:{backgroundColor:u.Ej,borderRadius:u.n_}});t.Z=e=>{let{orientation:t,variant:n="fullWidth",...s}=e,l=(0,a.Z)(),i=(0,d.useCallback)(e=>l.breakpoints.up(e),[l]),o=(0,c.Z)(i("xs")),u=(0,c.Z)(i("sm")),h=(0,c.Z)(i("md")),p=(0,c.Z)(i("lg")),x=(0,c.Z)(i("xl")),f=(0,d.useMemo)(()=>[["xs",o],["sm",u],["md",h],["lg",p],["xl",x]],[p,h,u,x,o]),j=(0,d.useMemo)(()=>{let e;return"object"==typeof t?f.some(n=>{let[r,s]=n;return s&&t[r]&&(e=t[r]),!s}):e=t,e},[f,t]);return(0,r.jsx)(m,{orientation:j,variant:n,...s})}},71108:function(e,t,n){"use strict";var r=n(67294),s=n(28937),l=n(11100);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{config:t,onError:n,onData:i,url:o=""}=e,[a,c]=(0,r.useState)(!1);return{fetch:(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,a="".concat(o).concat(e);a&&(c(!0),s.Z.get(a,{...t,...r}).then(e=>{let{data:t}=e;null==i||i.call(null,t)}).catch(e=>{let t=(0,l.Z)(e);null==n||n.call(null,t)}).finally(()=>{c(!1)}))},[o,t,i,n]),loading:a}}},81013:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(95996),i=n(76740);t.Z=e=>{let{list:t={}}=e,[n,o]=(0,s.useState)({}),a=(0,s.useMemo)(()=>Object.keys(t),[t]),c=(0,s.useMemo)(()=>Object.keys(n),[n]),d=(0,s.useMemo)(()=>c.length===a.length,[c.length,a.length]),u=(0,s.useMemo)(()=>c.length>0,[c.length]),h=(0,s.useMemo)(()=>a.length>1,[a.length]),m=(0,s.useCallback)(e=>{let{confirmDialogProps:t={},formSummaryProps:s={},getConfirmDialogTitle:l,onProceedAppend:o,renderEntry:a}=e;return{actionProceedText:"Delete",content:(0,r.jsx)(i.Z,{entries:n,maxDepth:0,renderEntry:a,...s}),onProceedAppend:o,proceedColour:"red",titleText:l(c.length),...t}},[n,c.length]),p=(0,s.useCallback)(e=>!!n[e],[n]);return{buildDeleteDialogProps:m,checklist:n,checks:c,getCheck:p,hasAllChecks:d,hasChecks:u,multipleItems:h,resetChecks:(0,s.useCallback)(()=>o({}),[]),setAllChecks:(0,s.useCallback)(e=>o(a.reduce((t,n)=>(e&&(t[n]=e),t),{})),[a]),setCheck:(0,s.useCallback)((e,t)=>o((0,l.ZP)(e,t||void 0)),[])}}},84337:function(e,t,n){"use strict";var r=n(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:n="",...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useState)({actionProceedText:e,content:t,titleText:n,...s})}},99246:function(e,t,n){"use strict";var r=n(67294);t.Z=()=>{let e=(0,r.useRef)(!0);return e.current?(e.current=!1,!0):e.current}},82657:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return no}});var r=n(85893),s=n(9008),l=n.n(s),i=n(11163),o=n(67294),a=function(e){let{fallbackValue:t="",joinSeparator:n="",limit:r=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Array?e.slice(0,r).join(n):null!=e?e:t},c=n(25436),d=n(53165),u=n(35338),h=n(90642),m=n(48801),p=n(77527),x=n(21038),f=n(46315),j=n(5387),g=n(2911),v=n(23852),Z=n(65375),b=n(37628),w=n(16562),k=n(72414),y=n(57882);let P=["1","on"],M=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,setMessage:n},id:r,label:s}=e,l=t(r),i=()=>{n(r)};return"ip"===s.toLowerCase()?(0,k._)(s,i,{onFinishBatch:l},e=>{n(r,{children:e})}):{defaults:{onSuccess:i},onFinishBatch:l,tests:[{test:k.HJ}]}},C=e=>{let{formUtils:t,id:n,isRequired:s,label:l="",name:i=n,value:o}=e,{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:c,setMessage:d}=t;return(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:n,label:l,name:i,value:o}),inputTestBatch:(0,k.qY)(l,()=>{d(n)},{onFinishBatch:a(n)},e=>{d(n,{children:e})}),onFirstRender:c(n),required:s,valueType:"number"},"".concat(n,"-wrapper"))},S={boolean:e=>{let{id:t,isChecked:n=!1,label:s,name:l=t}=e;return(0,r.jsx)(g.Z,{input:(0,r.jsx)(w.Z,{checked:n,id:t,label:s,name:l}),valueType:"boolean"},"".concat(t,"-wrapper"))},integer:C,second:C,select:e=>{let{formUtils:t,id:n,isRequired:s,label:l,name:i=n,selectOptions:o=[],value:a=""}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:d,setMessage:u}=t;return(0,r.jsx)(g.Z,{input:(0,r.jsx)(b.Z,{id:n,label:l,name:i,selectItems:o,value:a}),inputTestBatch:{defaults:{onSuccess:()=>{u(n)}},onFinishBatch:c(n),tests:[{test:k.HJ}]},onFirstRender:d(n),required:s},"".concat(n,"-wrapper"))},string:e=>{let t;let{formUtils:n,id:s,isRequired:l,isSensitive:i=!1,label:o="",name:a=s,value:c}=e,{buildInputFirstRenderFunction:d}=n;return i&&(t=f.Z.password),(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:s,label:o,name:a,type:t,value:c}),inputTestBatch:M({formUtils:n,id:s,label:o}),onFirstRender:d(s),required:l},"".concat(s,"-wrapper"))}},I=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("-")},A=(0,p.ZP)(j.Z)({margin:".4em 0"});var F=e=>{let{fenceId:t,fenceParameterTooltipProps:n,fenceTemplate:s,formUtils:l,previousFenceName:i,previousFenceParameters:a}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:d,setMessage:m}=l,p=(0,o.useMemo)(()=>{let e;if(s&&t){let{parameters:o}=s[t],p={};a&&(p=Object.entries(a).reduce((e,n)=>{let[r,s]=n;return e[I(t,r)]=s,e},{}));let{optional:f,required:b}=Object.entries(o).sort((e,t)=>{let[n]=e,[r]=t;return n>r?1:-1}).reduce((e,s)=>{var i,o;let[a,{content_type:c,default:d,deprecated:m,description:f,options:j,replacement:g,required:v}]=s;if([1===Number(m),g].some(e=>e))return e;let{optional:Z,required:b}=e,w=null!==(i=S[c])&&void 0!==i?i:S.string,k=I(t,a),M=null!==(o=p[k])&&void 0!==o?o:d,C=!/plug|port/i.test(a)&&1===Number(v),A=u.JW.test(a),F=w({formUtils:l,id:k,isChecked:P.includes(M),isRequired:C,isSensitive:A,label:a,selectOptions:j,value:M}),T=(0,r.jsx)(x.Z,{componentsProps:{tooltip:{sx:{maxWidth:{md:"62.6em"}}}},disableInteractive:!0,placement:"top-start",title:(0,r.jsx)(y.Ac,{children:f}),...n,children:(0,r.jsx)(h.Z,{children:F})},"".concat(k,"-tooltip"));return C?b.push(T):Z.push(T),e},{optional:[],required:[]}),w=I(t,"name"),M="Fence device name";e=(0,r.jsxs)(j.Z,{sx:{"& > div:first-child":{marginTop:0},"& > div":{marginBottom:0}},children:[(0,r.jsx)(Z.TZ,{expandInitially:!0,header:"Required parameters",children:(0,r.jsxs)(A,{children:[(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:w,label:M,name:w,value:i}),inputTestBatch:(0,k.Gn)(M,()=>{m(w)},{onFinishBatch:c(w)},e=>{m(w,{children:e})}),onFirstRender:d(w),required:!0},"".concat(w,"-wrapper")),b]})}),(0,r.jsx)(Z.TZ,{header:"Optional parameters",children:(0,r.jsx)(A,{children:f})})]})}return e},[c,d,t,n,s,l,i,a,m]);return(0,r.jsx)(r.Fragment,{children:p})},T=n(90209),U=n(99246);let O="add-fence-input-agent";var N=e=>{let{fenceTemplate:t,formUtils:n,loading:s}=e,{setValidity:l}=n,i=(0,U.Z)(),[a,c]=(0,o.useState)(null),d=(0,o.useMemo)(()=>t?Object.entries(t).sort((e,t)=>{let[n]=e,[r]=t;return n>r?1:-1}).map(e=>{let[t,{description:n}]=e;return{fenceDescription:"string"==typeof n?n:"No description.",fenceId:t,label:t}}):[],[t]),u=(0,o.useMemo)(()=>(0,r.jsx)(m.Z,{id:O,isOptionEqualToValue:(e,t)=>e.fenceId===t.fenceId,label:"Fence device type",onChange:(e,t)=>{l(O,null!==t),c(t)},openOnFocus:!0,options:d,renderOption:(e,t,n)=>{let{fenceDescription:s,fenceId:l}=t,{selected:i}=n;return(0,r.jsxs)(h.Z,{component:"li",sx:{display:"flex",flexDirection:"column","& > *":{width:"100%"}},...e,children:[(0,r.jsx)(y.Ac,{inverted:!0,sx:{fontSize:"1.2em",fontWeight:i?400:void 0},children:l}),(0,r.jsx)(y.Ac,{selected:!1,children:s})]})},sx:{marginTop:".3em"},value:a}),[d,a,l]),p=(0,o.useMemo)(()=>(0,r.jsx)(F,{fenceId:null==a?void 0:a.fenceId,fenceTemplate:t,formUtils:n}),[t,null==a?void 0:a.fenceId,n]),x=(0,o.useMemo)(()=>s?(0,r.jsx)(T.Z,{}):(0,r.jsxs)(j.Z,{children:[u,p]}),[u,p,s]);return(0,o.useEffect)(()=>{i&&l(O,null!==a)},[a,i,l]),(0,r.jsx)(r.Fragment,{children:x})},R=n(28937),q=n(47177),E=e=>{let{fenceId:t,fenceTemplate:n,formUtils:s,loading:l,previousFenceName:i,previousFenceParameters:a}=e,c=(0,o.useMemo)(()=>l?(0,r.jsx)(T.Z,{}):(0,r.jsx)(F,{fenceId:t,fenceTemplate:n,formUtils:s,previousFenceName:i,previousFenceParameters:a}),[n,t,s,l,i,a]);return(0,r.jsx)(r.Fragment,{children:c})},D=n(18950),_=n(76740),B=n(11100),H=n(18541),L=n(18050),V=n(14631),z=n(81013),$=n(84337),W=n(95275);let G=e=>{let{id:t}=e,n=new RegExp("^(fence[^-]+)".concat("-","([^\\s]+)$")),r=t.match(n);if(!r)throw Error("Not target input element");return r},J=(e,t,n)=>{if("name"===e)throw t.name=n,Error("Not child parameter")},Q=e=>{if(!e)throw Error("Not parameter specification")},K=(e,t)=>{if([t,"",null,void 0].some(t=>e===t))throw Error("Skippable parameter value")},X=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[{target:s}]=n,{elements:l}=s;return Object.values(l).reduce((t,n)=>{try{let[,r,s]=G(n);t.agent=r;let{checked:l,value:i}=n;J(s,t,i);let{[r]:{parameters:{[s]:o}}}=e;Q(o);let{content_type:a,default:c}=o,d=i;"boolean"===a&&(d=l?"1":""),K(d,c),t.parameters[s]=d}catch(e){}return t},{agent:"",name:"",parameters:{}})};var Y=()=>{let e=(0,U.Z)(),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)({}),[l,i]=(0,$.Z)(),[a,c]=(0,$.Z)(),[h,m]=(0,o.useState)(),[p,x]=(0,o.useState)(),[f,g]=(0,o.useState)(!1),[v,b]=(0,o.useState)(!0),{isLoading:w}=(0,V.Z)("".concat(d.Z,"/fence"),{onSuccess:e=>m(e),refreshInterval:6e4}),k=(0,o.useCallback)(()=>{R.Z.get("/fence").then(e=>{let{data:t}=e;m(t)})},[m]),P=(0,W.Z)([O],s),{isFormInvalid:M,isFormSubmitting:C,submitForm:S}=P,{buildDeleteDialogProps:I,checks:A,getCheck:F,hasChecks:G,resetChecks:J,setCheck:Q}=(0,z.Z)({list:h}),K=(0,o.useCallback)(e=>{let{cap:t,depth:n,key:r}=e;return 0===n?t(r):r},[]),Y=(0,o.useMemo)(()=>(0,r.jsx)(H.Z,{allowEdit:!0,allowItemButton:f,disableDelete:!G,edit:f,header:!0,listEmpty:"No fence device(s) registered.",listItems:h,onAdd:()=>{var e;c({actionProceedText:"Add",content:(0,r.jsx)(N,{fenceTemplate:p,formUtils:P}),onSubmitAppend:e=>{var n;if(!p)return;let s=X(p,e),{agent:l,name:o}=s;i({actionProceedText:"Add",content:(0,r.jsx)(_.Z,{entries:s,hasPassword:!0,getEntryLabel:K}),onProceedAppend:()=>{S({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add fence device. ",e]}),method:"post",onSuccess:()=>k(),successMsg:"Added fence device ".concat(o),url:"/fence"})},titleText:(0,r.jsxs)(y.z,{children:["Add a"," ",(0,r.jsx)(y.Q0,{fontSize:"inherit",children:l})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a fence device"}),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;i(I({getConfirmDialogTitle:e=>"Delete ".concat(e," fence device(s)?"),onProceedAppend:()=>{S({body:{uuids:A},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to delete fence device(s). ",e]}),method:"delete",onSuccess:()=>{k(),J()},url:"/fence"})},renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(y.Ac,{children:null==h?void 0:h[t].fenceName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{g(e=>!e)},onItemCheckboxChange:(e,t,n)=>{Q(e,n)},onItemClick:e=>{var s;let{fenceAgent:l,fenceName:o,fenceParameters:a,fenceUUID:d}=e;c({actionProceedText:"Update",content:(0,r.jsx)(E,{fenceId:l,fenceTemplate:p,formUtils:P,previousFenceName:o,previousFenceParameters:a}),onSubmitAppend:e=>{var n;if(!p)return;let s=X(p,e);i({actionProceedText:"Update",content:(0,r.jsx)(_.Z,{entries:s,hasPassword:!0,getEntryLabel:K}),onProceedAppend:()=>{S({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update fence device. ",e]}),method:"put",onSuccess:()=>k(),successMsg:"Updated fence device ".concat(o),url:"/fence/".concat(d)})},titleText:(0,r.jsxs)(y.z,{children:["Update"," ",(0,r.jsx)(y.Q0,{fontSize:"inherit",children:o})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,r.jsxs)(y.z,{children:["Update fence device"," ",(0,r.jsx)(y.Q0,{fontSize:"inherit",children:o})," ","parameters"]})}),null===(s=n.current.setOpen)||void 0===s||s.call(null,!0)},renderListItemCheckboxState:e=>F(e),renderListItem:(e,t)=>{let{fenceAgent:n,fenceName:s,fenceParameters:l}=t;return(0,r.jsxs)(j.Z,{row:!0,children:[(0,r.jsx)(y.Ac,{children:s}),(0,r.jsx)(y.Ac,{children:Object.entries(l).reduce((e,t)=>{let[n,s]=t,l=(0,r.jsxs)(r.Fragment,{children:[n,'="']});return l=u.JW.test(n)?(0,r.jsxs)(r.Fragment,{children:[l,(0,r.jsx)(y.PJ,{wrapper:"mono",children:s})]}):(0,r.jsxs)(r.Fragment,{children:[l,s]}),(0,r.jsxs)(r.Fragment,{children:[e," ",l,'"']})},n)})]})}}),[I,A,h,p,P,F,k,K,G,f,J,Q,i,c,S]),ee=(0,o.useMemo)(()=>v||w?(0,r.jsx)(T.Z,{}):Y,[w,v,Y]),et=(0,o.useMemo)(()=>(0,r.jsx)(L.Z,{count:1,defaultMessageType:"warning",ref:s}),[]);return e&&R.Z.get("/fence/template").then(e=>{let{data:t}=e;x(t)}).catch(e=>{(0,B.Z)(e)}).finally(()=>{b(!1)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Z.s_,{children:[(0,r.jsx)(Z.V9,{children:(0,r.jsx)(y.z,{children:"Manage fence devices"})}),ee]}),(0,r.jsx)(D.Z,{dialogProps:{PaperProps:{sx:{minWidth:{xs:"90%",md:"50em"}}}},scrollBoxProps:{padding:".3em .5em"},...a,disableProceed:M,loadingAction:C,preActionArea:et,ref:n,scrollContent:!0,showClose:!0}),(0,r.jsx)(q.Z,{closeOnProceed:!0,scrollBoxProps:{paddingRight:"1em"},...l,ref:t,scrollContent:!0})]})},ee=n(73846),et=n(45036),en=n(9968),er=n(82092);let es={online:"ok",offline:"off"},el={dr:"DR",node:"Subnode"};var ei=e=>{var t;let{data:n}=e,{hostName:s,hostStatus:l,hostType:i,shortHostName:o}=n;return(0,r.jsxs)(j.Z,{row:!0,spacing:".5em",children:[(0,r.jsx)(en.Z,{colour:null!==(t=es[l])&&void 0!==t?t:"warning",sx:{alignSelf:"stretch",height:"auto"}}),(0,r.jsxs)(j.Z,{flexGrow:1,spacing:0,children:[(0,r.jsxs)(j.Z,{sm:"row",spacing:".5em",children:[(0,r.jsx)(y.Ac,{children:el[i]}),(0,r.jsx)(y.$_,{whiteSpace:"nowrap",children:o}),(0,r.jsx)(er.Z,{orientation:"vertical",sx:{alignSelf:"stretch",height:"auto"}}),(0,r.jsx)(y.$_,{sx:{display:{xs:"none",sm:"flex"}},whiteSpace:"nowrap",children:s})]}),(0,r.jsx)(y.Ac,{children:l})]})]})},eo=n(45328),ea=n(8506),ec=n(42050),ed=n(50385),eu=n(60318),eh=n(42815),em=n(89621),ep=n(85533),ex=n(17254),ef=n(39971),ej=e=>{let{formControlProps:t,formControlLabelProps:n,formLabelProps:s,id:l,label:i,name:a,onChange:c,radioItems:d,radioProps:{sx:u,...h}={},radioGroupProps:m,value:p}=e,x=(0,o.useMemo)(()=>"string"==typeof i?(0,r.jsx)(y.Ac,{children:i}):i,[i]),f=(0,o.useMemo)(()=>Object.entries(d).map(e=>{let[t,{label:s,value:i}]=e,o="string"==typeof s?(0,r.jsx)(y.Ac,{children:s}):s;return(0,r.jsx)(ed.Z,{control:(0,r.jsx)(eu.Z,{...h,sx:{["&.".concat(eh.Z.root)]:{color:ef.s7},...u}}),value:i,label:o,...n},"".concat(l,"-").concat(t))}),[n,l,d,u,h]);return(0,r.jsxs)(em.Z,{...t,children:[(0,r.jsx)(ep.Z,{...s,children:x}),(0,r.jsx)(ex.Z,{id:l,name:a,onChange:c,row:!0,value:p,...m,children:f})]})},eg=n(16310),ev=n(48313);let eZ=eg.Ry().shape({enterpriseKey:(0,ev.uI)().optional(),ip:(0,ev.TB)().required(),name:eg.Z_().required(),redhatConfirmPassword:eg.Z_().when("redhatPassword",(e,t)=>String(e).length>0?t.required().oneOf([eg.iH("redhatPassword")]):t.optional()),redhatPassword:eg.Z_().when("redhatUsername",(e,t)=>String(e).length>0?t.required():t.optional()),redhatUsername:eg.Z_().when("redhatPassword",(e,t)=>String(e).length>0?t.required():t.optional()),type:eg.Z_().oneOf(["dr","subnode"]).required(),uuid:(0,ev.uI)().required()},[["redhatUsername","redhatPassword"]]),eb=eg.Ry({ip:(0,ev.TB)().required(),password:eg.Z_().required()});var ew=n(12823),ek=n(2094);let ey={subnode:{label:"Subnode",value:"subnode"},dr:{label:"Disaster Recovery (DR) host",value:"dr"}};var eP=e=>{let{host:t,setResponse:n,tools:s}=e,{disabledSubmit:l,formik:i,formikErrors:a,handleChange:c}=(0,ek.Z)({initialValues:{ip:t.hostIpAddress,name:t.hostName,password:t.hostPassword,type:"",uuid:t.hostUUID},onSubmit:(e,t)=>{let{setSubmitting:l}=t,{enterpriseKey:i,ip:o,name:a,password:c,type:d,uuid:u,redhatPassword:h,redhatUsername:m}=e;s.confirm.prepare({actionProceedText:"Prepare",content:(0,r.jsx)(_.Z,{entries:e,hasPassword:!0}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{s.confirm.loading(!0),R.Z.put("/host/prepare",{enterpriseUUID:i,hostIPAddress:o,hostName:a,hostPassword:c,hostType:"subnode"===d?"node":d,hostUUID:u,redhatPassword:h,redhatUser:m}).then(()=>{s.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Started job to prepare host at ",o,"."]})}),s.add.open(!1),setTimeout(n,500)}).catch(e=>{let t=(0,B.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to prepare host at ",o,". ",t.children]}),s.confirm.finish("Error",t),l(!1)})},titleText:"Prepare host at ".concat(e.ip," with the following?")}),s.confirm.open()},validationSchema:eZ}),d=(0,o.useMemo)(()=>"enterpriseKey",[]),u=(0,o.useMemo)(()=>"name",[]),h=(0,o.useMemo)(()=>"redhatConfirmPassword",[]),m=(0,o.useMemo)(()=>"redhatPassword",[]),p=(0,o.useMemo)(()=>"redhatUsername",[]),x=(0,o.useMemo)(()=>"type",[]),f=(0,o.useMemo)(()=>t.isInetConnected&&/rhel/i.test(t.hostOS)&&!t.isOSRegistered,[t.hostOS,t.isInetConnected,t.isOSRegistered]);return(0,r.jsxs)(ea.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),i.submitForm()},spacing:"1em",children:[(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(ej,{id:x,label:"Host type",name:x,onChange:c,radioItems:ey,value:i.values.type})})}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{id:u,label:"Host name",name:u,onChange:c,required:!0,value:i.values.name})})}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{id:d,label:"Alteeve enterprise key",name:d,onChange:c,value:i.values.enterpriseKey})})}),f&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:p,label:"RedHat username",name:p,onChange:c,value:i.values.redhatUsername})})}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:m,label:"RedHat password",name:m,onChange:c,type:"password",value:i.values.redhatPassword})})}),(0,r.jsx)(ea.ZP,{display:{xs:"none",sm:"initial"},item:!0,sm:1}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:h,label:"Confirm RedHat password",name:h,onChange:c,type:"password",value:i.values.redhatConfirmPassword})})})]}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(L.Z,{count:1,messages:a})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ec.Z,{actions:[{background:"blue",children:"Prepare host",disabled:l,type:"submit"}]})})]})},eM=n(29873),eC=n(21758),eS=n(5499),eI=e=>{let{jobs:t,progress:n}=e,s=(0,o.useMemo)(()=>Object.keys(t),[t]),{altData:l,loading:i}=(0,eS.Z)("/job?broken_keys",{mod:e=>{let t=0,r=s.reduce((n,r)=>{let{[r]:s}=e;return s&&(n.push(s),t+=s.progress),n},[]);return n.setTotal(t/r.length),r},refreshInterval:2e3});return i?(0,r.jsx)(T.Z,{mt:0}):l?(0,r.jsxs)(ea.ZP,{alignItems:"center",container:!0,spacing:"0.5em",children:[(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(y.Ac,{children:100===n.total?"Finished deletion.":"Deleting..."})}),...l.map(e=>{let{progress:t,uuid:n}=e;return(0,r.jsx)(ea.ZP,{item:!0,children:(0,r.jsx)(eC.Z,{slotProps:{pie:{size:"1em"}},value:t})},"".concat(n,"-progress"))})]}):(0,r.jsx)(eM.Z,{type:"warning",children:"Failed to get the list of jobs."})},eA=e=>{let{setResponse:t,tools:n}=e,s=(0,o.useRef)(null),[l,i]=(0,o.useState)(),[a,c]=(0,o.useState)(0),[d,u]=(0,o.useState)(!1),[h,m]=(0,o.useState)([]),p=(0,o.useCallback)(e=>{var t,n;return null===(n=s.current)||void 0===n?void 0:null===(t=n.setMessage)||void 0===t?void 0:t.call(null,"api",e)},[]),{disabledSubmit:x,formik:f,formikErrors:j,handleChange:g}=(0,ek.Z)({initialValues:{ip:"",password:""},onSubmit:(e,s)=>{let{setSubmitting:l}=s;p(),u(!0),m([]),t(void 0),i(void 0);let{ip:o,password:a}=e;R.Z.put("/command/inquire-host",{ipAddress:o,password:a}).then(e=>{let{data:s}=e,{badSshKeys:l,isConnected:c}=s;if(l){p({children:(0,r.jsxs)(r.Fragment,{children:["Host identification at ",o," changed. If this is valid, please delete the conflicting SSH host key."]}),type:"warning"}),m([{background:"red",children:"Delete keys",onClick:()=>{n.confirm.prepare({actionProceedText:"Delete",content:(0,r.jsxs)(y.Ac,{children:["There's a different host key on ",o,", which could mean a MITM attack. But if this change is expected, you can delete the known host key(s) to resolve the conflict."]}),onProceedAppend:()=>{n.confirm.loading(!0),R.Z.delete("/ssh-key/conflict",{data:l}).then(e=>{n.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Started job to delete host key(s) for ",o,"."]})}),p(),m([]);let{data:t}=e;t&&i(t.jobs)}).catch(e=>{let t=(0,B.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to delete host key(s). ",t.children]}),n.confirm.finish("Error",t)})},proceedColour:"red",titleText:"Delete all known SSH host key(s) for ".concat(o,"?")}),n.confirm.open(!0)},type:"button"}]);return}if(!c){p({children:(0,r.jsx)(r.Fragment,{children:"Failed to connect. Please make sure the credentials are correct, and the host is reachable from this striker."}),type:"warning"});return}t({...s,hostIpAddress:o,hostPassword:a}),p()}).catch(e=>{let t=(0,B.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to access ",o,". ",t.children]}),p(t)}).finally(()=>{l(!1),u(!1)})},validationSchema:eb}),Z=(0,o.useMemo)(()=>"ip",[]),b=(0,o.useMemo)(()=>"password",[]),w=(0,o.useMemo)(()=>!!l&&a<100,[l,a]);return(0,r.jsxs)(ea.ZP,{component:"form",container:!0,columns:{xs:1,sm:2},onSubmit:e=>{e.preventDefault(),f.submitForm()},spacing:"1em",children:[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:Z,label:"IP address",name:Z,onChange:g,required:!0,value:f.values.ip})})}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:b,label:"Password",name:b,onChange:g,required:!0,type:"password",value:f.values.password})})}),l&&(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eI,{jobs:l,progress:{total:a,setTotal:c}})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(L.Z,{count:1,messages:j,ref:s})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:d?(0,r.jsx)(T.Z,{mt:0}):(0,r.jsx)(ec.Z,{actions:[...h,{background:"blue",children:"Test access",disabled:x||w,type:"submit"}]})})]})},eF=e=>{let{onValidateHostsChange:t}=e,[n,s]=(0,o.useState)();return(0,r.jsx)(ee.Z,{formDialogProps:{common:{onClose:function(e){let{handlers:{base:t}}=e;for(var n=arguments.length,r=Array(n>1?n-1:0),l=1;l<n;l++)r[l-1]=arguments[l];null==t||t.call(null,...r),setTimeout(s,500)}}},addHeader:"Initialize host",editHeader:"",entriesUrl:"/host?types=dr,node",entryUrlPrefix:"/host",getDeleteErrorMessage:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return{...n,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete host(s). ",e]})}},getDeleteHeader:e=>"Delete the following ".concat(e," host(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted host(s)"})}),listEmpty:"No host(s) found.",listProps:{allowAddItem:!0,allowEdit:!1,allowItemButton:!0},onValidateEntriesChange:t,renderAddForm:e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eA,{setResponse:s,tools:e}),n&&(0,r.jsx)(eP,{host:n,setResponse:s,tools:e})]}),renderDeleteItem:(e,t)=>{let{key:n}=t,s=null==e?void 0:e[n];return(0,r.jsx)(y.Ac,{children:null==s?void 0:s.shortHostName})},renderEditForm:(e,t)=>t&&(0,r.jsx)(et.VZ,{children:(0,r.jsx)(_.Z,{entries:t,renderEntryValue:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];let{0:{entry:l,key:i}}=n;return"command"===i?(0,r.jsx)(eo.Z,{iconProps:{fontSize:"small"},mapPreset:"copy",onClick:()=>navigator.clipboard.writeText(String(l)),size:"small"}):e(...n)},hasPassword:!0})}),renderListItem:(e,t)=>(0,r.jsx)(ei,{data:t})})},eT=n(18573),eU=()=>{let[e,t]=(0,o.useState)(!1);return(0,r.jsxs)(Z.s_,{children:[(0,r.jsxs)(Z.V9,{children:[(0,r.jsx)(y.z,{children:"Hosts"}),(0,r.jsx)(eT.Z,{syncing:e})]}),(0,r.jsx)(eF,{onValidateHostsChange:n=>{n!==e&&t(n)}})]})},eO=n(19166),eN=n(22143),eR=e=>{let{list:t,setValue:n,value:s}=e;return 0===t.length?(0,r.jsx)(y.Ac,{children:"No host(s) found."}):(0,r.jsx)(eN.Z,{centered:!0,onChange:(e,t)=>{n(t)},orientation:"vertical",value:s,children:t.map(e=>{let{hostConfigured:t,hostStatus:n,hostUUID:s,shortHostName:l}=e;return(0,r.jsx)(eO.Z,{label:(0,r.jsxs)(ea.ZP,{columns:{xs:2},container:!0,spacing:"1em",children:[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{noWrap:!0,children:l})}),(0,r.jsx)(ea.ZP,{borderLeft:"thin solid ".concat(ef.d),item:!0,xs:1,children:(0,r.jsxs)(y.Ac,{noWrap:!0,children:[n,t?", configured":""]})})]}),sx:{textAlign:"left"},value:s},"host-".concat(s))})})},eq=n(66859),eE=n(19306);let eD=eg.Ry({hostName:eg.Z_().required(),networkInit:eE.PC});var e_=e=>{let{values:t}=e;return(0,r.jsxs)(ea.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.Ac,{children:"Host name"})}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{children:t.hostName})}),(0,r.jsx)(eE.e2,{...e})]})},eB=n(93666);let eH=e=>{let{dns:t="",gateway:n="",hostName:r="",networks:s}=e,l={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"},defaultifn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"},defaultsn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"sn"},defaultmn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"mn"}};return s&&(l=(0,eB.Z)(s)),{hostName:r,mini:!1,networkInit:{dns:t,gateway:n,networks:l}}};var eL=e=>{let{detail:t,tools:n,uuid:s}=e,l=(0,o.useRef)(null),i=(0,ek.Z)({initialValues:eH(t),onSubmit:(e,s)=>{let{setSubmitting:i}=s,o=(0,eq.Z)(e,l.current);n.confirm.prepare({actionProceedText:"Prepare network",content:l.current&&(0,r.jsx)(e_,{gatewayIface:o.gatewayInterface,ifaces:l.current,values:e}),onCancelAppend:()=>i(!1),onProceedAppend:()=>{n.confirm.loading(!0),R.Z.put("/host/".concat(t.hostUUID,"?handler=subnode-network"),o).then(()=>{n.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started network config on"," ",t.shortHostName]})})}).catch(e=>{let s=(0,B.Z)(e);s.children=(0,r.jsxs)(r.Fragment,{children:["Failed to prepare network on ",t.shortHostName,"."," ",s.children]}),n.confirm.finish("Error",s),i(!1)})},titleText:"Prepare network on ".concat(t.shortHostName," with the following?")}),n.confirm.open()},validationSchema:eD}),{disabledSubmit:a,formik:c,formikErrors:d,handleChange:u}=i,h=(0,o.useMemo)(()=>t.hostType.replace("node","subnode"),[t.hostType]),{parentSequence:m,sequence:p}=(0,o.useMemo)(()=>{let[e,n]=t.shortHostName.replace(/^.*a(\d+).*(?:n|dr)(\d+)$/,"$1,$2").split(",",2);return{parentSequence:Number(e),sequence:Number(n)}},[t.shortHostName]),x=(0,o.useMemo)(()=>({hostName:"hostName",mini:"mini",networks:"networkInit.networks"}),[]);return(0,r.jsxs)(ea.ZP,{columns:{xs:1,sm:2,md:3,lg:4},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),c.handleSubmit(e)},spacing:"1em",children:[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{id:x.hostName,label:"Host name",name:x.hostName,onChange:u,required:!0,value:c.values.hostName})})}),(0,r.jsx)(ea.ZP,{display:{xs:"none",md:"initial"},flexGrow:1,item:!0}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(w.Z,{id:x.mini,label:"Minimal config",name:x.mini,onChange:(e,t)=>{if(t){let{defaultbcn:e}=c.values.networkInit.networks;c.setFieldValue(x.networks,{defaultbcn:e},!0)}else c.resetForm();c.handleChange(e)},checked:c.values.mini})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eE.rQ,{formikUtils:i,host:{parentSequence:m,sequence:p,type:h,uuid:s},onFetchSuccess:e=>{l.current=e}})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(L.Z,{count:1,messages:d})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ec.Z,{actions:[{background:"blue",children:"Prepare network",disabled:a,type:"submit"}]})})]})},eV=n(40657),ez=e=>{let{uuid:t}=e,{confirmDialog:n,finishConfirm:s,setConfirmDialogLoading:l,setConfirmDialogOpen:i,setConfirmDialogProps:a}=(0,eV.Z)({initial:{scrollContent:!0,wide:!0}}),c=(0,o.useMemo)(()=>({add:{open:()=>null},confirm:{finish:s,loading:l,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return i(e)},prepare:a},edit:{open:()=>null}}),[s,l,i,a]),{data:d}=(0,eS.Z)("/host/".concat(t));return d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eL,{detail:d,tools:c,uuid:t}),n]}):(0,r.jsx)(T.Z,{mt:0})},e$=n(17428),eW=()=>{let[e,t]=(0,o.useState)(!1),{data:n}=(0,eS.Z)("/host?types=dr,node"),s=(0,o.useMemo)(()=>n&&Object.values(n),[n]);return s?(0,r.jsxs)(Z.s_,{children:[(0,r.jsx)(eR,{list:s,setValue:t,value:e}),e&&(0,r.jsx)(er.Z,{sx:{margin:"2em 0"}}),s.map(t=>(0,r.jsx)(e$.Z,{changingTabId:e,tabId:t.hostUUID,children:(0,r.jsx)(ez,{uuid:t.hostUUID})},"cell-".concat(t.hostUUID)))]}):(0,r.jsx)(Z.s_,{children:(0,r.jsx)(T.Z,{})})},eG=n(28951),eJ=n(91905);let eQ="an-host-input",eK="".concat(eQ,"-cell"),eX="IPMI IP",eY={fence:(e,t)=>{let{dataset:{hostId:n="",fenceId:r="",fenceName:s=""},value:l}=t,{hostConfig:{hosts:{[n]:i}}}=e,{fences:o={}}=i;o[r]={fenceName:s,fencePort:l},i.fences=o},host:(e,t)=>{let{dataset:{hostId:n="",hostNumber:r="",hostType:s=""}}=t,l=Number.parseInt(r,10);e.hostConfig.hosts[n]={hostNumber:l,hostType:s}},ipmi:(e,t)=>{let{dataset:{hostId:n=""},value:r}=t,{hostConfig:{hosts:{[n]:s}}}=e;s.ipmiIp=r},network:(e,t)=>{let{dataset:{hostId:n="",networkId:r="",networkNumber:s="",networkType:l=""},value:i}=t,{hostConfig:{hosts:{[n]:o}}}=e,{networks:a={}}=o,c=Number.parseInt(s,10);a[r]={networkIp:i,networkNumber:c,networkType:l},o.networks=a},ups:(e,t)=>{let{checked:n,dataset:{hostId:r="",upsId:s="",upsName:l=""}}=t,{hostConfig:{hosts:{[r]:i}}}=e,{upses:o={}}=i;o[s]={isUsed:n,upsName:l},i.upses=o}},e0={xs:1,sm:2,md:3},e1=(e,t)=>"".concat(eQ,"-").concat(e,"-").concat(t,"-port"),e2=e=>"".concat(eQ,"-").concat(e,"-ipmi-ip"),e5=(e,t)=>"".concat(eQ,"-").concat(e,"-").concat(t,"-ip"),e8=(e,t)=>"".concat(eQ,"-").concat(e,"-").concat(t,"-power-host");var e3=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,buildInputUnmountFunction:s,setMessage:l},hostId:i,hostNumber:a,hostType:c,previous:{fences:d={},ipmiIp:u,networks:h={},upses:m={}}={},hostLabel:p="".concat(c.replace("node","subnode")," ").concat(a)}=e,x=(0,o.useMemo)(()=>Object.entries(d),[d]),f=(0,o.useMemo)(()=>Object.entries(h),[h]),b=(0,o.useMemo)(()=>Object.entries(m),[m]),P=(0,o.useMemo)(()=>!!b.length,[b.length]),M=(0,o.useMemo)(()=>"".concat(eQ,"-").concat(i),[i]),C=(0,o.useMemo)(()=>e2(i),[i]),S=(0,o.useMemo)(()=>"".concat(eK,"-").concat(i,"-ipmi-ip"),[i]),I=(0,o.useMemo)(()=>x.reduce((e,s)=>{let[o,{fenceName:a,fencePort:c}]=s,d="".concat(eK,"-").concat(i,"-").concat(o,"-port"),u=e1(i,o),h="Plug on ".concat(a);return e[d]={children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{baseInputProps:{"data-handler":"fence","data-host-id":i,"data-fence-id":o,"data-fence-name":a},id:u,label:h,value:c}),inputTestBatch:(0,k.Gn)("".concat(i," ").concat(h),()=>{l(u)},{onFinishBatch:t(u)},e=>{l(u,{children:e})}),onFirstRender:n(u)})},e},{}),[t,n,x,i,l]),A=(0,o.useMemo)(()=>f.reduce((e,o)=>{let[a,{networkIp:c,networkNumber:d,networkType:u}]=o,h="".concat(eK,"-").concat(i,"-").concat(a,"-ip"),m=e5(i,a),p="".concat(u.toUpperCase()," ").concat(d," IP");return e[h]={children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{baseInputProps:{"data-handler":"network","data-host-id":i,"data-network-id":a,"data-network-number":d,"data-network-type":u},id:m,label:p,value:c}),inputTestBatch:(0,k._)("".concat(i," ").concat(p),()=>{l(m)},{onFinishBatch:t(m)},e=>{l(m,{children:e})}),onFirstRender:n(m),onUnmount:s(m),required:!0})},e},{}),[f,i,t,n,s,l]),F=(0,o.useMemo)(()=>b.reduce((e,t)=>{let[n,{isUsed:s,upsName:l}]=t,o="".concat(eK,"-").concat(i,"-").concat(n,"-power-host"),a=e8(i,n),c="Uses ".concat(l);return e[o]={children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(w.Z,{baseInputProps:{"data-handler":"ups","data-host-id":i,"data-ups-id":n,"data-ups-name":l},checked:s,id:a,label:c}),valueType:"boolean"})},e},{}),[i,b]),T=(0,o.useMemo)(()=>P&&(0,r.jsx)(eJ.Z,{columns:e0,layout:F,spacing:"1em"}),[P,F]);return(0,r.jsxs)(Z.Lg,{mv:0,children:[(0,r.jsx)(Z.CH,{children:(0,r.jsx)(y.Ac,{children:p})}),(0,r.jsxs)(Z.bc,{children:[(0,r.jsx)("input",{hidden:!0,id:M,readOnly:!0,"data-handler":"host","data-host-id":i,"data-host-number":a,"data-host-type":c}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(eJ.Z,{columns:e0,layout:{"fence-message":{children:(0,r.jsx)(eM.Z,{children:"It is recommended to provide at least 1 fence device plug."}),width:"100%",xs:0},...A,[S]:{children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{baseInputProps:{"data-handler":"ipmi","data-host-id":i},id:C,label:eX,value:u}),inputTestBatch:(0,k._)("".concat(i," ").concat(eX),()=>{l(C)},{onFinishBatch:t(C)},e=>{l(C,{children:e})}),onFirstRender:n(C),onUnmount:s(C)})},...I},spacing:"1em"}),T]})]})]})};let e9="".concat("".concat("an-host-config-input","-group"),"-cell"),e7={node1:{hostNumber:1,hostType:"node"},node2:{hostNumber:2,hostType:"node"}},e4=e=>{let{anSeq:t,minIp:n,offset3:r=10,step3:s=2,subnetMask:l,subSeq:i}=e;try{let e=new eG.Netmask("".concat(n,"/").concat(l));if(16!==e.bitmask)return"".concat(e.base.replace(/\.0/g,""),".");return n.replace(/^((\d+\.){2})\d+\.\d+$/,"$1".concat((t-1)*s+r,".").concat(i))}catch(e){return""}};var e6=e=>{let{anSequence:t,formUtils:n,knownFences:s={},knownUpses:l={},networkListEntries:i,previous:{hosts:a=e7}={}}=e,c=(0,o.useMemo)(()=>Object.entries(a),[a]),d=(0,o.useMemo)(()=>Object.values(s),[s]),u=(0,o.useMemo)(()=>Object.values(l),[l]),h=(0,o.useMemo)(()=>c.reduce((e,s)=>{let[l,o]=s,{fences:a={},hostNumber:c,hostType:h,ipmiIp:m,networks:p={},upses:x={}}=o,f=m,j=d.reduce((e,t)=>{let{fenceName:n}=t,{[n]:{fencePort:r=""}={}}=a;return e[n]={fenceName:n,fencePort:r},e},{}),g=i.reduce((e,n)=>{let[r,{networkMinIp:s,networkNumber:l,networkSubnetMask:i,networkType:o}]=n,{[r]:{networkIp:a=""}={}}=p;return a||(a=e4({anSeq:t,minIp:s,subnetMask:i,subSeq:c})),f||"bcn"!==o||1!==l||(f=e4({anSeq:t,minIp:s,offset3:11,subnetMask:i,subSeq:c})),e[r]={networkIp:a,networkNumber:l,networkType:o},e},{}),v=u.reduce((e,t)=>{let{upsName:n}=t,{[n]:{isUsed:r=!0}={}}=x;return e[n]={isUsed:r,upsName:n},e},{});return e["".concat(e9,"-").concat(l)]={children:(0,r.jsx)(e3,{formUtils:n,hostId:l,hostNumber:c,hostType:h,previous:{fences:j,ipmiIp:f,networks:g,upses:v}}),md:3,sm:2},e},{}),[t,n,c,d,u,i]);return(0,r.jsx)(eJ.Z,{columns:{xs:1,sm:2,md:3},layout:h,spacing:"1em"})},te=n(23279),tt=n.n(te);let tn="an-id-input",tr="".concat(tn,"-domain"),ts="".concat(tn,"-prefix"),tl="".concat(tn,"-sequence"),ti="Domain name",to="Prefix",ta="Sequence";var tc=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:s,setMessage:l},onSequenceChange:i,previous:{domain:a,prefix:c,sequence:d}={}}=e,u=(0,o.useMemo)(()=>i&&tt()(i,t),[t,i]);return(0,r.jsx)(eJ.Z,{columns:{xs:1,sm:2,md:3},layout:{"an-id-input-cell-prefix":{children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:ts,label:to,value:c}),inputTestBatch:(0,k.Gn)(to,()=>{l(ts)},{onFinishBatch:n(ts)},e=>{l(ts,{children:e})}),onFirstRender:s(ts),required:!0})},"an-id-input-cell-domain":{children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:tr,label:ti,value:a}),inputTestBatch:(0,k.Gn)(ti,()=>{l(tr)},{onFinishBatch:n(tr)},e=>{l(tr,{children:e})}),onFirstRender:s(tr),required:!0})},"an-id-input-cell-sequence":{children:(0,r.jsx)(g.Z,{createInputOnChangeHandlerOptions:{postSet:u},input:(0,r.jsx)(v.Z,{id:tl,label:ta,value:d}),inputTestBatch:(0,k.qY)(ta,()=>{l(tl)},{onFinishBatch:n(tl)},e=>{l(tl,{children:e})}),onFirstRender:s(tl),required:!0,valueType:"number"})}},spacing:"1em"})},td=n(25934),tu=n(94047);let th="an-network-input",tm="".concat(th,"-cell"),tp={gateway:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkGateway=r},minip:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkMinIp=r},network:(e,t)=>{let{dataset:{networkId:n="",networkNumber:r="",networkType:s=""}}=t,{networkConfig:{networks:l}}=e,i=Number.parseInt(r,10);l[n]={networkNumber:i,networkType:s}},subnetmask:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkSubnetMask=r}},tx=e=>"".concat(th,"-").concat(e,"-gateway"),tf=e=>"".concat(th,"-").concat(e,"-min-ip"),tj=e=>"".concat(th,"-").concat(e,"-network-type"),tg=e=>"".concat(th,"-").concat(e,"-subnet-mask");var tv=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:s,buildInputUnmountFunction:l,setMessage:i},inputGatewayLabel:a="Gateway",inputMinIpLabel:c="IP address",inputSubnetMaskLabel:d="Subnet mask",networkId:u,networkNumber:h,networkType:m,networkTypeOptions:p,onClose:x,onNetworkGatewayChange:f,onNetworkMinIpChange:j,onNetworkSubnetMaskChange:w,onNetworkTypeChange:y,previous:{gateway:P,minIp:M,subnetMask:C}={},readonlyNetworkName:S,showCloseButton:I,showGateway:A}=e,F=(0,o.useMemo)(()=>"".concat(tu.Z[m]," ").concat(h),[h,m]),T=(0,o.useMemo)(()=>"".concat(tm,"-").concat(u,"-gateway"),[u]),U=(0,o.useMemo)(()=>"".concat(tm,"-").concat(u,"-ip"),[u]),O=(0,o.useMemo)(()=>"".concat(tm,"-").concat(u,"-subnet-mask"),[u]),N=(0,o.useMemo)(()=>"".concat(th,"-").concat(u),[u]),R=(0,o.useMemo)(()=>tx(u),[u]),q=(0,o.useMemo)(()=>tf(u),[u]),E=(0,o.useMemo)(()=>tj(u),[u]),D=(0,o.useMemo)(()=>tg(u),[u]),_=(0,o.useMemo)(()=>A?void 0:"none",[A]),B=(0,o.useMemo)(()=>f&&tt()(f,t),[t,f]),H=(0,o.useMemo)(()=>j&&tt()(j,t),[t,j]),L=(0,o.useMemo)(()=>w&&tt()(w,t),[t,w]),V=(0,o.useMemo)(()=>I&&(0,r.jsx)(eo.Z,{mapPreset:"close",iconProps:{fontSize:"small"},onClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==x||x.call(null,{networkId:u,networkType:m},...t)},sx:{padding:".2em",position:"absolute",right:"-.6rem",top:"-.2rem"}}),[I,u,m,x]),z=(0,o.useMemo)(()=>{let e;return A&&R&&(e=(0,r.jsx)(g.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==B?void 0:B.call(null,{networkId:u,networkType:m},...t)}},input:(0,r.jsx)(v.Z,{baseInputProps:{"data-handler":"gateway","data-network-id":u},id:R,label:a,value:P}),inputTestBatch:(0,k._)("".concat(F," ").concat(a),()=>{i(R)},{onFinishBatch:n(R)},e=>{i(R,{children:e})}),onFirstRender:s(R),onUnmount:l(R),required:A})),e},[A,R,u,a,P,F,n,s,l,B,m,i]);return(0,r.jsxs)(Z.Lg,{mv:0,children:[(0,r.jsxs)(Z.CH,{children:[(0,r.jsx)(g.Z,{input:(0,r.jsx)(b.Z,{id:E,isReadOnly:S,onChange:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==y||y.call(null,{networkId:u,networkType:m},...t)},selectItems:p,selectProps:{renderValue:()=>F},value:m})}),V]}),(0,r.jsxs)(Z.bc,{children:[(0,r.jsx)("input",{hidden:!0,id:N,readOnly:!0,"data-handler":"network","data-network-id":u,"data-network-number":h,"data-network-type":m}),(0,r.jsx)(eJ.Z,{columns:{xs:1,sm:2,md:3},layout:{[U]:{children:(0,r.jsx)(g.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==H?void 0:H.call(null,{networkId:u,networkType:m},...t)}},input:(0,r.jsx)(v.Z,{baseInputProps:{"data-handler":"minip","data-network-id":u},id:q,label:c,value:M}),inputTestBatch:(0,k._)("".concat(F," ").concat(c),()=>{i(q)},{onFinishBatch:n(q)},e=>{i(q,{children:e})}),onFirstRender:s(q),onUnmount:l(q),required:!0})},[O]:{children:(0,r.jsx)(g.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==L?void 0:L.call(null,{networkId:u,networkType:m},...t)}},input:(0,r.jsx)(v.Z,{baseInputProps:{"data-handler":"subnetmask","data-network-id":u},id:D,label:d,value:C}),inputTestBatch:(0,k._)("".concat(F," ").concat(d),()=>{i(D)},{onFinishBatch:n(D)},e=>{i(D,{children:e})}),onFirstRender:s(D),onUnmount:l(D),required:!0})},[T]:{children:z,display:_}},spacing:"1em"})]})]})},tZ=n(95996);let tb="an-network-config-input",tw="".concat(tb,"-cell"),tk="".concat(tb,"-dns"),ty="".concat(tb,"-ntp"),tP=Object.entries(tu.Z),tM={bcn:{base:"10.201.0.0",mask:"255.255.0.0"},mn:{base:"10.199.0.0",mask:"255.255.0.0"},sn:{base:"10.101.0.0",mask:"255.255.0.0"}},tC=e=>"ifn"===e,tS=e=>"mn"===e,tI=e=>{let{entries:t,type:n}=e,r=t.filter(e=>{let[,{networkType:t}]=e;return t===n}).sort((e,t)=>{let[,{networkNumber:n}]=e,[,{networkNumber:r}]=t;return n>r?1:-1}).pop();if(!r){var s;return null!==(s=tM[n])&&void 0!==s?s:{}}let[,{networkMinIp:l,networkSubnetMask:i}]=r;try{let{base:e,mask:t}=new eG.Netmask("".concat(l,"/").concat(i)).next();return{base:e,mask:t}}catch(e){return{}}};var tA=e=>{let{formUtils:t,networkListEntries:n,previous:{dnsCsv:s="8.8.8.8,8.8.4.4",ntpCsv:l}={},setNetworkList:i}=e,{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:c,setMessage:d,setMessageRe:u}=t,h=(0,o.useCallback)(function(e){let{input:t=n,end:r=n.length}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r-1,l=0;return t.every((t,n)=>{let[,{networkType:r}]=t;return r===e&&(l+=1),n<s}),l},[n]),m=(0,o.useMemo)(()=>tP.map(e=>{let[t,n]=e;return{displayValue:n,value:t}}),[]),p=(0,o.useCallback)(function(){let{networkMinIp:e="",networkSubnetMask:t="",networkType:r=n.some(e=>{let[,{networkType:t}]=e;return tS(t)})?"ifn":"mn",networkGateway:s=tC(r)?"":void 0,networkNumber:l=h(r)+1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{base:i=e,mask:o=t}=tI({entries:n,type:r});return{network:{networkGateway:s,networkMinIp:i,networkNumber:l,networkSubnetMask:o,networkType:r},networkId:(0,td.Z)()}},[h,n]),x=(0,o.useCallback)((e,t)=>i((0,tZ.ZP)(e,t)),[i]),f=(0,o.useCallback)((e,t,n)=>i(r=>{let s={...r},{[e]:l}=s;return l&&(l[t]=n),s}),[i]),j=(0,o.useCallback)((e,t)=>{let{networkId:r,networkType:s}=e,{target:{value:l}}=t,o=String(l),a=!1,c=0;i(n.reduce((e,t)=>{let[l,i]=t,{networkNumber:d,networkType:h,networkMinIp:m,networkSubnetMask:p,...x}=i,f=d,j=h;l===r&&(a=!0,j=o,u(RegExp(l)));let g=j===o;if(g&&(c+=1),a){g?f=c:j===s&&(f-=1);let{base:t=m,mask:r=p}=tI({entries:n,type:j});e[l]={...x,networkMinIp:t,networkSubnetMask:r,networkNumber:f,networkType:j}}else e[l]=i;return e},{}))},[n,u,i]),Z=(0,o.useCallback)(e=>{let{networkId:t,networkType:r}=e,s=!1,l=0;i(n.reduce((e,n)=>{let[i,o]=n;if(i===t)return s=!0,e;let{networkType:a}=o,c=a===r;return c&&(l+=1),e[i]=s&&c?{...o,networkNumber:l}:o,e},{}))},[n,i]),b=(0,o.useMemo)(()=>n.reduce((e,n)=>{let[s,{networkGateway:l,networkMinIp:i,networkNumber:o,networkSubnetMask:a,networkType:c}]=n,d="".concat(tw,"-").concat(s),u=1===o,h=tC(c),p=tS(c)||!u;return e[d]={children:(0,r.jsx)(tv,{formUtils:t,networkId:s,networkNumber:o,networkType:c,networkTypeOptions:m,onClose:Z,onNetworkMinIpChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return f(n,"networkMinIp",r)},onNetworkSubnetMaskChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return f(n,"networkSubnetMask",r)},onNetworkTypeChange:j,previous:{gateway:l,minIp:i,subnetMask:a},readonlyNetworkName:!p,showCloseButton:p,showGateway:h}),md:3,sm:2},e},{}),[n,t,m,Z,j,f]);return(0,r.jsx)(eJ.Z,{columns:{xs:1,sm:2,md:3},layout:{...b,"an-network-config-cell-add-network":{children:(0,r.jsx)(eo.Z,{mapPreset:"add",onClick:()=>{let{network:e,networkId:t}=p();x(t,e)}}),display:"flex",justifyContent:"center",md:3,sm:2},"an-network-config-input-cell-dns":{children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:tk,label:"DNS",value:s}),inputTestBatch:(0,k.dg)("DNS",()=>{d(tk)},{onFinishBatch:a(tk)},e=>{d(tk,{children:e})}),onFirstRender:c(tk),required:!0})},"an-network-config-input-cell-ntp":{children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:ty,label:"NTP",value:l}),inputTestBatch:(0,k.dg)("NTP",()=>{d(ty)},{onFinishBatch:a(ty)},e=>{d(ty,{children:e})}),onFirstRender:c(ty)})}},spacing:"1em"})};let tF={bcn1:{networkMinIp:"10.201.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"bcn"},sn1:{networkMinIp:"10.101.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"sn"},ifn1:{networkMinIp:"",networkNumber:1,networkSubnetMask:"",networkType:"ifn"}};var tT=e=>{var t;let{formUtils:n,knownFences:s,knownUpses:l,previous:{hostConfig:i,networkConfig:a={},...c}={}}=e,{networks:d=tF}=a,[u,h]=(0,o.useState)(null!==(t=null==c?void 0:c.sequence)&&void 0!==t?t:0),[m,p]=(0,o.useState)(d),x=(0,o.useMemo)(()=>Object.entries(m),[m]);return(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(tc,{formUtils:n,onSequenceChange:e=>{let{target:{value:t}}=e;h(Number(t))},previous:c}),(0,r.jsx)(tA,{formUtils:n,networkListEntries:x,previous:a,setNetworkList:p}),(0,r.jsx)(e6,{anSequence:u,formUtils:n,knownFences:s,knownUpses:l,networkListEntries:x,previous:i})]})},tU=e=>{let{formUtils:t,knownFences:n,knownUpses:s,previous:l}=e;return(0,r.jsx)(tT,{formUtils:t,knownFences:n,knownUpses:s,previous:l})},tO=n(50361),tN=n.n(tO),tR=n(47856),tq=n(74178);let tE=eg.Ry({name:eg.Z_().required(),uuid:(0,ev.uI)().required()}),tD=eg.Ry({anvil:eg.Vo(e=>void 0!==e?tE:eg.nK().optional()),number:eg.Rx(),type:eg.Z_(),uuid:(0,ev.uI)().required()}),t_=eg.Z_().when("rerun",(e,t)=>e[0]?t.optional():t.required()),tB=eg.Ry({confirmPassword:t_.oneOf([eg.iH("password")]),description:t_,hosts:eg.Vo(e=>eg.Ry((0,tq.Z)(e,tD))),password:t_,rerun:eg.O7().required(),reuseHosts:eg.O7().when("hosts",(e,t)=>Object.values(e[0]).some(e=>!!e.anvil)?t.isTrue():t.isFalse())});var tH=e=>{let{detail:t,knownFences:n,knownHosts:s,knownUpses:l,onSubmitSuccess:i,tools:a}=e,{anvil:c,domain:d,hostConfig:u,networkConfig:h}=t,{hosts:m}=u,{dnsCsv:p,networks:x,ntpCsv:g}=h,Z=(0,o.useMemo)(()=>Object.entries(m),[m]),w=(0,o.useMemo)(()=>Object.entries(x),[x]),k=(0,o.useMemo)(()=>Object.entries(n),[n]),P=(0,o.useMemo)(()=>Object.entries(s),[s]),M=(0,o.useMemo)(()=>Object.entries(l),[l]),C=(0,o.useMemo)(()=>P.map(e=>{let[,{anvil:t,hostName:n,hostUUID:s}]=e;return{displayValue:(0,r.jsxs)(j.Z,{spacing:0,children:[(0,r.jsx)(y.Ac,{inverted:!0,children:n}),(0,r.jsx)(y.KI,{inverted:!0,children:t?"Used by ".concat(t.name):"Ready"})]}),value:s}}),[P]),{disabledSubmit:S,formik:I,formikErrors:A,handleChange:F}=(0,ek.Z)({initialValues:{confirmPassword:"",description:"",hosts:Z.reduce((e,t)=>{let n;let[r,{hostName:l,hostNumber:i,hostType:o}]=t,a="";if(c){let{hosts:{[i]:{uuid:e}}}=c;a=e;let t=s[e];t&&(n=t.anvil)}else if(l){let e=P.find(e=>{let[,{shortHostName:t}]=e;return t===l});if(e){let[,t]=e;n=t.anvil,a=t.hostUUID}}return e[r]={anvil:n,number:i,type:o,uuid:a},e},{}),password:"",rerun:!!c,reuseHosts:!1},onSubmit:(e,n)=>{let{setSubmitting:l}=n,{confirmPassword:o,rerun:c,reuseHosts:u,hosts:h,...p}=e,x={...c?null:p,hosts:Object.values(h).reduce((e,t)=>{let{number:n,type:r,uuid:l}=t,i="".concat(r).concat(n);return e["".concat(r.replace("node","Subnode")," ").concat(n)]={useHost:s[l].hostName,renameTo:"".concat(m[i].hostName,".").concat(d)},e},{})};a.confirm.prepare({actionProceedText:"Run",content:(0,r.jsx)(_.Z,{entries:x,hasPassword:!0}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{a.confirm.loading(!0),R.Z.put("/command/run-manifest/".concat(t.uuid),e).then(()=>{a.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started installing ",t.name]})}),null==i||i.call(null),a.edit.open(!1)}).catch(e=>{let t=(0,B.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to run install manifest. ",t.children]}),a.confirm.finish("Error",t),l(!1)})},titleText:"Run install manifest ".concat(t.name," with the following?")}),a.confirm.open()},validationSchema:tB}),T=(0,o.useMemo)(()=>"confirmPassword",[]),U=(0,o.useMemo)(()=>"description",[]),O=(0,o.useMemo)(()=>"hosts",[]),N=(0,o.useMemo)(()=>"password",[]),q=(0,o.useMemo)(()=>"reuseHosts",[]),E=(0,o.useMemo)(()=>Z.reduce((e,t)=>{let[n,{hostNumber:l,hostType:i}]=t,o="".concat(O,".").concat(n),a="".concat(o,".uuid"),c="".concat(i.replace("node","Subnode")," ").concat(l);return e.push((0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(b.Z,{id:a,label:c,name:a,onChange:e=>{let{target:{value:t}}=e,{[t]:{anvil:r}}=s,o=tN()(I.values.hosts),a=Object.entries(o).find(e=>{let[r,{uuid:s}]=e;return r!==n&&s===t});if(a){let[e,t]=a,{number:r,type:s}=t;o[e]={...o[n],number:r,type:s}}return o[n]={anvil:r,number:l,type:i,uuid:t},I.setFieldValue(O,o)},required:!0,selectItems:C,selectProps:{renderValue:e=>{let{[e]:{hostName:t}}=s;return t}},value:I.values.hosts[n].uuid})},"".concat(n,"-selector"))),e},[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.Ac,{children:"Use host"})},"host-selector-header")]),[I,Z,C,O,s]),D=(0,o.useMemo)(()=>Z.reduce((e,t)=>{let[n,{hostName:s}]=t;return e.push((0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsxs)(y.$_,{noWrap:!0,children:[s,".",d]})},"".concat(n,"-rename"))),e},[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.Ac,{children:"New hostname"})},"host-rename-header")]),[Z,d]),H=(0,o.useMemo)(()=>w.reduce((e,t)=>{let[n,s]=t,{networkNumber:l,networkType:i}=s,o="".concat(i.toLocaleUpperCase()).concat(l),a=Z.map(e=>{let[t,{networks:s}]=e,l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{children:e})},"".concat(n,"-").concat(t,"-ip"))};if(!s)return l();let{[n]:i}=s;if(!i)return l();let{networkIp:o}=i;return l(o)});return e.push((0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.Ac,{children:o})},"".concat(n,"-header")),...a),e},[]),[Z,w]),V=(0,o.useMemo)(()=>k.reduce((e,t)=>{let[n,s]=t,{fenceName:l}=s,i=Z.map(e=>{let[t,{fences:s}]=e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{children:e})},"".concat(n,"-").concat(t,"-port"))};if(!s)return i();let{[l]:o}=s;if(!o)return i();let{fencePort:a}=o;return i(a)});return e.push((0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsxs)(y.Ac,{children:["Plug on ",l]})},"".concat(n,"-header")),...i),e},[]),[Z,k]),z=(0,o.useMemo)(()=>M.reduce((e,t)=>{let[n,s]=t,{upsName:l}=s,i=Z.map(e=>{let[t,{upses:s}]=e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{children:e})},"".concat(n,"-").concat(t,"-used"))};if(!s)return i();let{[l]:o}=s;if(!o)return i();let{isUsed:a}=o;return i(a?"yes":"no")});return e.push((0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsxs)(y.Ac,{children:["Uses ",l]})},"".concat(n,"-header")),...i),e},[]),[Z,M]),$=(0,o.useMemo)(()=>{let e;let t=w.find(e=>{let{1:{networkGateway:t}}=e;return!!t}),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{justifyContent:"end",children:e})},"gateway-value")};if(t){let[,{networkGateway:r}]=t;e=r&&r.length>0?n(r):n()}else e=n();return[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.Ac,{children:"Gateway"})},"gateway-header"),e]},[w]),W=(0,o.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{justifyContent:"end",children:e})},"dns-value")},t=p&&p.length>0?e(p):e();return[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.Ac,{children:"DNS"})},"dns-header"),t]},[p]),G=(0,o.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.$_,{justifyContent:"end",children:e})},"ntp-value")},t=g&&g.length>0?e(g):e();return[(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(y.Ac,{children:"NTP"})},"ntp-header"),t]},[g]),J=(0,o.useMemo)(()=>{let e=Object.values(I.values.hosts).filter(e=>!!e.anvil);if(0===e.length)return null;let t=e.slice(1).reduce((e,t)=>"".concat(e,", ").concat(s[t.uuid].shortHostName),s[e[0].uuid].shortHostName);return(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(eM.Z,{children:[(0,r.jsx)(tR.Z,{id:q,invert:!0,name:q,onChange:I.handleChange,required:!0,sx:{marginRight:".5em"},thinPadding:!0,value:I.values.reuseHosts}),"Confirm reusing host(s): ",t,"."]})})},[I,s,q]);return(0,r.jsxs)(ea.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),I.submitForm()},spacing:"1em",children:[c?(0,r.jsxs)(ea.ZP,{item:!0,width:"100%",children:[(0,r.jsx)(y.Ac,{children:"Description"}),(0,r.jsx)(y.Ac,{children:c.description})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{id:U,label:"Description",name:U,onChange:F,required:!0,value:I.values.description})})}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:N,label:"Password",name:N,onChange:F,required:!0,type:f.Z.password,value:I.values.password})})}),(0,r.jsx)(ea.ZP,{item:!0,xs:1,children:(0,r.jsx)(ew.Z,{input:(0,r.jsx)(v.Z,{disableAutofill:!0,id:T,label:"Confirm password",name:T,onChange:F,required:!0,type:f.Z.password,value:I.values.confirmPassword})})})]}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(ea.ZP,{alignItems:"center",columns:Z.length+1,columnSpacing:"1em",container:!0,rowSpacing:".6em",children:[...E,...D,...H,...V,...z]})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(ea.ZP,{columns:2,container:!0,spacing:".6em",children:[...$,...W,...G]})}),J,(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(L.Z,{count:1,messages:A})}),(0,r.jsx)(ea.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ec.Z,{actions:[{background:"blue",children:"Run",disabled:S,type:"submit"}]})})]})};let tL=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[{target:r}]=t,{elements:s}=r,{value:l}=s.namedItem(tr),{value:i}=s.namedItem(ts),{value:o}=s.namedItem(tl),{value:a}=s.namedItem(tk),{value:c}=s.namedItem(ty),d=Number.parseInt(o,10);return Object.values(s).reduce((e,t)=>{var n,r;let{id:s}=t;if(RegExp("^".concat(eQ)).test(s)){let{dataset:{handler:r=""}}=t;null===(n=eY[r])||void 0===n||n.call(null,e,t)}else if(RegExp("^".concat(th)).test(s)){let{dataset:{handler:n=""}}=t;null===(r=tp[n])||void 0===r||r.call(null,e,t)}return e},{domain:l,hostConfig:{hosts:{}},networkConfig:{dnsCsv:a,networks:{},ntpCsv:c},prefix:i,sequence:d})};var tV=()=>{let e=(0,o.useRef)({}),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)(null),l=(0,o.useRef)({}),[i,a]=(0,$.Z)(),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(!0),[m,p]=(0,o.useState)(),{data:x,loading:f,mutate:g}=(0,eS.Z)("/manifest",{refreshInterval:1e4}),{data:v,loading:b,mutate:w}=(0,eS.Z)("/manifest/template"),{data:k,loading:P,mutate:M}=(0,eS.Z)("/host?types=node"),C=(0,W.Z)([tr,ts,tl,tk,ty],l),{isFormInvalid:S,isFormSubmitting:I,submitForm:A}=C,{buildDeleteDialogProps:F,checks:U,getCheck:O,hasChecks:N,resetChecks:E,setCheck:V}=(0,z.Z)({list:x}),{name:G,uuid:J}=(0,o.useMemo)(()=>null!=m?m:{},[m]),{domain:Q,fences:K,prefix:X,sequence:Y,upses:ee}=(0,o.useMemo)(()=>null!=v?v:{},[v]),en=(0,o.useCallback)(e=>{let{hostConfig:{hosts:t}}=e,n=Object.values(t).reduce((e,t)=>{let{fences:n,hostType:r,hostNumber:s}=t,l="".concat(r.replace(/node/,"subnode")).concat(s);return n?e[l]=Object.values(n).reduce((e,t)=>{let{fencePort:n}=t;return e+(n.length?1:0)},0):e[l]=0,e},{}),s=Object.entries(n).map(e=>{let[t,n]=e;return n?(0,r.jsx)(r.Fragment,{}):(0,r.jsxs)(eM.Z,{children:["No fence device port specified for ",t,"."]},"".concat(t,"-no-fence-port-message"))});return{counts:n,messages:s}},[]),er=(0,o.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(tT,{formUtils:C,knownFences:K,knownUpses:ee,previous:{domain:Q,prefix:X,sequence:Y}}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),l=0;l<n;l++)s[l]=arguments[l];let i=tL(...s),{messages:o}=en(i);a({actionProceedText:"Add",content:(0,r.jsx)(_.Z,{entries:i,maxDepth:6}),onProceedAppend:()=>{A({body:i,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add install manifest. ",e]}),method:"post",onSuccess:()=>g(),successMsg:"Successfully added install manifest",url:"/manifest"})},preActionArea:(0,r.jsx)(j.Z,{spacing:".3em",children:o}),titleText:"Add install manifest?"}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},titleText:"Add an install manifest"}),[en,C,g,K,ee,Q,X,Y,a,A]),es=(0,o.useMemo)(()=>({actionProceedText:"Edit",content:(0,r.jsx)(tU,{formUtils:C,knownFences:K,knownUpses:ee,previous:m}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),l=0;l<n;l++)s[l]=arguments[l];let i=tL(...s),{messages:o}=en(i);a({actionProceedText:"Edit",content:(0,r.jsx)(_.Z,{entries:i,maxDepth:6}),onProceedAppend:()=>{A({body:i,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update install manifest. ",e]}),method:"put",onSuccess:()=>g(),successMsg:"Successfully updated install manifest ".concat(G),url:"/manifest/".concat(J)})},preActionArea:(0,r.jsx)(j.Z,{spacing:".3em",children:o}),titleText:"Update install manifest ".concat(G,"?")}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},loading:u,titleText:"Update install manifest ".concat(G)}),[en,C,g,u,K,ee,m,G,J,a,A]),el=(0,o.useCallback)((e,t)=>{h(!0),R.Z.get("manifest/".concat(e)).then(t=>{let{data:n}=t;n.uuid=e,p(n)}).catch(e=>{(0,B.Z)(e)}).finally(()=>{h(!1),null==t||t.call(null)})},[h,p]),ei=(0,o.useMemo)(()=>(0,r.jsx)(H.Z,{allowEdit:!0,allowItemButton:c,disableDelete:!N,edit:c,header:!0,listEmpty:"No manifest(s) registered.",listItems:x,onAdd:()=>{var e;null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var t;a(F({onProceedAppend:()=>{A({body:{uuids:U},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Delete manifest(s) failed. ",e]}),method:"delete",onSuccess:()=>{g(),E()},url:"/manifest"})},getConfirmDialogTitle:e=>"Delete ".concat(e," manifest(s)?"),renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(y.Ac,{children:null==x?void 0:x[t].manifestName})}})),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},onEdit:()=>{d(e=>!e)},onItemCheckboxChange:(e,t,n)=>{V(e,n)},onItemClick:e=>{var t;let{manifestName:r,manifestUUID:s}=e;p({name:r,uuid:s}),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0),el(s)},renderListItemCheckboxState:e=>O(e),renderListItem:(e,t)=>{let{manifestName:n}=t;return(0,r.jsxs)(j.Z,{fullWidth:!0,row:!0,children:[(0,r.jsx)(eo.Z,{disabled:c,mapPreset:"play",onClick:()=>{var t;null===(t=s.current)||void 0===t||t.setOpen(!0),el(e)},variant:"normal"}),(0,r.jsx)(y.Ac,{children:n})]})}}),[F,U,O,el,g,N,c,x,E,V,a,p,A]),ea=(0,o.useMemo)(()=>P||b||f?(0,r.jsx)(T.Z,{}):ei,[P,f,b,ei]),ec=(0,o.useMemo)(()=>(0,r.jsx)(L.Z,{count:1,defaultMessageType:"warning",ref:l}),[]),{confirmDialog:ed,finishConfirm:eu,setConfirmDialogLoading:eh,setConfirmDialogOpen:em,setConfirmDialogProps:ep}=(0,eV.Z)({initial:{scrollContent:!0,wide:!0}}),ex=(0,o.useMemo)(()=>({add:{open:()=>null},confirm:{finish:eu,loading:eh,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return em(e)},prepare:ep},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==s?void 0:null===(e=s.current)||void 0===e?void 0:e.setOpen(t)}}}),[eu,eh,em,ep]),ef=(0,o.useMemo)(()=>b||u||P,[P,u,b]),ej=(0,o.useMemo)(()=>m&&K&&k&&ee&&(0,r.jsx)(tH,{detail:m,knownFences:K,knownHosts:k,knownUpses:ee,onSubmitSuccess:()=>{w(),M()},tools:ex}),[ex,M,w,k,K,ee,m]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Z.s_,{children:[(0,r.jsx)(Z.V9,{children:(0,r.jsx)(y.z,{children:"Manage manifests"})}),ea]}),(0,r.jsx)(D.Z,{...er,disableProceed:S,loadingAction:I,preActionArea:ec,ref:t,scrollContent:!0,showClose:!0}),(0,r.jsx)(D.Z,{...es,disableProceed:S,loadingAction:I,preActionArea:ec,ref:n,scrollContent:!0,showClose:!0}),(0,r.jsx)(et.Js,{header:"".concat((null==m?void 0:m.anvil)?"Rerun":"Run"," install manifest ").concat(null==m?void 0:m.name),loading:ef,ref:s,showClose:!0,wide:!0,children:ej}),(0,r.jsx)(q.Z,{closeOnProceed:!0,...i,ref:e,scrollContent:!0,wide:!0}),ed]})};let tz="common-ups-input-ip-address",t$="common-ups-input-host-name",tW="IP address",tG="Host name";var tJ=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,setMessage:s},previous:{upsIPAddress:l,upsName:i}={}}=e;return(0,r.jsx)(eJ.Z,{columns:{xs:1,sm:2},layout:{"common-ups-input-cell-host-name":{children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:t$,label:tG,value:i}),inputTestBatch:(0,k.Gn)(tG,()=>{s(t$)},{onFinishBatch:t(t$)},e=>{s(t$,{children:e})}),onFirstRender:n(t$),required:!0})},"common-ups-input-cell-ip-address":{children:(0,r.jsx)(g.Z,{input:(0,r.jsx)(v.Z,{id:tz,label:tW,value:l}),inputTestBatch:(0,k._)(tW,()=>{s(tz)},{onFinishBatch:t(tz)},e=>{s(tz,{children:e})}),onFirstRender:n(tz),required:!0})}},spacing:"1em"})},tQ=n(65716);let tK="add-ups-select-ups-type-id";var tX=e=>{let{formUtils:t,loading:n,previous:s={},upsTemplate:l}=e,{buildInputFirstRenderFunction:i,setValidity:a}=t,{upsTypeId:c=""}=s,d=(0,U.Z)(),[u,h]=(0,o.useState)(c),m=(0,o.useMemo)(()=>l?Object.entries(l).map(e=>{let t,[n,{brand:s,description:l,links:{0:i}}]=e;if(i){let{linkHref:e,linkLabel:n}=i;t=(0,r.jsx)(tQ.Z,{href:e,onClick:e=>{e.stopPropagation()},sx:{display:"inline-flex",color:ef.E5},target:"_blank",children:n})}return{displayValue:(0,r.jsxs)(j.Z,{spacing:0,children:[(0,r.jsx)(y.Ac,{inverted:!0,children:s}),(0,r.jsxs)(y.Ac,{inverted:!0,children:[l," (",t,")"]})]}),value:n}}):[],[l]),p=(0,o.useMemo)(()=>l&&(0,r.jsx)(b.Z,{formControlProps:{sx:{marginTop:".3em"}},id:tK,label:"UPS type",onChange:e=>{let{target:{value:t}}=e,n=String(t);a(tK,!0),h(n)},required:!0,selectItems:m,selectProps:{onClearIndicatorClick:()=>{a(tK,!1),h("")},renderValue:e=>{let{brand:t}=l[String(e)];return t}},value:u}),[l,m,u,a]),x=(0,o.useMemo)(()=>n?(0,r.jsx)(T.Z,{}):(0,r.jsxs)(j.Z,{children:[p,u&&(0,r.jsx)(tJ,{formUtils:t,previous:s})]}),[t,u,n,p,s]);return(0,o.useEffect)(()=>{d&&i(tK)({isValid:!!u})},[i,u,d]),x};let tY="edit-ups-input-ups-uuid";var t0=e=>{let{formUtils:t,loading:n,previous:s,upsTemplate:l,upsUUID:i}=e;return(0,o.useMemo)(()=>n?(0,r.jsx)(T.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tX,{formUtils:t,previous:s,upsTemplate:l}),(0,r.jsx)("input",{hidden:!0,id:tY,readOnly:!0,value:i})]}),[t,n,s,l,i])};let t1=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[{target:s}]=n,{elements:l}=s,{value:i}=l.namedItem(t$),{value:o}=l.namedItem(tz),a=l.namedItem(tK),c="",d="",u="";a&&({value:u}=a,{agent:c,brand:d}=e[u]);let h=l.namedItem(tY),m="";return h&&({value:m}=h),{agent:c,brand:d,ipAddress:o,name:i,typeId:u,uuid:m}},t2=e=>{let{brand:t,ipAddress:n,name:s,uuid:l}=e;return(0,r.jsx)(H.Z,{listItems:{"ups-brand":{label:"Brand",value:t},"ups-name":{label:"Host name",value:s},"ups-ip-address":{label:"IP address",value:n}},listItemProps:{sx:{padding:0}},renderListItem:(e,t)=>{let{label:n,value:s}=t;return(0,r.jsxs)(j.Z,{fullWidth:!0,growFirst:!0,row:!0,children:[(0,r.jsx)(y.Ac,{children:n}),(0,r.jsx)(y.$_,{children:s})]},"confirm-ups-".concat(l,"-").concat(e))}})};var t5=()=>{let e=(0,U.Z)(),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)({}),[l,i]=(0,$.Z)(),[a,c]=(0,$.Z)(),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!0),[x,f]=(0,o.useState)(),{data:g,isLoading:v}=(0,V.Z)("".concat(d.Z,"/ups"),{refreshInterval:6e4}),b=(0,W.Z)([tz,t$,tK],s),{isFormInvalid:w,isFormSubmitting:k,submitForm:P}=b,{buildDeleteDialogProps:M,checks:C,getCheck:S,hasChecks:I,setCheck:A}=(0,z.Z)({list:g}),F=(0,o.useCallback)(e=>{var n,s;let{upsAgent:l,upsIPAddress:o,upsName:a,upsUUID:c}=e,d=null!==(s=null===(n=Object.entries(null!=x?x:{}).find(e=>{let[,{agent:t}]=e;return l===t}))||void 0===n?void 0:n[0])&&void 0!==s?s:"";return{actionProceedText:"Update",content:(0,r.jsx)(t0,{formUtils:b,previous:{upsIPAddress:o,upsName:a,upsTypeId:d},upsTemplate:x,upsUUID:c}),onSubmitAppend:e=>{var n;if(!x)return;let s=t1(x,e),{name:l}=s;i({actionProceedText:"Update",content:t2(s),onProceedAppend:()=>{P({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update UPS. ",e]}),method:"put",successMsg:"Successfully updated UPS ".concat(a),url:"/ups/".concat(c)})},titleText:(0,r.jsxs)(y.z,{children:["Update"," ",(0,r.jsx)(y.Q0,{fontSize:"inherit",children:l})," ","with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,r.jsxs)(y.z,{children:["Update UPS"," ",(0,r.jsx)(y.Q0,{fontSize:"inherit",children:a})]})}},[b,i,P,x]),O=(0,o.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(tX,{formUtils:b,upsTemplate:x}),onSubmitAppend:e=>{var n;if(!x)return;let s=t1(x,e),{brand:l,name:o}=s;i({actionProceedText:"Add",content:t2(s),onProceedAppend:()=>{P({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add UPS. ",e]}),method:"post",successMsg:"Successfully added UPS ".concat(o),url:"/ups"})},titleText:(0,r.jsxs)(y.z,{children:["Add a"," ",(0,r.jsx)(y.Q0,{fontSize:"inherit",children:l})," UPS with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a UPS"}),[b,i,P,x]),N=(0,o.useMemo)(()=>(0,r.jsx)(H.Z,{allowEdit:!0,allowItemButton:u,disableDelete:!I,edit:u,header:!0,listEmpty:"No Ups(es) registered.",listItems:g,onAdd:()=>{var e;c(O),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;i(M({getConfirmDialogTitle:e=>"Delete ".concat(e," UPSes?"),onProceedAppend:()=>{P({body:{uuids:C},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to delete UPS(es). ",e]}),method:"delete",url:"/ups"})},renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(y.Ac,{children:null==g?void 0:g[t].upsName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{h(e=>!e)},onItemCheckboxChange:(e,t,n)=>{A(e,n)},onItemClick:e=>{var t;c(F(e)),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0)},renderListItemCheckboxState:e=>S(e),renderListItem:(e,t)=>{let{upsAgent:n,upsIPAddress:s,upsName:l}=t;return(0,r.jsxs)(j.Z,{fullWidth:!0,row:!0,children:[(0,r.jsx)(y.Ac,{children:l}),(0,r.jsxs)(y.Ac,{children:['agent="',n,'"']}),(0,r.jsxs)(y.Ac,{children:['ip="',s,'"']})]})}}),[O,M,F,C,S,I,u,A,i,c,P,g]),E=(0,o.useMemo)(()=>m||v?(0,r.jsx)(T.Z,{}):N,[m,v,N]),_=(0,o.useMemo)(()=>(0,r.jsx)(L.Z,{count:1,defaultMessageType:"warning",ref:s}),[]);return e&&R.Z.get("/ups/template").then(e=>{let{data:t}=e;f(t)}).catch(e=>{(0,B.Z)(e)}).finally(()=>{p(!1)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Z.s_,{children:[(0,r.jsx)(Z.V9,{children:(0,r.jsx)(y.z,{children:"Manage UPSes"})}),E]}),(0,r.jsx)(D.Z,{...a,disableProceed:w,loadingAction:k,preActionArea:_,ref:n,showClose:!0}),(0,r.jsx)(q.Z,{closeOnProceed:!0,...l,ref:t})]})},t8=n(92214);let t3="prepare-host",t9="prepare-network",t7="manage-fence",t4="manage-ups",t6="manage-manifest",ne={[t3]:"Prepare Host",[t9]:"Prepare Network",[t7]:"Manage Fence Devices",[t4]:"Manage UPSes",[t6]:"Manage Manifests"},nt="Loading",nn=()=>(0,r.jsx)(t8.Z,{children:(0,r.jsx)(eU,{})}),nr=()=>(0,r.jsx)(t8.Z,{children:(0,r.jsx)(eW,{})}),ns=()=>(0,r.jsx)(t8.Z,{children:(0,r.jsx)(Y,{})}),nl=()=>(0,r.jsx)(t8.Z,{children:(0,r.jsx)(t5,{})}),ni=()=>(0,r.jsx)(t8.Z,{children:(0,r.jsx)(tV,{})});var no=()=>{let{isReady:e,push:t,query:n}=(0,i.useRouter)(),[s,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(nt);return(0,o.useEffect)(()=>{if(!e)return;let{step:r}=n,l=a(r,{fallbackValue:t3});ne[l]||(l=t3),t({query:{...n,step:l}},void 0,{shallow:!0}),u===nt&&h(ne[l]),s||d(l)},[e]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:u})}),(0,r.jsx)(c.Z,{}),(0,r.jsx)(Z.s_,{children:(0,r.jsxs)(eN.Z,{onChange:(e,r)=>{d(r),h(ne[r]),t({query:{...n,step:r}},void 0,{shallow:!0})},orientation:{xs:"vertical",sm:"horizontal"},value:s,children:[(0,r.jsx)(eO.Z,{label:"Prepare host",value:t3}),(0,r.jsx)(eO.Z,{label:"Prepare network",value:t9}),(0,r.jsx)(eO.Z,{label:"Manage fence devices",value:t7}),(0,r.jsx)(eO.Z,{label:"Manage UPSes",value:t4}),(0,r.jsx)(eO.Z,{label:"Manage manifests",value:t6})]})}),(0,r.jsx)(e$.Z,{changingTabId:s,tabId:t3,children:(0,r.jsx)(nn,{})}),(0,r.jsx)(e$.Z,{changingTabId:s,tabId:t9,children:(0,r.jsx)(nr,{})}),(0,r.jsx)(e$.Z,{changingTabId:s,tabId:t7,children:(0,r.jsx)(ns,{})}),(0,r.jsx)(e$.Z,{changingTabId:s,tabId:t4,children:(0,r.jsx)(nl,{})}),(0,r.jsx)(e$.Z,{changingTabId:s,tabId:t6,children:(0,r.jsx)(ni,{})})]})}}},function(e){e.O(0,[447,256,940,245,84,548,763,731,845,25,558,436,716,879,93,888,774,179],function(){return e(e.s=29582)}),_N_E=e.O()}]);