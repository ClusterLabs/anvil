(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257],{656:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(e,t,r)=>{let s,{query:n}=e;if(void 0===r){let{[t]:e,...r}=n;s=r}else s={...n,[t]:r};return s}},2240:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var s=r(37876),n=r(71918),i=r(51553),l=r(35268),a=r(14232),o=r(10595),d=r(64345),c=r(20795);let u=(0,l.Ay)(n.A)({height:"3.5em",marginLeft:0,width:"100%"}),h=e=>{let{baseInputProps:t,checked:r,formControlLabelProps:n,id:l,label:h,name:m,onChange:x,switchProps:j}=e,v=(0,a.useMemo)(()=>(0,d.A)(h,c.a3,{color:"".concat(o.Qu,"AF"),inheritColour:!0}),[h]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u,{control:(0,s.jsx)(i.A,{checked:r,edge:"end",name:m,onChange:x,...j}),label:v,labelPlacement:"start",slotProps:{typography:{flexGrow:1}},...n}),(0,s.jsx)("input",{checked:r,hidden:!0,id:l,readOnly:!0,type:"checkbox",...t})]})}},4903:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(37876),n=r(41316);let i=e=>{let{children:t}=e;return(0,s.jsxs)(n.Ay,{columns:{lg:8,xs:1},container:!0,children:[(0,s.jsx)(n.Ay,{item:!0,xs:1}),(0,s.jsx)(n.Ay,{item:!0,lg:6,xs:1,children:t}),(0,s.jsx)(n.Ay,{item:!0,xs:1})]})}},10342:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(37876),n=r(7254),i=r(14232);let l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[l]=t,{changingTabId:a,children:o,retain:d=!1,tabId:c}=l,u=(0,i.useMemo)(()=>a===c,[a,c]),h=(0,i.useMemo)(()=>d?(0,s.jsx)(n.A,{sx:{display:u?"initial":"none"},children:o}):u&&o,[o,u,d]);return(0,s.jsx)(s.Fragment,{children:h})}},13920:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var s=r(37876),n=r(7254),i=r(60999),l=r(80963),a=r(40123),o=r.n(a),d=r(65532),c=r(89889),u=r(34318),h=r(20795);let m=e=>{let{entry:t}=e;return(0,s.jsx)(h.NA,{whiteSpace:"nowrap",children:String(t)})},x=e=>{let{entry:t,hasPassword:r}=e;return(e=>null==e||"object"==typeof e&&o()(e)||"number"==typeof e&&!Number.isFinite(e)||"string"==typeof e&&0===e.trim().length)(t)?(0,s.jsx)(h.a3,{children:"none"}):r?(e=>{let{entry:t,key:r}=e;return d.sX.test(r)?(0,s.jsx)(h.EN,{wrapper:"mono",children:String(t)}):m(e)})(e):m(e)},j=e=>{let{depth:t,entry:r,getLabel:i,hasPassword:l,key:a,nest:o,renderValue:d}=e;return(0,s.jsxs)(u.A,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,s.jsx)(h.a3,{children:i({cap:c.A,depth:t,entry:r,hasPassword:l,key:a})}),(0,s.jsx)(n.A,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!o&&d(x,{depth:t,entry:r,hasPassword:l,key:a})})]})},v=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},g=e=>{let{depth:t=0,entries:r,getEntryLabel:n,getListProps:a,getListItemProps:d,hasPassword:c,listKey:u,maxDepth:h,renderEntry:m,renderEntryValue:x,skip:j}=e,p=[];Object.entries(r).forEach(e=>{let[r,i]=e,a="form-summary-entry-".concat(r),u=(e=>null!==e&&"object"==typeof e&&!o()(e))(i),A=u?null:i,f={depth:t,entry:A,hasPassword:c,key:r};j(v,f)||p.push((0,s.jsx)(l.Ay,{sx:{paddingLeft:"".concat(t,"em")},...null==d?void 0:d.call(null,f),children:m({depth:t,entry:A,getLabel:n,hasPassword:c,key:r,nest:u,renderValue:x})},a)),u&&t<h&&p.push(g({depth:t+1,entries:i,getEntryLabel:n,hasPassword:c,listKey:r,maxDepth:h,renderEntry:m,renderEntryValue:x,skip:j}))});let A="form-summary-list-".concat(null!=u?u:"root");return(0,s.jsx)(i.A,{dense:!0,disablePadding:!0,...null==a?void 0:a.call(null,{depth:t,entries:r,key:u}),children:p},A)},p=e=>{let{entries:t,getEntryLabel:r=e=>{let{cap:t,key:r}=e;return t(r)},getListProps:s,getListItemProps:n,hasPassword:i=!1,maxDepth:l=3,renderEntry:a=j,renderEntryValue:o=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e(...r)},skip:d=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e(...r)}}=e;return g({entries:t,getEntryLabel:r,getListProps:s,getListItemProps:n,hasPassword:i,maxDepth:l,renderEntry:a,renderEntryValue:o,skip:d})}},15421:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/server",function(){return r(72924)}])},51588:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=function(e){let{fallbackValue:t="",joinSeparator:r="",limit:s=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Array?e.slice(0,s).join(r):null!=e?e:t}},53481:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(51588);let n=(e,t,r)=>{let n;if(!e||!t.isReady)return;let{name:i,uuid:l}=t.query;return i?n=Object.values(e).find(r((0,s.A)(i))):l&&(n=e[(0,s.A)(l)]),n}},53650:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var s=r(37876),n=r(41316),i=r(14232),l=r(40038),a=r(39393),o=r(11457),d=r(20795),c=r(30827),u=r(64345),h=r(16650);let m=e=>{let{commands:t,getLabel:r,names:m,progress:x,uuids:j}=e,[v,g]=(0,i.useState)(0),p=(0,i.useMemo)(()=>(0,h.tB)(),[]),A=(0,i.useMemo)(()=>{let e=new URLSearchParams;return m&&m.forEach(t=>{e.append("name",t)}),t&&t.forEach(t=>{e.append("command",t)}),e.append("start",String(p)),e.toString()},[t,p,m]),{altData:f,loading:b}=(0,c.A)("/job?".concat(A),{mod:e=>{let t,r=(t=j?j.reduce((t,r)=>{let{[r]:s}=e;return s&&t.push(s),t},[]):Object.values(e)).reduce((e,t)=>e+t.progress,0);return x.set(r/t.length),v<t.length&&g(t.length),t},refreshInterval:3e3}),y=(0,i.useMemo)(()=>(0,u.A)(null==r?void 0:r(x.value),d.a3),[r,x.value]);return b?(0,s.jsx)(o.A,{mt:0}):f?0===v?(0,s.jsx)(d.a3,{children:"Waiting for jobs to start..."}):0===f.length?null:(0,s.jsxs)(n.Ay,{alignItems:"center",columnSpacing:"0.5em",container:!0,children:[...f.map(e=>(0,s.jsx)(n.Ay,{item:!0,children:(0,s.jsx)(a.A,{error:!!e.error.count,slotProps:{pie:{size:"1em"}},value:e.progress})},"".concat(e.uuid,"-progress"))),(0,s.jsx)(n.Ay,{item:!0,xs:!0,children:y})]}):(0,s.jsx)(l.A,{type:"warning",children:"Failed to get jobs."})}},62396:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,h:()=>d});var s=r(77617),n=r(72693),i=r(35268),l=r(13180),a=r(34637),o=r(10595);let d={draggable:"".concat("DragDataGrid","-draggable")},c=(0,i.Ay)(l.z)({color:o.Qu,["& .".concat(d.draggable)]:{"&:hover":{cursor:"grab",["& .".concat(a.x.cell)]:{["& .".concat(n.A.root)]:{cursor:"auto"}}}},["& .".concat(a.x.columnHeader)]:{"&:focus":{outline:"none"}},["& .".concat(a.x.cell)]:{"&:focus":{outline:"none"},"&:focus-within":{outline:"none"}},["& .".concat(a.x["container--top"])]:{'& [role="row"]':{backgroundColor:"transparent"}},["& .".concat(s.A.root)]:{color:"inherit"}})},72924:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>e8});var s=r(37876),n=r(7254),i=r(35268),l=r(77328),a=r.n(l),o=r(89099),d=r(14232),c=r(77913),u=r(53481),h=r(51588),m=r(88577),x=r(66998),j=r(28957),v=r(35755),g=r(89121),p=r(53650),A=r(20795),f=r(61931),b=r(28850),y=r(74235);let w=()=>{let[e,t]=(0,d.useState)(0),[r,i]=(0,d.useState)(),l=(0,f.A)();return(0,s.jsxs)(n.A,{children:[r?(0,s.jsx)(p.A,{getLabel:e=>100===e?"Finished.":"Scanning network...",names:["scan-network"],progress:{set:t,value:e}}):(0,s.jsx)(g.A,{onClick:()=>{l.setConfirmDialogProps({actionProceedText:"Scan",content:(0,s.jsx)(A.a3,{children:"This operation will scan all networks for IP addresses, including server IPs, and record them. The scan will take a long time to complete; you can check the progress in the jobs list."}),onProceedAppend:()=>{l.setConfirmDialogLoading(!0),b.A.put("/command/scan-network").then(e=>{var t;(null==e||null==(t=e.data)?void 0:t.uuid)&&i(e.data),l.finishConfirm("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered network scan"})})}).catch(e=>{let t=(0,y.A)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register network scan. ",t.children]}),l.finishConfirm("Error",t)})},titleText:"Start scanning networks?"}),l.setConfirmDialogOpen(!0)},children:"Scan network"}),l.confirmDialog]})};var k=r(41316),S=r(52076),C=r.n(S),M=r(34318),I=r(16770),z=r(92107),O=r(92144);let F=(0,d.forwardRef)((e,t)=>{let{formikUtils:r,slotProps:n}=e,{formik:i}=r,[l,a]=(0,d.useState)(),o=(0,d.useMemo)(()=>({order:"order"}),[]),c=(0,d.useMemo)(()=>void 0===l?-1:i.values.order.indexOf(l),[i.values.order,l]),u=(0,d.useMemo)(()=>c<1,[c]),h=(0,d.useMemo)(()=>{let e=i.values.order.length-1;return c<0||c>=e},[i.values.order.length,c]);return(0,d.useImperativeHandle)(t,()=>({selectedId:l,setSelectedId:a}),[l]),(0,s.jsxs)(M.A,{spacing:".6em",...null==n?void 0:n.box,children:[(0,s.jsx)(O.A,{disabled:u,onClick:()=>{let{order:e}=i.values;if(u)return;let t=c-1,{[t]:r,[c]:s}=e,n=[...e];n.splice(t,2,s,r),i.setFieldValue(o.order,n,!0)},children:(0,s.jsx)(z.A,{fontSize:"small"})}),(0,s.jsx)(O.A,{disabled:h,onClick:()=>{let{order:e}=i.values;if(h)return;let t=c+1,{[c]:r,[t]:s}=e,n=[...e];n.splice(c,2,s,r),i.setFieldValue(o.order,n,!0)},children:(0,s.jsx)(I.A,{fontSize:"small"})})]})});F.displayName="ServerBootOrderControlBox";var D=r(34637),V=r(10595),N=r(62396);let R=(0,i.Ay)(N.A)({["& .".concat(D.x.cell)]:{'&[data-colindex="0"]':{borderLeft:"thick solid ".concat(V.Qu)}},["& .".concat(D.x.row)]:{"&:hover":{cursor:"pointer"}},"& .Mui-selected":{["& .".concat(D.x.cell)]:{'&[data-colindex="0"]':{borderLeft:"thick solid ".concat(V.ft)}}}}),W=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let[n]=t,{children:i,formik:l,...a}=n;return(0,s.jsx)(k.Ay,{columns:{xs:1,sm:2,md:3},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),l.handleSubmit(e)},spacing:"1em",...a,children:i})};var P=r(48937),T=r(11457),U=r(30827);let L=e=>{let{dangerous:t,detail:r,formDisabled:n,label:i}=e,{data:l}=(0,U.A)("/job?name=".concat(r.uuid,"::update"),{refreshInterval:2e3}),a=(0,d.useMemo)(()=>!l||n||Object.keys(l).length>0,[n,l]),o=(0,d.useMemo)(()=>t?"red":"blue",[t]);return l?(0,s.jsx)(P.A,{actions:[{background:o,children:i,disabled:a,type:"submit"}]}):(0,s.jsx)(T.A,{mt:0})};var q=r(13920);let B=function(e,t,r,n,i){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},{setSubmitting:a}=t,{buildRequestBody:o,buildSummary:d,onSuccess:c}=l,u=null==d?void 0:d.call(null,e);r.confirm.prepare({actionProceedText:"Save",content:(0,s.jsx)(q.A,{entries:null!=u?u:e}),onCancelAppend:()=>a(!1),onProceedAppend:()=>{var t;r.confirm.loading(!0);let i=null==o?void 0:o.call(null,e,u);b.A.put(n(),null!=(t=null!=i?i:u)?t:e).then(()=>{r.confirm.finish("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered server update job"})}),null==c||c.call(null),r.add.open(!1),r.edit.open(!1)}).catch(e=>{let t=(0,y.A)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register server update job. ",t.children]}),r.confirm.finish("Error",t),a(!1)})},titleText:i()}),r.confirm.open(!0)};var H=r(93647);let E=(0,i.Ay)("div")({display:"flex",flexDirection:"column",width:"100%"}),_=e=>{let{detail:t,tools:r}=e,n=(0,d.useRef)(null),i=(0,d.useMemo)(()=>{let[,...e]=t.devices.diskOrderBy.boot;return e},[t.devices.diskOrderBy.boot]),l=(0,H.A)({initialValues:{order:i},onSubmit:(e,s)=>{B(e,s,r,()=>"/server/".concat(t.uuid,"/set-boot-order"),()=>"Set boot order?",{buildSummary:e=>({order:e.order.map(e=>{let{[e]:{target:{dev:r}}}=t.devices.disks;return r})})})}}),{disabledSubmit:a,formik:o}=l,c=(0,d.useMemo)(()=>o.values.order.map(e=>{let{[e]:{device:r,source:{dev:{path:s=""},file:{path:n=""}},target:{dev:i}}}=t.devices.disks;return{dev:i,index:e,name:r,source:s||n}}),[t.devices.disks,o.values.order]),u=(0,d.useMemo)(()=>[{field:"name",flex:0,headerName:"Name",renderCell:e=>{let{value:t=""}=e,r=t;return/cdrom/.test(t)&&(r="optical"),r=C()(r)},sortable:!1},{field:"dev",flex:0,headerName:"Device",renderCell:e=>{let{value:t}=e;return(0,s.jsx)(A.NA,{noWrap:!0,children:t})},sortable:!1},{field:"source",flex:1,headerName:"Source",renderCell:e=>{let{value:t}=e;return(0,s.jsx)(A.NA,{noWrap:!0,textOverflow:"ellipsis",children:t})},sortable:!1}],[]);return(0,s.jsxs)(W,{formik:o,children:[(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(M.A,{row:!0,spacing:"1em",children:[(0,s.jsx)(F,{formikUtils:l,ref:e=>{n.current=e}}),(0,s.jsx)(E,{children:(0,s.jsx)(R,{columns:u,disableColumnMenu:!0,getRowId:e=>e.index,hideFooter:!0,onRowSelectionModelChange:e=>{var t;let[r]=e;null==(t=n.current)||t.setSelectedId(Number(r))},rows:c})})]})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:t,formDisabled:a,label:"Save"})})]})};var G=r(67820),Y=r(69146),K=r(91408),Z=r(77782),Q=r(27743);let X=K.Ik({file:(0,Q.ZC)().nullable()}),$=K.Ik({cores:K.ai().min(1).required(),sockets:K.ai().min(1).required()}),J=K.Ik({lvmVgUuid:K.Yj().required("Volume group is required."),protocol:K.Yj().required().oneOf(["long-throw","short-throw","sync"])}),ee=K.Ik({after:K.Yj(),delay:K.ai().min(0)});var et=r(88259);let er=e=>{let{cpu:t,detail:r,tools:n}=e,{topology:i}=r.cpu,{disabledSubmit:l,formik:a,formikErrors:o,handleChange:c}=(0,H.A)({initialValues:{clusters:String(i.clusters),cores:String(i.cores),dies:String(i.dies),sockets:String(i.sockets),threads:String(i.threads)},onSubmit:(e,t)=>{B(e,t,n,()=>"/server/".concat(r.uuid,"/set-cpu"),()=>"Set CPU?",{buildSummary:e=>({cores:Number(e.cores),sockets:Number(e.sockets)})})},validationSchema:$}),u=(0,d.useMemo)(()=>({cores:"cores",sockets:"sockets"}),[]);return(0,s.jsxs)(W,{formik:a,children:[(0,s.jsxs)(k.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(A.a3,{children:["Model: ",Object.values(t.hosts)[0].model]}),(0,s.jsxs)(A.a3,{children:["Available cores: ",t.cores]})]}),(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(Y.A,{id:u.cores,label:"Cores",name:u.cores,onChange:c,required:!0,value:a.values.cores})})}),(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(Y.A,{id:u.sockets,label:"Sockets",name:u.sockets,onChange:c,required:!0,value:a.values.sockets})})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:o})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:r,formDisabled:l,label:"Save"})})]})},es=e=>{let{detail:t}=e,{data:r}=(0,U.A)("/anvil/".concat(t.anvil.uuid,"/cpu"),{refreshInterval:5e3});return r?(0,s.jsx)(er,{cpu:r,...e}):(0,s.jsx)(T.A,{mt:0})};var en=r(14e3),ei=r(21129);let el=e=>{let{detail:t,tools:r}=e,n=(0,en.useRouter)(),{disabledSubmit:i,formik:l,handleChange:a}=(0,H.A)({initialValues:{name:""},onSubmit:(e,i)=>{(0,ei.A)(r,"/server/".concat(t.uuid),"Delete server ".concat(t.name,"?"),{description:(0,s.jsxs)(A.a3,{children:["Are you sure you want to delete the server ",t.name,"? This action is not reversible!"]}),dangerous:!0,method:"delete",messages:{fail:(0,s.jsx)(s.Fragment,{children:"Failed to register server deletion job."}),proceed:"Delete",success:(0,s.jsx)(s.Fragment,{children:"Successfully registered server deletion job"})},onCancel:()=>{i.setSubmitting(!1)},onFail:()=>{i.setSubmitting(!1)},onSuccess:()=>{n.replace("/")}})},validationSchema:K.Ik({name:K.Yj().required().oneOf([t.name])})}),o=(0,d.useMemo)(()=>({name:"name"}),[]);return(0,s.jsxs)(W,{formik:l,justifyContent:"center",children:[(0,s.jsxs)(k.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(A.a3,{children:["Deleting ",(0,s.jsx)(A.kp,{children:t.name})," will remove all of its data, including its configurations and storage volume(s)."]}),(0,s.jsx)(A.a3,{children:"Please type the server name to ensure the correct server gets deleted."})]}),(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(Y.A,{id:o.name,label:"Server name",name:o.name,onChange:a,value:l.values.name})})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{dangerous:!0,detail:t,formDisabled:i,label:"Delete"})})]})};var ea=r(19686),eo=r(93995),ed=r(31254),ec=r(45944),eu=r(40038),eh=r(18726),em=r(69647),ex=r(22346),ej=r(44082),ev=r(98496),eg=r(21967),ep=r(43620);let eA=[...ex.W,{displayValue:"%",value:"percent"}],ef=e=>{var t;let{device:r,detail:n,tools:i}=e,l=(0,d.useMemo)(()=>n.devices.disks.find(e=>e.target.dev===r),[n.devices.disks,r]),{altData:a}=(0,U.A)("/anvil/".concat(n.anvil.uuid,"/storage"),{mod:ej.A,refreshInterval:5e3}),{disabledSubmit:o,formik:c,formikErrors:u,handleChange:h}=(0,H.A)({initialValues:{size:{unit:"GiB",value:"0"},storage:null!=(t=null==l?void 0:l.source.dev.sg)?t:""},onSubmit:(e,t)=>{B(e,t,i,()=>"/server/".concat(n.uuid,"/").concat(r?"grow-disk":"add-disk"),()=>"Add disk on ".concat(null==a?void 0:a.storageGroups[e.storage].name,"?"),{buildSummary:e=>{let{size:t,storage:s}=e,{unit:n,value:i}=t,l=/percent/i.test(n)?"%":n;return r?{device:r,size:"".concat(i).concat(l)}:{size:"".concat(i).concat(l),storage:null==a?void 0:a.storageGroups[s].name}},buildRequestBody:(e,t)=>((null==t?void 0:t.storage)&&(t.storage=e.storage),t)})},validationSchema:(e=>K.Ik({size:K.gl().when(["storage"],(t,r)=>{let[s]=t,n=null==e?void 0:e.storageGroups[s];return n?(0,Z._0)(n.free):r}),storage:(0,Q.ZC)()}))(a)}),m=(0,d.useMemo)(()=>{let e="size";return{size:e,storage:"storage",unit:"".concat(e,".unit"),value:"".concat(e,".value")}},[]),x=(0,d.useMemo)(()=>a&&Object.values(a.storageGroups).map(e=>({displayValue:e.name,value:e.uuid})),[a]),j=(0,d.useMemo)(()=>{if(a)return a.storageGroups[c.values.storage]},[c.values,a]),v=(0,d.useMemo)(()=>{let{unit:e}=c.values.size;return"percent"===e?"GiB":e},[c.values.size]),g=(0,d.useMemo)(()=>{if(!j)return;let e={toUnit:v};return{free:(0,em.zz)(j.free,e),size:(0,em.zz)(j.size,e),used:(0,em.zz)(j.used,e)}},[v,j]),p=(0,d.useMemo)(()=>{if(!l)return;let{name:e="",size:t}=l.source.dev.lv;if(t)return{name:e,size:(0,em.zz)(t,{toUnit:v}),zero:/_0$/.test(e)}},[v,l]),f=(0,d.useMemo)(()=>"shut off"!==n.state&&(null==p?void 0:p.zero)||o,[n.state,null==p?void 0:p.zero,o]),b=(0,d.useMemo)(()=>{if("shut off"!==n.state&&(null==p?void 0:p.zero))return(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eu.A,{children:"A server must be shut off in order to grow its disk 0."})})},[n.state,null==p?void 0:p.zero]),y=(0,d.useMemo)(()=>g&&a&&(0,s.jsxs)(k.Ay,{item:!0,width:"100%",children:[(0,s.jsxs)(A.a3,{children:["Storage group: ",(0,s.jsx)(A.kp,{noWrap:!0,children:null==j?void 0:j.name})]}),(0,s.jsx)(ev.Fn,{storages:a,target:c.values.storage}),(0,s.jsxs)(k.Ay,{container:!0,children:[(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsxs)(A.a3,{children:["Used: ",g.used]})}),(0,s.jsx)(k.Ay,{item:!0,textAlign:"center",xs:!0,children:(0,s.jsxs)(A.a3,{fontWeight:400,children:["Free: ",g.free]})}),(0,s.jsx)(k.Ay,{item:!0,textAlign:"right",children:(0,s.jsxs)(A.a3,{children:["Total: ",g.size]})})]})]}),[g,c.values.storage,null==j?void 0:j.name,a]),w=(0,d.useMemo)(()=>r&&(0,s.jsx)(k.Ay,{item:!0,textAlign:"center",width:{xs:"100%",sm:"fit-content"},children:(0,s.jsx)(eh.A,{sx:{color:V.Qu}})}),[r]);return x?(0,s.jsxs)(W,{alignItems:"center",formik:c,children:[b,y,(0,s.jsx)(k.Ay,{item:!0,sm:!0,xs:1,children:r?(0,s.jsxs)(k.Ay,{alignItems:"center",container:!0,children:[(0,s.jsxs)(k.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(A.a3,{children:["Disk: ",(0,s.jsx)(A.kp,{noWrap:!0,children:r})]}),(0,s.jsxs)(A.a3,{children:["(",(0,s.jsxs)(A.kp,{children:["volume=",null==p?void 0:p.name]}),")"]})]}),(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsx)(A.a3,{fontWeight:400,noWrap:!0,children:null==p?void 0:p.size})})]}):(0,s.jsx)(ep.A,{id:m.storage,label:"Storage group",name:m.storage,onChange:c.handleChange,selectItems:x,selectProps:{disabled:!!r},value:c.values.storage})}),w,(0,s.jsx)(k.Ay,{item:!0,sm:!0,xs:1,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(eg.A,{id:"server-disk-input",label:"Disk size",inputWithLabelProps:{id:m.value,inputProps:{disabled:!c.values.storage},name:m.value},onChange:h,selectItems:eA,selectWithLabelProps:{id:m.unit,name:m.unit,onChange:e=>{let t=e.target.value,{unit:r,value:s}=c.values.size;if([t,r].includes("percent"))return void c.setFieldValue(m.size,{unit:t,value:"0"},!0);let n=(0,em.u7)(s,{fromUnit:r,precision:"B"===t?0:void 0,toUnit:t});if(!n)return;let{value:i}=n;c.setFieldValue(m.size,{unit:t,value:i},!0)},selectProps:{disabled:!c.values.storage},value:c.values.size.unit},value:c.values.size.value})})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:u})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:n,formDisabled:f,label:"Save"})})]}):(0,s.jsx)(T.A,{mt:0})};var eb=r(68072),ey=r(43010);let ew=e=>{let{fileUuid:t}=e,{data:r}=(0,U.A)("/file/".concat(t));if(!r)return(0,s.jsx)(T.A,{mt:0});let{checksum:i,path:l,size:a}=r;return(0,s.jsxs)(n.A,{children:[(0,s.jsx)(A.NA,{children:l.full}),(0,s.jsx)(A.NA,{children:(0,em.zz)(a,{toUnit:"ibyte"})}),(0,s.jsxs)(A.NA,{children:["md5: ",i]})]})},ek=e=>{var t;let{detail:r,device:n,tools:i}=e,l=(0,d.useMemo)(()=>r.devices.disks.find(e=>e.target.dev===n),[r.devices.disks,n]),{data:a}=(0,U.A)("/file?name=".concat(r.anvil.name,"&type=iso"),{refreshInterval:5e3}),{disabledSubmit:o,formik:c,formikErrors:u}=(0,H.A)({initialValues:{file:null!=(t=null==l?void 0:l.source.file.uuid)?t:null},onSubmit:(e,t)=>{B(e,t,i,()=>"/server/".concat(r.uuid,"/change-iso"),()=>"".concat(e.file?"Insert":"Eject"," ISO?"),{buildSummary:e=>{var t;let{file:r}=e,s=null==l?void 0:l.target.dev;return r?{device:s,iso:null==a||null==(t=a[r])?void 0:t.name}:{device:s}},buildRequestBody:(e,t)=>((null==t?void 0:t.iso)&&e.file&&(t.iso=e.file),t)})},validationSchema:X}),h=(0,d.useMemo)(()=>({file:"file"}),[]),m=(0,d.useMemo)(()=>a&&Object.values(a),[a]),x=(0,d.useMemo)(()=>{if(!a)return;let{file:e}=c.values;if(e)return a[e]},[c.values,a]);return m?(0,s.jsxs)(W,{formik:c,children:[(0,s.jsx)(k.Ay,{item:!0,xs:!0,children:(0,s.jsx)(ey.A,{disableClearable:!0,extendRenderInput:e=>{e.inputLabelProps={...e.inputLabelProps,shrink:!0},e.inputProps={...e.inputProps,notched:!0,placeholder:"Empty slot"}},getOptionLabel:e=>e.name,id:h.file,isOptionEqualToValue:(e,t)=>e.uuid===(null==t?void 0:t.uuid),label:"ISO (optical disk)",noOptionsText:"No matching ISO",onChange:(e,t)=>{c.setFieldValue(h.file,t?t.uuid:null,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{let{name:r,uuid:n}=t;return(0,d.createElement)("li",{...e,key:"iso-op-".concat(n)},(0,s.jsx)(A.a3,{inheritColour:!0,children:r}))},value:x})}),(0,s.jsx)(k.Ay,{item:!0,alignSelf:"center",children:(0,s.jsx)(O.A,{onClick:()=>{c.setFieldValue(h.file,null,!0)},size:"small",children:(0,s.jsx)(eb.A,{})})}),c.values.file&&(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ew,{fileUuid:c.values.file})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:u})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:r,formDisabled:o,label:"Save"})})]}):(0,s.jsx)(T.A,{mt:0})},eS=e=>{let{detail:t,tools:r}=e,n=(0,d.useRef)(null),i=(0,d.useRef)(null),l=(0,d.useRef)(null),[a,o]=(0,d.useState)(),c=(0,d.useMemo)(()=>t.devices.disks.reduce((e,t)=>(e[t.target.dev]=t,e),{}),[t.devices.disks]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.Ay,{container:!0,spacing:"1em",children:[(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eu.A,{children:'Disk operations "shrink" or "delete" must be done through commands to avoid data loss.'})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ec.A,{allowAddItem:!0,header:!0,listEmpty:"No disk(s) found.",listItems:c,onAdd:()=>{o(void 0),r.add={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=n.current)?void 0:e.setOpen(t)}},r.add.open(!0)},renderListItem:(e,t)=>{let{device:n,source:{dev:{path:a=""},file:{path:d=""}},target:{dev:c}}=t,u=n;return/cd/.test(n)&&(u="optical"),(0,s.jsxs)(k.Ay,{alignItems:"center",columnGap:"1em",container:!0,children:[(0,s.jsxs)(k.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(M.A,{columnSpacing:0,row:!0,rowSpacing:".5em",children:[(0,s.jsxs)(A.a3,{noWrap:!0,children:[C()(u),":"]})," ",(0,s.jsx)(A.NA,{noWrap:!0,children:e})]}),(0,s.jsx)(A.NA,{noWrap:!0,children:a||d})]}),"optical"===u&&(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsx)(O.A,{onClick:()=>{o(c),r.edit={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=l.current)?void 0:e.setOpen(t)}},r.edit.open(!0)},size:"small",children:(0,s.jsx)(ea.A,{})})}),"disk"===u&&(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsx)(O.A,{onClick:()=>{o(c),r.edit={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=i.current)?void 0:e.setOpen(t)}},r.edit.open(!0)},size:"small",children:(0,s.jsx)(eo.A,{sx:{rotate:"90deg"}})})})]})}})})]}),(0,s.jsx)(ed.K_,{header:"Add disk",ref:n,showClose:!0,wide:!0,children:(0,s.jsx)(ef,{...e})}),(0,s.jsx)(ed.K_,{header:"".concat(a,": grow disk"),ref:i,showClose:!0,wide:!0,children:a&&(0,s.jsx)(ef,{device:a,...e})}),(0,s.jsx)(ed.K_,{header:"".concat(a,": insert or eject ISO"),ref:l,showClose:!0,wide:!0,children:a&&(0,s.jsx)(ek,{device:a,...e})})]})};var eC=r(51553);let eM={mac:"auto",model:"e1000e"},eI=e=>{let{detail:t,tools:r}=e,{disabledSubmit:n,formik:i,formikErrors:l,handleChange:a}=(0,H.A)({initialValues:{bridge:"",mac:"",model:eM.model},onSubmit:(e,s)=>{B(e,s,r,()=>"/server/".concat(t.uuid,"/add-interface"),()=>"Add interface?",{buildSummary:e=>{let t={...e};return t.mac||(t.mac=eM.mac),t},buildRequestBody:(e,t)=>{let r={};return(null==t?void 0:t.bridge)&&(r.bridge=t.bridge),(null==t?void 0:t.mac)&&t.mac!==eM.mac&&(r.mac=t.mac),(null==t?void 0:t.model)&&t.model!==eM.model&&(r.model=t.model),r}})},validationSchema:(e=>K.Ik({bridge:K.Yj().required(),mac:(0,Q.By)().notOneOf([...e.devices.interfaces.map(e=>e.mac.address),...Object.values(e.bridges).map(e=>e.mac)],"${path} already exists"),model:K.Yj().nullable()}))(t)}),o=(0,d.useMemo)(()=>({bridge:"bridge",mac:"mac",model:"model"}),[]),c=(0,d.useMemo)(()=>Object.values(Object.values(t.bridges).reduce((e,t)=>{let{name:r}=t;return r in e||(e[r]={value:r}),e},{})),[t.bridges]);return(0,s.jsxs)(W,{formik:i,children:[(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(ep.A,{id:o.bridge,label:"Bridge",name:o.bridge,onChange:i.handleChange,required:!0,selectItems:c,value:i.values.bridge})}),(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(Y.A,{id:o.mac,inputLabelProps:{shrink:!0},inputProps:{notched:!0,placeholder:"Auto generated"},label:"Mac address",name:o.mac,onChange:a,value:i.values.mac})})}),(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(ey.A,{id:o.model,label:"Model",noOptionsText:"No matching model",onChange:(e,t)=>{i.setFieldValue(o.model,t,!0)},openOnFocus:!0,options:t.libvirt.nicModels,value:i.values.model})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:l})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:t,formDisabled:n,label:"Save"})})]})};var ez=r(88307);let eO={down:"plug-in",up:"unplug"},eF={down:"unplugged",up:"plugged-in"},eD=e=>{let{detail:t,tools:r}=e,n=(0,d.useRef)(null),[i,l]=(0,d.useState)(0),[a,o]=(0,d.useState)(!1),c=(0,d.useMemo)(()=>t.devices.interfaces.reduce((e,t)=>(e[t.mac.address]=t,e),{}),[t.devices.interfaces]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.Ay,{container:!0,children:[(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ec.A,{allowAddItem:!0,header:!0,listEmpty:"No server network interface(s) found.",listItems:c,onAdd:()=>{r.add={open:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==(e=n.current)?void 0:e.setOpen(t)}},r.add.open(!0)},renderListItem:(e,n)=>{let{ip:i,link:{state:l},model:{type:a},source:{bridge:d},target:{dev:c}}=n,u="up"===l;return(0,s.jsxs)(k.Ay,{alignItems:"center",columnGap:"1em",container:!0,children:[(0,s.jsxs)(k.Ay,{alignItems:"center",display:"flex",flexDirection:"column",item:!0,minWidth:"5em",children:[(0,s.jsx)(A.xF,{noWrap:!0,children:C()(eF[l])}),(0,s.jsx)(eC.A,{checked:u,onChange:()=>{let{[l]:n}=eO;o(!1),(0,ei.A)(r,"/server/".concat(t.uuid,"/set-interface-state"),"".concat(C()(n)," ").concat(c," (").concat(e,")?"),{body:{active:!u,mac:e},messages:{proceed:C()(n),fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",n," interface job."]}),success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",n," interface job"]})},onSuccess:()=>{o(!0)}})}})]}),(0,s.jsxs)(k.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(A.NA,{noWrap:!0,children:[c," (",a,")"]}),(0,s.jsx)(A.NA,{noWrap:!0,children:d})]}),(0,s.jsx)(k.Ay,{item:!0,xs:!0,children:(0,s.jsxs)(M.A,{columnSpacing:"0.5em",sm:"row",xs:"column",children:[(0,s.jsx)(A.NA,{noWrap:!0,children:e}),(0,s.jsx)(j.A,{flexItem:!0,orientation:"vertical",sx:{display:{xs:"none",sm:"initial"}}}),(0,s.jsx)(ez.A,{ip:i})]})}),(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsx)(O.A,{mapPreset:"delete",onClick:()=>{(0,ei.A)(r,"/server/".concat(t.uuid,"/delete-interface"),"Delete ".concat(c," (").concat(e,")?"),{body:{mac:e},messages:{proceed:"Delete",fail:(0,s.jsx)(s.Fragment,{children:"Failed to register delete interface job."}),success:(0,s.jsx)(s.Fragment,{children:"Successfully registered delete interface job"})}})},size:"small",variant:"redcontained"})})]})}})}),a&&(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(p.A,{getLabel:e=>100===e?"Finished.":"Changing interface(s)...",names:["server::".concat(t.uuid,"::set_interface_state")],progress:{set:l,value:i}})})]}),(0,s.jsx)(ed.K_,{header:"Add interface",ref:n,showClose:!0,wide:!0,children:(0,s.jsx)(eI,{...e})})]})};var eV=r(62243);let eN=e=>{var t,r;let{detail:n,memory:i,tools:l}=e,{disabledSubmit:a,formik:o,formikErrors:c,handleChange:u}=(0,H.A)({initialValues:{size:{unit:"GiB",value:null!=(r=null==(t=(0,em.u7)(n.memory.size,{toUnit:"GiB"}))?void 0:t.value)?r:"0"}},onSubmit:(e,t)=>{B(e,t,l,()=>"/server/".concat(n.uuid,"/set-memory"),()=>"Set memory?",{buildSummary:e=>{let{unit:t,value:r}=e.size;return{size:"".concat(r).concat(t)}}})},validationSchema:(e=>{let{available:t}=e;return K.Ik({size:(0,Z.Yy)(t)})})(i)}),h=(0,d.useMemo)(()=>{let e="size";return{size:e,unit:"".concat(e,".unit"),value:"".concat(e,".value")}},[]),m=(0,d.useMemo)(()=>{let e={toUnit:o.values.size.unit},t=(0,em.zz)(i.allocated,e),r=(0,em.zz)(i.available,e);return{allocated:t,available:r,reserved:(0,em.zz)(i.reserved,e),total:(0,em.zz)(i.total,e)}},[o.values.size.unit,i.allocated,i.available,i.reserved,i.total]);return(0,s.jsxs)(W,{formik:o,children:[(0,s.jsxs)(k.Ay,{item:!0,width:"100%",children:[(0,s.jsx)(ev.jk,{memory:i}),(0,s.jsxs)(k.Ay,{container:!0,children:[(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsxs)(A.a3,{children:["Allocated: ",m.allocated]})}),(0,s.jsx)(k.Ay,{item:!0,textAlign:"center",xs:!0,children:(0,s.jsxs)(A.a3,{fontWeight:400,children:["Available: ",m.available]})}),(0,s.jsxs)(k.Ay,{item:!0,textAlign:"right",children:[(0,s.jsxs)(A.a3,{children:["System: ",m.reserved]}),(0,s.jsxs)(A.a3,{children:["Total: ",m.total]})]})]})]}),(0,s.jsx)(k.Ay,{item:!0,sm:"auto",xs:1,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(eg.A,{id:"server-memory-input",label:"Memory",inputWithLabelProps:{id:h.value,name:h.value},onChange:u,selectItems:ex.W,selectWithLabelProps:{id:h.unit,name:h.unit,onChange:e=>{let t=e.target.value,{value:r,unit:s}=o.values.size,n=(0,em.u7)(r,{fromUnit:s,precision:"B"===t?0:void 0,toUnit:t});if(!n)return;let{value:i}=n;o.setFieldValue(h.size,{value:i,unit:t},!0)},value:o.values.size.unit},value:o.values.size.value})})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:c})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:n,formDisabled:a,label:"Save"})})]})},eR=e=>{let{detail:t}=e,{altData:r}=(0,U.A)("/anvil/".concat(t.anvil.uuid,"/memory"),{mod:eV.A,refreshInterval:5e3});return r?(0,s.jsx)(eN,{memory:r,...e}):(0,s.jsx)(T.A,{mt:0})},eW=e=>{let{detail:t,tools:r}=e,{altData:n}=(0,U.A)("/host?type=subnode",{mod:e=>Object.values(e).find(e=>{var r,s;return(null==(r=e.anvil)?void 0:r.uuid)===t.anvil.uuid&&e.shortHostName!==(null==(s=t.host)?void 0:s.short)})});return n?t.host?(0,s.jsxs)(k.Ay,{container:!0,spacing:"1em",children:[(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(A.a3,{children:["Running on: ",t.host.short]})}),(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsxs)(g.A,{onClick:()=>{(0,ei.A)(r,"/server/".concat(t.uuid,"/migrate"),"Migrate ".concat(t.name," to ").concat(n.shortHostName,"?"),{body:{target:n.shortHostName},messages:{fail:(0,s.jsx)(s.Fragment,{children:"Failed to register migration job."}),proceed:"Migrate",success:(0,s.jsx)(s.Fragment,{children:"Successfully registered migration job"})}})},children:["Migrate to ",n.shortHostName]})})]}):(0,s.jsx)(eu.A,{children:"Cannot migrate a shut off server."}):(0,s.jsx)(T.A,{mt:0})};var eP=r(65795),eT=r.n(eP),eU=r(2240),eL=r(19284);let eq=e=>Object.values(e).reduce((e,t)=>{let{uuid:r}=t;return e[r]=(0,eL.A)(t),e},{});var eB=r(35781),eH=r(16650);let eE=BigInt(0),e_={"short-throw":{displayValue:(0,s.jsxs)(n.A,{children:[(0,s.jsx)(A.a3,{inheritColour:!0,children:"Async (short-throw)"}),(0,s.jsx)(A.a3,{selected:!1,children:"Replication writes are considered done when the data is in the active node's network transmit buffer."})]}),inputValue:"Async (short-throw)",value:"short-throw"},sync:{displayValue:(0,s.jsxs)(n.A,{children:[(0,s.jsx)(A.a3,{inheritColour:!0,children:"Sync"}),(0,s.jsx)(A.a3,{selected:!1,children:"Replication writes are considered done when the data is written to disk on the DR host."})]}),value:"sync"}},eG=Object.values(e_),eY=e=>{let{detail:t,drs:r,tools:n}=e,[i,l]=(0,d.useState)(0),[a,o]=(0,d.useState)(!1),c=(0,d.useMemo)(()=>a&&i<100,[a,i]),u=(0,d.useMemo)(()=>"/server/".concat(t.uuid,"/set-protect"),[t.uuid]),h=(0,d.useMemo)(()=>Object.values(r).reduce((e,t)=>(Object.values(t.storage.volumeGroups).forEach(t=>{e[t.internalUuid]=t}),e),{}),[r]),m=(0,d.useMemo)(()=>Object.values(h).map(e=>e.internalUuid),[h]),x=(0,d.useMemo)(()=>Object.values(t.devices.disks).reduce((e,t)=>{let{lv:r}=t.source.dev;return r.uuid&&(e[r.uuid]=r),e},{}),[t.devices.disks]),j=(0,d.useMemo)(()=>Object.values(t.protect)[0],[t.protect]),v=(0,d.useMemo)(()=>Object.values(x).map(e=>{let{size:t}=e;if(!t)return eE;try{return BigInt(t)}catch(e){return eE}}).reduce((e,t)=>e+t,eE),[x]),{changeFieldValue:f,disabledSubmit:b,formik:y,formikErrors:w}=(0,H.A)({initialValues:{lvmVgUuid:null,protocol:"short-throw"},onSubmit:(e,t)=>{o(!1),B(e,t,n,()=>u,()=>"Update server protect config?",{buildSummary:e=>{let{lvmVgUuid:t,protocol:s}=e;if(!t)return{};let{[t]:n}=h,{[n.host]:i}=r;return{drHost:i.short,volumeGroup:"".concat(n.name," (").concat(n.internalUuid,")"),protocol:s}},buildRequestBody:e=>{let{lvmVgUuid:t,protocol:r}=e,s={operation:"protect"};return t&&(s.lvmVgUuid=t),r&&(s.protocol=r),s},onSuccess:()=>{o(!0)}})},validationSchema:J}),S=(0,d.useMemo)(()=>({lvmVgUuid:"lvmVgUuid",protocol:"protocol"}),[]);if(j){var M,I;let e,{drUuid:o="",protocol:d,status:c}=j,{[o]:h}=r,m="connected"===c.connection;return c.maxEstimatedTimeToSync&&(e=(0,eH.KN)(c.maxEstimatedTimeToSync)),(0,s.jsxs)(k.Ay,{alignItems:"center",container:!0,spacing:"1em",children:[(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(A.a3,{children:[(0,s.jsx)(A.kp,{edge:"start",noWrap:!0,children:t.name})," ","is configured to be protected by"," ",(0,s.jsx)(A.kp,{noWrap:!0,children:h.short})," using protocol"," ",(0,s.jsx)(A.kp,{noWrap:!0,children:eT()(null!=(I=null==(M=e_[d])?void 0:M.inputValue)?I:d)}),"."]})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(A.a3,{children:["Replication status:"," ",(0,s.jsxs)(A.kp,{inheritColour:!0,color:(0,eB.Wh)(c.overall),children:[c.overall," ",e&&" (estimated ~".concat(e,")")]})," "]})}),(0,s.jsx)(k.Ay,{item:!0,xs:!0,children:(0,s.jsx)(eU.A,{checked:m,label:"Connection",onChange:(e,t)=>{let r=t?"connect":"disconnect",i=C()(r);(0,ei.A)(n,u,"".concat(i," the server on the protector DR host?"),{body:{operation:r},description:(0,s.jsx)(A.a3,{children:"connect"===r?(0,s.jsx)(s.Fragment,{children:"This operation connects the server to its copy on the DR host and start streaming replication."}):(0,s.jsx)(s.Fragment,{children:"This operation disconnects the server from its copy on the DR host and stop streaming replication."})}),messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",r," resource job."]}),proceed:i,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",r," resource job"]})}})}})}),(0,s.jsx)(k.Ay,{item:!0,xs:!0,children:(0,s.jsx)(g.A,{onClick:()=>{let e="update",t=C()(e);(0,ei.A)(n,u,"".concat(t," the server on the protector DR host?"),{body:{operation:e},description:(0,s.jsx)(A.a3,{children:"This operation is a combination that connects, performs a sync, and disconnects."}),messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",e," resource job."]}),proceed:t,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",e," resource job"]})}})},sx:{width:"100%"},children:"Update"})}),(0,s.jsx)(k.Ay,{item:!0,xs:!0,children:(0,s.jsx)(g.A,{background:"red",onClick:()=>{let e="remove",t=C()(e);(0,ei.A)(n,u,"".concat(t," protection for the server on the protector DR host?"),{body:{operation:e},description:(0,s.jsx)(A.a3,{children:"This operation removes the server's copy on the DR host and thus removes the protection."}),dangerous:!0,messages:{fail:(0,s.jsxs)(s.Fragment,{children:["Failed to register ",e," protection job."]}),proceed:t,success:(0,s.jsxs)(s.Fragment,{children:["Successfully registered ",e," protection job"]})}})},sx:{width:"100%"},children:"Remove protection"})}),a&&(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(p.A,{getLabel:e=>100===e?"Finished.":"Protecting...",names:["dr::protect"],progress:{set:l,value:i}})})]})}return(0,s.jsxs)(W,{formik:y,children:[(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(ec.A,{header:"Server disk(s)",listItems:x,renderListItem:(e,t)=>(0,s.jsxs)(k.Ay,{container:!0,children:[(0,s.jsx)(k.Ay,{item:!0,xs:!0,children:(0,s.jsxs)(A.a3,{children:[(0,s.jsx)(A.kp,{edge:"start",noWrap:!0,children:t.name})," ","(",(0,s.jsx)(A.kp,{noWrap:!0,variant:"caption",children:t.uuid}),")"]})}),(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsx)(A.a3,{edge:"end",noWrap:!0,children:t.size&&(0,em.zz)(t.size,{toUnit:"ibyte"})})})]})})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsxs)(A.a3,{children:["Server total disk(s) size:"," ",(0,em.zz)(v,{toUnit:"ibyte"})]})}),(0,s.jsx)(k.Ay,{item:!0,xs:2,children:(0,s.jsx)(ey.A,{getOptionDisabled:e=>{let{[e]:t}=h;return t.free<v},getOptionLabel:e=>{let{[e]:t}=h,{[t.host]:s}=r;return"".concat(s.short," - ").concat(t.name)},id:S.lvmVgUuid,label:"Volume group",noOptionsText:"No matching volume group",onChange:(e,t)=>{f(S.lvmVgUuid,t,!0)},openOnFocus:!0,options:m,renderOption:(e,t)=>{let{[t]:n}=h,{[n.host]:i}=r,l=n.free>=v?(0,s.jsx)(s.Fragment,{children:"Sufficient space"}):(0,s.jsx)(s.Fragment,{children:"Insufficient space"});return(0,d.createElement)("li",{...e,key:"dr-op-".concat(t)},(0,s.jsxs)(k.Ay,{alignItems:"center",columnSpacing:"1em",container:!0,children:[(0,s.jsxs)(k.Ay,{item:!0,xs:!0,children:[(0,s.jsxs)(A.a3,{edge:"start",inheritColour:!0,children:[(0,s.jsx)(A.kp,{edge:"start",inheritColour:!0,noWrap:!0,children:i.short})," ","-"," ",(0,s.jsx)(A.kp,{inheritColour:!0,noWrap:!0,children:n.name})]}),(0,s.jsxs)(A.a3,{edge:"start",inheritColour:!0,children:[(0,s.jsx)(A.kp,{edge:"start",inheritColour:!0,noWrap:!0,children:(0,em.zz)(n.free,{toUnit:"ibyte"})})," ","free"]})]}),(0,s.jsx)(k.Ay,{item:!0,children:(0,s.jsx)(A.a3,{edge:"end",inheritColour:!0,noWrap:!0,children:l})})]}))},required:!0,value:y.values.lvmVgUuid})}),(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(ep.A,{id:S.protocol,label:"Protocol",name:S.protocol,onChange:y.handleChange,required:!0,selectItems:eG,selectProps:{renderValue:e=>{var t,r;return C()(null!=(r=null==(t=e_[e])?void 0:t.inputValue)?r:e)}},value:y.values.protocol})}),a&&(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(p.A,{getLabel:e=>100===e?"Finished.":"Changing config...",names:["dr::link","dr::protect","storage-group-member::add::".concat(y.values.lvmVgUuid)],progress:{set:l,value:i}})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:w})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:t,formDisabled:b||c,label:"Save"})})]})},eK=e=>{let{altData:t,error:r,loading:n}=(0,U.A)("/host?detail=1&type=dr",{mod:eq});return n?(0,s.jsx)(T.A,{mt:0}):t?(0,s.jsx)(eY,{drs:t,...e}):(0,s.jsxs)(eu.A,{type:"warning",children:["Failed to get DR hosts. ",null==r?void 0:r.message]})},eZ=e=>{let{detail:t,servers:r,tools:n}=e,i=(0,en.useRouter)(),{disabledSubmit:l,formik:a,formikErrors:o,handleChange:c}=(0,H.A)({initialValues:{name:t.name},onSubmit:(e,r)=>{B(e,r,n,()=>"/server/".concat(t.uuid,"/rename"),()=>"Rename ".concat(t.name,"?"),{onSuccess:()=>{i.replace("/")}})},validationSchema:K.Ik({name:(0,Z.l9)(t.uuid,r)})}),u=(0,d.useMemo)(()=>({name:"name"}),[]),h=(0,d.useMemo)(()=>"shut off"!==t.state||l,[t.state,l]);return(0,s.jsxs)(W,{formik:a,children:["shut off"!==t.state&&(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(eu.A,{children:"A server can only be renamed when it's shut off."})}),(0,s.jsx)(k.Ay,{item:!0,sm:"auto",xs:1,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(Y.A,{id:u.name,label:"Server name",name:u.name,onChange:c,required:!0,value:a.values.name})})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:o})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:t,formDisabled:h,label:"Save"})})]})},eQ=e=>{let{detail:t,servers:r,tools:n}=e,{disabledSubmit:i,formik:l,formikErrors:a,handleChange:o}=(0,H.A)({initialValues:{active:t.start.active,after:t.start.after||"",delay:String(t.start.delay)},onSubmit:(e,s)=>{B(e,s,n,()=>"/server/".concat(t.uuid,"/set-start-dependency"),()=>"Set start dependency?",{buildSummary:e=>{var t;let{active:s,after:n,delay:i}=e;return s?{after:null==(t=r[n])?void 0:t.name,delay:"".concat(i," second(s)")}:{"stay-off":"yes"}},buildRequestBody:e=>{let{active:t,after:r,delay:s}=e;return t&&r?{after:r,delay:Number(s)}:{active:t}}})},validationSchema:ee}),c=(0,d.useMemo)(()=>({active:"active",after:"after",delay:"delay"}),[]),u=(0,d.useMemo)(()=>Object.values(r).filter(e=>e.uuid!==t.uuid),[t.uuid,r]),h=(0,d.useMemo)(()=>u.map(e=>{let{name:t,uuid:r}=e;return{displayValue:t,value:r}}),[u]);return(0,s.jsxs)(W,{formik:l,children:[(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(ep.A,{id:c.after,label:"Start after",name:c.after,onChange:l.handleChange,selectItems:h,selectProps:{disabled:!l.values.active,onClearIndicatorClick:()=>{l.setFieldValue(c.after,"",!0)}},value:l.values.after})}),(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(et.A,{input:(0,s.jsx)(Y.A,{id:c.delay,inputProps:{disabled:!l.values.active||""===l.values.after},label:"Delay (seconds)",name:c.delay,onChange:o,value:l.values.delay})})}),(0,s.jsx)(k.Ay,{item:!0,xs:1,children:(0,s.jsx)(eU.A,{checked:!l.values.active,id:c.active,label:"Stay off",name:c.active,onChange:(e,t)=>{l.setFieldValue(c.active,!t,!0)}})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(G.A,{count:1,messages:a})}),(0,s.jsx)(k.Ay,{item:!0,width:"100%",children:(0,s.jsx)(L,{detail:t,formDisabled:i,label:"Save"})})]})};var eX=r(82707),e$=r(10342),eJ=r(93282);let e0={bootOrder:{label:"Boot order",value:"boot-order"},cpu:{label:"CPU",value:"cpu"},delete:{label:"Deletion",value:"deletion"},disks:{label:"Disks",value:"disks"},general:{label:"General",value:"general"},interfaces:{label:"Interfaces",value:"interfaces"},memory:{label:"Memory",value:"memory"},migration:{label:"Migration",value:"migration"},name:{label:"Name",value:"name"},protect:{label:"Disaster recovery",value:"protect"},startDependency:{label:"Start dependency",value:"start-dependency"}},e1=(0,i.Ay)(c.i)(e=>{let{theme:t}=e;return{width:"100%",[t.breakpoints.up("xs")]:{height:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return"calc(".concat(e," * 0.6)")}("100vw")},[t.breakpoints.up("sm")]:{height:"6em"},[t.breakpoints.up("md")]:{height:"9em"}}}),e3=e=>{let{slotProps:t,serverUuid:r}=e,[n,i]=(0,d.useState)(e0.general.value),{data:l,mutate:a}=(0,U.A)("/server"),{data:o}=(0,U.A)("/server/".concat(r),{refreshInterval:3e3}),{confirmDialog:u,finishConfirm:h,setConfirmDialogLoading:m,setConfirmDialogOpen:g,setConfirmDialogProps:p}=(0,f.A)({initial:{scrollContent:!0,wide:!0}}),b=(0,d.useRef)({add:{open:()=>null},confirm:{finish:h,loading:m,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return g(e)},prepare:p},edit:{open:()=>null}});return o&&l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Zk,{children:(0,s.jsxs)(x.A,{container:!0,spacing:"1em",width:"100%",children:[(0,s.jsx)(x.A,{width:{xs:"100%",sm:"14em",md:"20em"},children:(0,s.jsxs)(x.A,{container:!0,spacing:"1em",width:"100%",children:[(0,s.jsx)(x.A,{width:"100%",children:(0,s.jsx)(c.wL,{server:o,children:(0,s.jsx)(c.lN,{server:o,slots:{screenshotBox:(0,s.jsx)(e1,{})},...null==t?void 0:t.preview})})}),(0,s.jsx)(x.A,{width:"100%",children:(0,s.jsxs)(eJ.A,{onChange:(e,t)=>{i(t),[e0.migration.value,e0.startDependency.value].includes(t)&&a()},orientation:"vertical",value:n,children:[(0,s.jsx)(eX.A,{...e0.general,label:o.name}),(0,s.jsx)(eX.A,{disabled:!0,icon:(0,s.jsx)(j.A,{orientation:"horizontal",sx:{width:"100%"}}),label:""}),(0,s.jsx)(eX.A,{...e0.bootOrder}),(0,s.jsx)(eX.A,{...e0.cpu}),(0,s.jsx)(eX.A,{...e0.disks}),(0,s.jsx)(eX.A,{...e0.interfaces}),(0,s.jsx)(eX.A,{...e0.memory}),(0,s.jsx)(eX.A,{...e0.migration}),(0,s.jsx)(eX.A,{...e0.name}),(0,s.jsx)(eX.A,{...e0.protect}),(0,s.jsx)(eX.A,{...e0.startDependency}),(0,s.jsx)(eX.A,{...e0.delete})]})})]})}),(0,s.jsx)(x.A,{display:{xs:"none",sm:"initial"},children:(0,s.jsx)(j.A,{orientation:"vertical"})}),(0,s.jsxs)(x.A,{size:"grow",children:[(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.general.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.general.label})}),(0,s.jsx)(x.A,{container:!0,rowSpacing:"0.4em",width:"100%",children:[{header:"UUID",value:o.uuid},{header:"State",value:o.state},{header:"On node",value:"".concat(o.anvil.name,": ").concat(o.anvil.description)},{header:"On host",value:o.host?o.host.short:"None"}].map(e=>{let{header:t,value:r}=e;return(0,s.jsx)(x.A,{width:"100%",children:(0,s.jsxs)(x.A,{columnSpacing:"1em",container:!0,width:"100%",children:[(0,s.jsx)(x.A,{width:"10em",children:(0,s.jsx)(A.a3,{children:t})}),(0,s.jsx)(x.A,{size:"grow",children:(0,s.jsx)(A.NA,{children:r})})]})},"general-".concat(t))})})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.bootOrder.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.bootOrder.label})}),(0,s.jsx)(_,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.cpu.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.cpu.label})}),(0,s.jsx)(es,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.delete.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.delete.label})}),(0,s.jsx)(el,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.disks.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.disks.label})}),(0,s.jsx)(eS,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.interfaces.value,children:[(0,s.jsxs)(v.aO,{children:[(0,s.jsx)(A.HM,{children:e0.interfaces.label}),(0,s.jsx)(w,{})]}),(0,s.jsx)(eD,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.memory.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.memory.label})}),(0,s.jsx)(eR,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.migration.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.migration.label})}),(0,s.jsx)(eW,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.name.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.name.label})}),(0,s.jsx)(eZ,{detail:o,tools:b.current,servers:l})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.protect.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.protect.label})}),(0,s.jsx)(eK,{detail:o,tools:b.current})]}),(0,s.jsxs)(e$.A,{changingTabId:n,tabId:e0.startDependency.value,children:[(0,s.jsx)(v.aO,{children:(0,s.jsx)(A.HM,{children:e0.startDependency.label})}),(0,s.jsx)(eQ,{detail:o,servers:l,tools:b.current})]})]})]})}),u]}):(0,s.jsx)(v.Zk,{children:(0,s.jsx)(T.A,{mt:0})})};var e2=r(4903),e5=r(656);let e7="Server",e6={preview:"".concat(e7,"-preview"),fullView:"".concat(e7,"-fullView")},e4=(0,i.Ay)("div")(e=>{let{theme:t}=e;return{["& .".concat(e6.preview)]:{width:"25%",height:"100%",[t.breakpoints.down("md")]:{width:"100%"}},["& .".concat(e6.fullView)]:{display:"flex",flexDirection:"row",width:"100%",justifyContent:"center"}}}),e8=()=>{var e;let t=(0,o.useRouter)(),{data:r,error:i,loading:l}=(0,U.A)("/server"),x=(0,d.useMemo)(()=>(0,u.A)(r,t,e=>t=>t.name===e),[t,r]),j=(0,d.useMemo)(()=>{if(!t.isReady)return"";let{view:e}=t.query;return(0,h.A)(e)},[t.isReady,t.query]);if(l)return(0,s.jsxs)("div",{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:"Loading..."})}),(0,s.jsx)(m.A,{}),(0,s.jsx)(e2.A,{children:(0,s.jsx)(v.Zk,{children:(0,s.jsx)(T.A,{mt:0})})})]});if(!x)return(0,s.jsxs)("div",{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:"Server?"})}),(0,s.jsx)(m.A,{}),(0,s.jsx)(e2.A,{children:(0,s.jsx)(v.Zk,{children:(0,s.jsxs)(eu.A,{children:["Couldn't find server ",t.query.name||t.query.uuid,". ",null==i?void 0:i.message]})})})]});let g={vnc:(0,s.jsx)(n.A,{className:e6.fullView,children:(0,s.jsx)(c.pO,{node:x.anvil,onClickCloseButton:()=>{let e=(0,e5.A)(t,"view");t.replace({query:e},void 0,{shallow:!0})},server:x})})};return(0,s.jsxs)(e4,{children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:x.name})}),(0,s.jsx)(m.A,{}),null!=(e=g[j])?e:(0,s.jsx)(e2.A,{children:(0,s.jsx)(e3,{serverUuid:x.uuid,slotProps:{preview:{onClick:()=>{let e=(0,e5.A)(t,"view","vnc");t.replace({query:e},void 0,{shallow:!0})}}}})})]})}},82707:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var s=r(37876),n=r(11547),i=r(1837),l=r(35268),a=r(14232),o=r(10595),d=r(20795);let c=(0,l.Ay)(n.A)({borderRadius:o.ax,color:o.Qu,padding:".4em .8em",textTransform:"none",["&.".concat(i.A.selected)]:{color:o.ft}}),u=e=>{let{label:t,...r}=e,n=(0,a.useMemo)(()=>"string"==typeof t?(0,s.jsx)(d.a3,{inheritColour:!0,children:t}):t,[t]);return(0,s.jsx)(c,{label:n,...r})}},93282:(e,t,r)=>{"use strict";r.d(t,{A:()=>x});var s=r(37876),n=r(1837),i=r(64122),l=r(22515),a=r(84932),o=r(66703),d=r(35268),c=r(14232),u=r(10595);let h="1.8em",m=(0,d.Ay)(i.A)({minHeight:"1em",["&.".concat(l.A.vertical)]:{minHeight:h,["& .".concat(n.A.root)]:{alignItems:"flex-start",minHeight:h,paddingLeft:"2em"},["& .".concat(l.A.indicator)]:{right:"initial"}},["& .".concat(n.A.root)]:{minHeight:"1em"},["& .".concat(l.A.indicator)]:{backgroundColor:u.ft,borderRadius:u.ax}}),x=e=>{let{orientation:t,variant:r="fullWidth",...n}=e,i=(0,o.A)(),l=(0,c.useCallback)(e=>i.breakpoints.up(e),[i]),d=(0,a.A)(l("xs")),u=(0,a.A)(l("sm")),h=(0,a.A)(l("md")),x=(0,a.A)(l("lg")),j=(0,a.A)(l("xl")),v=(0,c.useMemo)(()=>[["xs",d],["sm",u],["md",h],["lg",x],["xl",j]],[x,h,u,j,d]),g=(0,c.useMemo)(()=>{let e;return"object"==typeof t?v.some(r=>{let[s,n]=r;return n&&t[s]&&(e=t[s]),!n}):e=t,e},[v,t]);return(0,s.jsx)(m,{orientation:g,variant:r,...n})}}},e=>{e.O(0,[347,766,845,107,422,632,238,8,5,337,577,466,292,552,636,593,792],()=>e(e.s=15421)),_N_E=e.O()}]);