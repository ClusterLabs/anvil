(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(95911)}])},9968:function(e,n,t){"use strict";var s=t(85893),r=t(77527),i=t(90642),c=t(39971);let l="Decorator",o={ok:"".concat(l,"-ok"),warning:"".concat(l,"-warning"),error:"".concat(l,"-error"),off:"".concat(l,"-off")},a=(0,r.ZP)(i.Z)({borderRadius:c.n_,height:"100%",width:"1.4em",["&.".concat(o.ok)]:{backgroundColor:c.Ej},["&.".concat(o.warning)]:{backgroundColor:c.Wd},["&.".concat(o.error)]:{backgroundColor:c.hM},["&.".concat(o.off)]:{backgroundColor:c.s7}});n.Z=e=>{let{colour:n,...t}=e;return(0,s.jsx)(a,{...t,className:o[n]})}},91905:function(e,n,t){"use strict";var s=t(85893),r=t(67294),i=t(8506),c=t(90642);n.Z=e=>{let{calculateItemBreakpoints:n=()=>({xs:1}),layout:t,wrapperBoxProps:l,...o}=e,a=(0,r.useMemo)(()=>Object.entries(t).map((e,t)=>{let[s,c]=e;return c?(0,r.createElement)(i.ZP,{...n(t,s),key:s,item:!0,...c}):void 0}),[n,t]);return(0,s.jsx)(c.Z,{...l,children:(0,s.jsx)(i.ZP,{container:!0,...o,children:a})})}},65716:function(e,n,t){"use strict";var s=t(85893),r=t(11825),i=t(61769),c=t(39971),l=t(5387);n.Z=e=>{let{children:n,sx:t,...o}=e;return(0,s.jsx)(i.Z,{underline:"hover",variant:"subtitle1",...o,sx:{color:c.lD,textDecorationColor:c.s7,...t},children:(0,s.jsxs)(l.Z,{row:!0,children:[n,(0,s.jsx)(r.Z,{sx:{marginLeft:".3em"}})]})})}},39806:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var s=e=>e.reduce((e,n)=>{let{hostName:t,hostType:s,hostUUID:r,shortHostName:i}=n;return e[r]={name:t,short:i,type:s,uuid:r},e},{}),r=e=>e.reduce((e,n)=>{let{anvilDescription:t,anvilName:r,anvilUUID:i,hosts:c}=n;return e[i]={description:t,hosts:s(c),name:r,uuid:i},e},{})},95911:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ex}});var s=t(85893),r=t(90642),i=t(9008),c=t.n(i),l=t(24811),o=t(67294),a=t(8506),d=t(54490),h=t(39971),x=e=>{let{anvilStatus:n,anvil_name:t,anvil_uuid:s,hosts:r}=e;return{hosts:r.reduce((e,n)=>{let{host_name:t,host_uuid:s,maintenance_mode:r,server_count:i,state:c,state_percent:l}=n;return e[s]={name:t,maintenance:r,serverCount:i,state:c,stateProgress:l,uuid:s},e},{}),name:t,status:n,uuid:s}},u=t(22700),m=t(60665),j=t(82092),Z=t(5387),v=t(90209),p=t(55507),g=t(57882),f=t(29255),P=t(5499);let w=BigInt(100),b={offline:h.s7,optimal:h.Ej},_={offline:h.s7,optimal:h.Ej},y={offline:h.s7,online:h.Ej};var C=e=>{let{anvilUuid:n,refreshInterval:t=5e3}=e,{altData:r,loading:i}=(0,P.Z)("/anvil/".concat(n),{mod:x,refreshInterval:t}),{data:c,loading:C}=(0,P.Z)("/anvil/".concat(n,"/cpu"),{refreshInterval:t}),k=(0,o.useMemo)(()=>c&&Object.values(c.hosts),[c]),{altData:S,loading:A}=(0,P.Z)("/anvil/".concat(n,"/memory"),{mod:u.Z,refreshInterval:t}),{altData:M,loading:W}=(0,P.Z)("/anvil/".concat(n,"/store"),{mod:m.Z,refreshInterval:t}),N=(0,o.useMemo)(()=>[i,C,A,W].some(e=>e),[i,C,A,W]),E=(0,o.useMemo)(()=>{var e;if(!r)return;let n=null!==(e=b[r.status.system])&&void 0!==e?e:h.Wd;return(0,s.jsx)(g.$_,{inheritColour:!0,color:n,children:r.status.system})},[r]),I=(0,o.useMemo)(()=>{var e;let n;if(!r)return;let{drbd:t}=r.status;t.estimatedTimeToSync&&(n=(0,f.F6)(t.estimatedTimeToSync));let i=null!==(e=_[r.status.drbd.status])&&void 0!==e?e:h.Wd;return(0,s.jsxs)(g.$_,{inheritColour:!0,color:i,children:[r.status.drbd.status,n&&"(needs ~".concat(n,")")]})},[r]),O=(0,o.useMemo)(()=>r&&(0,s.jsx)(a.ZP,{columns:1,container:!0,children:Object.values(r.hosts).map(e=>{var n;let{name:t,serverCount:r,state:i,stateProgress:c,uuid:l}=e,o=null!==(n=y[i])&&void 0!==n?n:h.Wd,d=i;return["offline","online"].includes(i)||(d="".concat(i," (").concat(c,"%)")),(0,s.jsxs)(a.ZP,{alignItems:"center",columnSpacing:"0.5em",container:!0,sx:{},children:[(0,s.jsx)(a.ZP,{item:!0,xs:"auto",children:(0,s.jsx)(g.Ac,{variant:"caption",whiteSpace:"nowrap",children:t})}),(0,s.jsx)(a.ZP,{item:!0,xs:"auto",children:(0,s.jsx)(g.$_,{inheritColour:!0,color:o,children:d})}),(0,s.jsx)(a.ZP,{item:!0,xs:!0,children:(0,s.jsx)(j.Z,{})}),(0,s.jsx)(a.ZP,{item:!0,xs:"auto",children:(0,s.jsxs)(a.ZP,{alignItems:"center",columns:2,container:!0,width:"4em",children:[(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{variant:"caption",children:"Servers"})}),(0,s.jsx)(a.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(g.$_,{variant:"caption",children:r})})]})})]},"subnode-".concat(l))})}),[r]),D=(0,o.useMemo)(()=>c&&k&&(0,s.jsxs)(Z.Z,{row:!0,rowSpacing:".5em",children:[(0,s.jsxs)(g.Ac,{variant:"caption",whiteSpace:"nowrap",children:["Vendor"," ",(0,s.jsx)(g.Q0,{sx:{paddingRight:0},children:k[0].vendor})]}),(0,s.jsx)(j.Z,{sx:{flexGrow:1}}),(0,s.jsxs)(a.ZP,{alignItems:"center",columns:2,container:!0,width:"4em",children:[(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{variant:"caption",children:"Cores"})}),(0,s.jsx)(a.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(g.$_,{variant:"caption",children:c.cores})}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{variant:"caption",children:"Threads"})}),(0,s.jsx)(a.ZP,{display:"flex",item:!0,justifyContent:"flex-end",xs:1,children:(0,s.jsx)(g.$_,{variant:"caption",children:c.threads})})]})]}),[c,k]),z=(0,o.useMemo)(()=>S&&(0,s.jsxs)(Z.Z,{spacing:0,children:[(0,s.jsx)(Z.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(g.Ac,{mb:"-.3em",variant:"caption",children:["Free",(0,s.jsx)(g.Q0,{children:(0,d._d)(S.available,{toUnit:"ibyte"})}),"/",(0,s.jsx)(g.Q0,{sx:{paddingRight:0},children:(0,d._d)(S.total,{toUnit:"ibyte"})})]})}),(0,s.jsx)(p.Z,{thin:!0,value:{reserved:{value:Number(S.reserved*w/S.total)},allocated:{value:Number((S.reserved+S.allocated)*w/S.total),colour:{0:h.Ej,70:h.Wd,90:h.hM}}}})]}),[S]),U=(0,o.useMemo)(()=>M&&(0,s.jsxs)(Z.Z,{spacing:0,children:[(0,s.jsx)(Z.Z,{row:!0,justifyContent:"flex-end",children:(0,s.jsxs)(g.Ac,{mb:"-.3em",variant:"caption",children:["Total free",(0,s.jsx)(g.Q0,{children:(0,d._d)(M.totalFree,{toUnit:"ibyte"})}),"/",(0,s.jsx)(g.Q0,{sx:{paddingRight:0},children:(0,d._d)(M.totalSize,{toUnit:"ibyte"})})]})}),(0,s.jsx)(p.Z,{thin:!0,value:{allocated:{value:Number((M.totalSize-M.totalFree)*w/M.totalSize),colour:{0:h.Ej,70:h.Wd,90:h.hM}}}})]}),[M]);return N?(0,s.jsx)(v.Z,{mt:0}):(0,s.jsxs)(a.ZP,{alignItems:"center",columns:4,container:!0,sx:{["& > .".concat(l.Z.item,":nth-child(odd)")]:{alignItems:"center",display:"flex",height:"2.2em"}},children:[(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Node"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:E}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Replication"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:I}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Subnodes"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:O}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"CPU"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:D}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Memory"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:z}),(0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(g.Ac,{children:"Storage"})}),(0,s.jsx)(a.ZP,{item:!0,xs:3,children:U})]})},k=t(39806),S=t(91905),A=t(65716),M=t(65375),W=t(18573),N=e=>{let{refreshInterval:n=4e3}=e,{altData:t,loading:r,validating:i}=(0,P.Z)("/anvil",{mod:k.Z,refreshInterval:n}),c=(0,o.useMemo)(()=>t&&(0,s.jsx)(S.Z,{columns:{xs:1,md:2,lg:3,xl:4},layout:Object.values(t).reduce((e,t)=>{let{description:r,name:i,uuid:c}=t;return e["anvil-".concat(c)]={children:(0,s.jsxs)(M.Lg,{height:"100%",mv:0,children:[(0,s.jsxs)(M.CH,{children:[(0,s.jsx)(A.Z,{href:"/anvil?name=".concat(i),noWrap:!0,children:i}),(0,s.jsx)(g.Ac,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:r})]}),(0,s.jsx)(M.bc,{children:(0,s.jsx)(C,{anvilUuid:c,refreshInterval:n})})]})},e},{}),spacing:"1em",sx:{alignContent:"stretch",["& > .".concat(l.Z.item)]:{minWidth:"20em"}}}),[t,n]);return(0,s.jsxs)(M.s_,{children:[(0,s.jsxs)(M.V9,{children:[(0,s.jsx)(g.z,{children:"Nodes"}),(0,s.jsx)(W.Z,{syncing:i})]}),r?(0,s.jsx)(v.Z,{}):c]})},E=t(25436),I=t(86142),O=t(38855),D=t(44859),z=t(23279),U=t.n(z),T=t(46194),R=t(45328),$=t(37600),F=t(18766),B=t(29873),Q=t(43463),H=t(43267),L=t(77527),V=t(65625),X=t(48403),G=t.n(X),J=t(9968),q=t(45842),K=t(21758),Y=t(54420);let ee={running:"ok","shut off":"off",crashed:"error"},en=(0,L.ZP)(q.$x)(()=>({borderRadius:h.n_,height:"calc(".concat("3em"," * 0.8)"),width:"3em"})),et=(0,L.ZP)(q.$x)(()=>{let e="3.2em";return{height:e,margin:0,width:e}}),es=e=>{var n;return null!==(n=ee[e])&&void 0!==n?n:"warning"};var er=e=>{let n,t,i,c;let{servers:l,uuid:d}=e,h=l[d],x=(0,o.useMemo)(()=>"provisioning"===h.state,[h.state]),u=(0,o.useMemo)(()=>{let{jobs:e}=h;if(e)return(0,s.jsx)(et,{children:[...Object.values(e).map((e,n)=>{let{peer:t,progress:r,uuid:i}=e;return(0,s.jsx)(K.Z,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(2.8em - ".concat(1.5*n,"em)"),sx:{opacity:t?.6:void 0,["& .".concat(V.Z.circle)]:{strokeLinecap:"round"}},thickness:6},underline:{thickness:r?0:1}},value:r},"".concat(i,"-progress"))})]})},[h]);return x?(n=(0,s.jsx)(a.ZP,{item:!0,children:u}),i=(0,s.jsx)(g.Ac,{noWrap:!0,children:h.name}),c=(0,s.jsxs)(g.Ac,{noWrap:!0,children:[G()(h.state),"..."]})):(n=(0,s.jsx)(a.ZP,{alignSelf:"stretch",item:!0,children:(0,s.jsx)(J.Z,{colour:es(h.state)})}),t=(0,s.jsx)(q.MB,{server:h,slots:{screenshotBox:(0,s.jsx)(en,{})},slotProps:{screenshot:{sx:{fontSize:".6em"}}}}),i=(0,s.jsx)(A.Z,{href:"/server?name=".concat(h.name),noWrap:!0,children:h.name}),c=(0,s.jsx)(g.Ac,{noWrap:!0,children:G()(h.state)})),(0,s.jsxs)(a.ZP,{alignItems:"center",container:!0,spacing:"0.5em",children:[n,(0,s.jsx)(a.ZP,{item:!0,children:t}),(0,s.jsx)(a.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(a.ZP,{container:!0,children:[(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:i}),(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:c})]})}),(0,s.jsx)(a.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(A.Z,{href:"/anvil?name=".concat(h.anvil.name),noWrap:!0,children:h.anvil.name}),h.host&&(0,s.jsx)(g.Ac,{noWrap:!0,children:h.host.short})]})}),(0,s.jsx)(a.ZP,{item:!0,children:(0,s.jsx)(Y.Z,{iconButtonProps:{size:"small"},serverName:h.name,serverState:h.state,serverUuid:h.uuid})})]})},ei=e=>{let{groups:n,servers:t}=e,{altData:r,loading:i}=(0,P.Z)("/anvil",{mod:k.Z}),c=(0,o.useMemo)(()=>r?Object.entries(n).reduce((e,n,i,c)=>{let[l,o]=n;return o.length&&(o.forEach(n=>{e.push((0,s.jsx)(a.ZP,{item:!0,xs:1,children:(0,s.jsx)(er,{anvils:r,servers:t,uuid:n})},"".concat(n,"-summary")))}),i+1!==c.length&&e.push((0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{orientation:"horizontal"})},"".concat(l,"-end")))),e},[]):[],[r,n,t]);return i?(0,s.jsx)(a.ZP,{container:!0,spacing:"1em",children:(0,s.jsx)(v.Z,{mt:0})}):(0,s.jsx)(a.ZP,{columns:{xs:1,md:2,lg:3,xl:4},container:!0,spacing:"1em",children:[...c]})};let ec=(0,L.ZP)(q.$x)(e=>{let{theme:n}=e,t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return"calc(".concat(e," * 0.6)")};return{width:"100%",[n.breakpoints.up("xs")]:{height:t("100vw")},[n.breakpoints.up("sm")]:{height:t("50vw")},[n.breakpoints.up("md")]:{height:t("100vw / 3")},[n.breakpoints.up("lg")]:{height:t("25vw")},[n.breakpoints.up("xl")]:{height:t("100vw / 6")}}}),el=e=>(0,s.jsx)(a.ZP,{item:!0,children:(0,s.jsx)(q.bC,{getHeader:e=>{let{anvil:n,jobs:t,name:r}=e;return(0,s.jsxs)(s.Fragment,{children:[t?(0,s.jsx)(g.Ac,{noWrap:!0,children:r}):(0,s.jsx)(A.Z,{href:"/server?name=".concat(r),noWrap:!0,children:r}),(0,s.jsx)(A.Z,{href:"/anvil?name=".concat(n.name),noWrap:!0,sx:{opacity:.7},children:n.name})]})},server:e,showControls:!e.jobs,children:(0,s.jsx)(q.MB,{server:e,slots:{screenshotBox:(0,s.jsx)(ec,{})}})},"".concat(e.uuid,"-preview"))});var eo=e=>{let{groups:n,servers:t}=e,r=(0,o.useMemo)(()=>Object.entries(n).reduce((e,n,r,i)=>{let[c,l]=n;return l.length&&(l.forEach(n=>{let r=t[n];e.push((0,s.jsx)(a.ZP,{item:!0,xs:1,children:el(r)},"".concat(n,"-panel")))}),r+1!==i.length&&e.push((0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{orientation:"horizontal"})},"".concat(c,"-end")))),e},[]),[n,t]);return(0,s.jsx)(a.ZP,{columns:{xs:1,sm:2,md:3,lg:4,xl:6},container:!0,spacing:"1em",children:r})},ea=t(12823);let ed=(e,n)=>{let t={match:[],none:[]};if(!e)return t;let s=Object.keys(e);return n?s.reduce((t,s)=>{let r=e[s],i=RegExp(n,"i"),c=JSON.stringify(r);return i.test(c)?t.match.push(s):t.none.push(s),t},t):t.none=s,t};var eh=()=>{let e;let[n,t]=(0,o.useState)(null),[i,c]=(0,o.useState)(),[l,d]=(0,o.useState)(""),{data:x,loading:u,error:m,validating:Z}=(0,P.Z)("/server",{refreshInterval:4e3,onSuccess:e=>{c(ed(e,l))}}),p=(0,o.useMemo)(()=>U()(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[,s=""]=n;d(s),c(ed(...n))},500),[]),f=(0,o.useMemo)(()=>{if(l&&(null==i||!i.match.length))return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(g.Ac,{noWrap:!0,children:"No match"})}),(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{orientation:"horizontal"})})]})},[null==i?void 0:i.match.length,l]),w=(0,H.Zd)();if(u)return(0,s.jsx)(M.s_,{children:(0,s.jsx)(v.Z,{mt:0})});if(!x||!i)return(0,s.jsx)(M.s_,{children:(0,s.jsxs)(B.Z,{type:"warning",children:["Couldn't get the list of servers. ",null==m?void 0:m.message]})});let b="preferences.servers.view";return e="list"===localStorage.getItem(b)?(0,s.jsx)(ei,{groups:i,servers:x}):(0,s.jsx)(eo,{groups:i,servers:x}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(M.s_,{children:[(0,s.jsxs)(M.V9,{children:[(0,s.jsx)(g.z,{children:"Servers"}),(0,s.jsx)(W.Z,{syncing:Z}),(0,s.jsxs)(r.Z,{sx:{["&.".concat(D.Z.root)]:{marginRight:".5em"}},children:[(0,s.jsx)(T.Z,{onClick:e=>{t(e.currentTarget)},startIcon:(0,s.jsx)(I.Z,{}),sx:{lineHeight:2},children:"View"}),(0,s.jsxs)($.Z,{muiMenuProps:{anchorEl:n,keepMounted:!0,onClose:()=>t(null)},open:!!n,children:[(0,s.jsx)(F.Z,{onClick:()=>{localStorage.setItem(b,"previews"),t(null)},children:(0,s.jsx)(g.Ac,{inheritColour:!0,children:"Previews"})}),(0,s.jsx)(F.Z,{onClick:()=>{localStorage.setItem(b,"list"),t(null)},children:(0,s.jsx)(g.Ac,{inheritColour:!0,children:"List"})})]})]}),(0,s.jsx)(R.Z,{mapPreset:"add",onClick:()=>{w.setOpen(!0)}}),(0,s.jsx)(ea.Z,{input:(0,s.jsx)(Q.Z,{onChange:e=>{let{value:n}=e.target;p(x,n)},startAdornment:(0,s.jsx)(O.Z,{sx:{color:h.d,marginRight:".4em"}}),sx:{width:"20em"}})})]}),(0,s.jsxs)(a.ZP,{container:!0,spacing:"1em",children:[f,(0,s.jsx)(a.ZP,{item:!0,width:"100%",children:e})]})]}),w.dialog]})},ex=()=>(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(c(),{children:(0,s.jsx)("title",{children:"Dashboard"})}),(0,s.jsx)(E.Z,{}),(0,s.jsx)(eh,{}),(0,s.jsx)(N,{})]})}},function(e){e.O(0,[995,256,202,391,810,126,436,622,259,352,888,774,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);