(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[249],{88668:function(e,n,t){var r=t(83369),i=t(90619),l=t(72385);function a(e){var n=-1,t=null==e?0:e.length;for(this.__data__=new r;++n<t;)this.add(e[n])}a.prototype.add=a.prototype.push=i,a.prototype.has=l,e.exports=a},82908:function(e){e.exports=function(e,n){for(var t=-1,r=null==e?0:e.length;++t<r;)if(n(e[t],t,e))return!0;return!1}},90939:function(e,n,t){var r=t(2492),i=t(37005);e.exports=function e(n,t,l,a,o){return n===t||(null!=n&&null!=t&&(i(n)||i(t))?r(n,t,l,a,e,o):n!=n&&t!=t)}},2492:function(e,n,t){var r=t(46384),i=t(67114),l=t(18351),a=t(16096),o=t(64160),s=t(1469),u=t(44144),d=t(36719),c="[object Arguments]",m="[object Array]",h="[object Object]",p=Object.prototype.hasOwnProperty;e.exports=function(e,n,t,v,f,g){var x=s(e),j=s(n),Z=x?m:o(e),b=j?m:o(n);Z=Z==c?h:Z,b=b==c?h:b;var y=Z==h,w=b==h,A=Z==b;if(A&&u(e)){if(!u(n))return!1;x=!0,y=!1}if(A&&!y)return g||(g=new r),x||d(e)?i(e,n,t,v,f,g):l(e,n,Z,t,v,f,g);if(!(1&t)){var C=y&&p.call(e,"__wrapped__"),O=w&&p.call(n,"__wrapped__");if(C||O){var _=C?e.value():e,P=O?n.value():n;return g||(g=new r),f(_,P,t,v,g)}}return!!A&&(g||(g=new r),a(e,n,t,v,f,g))}},74757:function(e){e.exports=function(e,n){return e.has(n)}},67114:function(e,n,t){var r=t(88668),i=t(82908),l=t(74757);e.exports=function(e,n,t,a,o,s){var u=1&t,d=e.length,c=n.length;if(d!=c&&!(u&&c>d))return!1;var m=s.get(e),h=s.get(n);if(m&&h)return m==n&&h==e;var p=-1,v=!0,f=2&t?new r:void 0;for(s.set(e,n),s.set(n,e);++p<d;){var g=e[p],x=n[p];if(a)var j=u?a(x,g,p,n,e,s):a(g,x,p,e,n,s);if(void 0!==j){if(j)continue;v=!1;break}if(f){if(!i(n,function(e,n){if(!l(f,n)&&(g===e||o(g,e,t,a,s)))return f.push(n)})){v=!1;break}}else if(!(g===x||o(g,x,t,a,s))){v=!1;break}}return s.delete(e),s.delete(n),v}},18351:function(e,n,t){var r=t(62705),i=t(11149),l=t(77813),a=t(67114),o=t(68776),s=t(21814),u=r?r.prototype:void 0,d=u?u.valueOf:void 0;e.exports=function(e,n,t,r,u,c,m){switch(t){case"[object DataView]":if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)break;e=e.buffer,n=n.buffer;case"[object ArrayBuffer]":if(e.byteLength!=n.byteLength||!c(new i(e),new i(n)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return l(+e,+n);case"[object Error]":return e.name==n.name&&e.message==n.message;case"[object RegExp]":case"[object String]":return e==n+"";case"[object Map]":var h=o;case"[object Set]":var p=1&r;if(h||(h=s),e.size!=n.size&&!p)break;var v=m.get(e);if(v)return v==n;r|=2,m.set(e,n);var f=a(h(e),h(n),r,u,c,m);return m.delete(e),f;case"[object Symbol]":if(d)return d.call(e)==d.call(n)}return!1}},16096:function(e,n,t){var r=t(58234),i=Object.prototype.hasOwnProperty;e.exports=function(e,n,t,l,a,o){var s=1&t,u=r(e),d=u.length;if(d!=r(n).length&&!s)return!1;for(var c=d;c--;){var m=u[c];if(!(s?m in n:i.call(n,m)))return!1}var h=o.get(e),p=o.get(n);if(h&&p)return h==n&&p==e;var v=!0;o.set(e,n),o.set(n,e);for(var f=s;++c<d;){var g=e[m=u[c]],x=n[m];if(l)var j=s?l(x,g,m,n,e,o):l(g,x,m,e,n,o);if(!(void 0===j?g===x||a(g,x,t,l,o):j)){v=!1;break}f||(f="constructor"==m)}if(v&&!f){var Z=e.constructor,b=n.constructor;Z!=b&&"constructor"in e&&"constructor"in n&&!("function"==typeof Z&&Z instanceof Z&&"function"==typeof b&&b instanceof b)&&(v=!1)}return o.delete(e),o.delete(n),v}},68776:function(e){e.exports=function(e){var n=-1,t=Array(e.size);return e.forEach(function(e,r){t[++n]=[r,e]}),t}},90619:function(e){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},72385:function(e){e.exports=function(e){return this.__data__.has(e)}},21814:function(e){e.exports=function(e){var n=-1,t=Array(e.size);return e.forEach(function(e){t[++n]=e}),t}},18446:function(e,n,t){var r=t(90939);e.exports=function(e,n){return r(e,n)}},24084:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mail-config",function(){return t(86901)}])},96674:function(e,n,t){"use strict";var r=t(85893),i=t(89256),l=t(62191),a=t(89262),o=t(59879),s=t(324),u=t(28721),d=t(73315),c=t(14440),m=t(55074),h=t(67294),p=t(77831),v=t(34635),f=t(91029);let g=e=>(0,r.jsx)(i.Z,{in:!0,children:(0,r.jsx)(l.Z,{...e})}),x=(0,a.ZP)("ul")({padding:0}),j=o.Z;n.Z=e=>{let{componentsProps:n,extendRenderInput:t,getGroupLabel:i,label:l,messageBoxProps:a,renderGroup:o,renderInput:Z,sx:b,...y}=e,w=(0,h.useMemo)(()=>({paper:{sx:{backgroundColor:p.lD,["& .".concat(s.Z.groupLabel)]:{backgroundColor:p.lD}}},...n}),[n]),A=(0,h.useMemo)(()=>o||i&&(e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(j,{component:"div",className:s.Z.groupLabel,children:i(e.group)}),(0,r.jsx)(x,{className:s.Z.groupUl,children:e.children})]},e.key)),[i,o]),C=(0,h.useMemo)(()=>null!=Z?Z:e=>{let{fullWidth:n,InputProps:i,InputLabelProps:a,inputProps:o}=e,s={formControlProps:{fullWidth:n,ref:i.ref},inputLabelProps:a,inputProps:{className:i.className,endAdornment:i.endAdornment,inputProps:o,startAdornment:i.startAdornment},label:l};return null==t||t.call(null,s,e),(0,r.jsx)(f.Z,{...s})},[t,l,Z]),O=(0,h.useMemo)(()=>({["& .".concat(u.Z.root," .").concat(s.Z.endAdornment)]:{right:"7px",["& .".concat(d.Z.root)]:{color:p.s7}},...b}),[b]);return(0,r.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,r.jsx)(m.Z,{PaperComponent:g,...y,componentsProps:w,renderGroup:A,renderInput:C,sx:O}),(0,r.jsx)(v.Z,{...a})]})}},78533:function(e,n,t){"use strict";var r=t(85893),i=t(67294),l=t(98484),a=t(33544),o=t(97607),s=t(83916),u=t(68805),d=t(85291),c=t(2188),m=t(77510);let h=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return"function"==typeof e?e(...t):e};n.Z=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[p]=n,{addHeader:v,editHeader:f,entriesUrl:g,formDialogProps:x,getAddLoading:j,getDeleteErrorMessage:Z,getDeleteHeader:b,getDeletePromiseChain:y=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return e(...t)},getDeleteSuccessMessage:w,getEditLoading:A=e=>e,listEmpty:C,listProps:O,onItemClick:_=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return e(...t)},refreshInterval:P=5e3,renderAddForm:M,renderDeleteItem:F,renderEditForm:k,renderListItem:S,entryUrlPrefix:I=g}=p,V=(0,i.useRef)(null),D=(0,i.useRef)(null),{confirmDialog:E,finishConfirm:q,setConfirmDialogLoading:R,setConfirmDialogOpen:L,setConfirmDialogProps:U}=(0,c.Z)({initial:{scrollContent:!0}}),[N,T]=(0,i.useState)(!1),[H,W]=(0,i.useState)(),{data:z,mutate:K,loading:B}=(0,m.Z)(g,{refreshInterval:P}),{fetch:G,loading:J}=(0,u.Z)({onData:e=>W(e),url:I}),X=(0,i.useMemo)(()=>h(v),[v]),Q=(0,i.useMemo)(()=>h(f,H),[H,f]),Y=(0,i.useMemo)(()=>({add:{open:function(){var e;let n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==V?void 0:null===(e=V.current)||void 0===e?void 0:e.setOpen(n)}},confirm:{finish:q,loading:R,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return L(e)},prepare:U},edit:{open:function(){var e;let n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==D?void 0:null===(e=D.current)||void 0===e?void 0:e.setOpen(n)}}}),[q,R,L,U]),{buildDeleteDialogProps:$,checks:ee,getCheck:en,hasAllChecks:et,hasChecks:er,multipleItems:ei,resetChecks:el,setAllChecks:ea,setCheck:eo}=(0,d.Z)({list:z});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{allowCheckAll:ei,allowEdit:!0,allowItemButton:N,disableDelete:!er,edit:N,getListCheckboxProps:()=>({checked:et,onChange:(e,n)=>ea(n)}),getListItemCheckboxProps:e=>({checked:en(e),onChange:(n,t)=>eo(e,t)}),header:!0,listEmpty:C,listItems:z,loading:B,onAdd:()=>{var e;return null==V?void 0:null===(e=V.current)||void 0===e?void 0:e.setOpen(!0)},onDelete:()=>{U($({onProceedAppend:()=>{R(!0),Promise.all(y((e,n)=>e.map(e=>l.Z.delete("".concat(n,"/").concat(e))),ee,g)).then(()=>{q("Success",w()),K()}).catch(e=>{q("Error",Z((0,o.Z)(e)))}).finally(()=>{el()})},getConfirmDialogTitle:b,renderEntry:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return F(z,...n)}})),L(!0)},onEdit:()=>T(e=>!e),onItemClick:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return _((e,n)=>{var t;null==D||null===(t=D.current)||void 0===t||t.setOpen(!0),G("/".concat(n))},...n)},renderListItem:S,...O}),(0,r.jsx)(a.Js,{header:X,loading:null==j?void 0:j.call(null),ref:V,showClose:!0,...null==x?void 0:x.common,...null==x?void 0:x.add,children:M(Y)}),(0,r.jsx)(a.Js,{header:Q,loading:A(J),ref:D,showClose:!0,...null==x?void 0:x.common,...null==x?void 0:x.edit,children:k(Y,H)}),E]})}},2188:function(e,n,t){"use strict";var r=t(85893),i=t(67294),l=t(77583),a=t(99576);n.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initial:{actionProceedText:n="",content:t="",titleText:o="",...s}={}}=e,u=(0,i.useRef)(null),[d,c]=(0,i.useState)({actionProceedText:n,content:t,titleText:o}),m=(0,i.useCallback)(e=>c(n=>{let{loading:t,...r}=n;return{...r,loading:e}}),[]),h=(0,i.useCallback)(e=>{var n,t;return null==u?void 0:null===(t=u.current)||void 0===t?void 0:null===(n=t.setOpen)||void 0===n?void 0:n.call(null,e)},[]),p=(0,i.useCallback)((e,n)=>c({actionProceedText:"",content:(0,r.jsx)(a.Z,{...n}),showActionArea:!1,showClose:!0,titleText:e}),[]);return{confirmDialog:(0,i.useMemo)(()=>(0,r.jsx)(l.Z,{...s,...d,ref:u}),[d,s]),confirmDialogRef:u,setConfirmDialogLoading:m,setConfirmDialogOpen:h,setConfirmDialogProps:c,finishConfirm:p}}},82547:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var r=t(55066),i=t(18446),l=t.n(i),a=t(13218),o=t.n(a),s=t(67294),u=t(23279),d=t.n(u),c=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{wait:t=500,...r}=n;return d()(e,t,r)},m=t(87196);let h=(e,n,t)=>{let[r,...i]=e;if(!(r in n))return!1;let a=n[r],s=t[r];return o()(a)&&o()(s)&&i.length?h(i,a,s):!l()(a,s)};var p=e=>{let[n,t]=(0,s.useState)(!1),i=(0,r.TA)({...e}),l=(0,s.useCallback)(e=>h(e.split("."),i.values,i.initialValues),[i.initialValues,i.values]),a=(0,s.useMemo)(()=>{let e=c(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];i.handleChange(...n),t(!1)});return function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];t(!0),e(...r)}},[i.handleChange]),o=(0,s.useMemo)(()=>n||!i.dirty||!i.isValid||i.isValidating||i.isSubmitting,[n,i.dirty,i.isSubmitting,i.isValid,i.isValidating]),u=(0,s.useMemo)(()=>(0,m.Z)(i.errors,{skip:e=>!l(e)}),[i.errors,l]);return{disabledSubmit:o,formik:i,formikErrors:u,handleChange:a}}},86901:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Y}});var r=t(85893),i=t(99514),l=t(9008),a=t.n(l),o=t(39937),s=t(60166),u=t(67294),d=t(25934),c=t(4845),m=t(98484),h=t(56903),p=t(44089),v=t(97607),f=t(16310),g=t(36026),x=t(74077);let j=f.Rx().oneOf([0,1,2,3,4]),Z=f.Ry({delete:f.O7().optional(),level:j.required(),target:f.Ry({type:f.Z_().oneOf(["node","subnode"]).required(),uuid:(0,x.u)().required()}),uuid:(0,x.u)().optional()}),b=f.Vo(e=>f.Ry((0,g.Z)(e,Z))),y=f.Ry({alertOverrides:b,email:f.Z_().email().required(),language:f.Z_().oneOf(["en_CA"]).optional(),level:j.required(),name:f.Z_().required(),uuid:(0,x.u)().optional()}),w=f.Vo(e=>f.Ry((0,g.Z)(e,y)));var A=t(96674),C=t(65895),O=t(6189),_=t(59278),P=t(12387);let M=[{displayValue:"Ignore",value:0},{displayValue:"Critical",value:1},{displayValue:"Warning",value:2},{displayValue:"Notice",value:3},{displayValue:"Info",value:4}];var F=e=>{let{alertOverrideTargetOptions:n,alertOverrideValueId:t,mailRecipientUuid:l,formikUtils:a}=e,o=(0,u.useMemo)(()=>null!=t?t:(0,d.Z)(),[t]),{formik:s}=a,{values:{[l]:c}}=s,{alertOverrides:{[o]:m}}=c,p=(0,u.useMemo)(()=>"".concat(l,".alertOverrides.").concat(o),[o,l]),v=(0,u.useMemo)(()=>"".concat(p,".remove"),[p]),f=(0,u.useMemo)(()=>"".concat(p,".target"),[p]),g=(0,u.useMemo)(()=>"".concat(p,".level"),[p]);return(0,r.jsxs)(i.ZP,{alignItems:"center",columns:{xs:1,sm:10},container:!0,justifyContent:"stretch",spacing:"1em",children:[(0,r.jsx)(i.ZP,{item:!0,xs:6,children:(0,r.jsx)(A.Z,{getOptionLabel:e=>e.name,id:f,isOptionEqualToValue:(e,n)=>e.uuid===n.uuid,label:"Target",noOptionsText:"No node or subnode found.",onChange:(e,n)=>s.setFieldValue(f,n,!0),openOnFocus:!0,options:n,renderOption:(e,n)=>(0,u.createElement)("li",{...e,key:"".concat(n.node,"-").concat(n.uuid)},"node"===n.type?(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(_.Ac,{inheritColour:!0,children:n.name}),(0,r.jsx)(_.KI,{inheritColour:!0,children:n.description})]}):(0,r.jsx)(_.Ac,{inheritColour:!0,paddingLeft:".6em",children:n.name})),value:m.target})}),(0,r.jsx)(i.ZP,{item:!0,flexGrow:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(O.Z,{id:g,label:"Alert level",name:g,onChange:s.handleChange,selectItems:M,value:m.level})})}),(0,r.jsx)(i.ZP,{item:!0,width:"min-content",children:(0,r.jsx)(C.Z,{mapPreset:"delete",onClick:()=>{m.uuids?s.setFieldValue(v,!0,!0):s.setValues(e=>{let n={...e},{[l]:t}=n,{[o]:r,...i}=t.alertOverrides;return t.alertOverrides={...i},n})},size:"small"})})]})},k=t(83916),S=e=>{let{alertOverrideTargetOptions:n,formikUtils:t,mailRecipientUuid:i}=e,{formik:l}=t,{values:{[i]:a}}=l,{alertOverrides:o}=a;return(0,r.jsx)(k.Z,{allowAddItem:!0,edit:!0,header:"Alert override rules",listEmpty:"No alert overrides(s)",listItems:o,onAdd:()=>{let e=(0,d.Z)();l.setValues(n=>{let t={...n},{[i]:r}=t;return r.alertOverrides={...r.alertOverrides,[e]:{level:2,target:null}},t})},renderListItem:(e,l)=>!l.remove&&(0,r.jsx)(F,{alertOverrideTargetOptions:n,alertOverrideValueId:e,formikUtils:t,mailRecipientUuid:i})})},I=t(81208),V=t(91029),D=t(82547);let E=[{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(_.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Critical"}),(0,r.jsx)(_.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that could lead to imminent service interruption or unexpected loss of redundancy."})]}),value:1},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(_.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Warning"}),(0,r.jsx)(_.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that require attention from administrators, such as redundancy loss due to load shedding, hardware in pre-failure, input power loss, temperature anomalies, etc."})]}),value:2},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(_.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Notice"}),(0,r.jsx)(_.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that are generally safe to ignore, but might provide early warnings of developing issues or insight into system behaviour."})]}),value:3},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(_.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Info"}),(0,r.jsx)(_.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that are almost always safe to ignore, but may be useful in testing and debugging."})]}),value:4}],q={1:"Critical",2:"Warning",3:"Notice",4:"Info"},R=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/alert-override",{uuid:r}=e;return r?Object.values(e.alertOverrides).reduce((e,n)=>{let{remove:i,level:l,target:a,uuids:o}=n;if(o&&e.push(...Object.keys(o).map(e=>({method:"delete",url:"".concat(t,"/").concat(e)}))),a&&!i){var s;let n=null!==(s=a.subnodes)&&void 0!==s?s:[a.uuid];e.push(...n.map(e=>({body:{hostUuid:e,level:l,mailRecipientUuid:r},method:"post",url:t})))}return e},[]):[]};var L=e=>{let{alertOverrideTargetOptions:n,mailRecipientUuid:t,previousFormikValues:l,tools:a}=e,o=(0,u.useMemo)(()=>null!=t?t:(0,d.Z)(),[t]),h=(0,D.Z)({initialValues:null!=l?l:{[o]:{alertOverrides:{},email:"",language:"en_CA",level:2,name:""}},onSubmit:(e,n)=>{let{setSubmitting:t}=n,{[o]:i}=e,s="Add",u=(0,r.jsx)(r.Fragment,{children:"Failed to add mail recipient."}),d="post",c=(0,r.jsx)(r.Fragment,{children:"Mail recipient added."}),h="Add mail recipient with the following?",f="/mail-recipient";l&&(s="Update",u=(0,r.jsx)(r.Fragment,{children:"Failed to update mail server."}),d="put",c=(0,r.jsx)(r.Fragment,{children:"Mail recipient updated."}),h="Update ".concat(i.name," with the following?"),f+="/".concat(o));let{alertOverrides:g,uuid:x,...j}=i;a.confirm.prepare({actionProceedText:s,content:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{entries:j}),(0,r.jsx)(p.Z,{entries:{alertOverrides:Object.entries(g).reduce((e,n)=>{let[t,r]=n;return r.remove||!r.target||(e[t]={level:r.level,name:r.target.name}),e},{})}})]}),onCancelAppend:()=>t(!1),onProceedAppend:async()=>{a.confirm.loading(!0);let e=e=>{let n=(0,v.Z)(e);n.children=(0,r.jsxs)(r.Fragment,{children:[u," ",n.children]}),a.confirm.finish("Error",n),t(!1)};m.Z[d](f,j).then(n=>{let{data:t}=n,r={...i};t&&(r.uuid=t.uuid),Promise.all(R(r,l&&l[o]).map(e=>m.Z[e.method](e.url,e.body))).then(()=>{a.confirm.finish("Success",{children:c}),a["post"===d?"add":"edit"].open(!1)}).catch(e)}).catch(e)},titleText:h}),a.confirm.open(!0)},validationSchema:w}),{disabledSubmit:f,formik:g,formikErrors:x,handleChange:j}=h,Z=(0,u.useMemo)(()=>"".concat(o,".email"),[o]),b=(0,u.useMemo)(()=>"".concat(o,".level"),[o]),y=(0,u.useMemo)(()=>"".concat(o,".name"),[o]);return(0,r.jsxs)(i.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),g.submitForm()},spacing:"1em",children:[(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{id:y,label:"Recipient name",name:y,onChange:j,required:!0,value:g.values[o].name})})}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{id:Z,label:"Recipient email",name:Z,onChange:j,required:!0,value:g.values[o].email})})}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(O.Z,{id:b,label:"Alert level",name:b,onChange:g.handleChange,required:!0,selectItems:E,selectProps:{MenuProps:{sx:{["& .".concat(s.Z.paper)]:{maxWidth:{md:"60%",lg:"40%"}}}},renderValue:e=>q[e]},value:g.values[o].level})})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(S,{alertOverrideTargetOptions:n,formikUtils:h,mailRecipientUuid:o})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(I.Z,{count:1,messages:x})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(c.Z,{actions:[{background:"blue",children:l?"Update":"Add",disabled:f,type:"submit"}]})})]})},U=t(59752),N=t(78533),T=e=>(0,r.jsx)(L,{...e}),H=t(68805),W=t(77510),z=()=>{let[e,n]=(0,u.useState)(),{altData:t,loading:i}=(0,W.Z)("/anvil",{mod:U.Z}),l=(0,u.useMemo)(()=>t&&Object.values(t).sort((e,n)=>e.name.localeCompare(n.name)).reduce((e,n)=>{let t={description:n.description,name:n.name,node:n.uuid,subnodes:[],type:"node",uuid:n.uuid},r=Object.values(n.hosts).sort((e,n)=>e.name.localeCompare(n.name)).reduce((e,r)=>{var i;return"dr"===r.type||(e.push({name:r.name,node:n.uuid,type:"subnode",uuid:r.uuid}),null===(i=t.subnodes)||void 0===i||i.push(r.uuid)),e},[]);return e.push(t,...r),e},[]),[t]),{fetch:a,loading:o}=(0,H.Z)({onData:e=>n(e),url:"/alert-override"}),s=(0,u.useMemo)(()=>{if(t&&e)return Object.entries(Object.values(e).reduce((e,n)=>{let{node:{uuid:t}}=n;return e[t]?e[t].push(n):e[t]=[n],e},{})).reduce((e,n)=>{let[r,i]=n,[l,...a]=i;if(i.length>1&&a.every(e=>{let{level:n}=e;return n===l.level})){let{0:{level:n}}=i,{[r]:l}=t;e[r]={level:n,target:{description:l.description,name:l.name,node:l.uuid,subnodes:i.map(e=>{let{subnode:{uuid:n}}=e;return n}),type:"node",uuid:l.uuid},uuids:i.reduce((e,n)=>{let{subnode:t,uuid:r}=n;return e[r]=t.uuid,e},{})}}else i.forEach(n=>{let{level:t,node:r,subnode:i,uuid:l}=n;e[i.uuid]={level:t,target:{name:i.name,node:r.uuid,type:"subnode",uuid:i.uuid},uuids:{[l]:i.uuid}}});return e},{})},[e,t]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(N.Z,{addHeader:"Add mail recipient",editHeader:e=>"Update ".concat(null==e?void 0:e.name),entriesUrl:"/mail-recipient",getAddLoading:e=>e||i,getDeleteErrorMessage:e=>{let{children:n,...t}=e;return{...t,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete mail recipient(s). ",n]})}},getDeleteHeader:e=>"Delete the following ".concat(e," mail recipient(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted mail recipient(s)."})}),getEditLoading:e=>e||o,listEmpty:"No mail recipient(s) found.",onItemClick:function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];let[,i]=t;e(...t),a(void 0,{params:{"mail-recipient":i}})},renderAddForm:e=>l&&(0,r.jsx)(L,{alertOverrideTargetOptions:l,tools:e}),renderDeleteItem:(e,n)=>{let{key:t}=n,i=null==e?void 0:e[t];return(0,r.jsx)(_.Ac,{children:null==i?void 0:i.name})},renderEditForm:(e,n)=>l&&n&&s&&(0,r.jsx)(T,{alertOverrideTargetOptions:l,mailRecipientUuid:n.uuid,previousFormikValues:{[n.uuid]:{alertOverrides:s,...n}},tools:e}),renderListItem:(e,n)=>{let{name:t}=n;return(0,r.jsx)(_.Ac,{children:t})}})})};let K=f.Ry({address:f.Z_().required(),authentication:f.Z_().oneOf(["none","plain-text","encrypted"]),confirmPassword:f.Z_().when("password",(e,n)=>String(e).length>0?n.required().oneOf([f.iH("password")]):n.optional()),heloDomain:f.Z_().required(),password:f.Z_().optional(),port:f.Rx().required(),security:f.Z_().oneOf(["none","starttls","tls-ssl"]),username:f.Z_().optional(),uuid:(0,x.u)().required()}),B=f.Vo(e=>f.Ry((0,g.Z)(e,K)));var G=e=>{let{localhostDomain:n="",mailServerUuid:t,previousFormikValues:l,tools:a}=e,o=(0,u.useMemo)(()=>null!=t?t:(0,d.Z)(),[t]),{disabledSubmit:s,formik:h,formikErrors:f,handleChange:g}=(0,D.Z)({initialValues:null!=l?l:{[o]:{address:"",authentication:"none",heloDomain:n,port:587,security:"none",uuid:o}},onSubmit:(e,n)=>{let{setSubmitting:t}=n,{[o]:i}=e,s="Add",u=(0,r.jsx)(r.Fragment,{children:"Failed to add mail server."}),d="post",c=(0,r.jsx)(r.Fragment,{children:"Mail server added."}),h="Add mail server with the following?",f="/mail-server";l&&(s="Update",u=(0,r.jsx)(r.Fragment,{children:"Failed to update mail server."}),d="put",c=(0,r.jsx)(r.Fragment,{children:"Mail server updated."}),h="Update ".concat(i.address,":").concat(i.port," with the following?"),f+="/".concat(o));let{confirmPassword:g,uuid:x,...j}=i;a.confirm.prepare({actionProceedText:s,content:(0,r.jsx)(p.Z,{entries:j}),onCancelAppend:()=>t(!1),onProceedAppend:()=>{a.confirm.loading(!0),m.Z[d](f,i).then(()=>{a.confirm.finish("Success",{children:c}),a["post"===d?"add":"edit"].open(!1)}).catch(e=>{let n=(0,v.Z)(e);n.children=(0,r.jsxs)(r.Fragment,{children:[u," ",n.children]}),a.confirm.finish("Error",n),t(!1)})},titleText:h}),a.confirm.open(!0)},validationSchema:B}),x=(0,u.useMemo)(()=>"".concat(o,".address"),[o]),j=(0,u.useMemo)(()=>"".concat(o,".authentication"),[o]),Z=(0,u.useMemo)(()=>"".concat(o,".confirmPassword"),[o]),b=(0,u.useMemo)(()=>"".concat(o,".heloDomain"),[o]),y=(0,u.useMemo)(()=>"".concat(o,".password"),[o]),w=(0,u.useMemo)(()=>"".concat(o,".port"),[o]),A=(0,u.useMemo)(()=>"".concat(o,".security"),[o]),C=(0,u.useMemo)(()=>"".concat(o,".username"),[o]);return(0,r.jsxs)(i.ZP,{component:"form",onSubmit:e=>{e.preventDefault(),h.submitForm()},container:!0,columns:{xs:1,sm:2},spacing:"1em",children:[(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{id:x,label:"Server address",name:x,onChange:g,required:!0,value:h.values[o].address})})}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{id:w,label:"Server port",name:w,onChange:g,required:!0,type:"number",value:h.values[o].port})})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(O.Z,{id:A,label:"Server security type",name:A,onChange:g,required:!0,selectItems:["none","starttls","tls-ssl"],value:h.values[o].security})})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(O.Z,{id:j,label:"Server authentication method",name:j,onChange:g,required:!0,selectItems:["none","plain-text","encrypted"],value:h.values[o].authentication})})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{id:b,label:"HELO domain",name:b,onChange:g,required:!0,value:h.values[o].heloDomain})})}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:C,label:"Server username",name:C,onChange:g,value:h.values[o].username})})}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:y,label:"Server password",name:y,onChange:g,type:"password",value:h.values[o].password})})}),(0,r.jsx)(i.ZP,{display:{xs:"none",sm:"initial"},item:!0,sm:1}),(0,r.jsx)(i.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:Z,label:"Confirm password",name:Z,onChange:g,type:"password",value:h.values[o].confirmPassword})})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(I.Z,{count:1,messages:f})}),(0,r.jsx)(i.ZP,{item:!0,width:"100%",children:(0,r.jsx)(c.Z,{actions:[{background:"blue",children:l?"Update":"Add",disabled:s,type:"submit"}]})})]})},J=e=>(0,r.jsx)(G,{...e}),X=()=>{let{data:e,loading:n}=(0,W.Z)("/host/local");return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(N.Z,{addHeader:"Add mail server",editHeader:e=>"Update ".concat(null==e?void 0:e.address,":").concat(null==e?void 0:e.port),entriesUrl:"/mail-server",getAddLoading:e=>e||n,getDeleteErrorMessage:e=>{let{children:n,...t}=e;return{...t,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete mail server(s). ",n]})}},getDeleteHeader:e=>"Delete the following ".concat(e," mail server(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted mail server(s)."})}),listEmpty:"No mail server(s) found",renderAddForm:n=>e&&(0,r.jsx)(G,{localhostDomain:e.domain,tools:n}),renderDeleteItem:(e,n)=>{let{key:t}=n,i=null==e?void 0:e[t];return(0,r.jsxs)(_.Ac,{children:[null==i?void 0:i.address,":",null==i?void 0:i.port]})},renderEditForm:(e,n)=>n&&(0,r.jsx)(J,{mailServerUuid:n.uuid,previousFormikValues:{[n.uuid]:n},tools:e}),renderListItem:(e,n)=>{let{address:t,port:i}=n;return(0,r.jsxs)(_.Ac,{children:[t,":",i]})}})})},Q=t(23930),Y=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{children:(0,r.jsx)("title",{children:"Mail Config"})}),(0,r.jsx)(o.Z,{}),(0,r.jsxs)(i.ZP,{container:!0,columns:{xs:1,md:6,lg:4},children:[(0,r.jsx)(i.ZP,{item:!0,xs:1}),(0,r.jsx)(i.ZP,{item:!0,xs:1,md:4,lg:2,children:(0,r.jsxs)(Q.s_,{children:[(0,r.jsx)(Q.V9,{children:(0,r.jsx)(_.z,{children:"Mail config"})}),(0,r.jsx)(Q.TZ,{expandInitially:!0,header:"Manage mail servers",children:(0,r.jsx)(X,{})}),(0,r.jsx)(Q.TZ,{expandInitially:!0,header:"Manage mail recipients",children:(0,r.jsx)(z,{})})]})})]})]})}},function(e){e.O(0,[162,442,318,206,74,461,602,26,321,810,888,774,179],function(){return e(e.s=24084)}),_N_E=e.O()}]);