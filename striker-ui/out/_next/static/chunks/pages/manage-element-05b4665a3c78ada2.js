(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[808],{29582:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-element",function(){return n(2840)}])},78533:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(98484),o=n(34003),i=n(97607),a=n(83916),c=n(68805),d=n(85291),u=n(2188),h=n(77510);let m=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"==typeof e?e(...n):e};t.Z=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[p]=t,{addHeader:x,editHeader:f,entriesUrl:j,formDialogProps:g,getAddLoading:v,getDeleteErrorMessage:Z,getDeleteHeader:w,getDeletePromiseChain:b=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},getDeleteSuccessMessage:k,getEditLoading:y=e=>e,listEmpty:P,listProps:M,onItemClick:C=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},refreshInterval:S=5e3,renderAddForm:I,renderDeleteItem:A,renderEditForm:T,renderListItem:F,entryUrlPrefix:U=j}=p,O=(0,s.useRef)(null),N=(0,s.useRef)(null),{confirmDialog:R,finishConfirm:q,setConfirmDialogLoading:E,setConfirmDialogOpen:_,setConfirmDialogProps:D}=(0,u.Z)({initial:{scrollContent:!0}}),[B,H]=(0,s.useState)(!1),[L,V]=(0,s.useState)(),{data:$,mutate:z,loading:W}=(0,h.Z)(j,{refreshInterval:S}),{fetch:G,loading:J}=(0,c.Z)({onData:e=>V(e),url:U}),Q=(0,s.useMemo)(()=>m(x),[x]),K=(0,s.useMemo)(()=>m(f,L),[L,f]),X=(0,s.useMemo)(()=>({add:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==O?void 0:null===(e=O.current)||void 0===e?void 0:e.setOpen(t)}},confirm:{finish:q,loading:E,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return _(e)},prepare:D},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==N?void 0:null===(e=N.current)||void 0===e?void 0:e.setOpen(t)}}}),[q,E,_,D]),{buildDeleteDialogProps:Y,checks:ee,getCheck:et,hasAllChecks:en,hasChecks:er,multipleItems:es,resetChecks:el,setAllChecks:eo,setCheck:ei}=(0,d.Z)({list:$});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{allowCheckAll:es,allowEdit:!0,allowItemButton:B,disableDelete:!er,edit:B,getListCheckboxProps:()=>({checked:en,onChange:(e,t)=>eo(t)}),getListItemCheckboxProps:e=>({checked:et(e),onChange:(t,n)=>ei(e,n)}),header:!0,listEmpty:P,listItems:$,loading:W,onAdd:()=>{var e;return null==O?void 0:null===(e=O.current)||void 0===e?void 0:e.setOpen(!0)},onDelete:()=>{D(Y({onProceedAppend:()=>{E(!0),Promise.all(b((e,t)=>e.map(e=>l.Z.delete("".concat(t,"/").concat(e))),ee,j)).then(()=>{q("Success",k()),z()}).catch(e=>{q("Error",Z((0,i.Z)(e)))}).finally(()=>{el()})},getConfirmDialogTitle:w,renderEntry:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return A($,...t)}})),_(!0)},onEdit:()=>H(e=>!e),onItemClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return C((e,t)=>{var n;null==N||null===(n=N.current)||void 0===n||n.setOpen(!0),G("/".concat(t))},...t)},renderListItem:F,...M}),(0,r.jsx)(o.Js,{header:Q,loading:null==v?void 0:v.call(null),ref:O,showClose:!0,...null==g?void 0:g.common,...null==g?void 0:g.add,children:I(X)}),(0,r.jsx)(o.Js,{header:K,loading:y(J),ref:N,showClose:!0,...null==g?void 0:g.common,...null==g?void 0:g.edit,children:T(X,L)}),R]})}},11399:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(77583);let o=(0,s.forwardRef)((e,t)=>{let{children:n,contentContainerProps:o,dialogProps:i,onSubmitAppend:a,proceedButtonProps:c,scrollBoxProps:d,scrollContent:u,...h}=e,m=(0,s.useMemo)(()=>({...o,component:"form",onSubmit:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[r]=t;r.preventDefault(),null==a||a.call(null,...t)}}),[o,a]),p=(0,s.useMemo)(()=>({...d,sx:u?{overflowX:"hidden",paddingTop:".6em",...null==d?void 0:d.sx}:null==d?void 0:d.sx}),[d,u]);return(0,r.jsx)(l.Z,{dialogProps:i,contentContainerProps:m,proceedButtonProps:{...c,type:"submit"},scrollContent:u,scrollBoxProps:p,wide:!0,...h,ref:t,children:n})});o.displayName="FormDialog",t.Z=o},44089:function(e,t,n){"use strict";var r=n(85893),s=n(14440),l=n(54965),o=n(37969),i=n(38189),a=n(66173),c=n(56903),d=n(59278);let u=e=>{let{entry:t}=e;return(0,r.jsx)(d.$_,{whiteSpace:"nowrap",children:String(t)})},h=e=>{let{entry:t,key:n}=e;return i.JW.test(n)?(0,r.jsx)(d.PJ,{wrapper:"mono",children:String(t)}):u(e)},m=e=>{let{entry:t,hasPassword:n}=e;return["",null,void 0].some(e=>t===e)||Number.isNaN(t)?(0,r.jsx)(d.Ac,{children:"none"}):n?h(e):u(e)},p=e=>{let{depth:t,entry:n,getLabel:l,hasPassword:o,key:i,nest:u,renderValue:h}=e;return(0,r.jsxs)(c.Z,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,r.jsx)(d.Ac,{children:l({cap:a.Z,depth:t,entry:n,hasPassword:o,key:i})}),(0,r.jsx)(s.Z,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!u&&h(m,{depth:t,entry:n,hasPassword:o,key:i})})]})},x=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},f=e=>{let{depth:t=0,entries:n,getEntryLabel:s,getListProps:i,getListItemProps:a,hasPassword:c,listKey:d,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:p}=e,j=[];Object.entries(n).forEach(e=>{let[n,o]=e,i=null!==o&&"object"==typeof o,d=i?null:o,g={depth:t,entry:d,hasPassword:c,key:n};p(x,g)||j.push((0,r.jsx)(l.ZP,{sx:{paddingLeft:"".concat(t,"em")},...null==a?void 0:a.call(null,g),children:h({depth:t,entry:d,getLabel:s,hasPassword:c,key:n,nest:i,renderValue:m})},"form-summary-entry-".concat(n))),i&&t<u&&j.push(f({depth:t+1,entries:o,getEntryLabel:s,hasPassword:c,listKey:n,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:p}))});let g="form-summary-list-".concat(null!=d?d:"root");return(0,r.jsx)(o.Z,{dense:!0,disablePadding:!0,...null==i?void 0:i.call(null,{depth:t,entries:n,key:d}),children:j},g)};t.Z=e=>{let{entries:t,getEntryLabel:n=e=>{let{cap:t,key:n}=e;return t(n)},getListProps:r,getListItemProps:s,hasPassword:l=!1,maxDepth:o=3,renderEntry:i=p,renderEntryValue:a=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},skip:c=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)}}=e;return f({entries:t,getEntryLabel:n,getListProps:r,getListItemProps:s,hasPassword:l,maxDepth:o,renderEntry:i,renderEntryValue:a,skip:c})}},68805:function(e,t,n){"use strict";var r=n(67294),s=n(98484),l=n(97607);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{config:t,onError:n,onData:o,url:i=""}=e,[a,c]=(0,r.useState)(!1);return{fetch:(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,a="".concat(i).concat(e);a&&(c(!0),s.Z.get(a,{...t,...r}).then(e=>{let{data:t}=e;null==o||o.call(null,t)}).catch(e=>{let t=(0,l.Z)(e);null==n||n.call(null,t)}).finally(()=>{c(!1)}))},[i,t,o,n]),loading:a}}},85291:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(8534),o=n(44089);t.Z=e=>{let{list:t={}}=e,[n,i]=(0,s.useState)({}),a=(0,s.useMemo)(()=>Object.keys(t),[t]),c=(0,s.useMemo)(()=>Object.keys(n),[n]),d=(0,s.useMemo)(()=>c.length===a.length,[c.length,a.length]),u=(0,s.useMemo)(()=>c.length>0,[c.length]),h=(0,s.useMemo)(()=>a.length>1,[a.length]),m=(0,s.useCallback)(e=>{let{confirmDialogProps:t={},formSummaryProps:s={},getConfirmDialogTitle:l,onProceedAppend:i,renderEntry:a}=e;return{actionProceedText:"Delete",content:(0,r.jsx)(o.Z,{entries:n,maxDepth:0,renderEntry:a,...s}),onProceedAppend:i,proceedColour:"red",titleText:l(c.length),...t}},[n,c.length]),p=(0,s.useCallback)(e=>!!n[e],[n]);return{buildDeleteDialogProps:m,checklist:n,checks:c,getCheck:p,hasAllChecks:d,hasChecks:u,multipleItems:h,resetChecks:(0,s.useCallback)(()=>i({}),[]),setAllChecks:(0,s.useCallback)(e=>i(a.reduce((t,n)=>(e&&(t[n]=e),t),{})),[a]),setCheck:(0,s.useCallback)((e,t)=>i((0,l.ZP)(e,t||void 0)),[])}}},62848:function(e,t,n){"use strict";var r=n(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:n="",...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useState)({actionProceedText:e,content:t,titleText:n,...s})}},2840:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return nx}});var r=n(85893),s=n(9008),l=n.n(s),o=n(11163),i=n(67294),a=function(e){let{fallbackValue:t="",joinSeparator:n="",limit:r=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Array?e.slice(0,r).join(n):null!=e?e:t},c=n(82777),d=n(74717),u=n(92230),h=n(38189),m=n(14440),p=n(96674),x=n(89262),f=n(51050),j=n(37842),g=n(56903),v=n(28293),Z=n(91029),w=n(23930),b=n(6189),k=n(41553),y=n(11901),P=n(77831),M=n(59278);let C=(0,x.ZP)(k.Z)({height:"3.5em",marginLeft:0,width:"100%"});var S=e=>{let{baseInputProps:t,checked:n,formControlLabelProps:s,id:l,label:o,name:a,onChange:c,switchProps:d}=e,u=(0,i.useMemo)(()=>"string"==typeof o?(0,r.jsx)(M.Ac,{inheritColour:!0,color:"".concat(P.s7,"AF"),children:o}):(0,r.jsx)(r.Fragment,{children:o}),[o]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C,{componentsProps:{typography:{flexGrow:1}},control:(0,r.jsx)(y.Z,{checked:n,edge:"end",name:a,onChange:c,...d}),label:u,labelPlacement:"start",...s}),(0,r.jsx)("input",{checked:n,hidden:!0,id:l,readOnly:!0,...t})]})},I=n(52675);let A=["1","on"],T=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,setMessage:n},id:r,label:s}=e,l=t(r),o=()=>{n(r)};return"ip"===s.toLowerCase()?(0,I._)(s,o,{onFinishBatch:l},e=>{n(r,{children:e})}):{defaults:{onSuccess:o},onFinishBatch:l,tests:[{test:I.HJ}]}},F=e=>{let{formUtils:t,id:n,isRequired:s,label:l="",name:o=n,value:i}=e,{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:c,setMessage:d}=t;return(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:n,label:l,name:o,value:i}),inputTestBatch:(0,I.qY)(l,()=>{d(n)},{onFinishBatch:a(n)},e=>{d(n,{children:e})}),onFirstRender:c(n),required:s,valueType:"number"},"".concat(n,"-wrapper"))},U={boolean:e=>{let{id:t,isChecked:n=!1,label:s,name:l=t}=e;return(0,r.jsx)(v.Z,{input:(0,r.jsx)(S,{checked:n,id:t,label:s,name:l}),valueType:"boolean"},"".concat(t,"-wrapper"))},integer:F,second:F,select:e=>{let{formUtils:t,id:n,isRequired:s,label:l,name:o=n,selectOptions:i=[],value:a=""}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:d,setMessage:u}=t;return(0,r.jsx)(v.Z,{input:(0,r.jsx)(b.Z,{id:n,label:l,name:o,selectItems:i,value:a}),inputTestBatch:{defaults:{onSuccess:()=>{u(n)}},onFinishBatch:c(n),tests:[{test:I.HJ}]},onFirstRender:d(n),required:s},"".concat(n,"-wrapper"))},string:e=>{let t;let{formUtils:n,id:s,isRequired:l,isSensitive:o=!1,label:i="",name:a=s,value:c}=e,{buildInputFirstRenderFunction:d}=n;return o&&(t=j.Z.password),(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:s,label:i,name:a,type:t,value:c}),inputTestBatch:T({formUtils:n,id:s,label:i}),onFirstRender:d(s),required:l},"".concat(s,"-wrapper"))}},O=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("-")},N=(0,x.ZP)(g.Z)({margin:".4em 0"});var R=e=>{let{fenceId:t,fenceParameterTooltipProps:n,fenceTemplate:s,formUtils:l,previousFenceName:o,previousFenceParameters:a}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:d,setMessage:u}=l,p=(0,i.useMemo)(()=>{let e;if(s&&t){let{parameters:i}=s[t],p={};a&&(p=Object.entries(a).reduce((e,n)=>{let[r,s]=n;return e[O(t,r)]=s,e},{}));let{optional:x,required:j}=Object.entries(i).sort((e,t)=>{let[n]=e,[r]=t;return n>r?1:-1}).reduce((e,s)=>{var o,i;let[a,{content_type:c,default:d,deprecated:u,description:x,options:j,replacement:g,required:v}]=s;if([1===Number(u),g].some(e=>e))return e;let{optional:Z,required:w}=e,b=null!==(o=U[c])&&void 0!==o?o:U.string,k=O(t,a),y=null!==(i=p[k])&&void 0!==i?i:d,P=!/plug|port/i.test(a)&&1===Number(v),C=h.JW.test(a),S=b({formUtils:l,id:k,isChecked:A.includes(y),isRequired:P,isSensitive:C,label:a,selectOptions:j,value:y}),I=(0,r.jsx)(f.Z,{componentsProps:{tooltip:{sx:{maxWidth:{md:"62.6em"}}}},disableInteractive:!0,placement:"top-start",title:(0,r.jsx)(M.Ac,{children:x}),...n,children:(0,r.jsx)(m.Z,{children:S})},"".concat(k,"-tooltip"));return P?w.push(I):Z.push(I),e},{optional:[],required:[]}),b=O(t,"name"),k="Fence device name";e=(0,r.jsxs)(g.Z,{sx:{"& > div:first-child":{marginTop:0},"& > div":{marginBottom:0}},children:[(0,r.jsx)(w.TZ,{expandInitially:!0,header:"Required parameters",children:(0,r.jsxs)(N,{children:[(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:b,label:k,name:b,value:o}),inputTestBatch:(0,I.Gn)(k,()=>{u(b)},{onFinishBatch:c(b)},e=>{u(b,{children:e})}),onFirstRender:d(b),required:!0},"".concat(b,"-wrapper")),j]})}),(0,r.jsx)(w.TZ,{header:"Optional parameters",children:(0,r.jsx)(N,{children:x})})]})}return e},[c,d,t,n,s,l,o,a,u]);return(0,r.jsx)(r.Fragment,{children:p})},q=n(53541),E=n(6631);let _="add-fence-input-agent";var D=e=>{let{fenceTemplate:t,formUtils:n,loading:s}=e,{setValidity:l}=n,o=(0,E.Z)(),[a,c]=(0,i.useState)(null),d=(0,i.useMemo)(()=>t?Object.entries(t).sort((e,t)=>{let[n]=e,[r]=t;return n>r?1:-1}).map(e=>{let[t,{description:n}]=e;return{fenceDescription:"string"==typeof n?n:"No description.",fenceId:t,label:t}}):[],[t]),u=(0,i.useMemo)(()=>(0,r.jsx)(p.Z,{id:_,isOptionEqualToValue:(e,t)=>e.fenceId===t.fenceId,label:"Fence device type",onChange:(e,t)=>{l(_,null!==t),c(t)},openOnFocus:!0,options:d,renderOption:(e,t,n)=>{let{fenceDescription:s,fenceId:l}=t,{selected:o}=n;return(0,r.jsxs)(m.Z,{component:"li",sx:{display:"flex",flexDirection:"column","& > *":{width:"100%"}},...e,children:[(0,r.jsx)(M.Ac,{inverted:!0,sx:{fontSize:"1.2em",fontWeight:o?400:void 0},children:l}),(0,r.jsx)(M.Ac,{selected:!1,children:s})]})},sx:{marginTop:".3em"},value:a}),[d,a,l]),h=(0,i.useMemo)(()=>(0,r.jsx)(R,{fenceId:null==a?void 0:a.fenceId,fenceTemplate:t,formUtils:n}),[t,null==a?void 0:a.fenceId,n]),x=(0,i.useMemo)(()=>s?(0,r.jsx)(q.Z,{}):(0,r.jsxs)(g.Z,{children:[u,h]}),[u,h,s]);return(0,i.useEffect)(()=>{o&&l(_,null!==a)},[a,o,l]),(0,r.jsx)(r.Fragment,{children:x})},B=n(98484),H=n(77583),L=e=>{let{fenceId:t,fenceTemplate:n,formUtils:s,loading:l,previousFenceName:o,previousFenceParameters:a}=e,c=(0,i.useMemo)(()=>l?(0,r.jsx)(q.Z,{}):(0,r.jsx)(R,{fenceId:t,fenceTemplate:n,formUtils:s,previousFenceName:o,previousFenceParameters:a}),[n,t,s,l,o,a]);return(0,r.jsx)(r.Fragment,{children:c})},V=n(11399),$=n(44089),z=n(97607),W=n(83916),G=n(81208),J=n(48430),Q=n(85291),K=n(62848),X=n(56907);let Y=e=>{let{id:t}=e,n=new RegExp("^(fence[^-]+)".concat("-","([^\\s]+)$")),r=t.match(n);if(!r)throw Error("Not target input element");return r},ee=(e,t,n)=>{if("name"===e)throw t.name=n,Error("Not child parameter")},et=e=>{if(!e)throw Error("Not parameter specification")},en=(e,t)=>{if([t,"",null,void 0].some(t=>e===t))throw Error("Skippable parameter value")},er=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[{target:s}]=n,{elements:l}=s;return Object.values(l).reduce((t,n)=>{try{let[,r,s]=Y(n);t.agent=r;let{checked:l,value:o}=n;ee(s,t,o);let{[r]:{parameters:{[s]:i}}}=e;et(i);let{content_type:a,default:c}=i,d=o;"boolean"===a&&(d=l?"1":""),en(d,c),t.parameters[s]=d}catch(e){}return t},{agent:"",name:"",parameters:{}})};var es=()=>{let e=(0,E.Z)(),t=(0,i.useRef)({}),n=(0,i.useRef)({}),s=(0,i.useRef)({}),[l,o]=(0,K.Z)(),[a,c]=(0,K.Z)(),[d,m]=(0,i.useState)(),[p,x]=(0,i.useState)(),[f,j]=(0,i.useState)(!1),[v,Z]=(0,i.useState)(!0),{isLoading:b}=(0,J.Z)("".concat(u.Z,"/fence"),{onSuccess:e=>m(e),refreshInterval:6e4}),k=(0,i.useCallback)(()=>{B.Z.get("/fence").then(e=>{let{data:t}=e;m(t)})},[m]),y=(0,X.Z)([_],s),{isFormInvalid:P,isFormSubmitting:C,submitForm:S}=y,{buildDeleteDialogProps:I,checks:A,getCheck:T,hasChecks:F,resetChecks:U,setCheck:O}=(0,Q.Z)({list:d}),N=(0,i.useCallback)(e=>{let{cap:t,depth:n,key:r}=e;return 0===n?t(r):r},[]),R=(0,i.useMemo)(()=>(0,r.jsx)(W.Z,{allowEdit:!0,allowItemButton:f,disableDelete:!F,edit:f,header:!0,listEmpty:"No fence device(s) registered.",listItems:d,onAdd:()=>{var e;c({actionProceedText:"Add",content:(0,r.jsx)(D,{fenceTemplate:p,formUtils:y}),onSubmitAppend:e=>{var n;if(!p)return;let s=er(p,e),{agent:l,name:i}=s;o({actionProceedText:"Add",content:(0,r.jsx)($.Z,{entries:s,hasPassword:!0,getEntryLabel:N}),onProceedAppend:()=>{S({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add fence device. ",e]}),method:"post",onSuccess:()=>k(),successMsg:"Added fence device ".concat(i),url:"/fence"})},titleText:(0,r.jsxs)(M.z,{children:["Add a"," ",(0,r.jsx)(M.Q0,{fontSize:"inherit",children:l})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a fence device"}),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;o(I({getConfirmDialogTitle:e=>"Delete ".concat(e," fence device(s)?"),onProceedAppend:()=>{S({body:{uuids:A},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to delete fence device(s). ",e]}),method:"delete",onSuccess:()=>{k(),U()},url:"/fence"})},renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(M.Ac,{children:null==d?void 0:d[t].fenceName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{j(e=>!e)},onItemCheckboxChange:(e,t,n)=>{O(e,n)},onItemClick:e=>{var s;let{fenceAgent:l,fenceName:i,fenceParameters:a,fenceUUID:d}=e;c({actionProceedText:"Update",content:(0,r.jsx)(L,{fenceId:l,fenceTemplate:p,formUtils:y,previousFenceName:i,previousFenceParameters:a}),onSubmitAppend:e=>{var n;if(!p)return;let s=er(p,e);o({actionProceedText:"Update",content:(0,r.jsx)($.Z,{entries:s,hasPassword:!0,getEntryLabel:N}),onProceedAppend:()=>{S({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update fence device. ",e]}),method:"put",onSuccess:()=>k(),successMsg:"Updated fence device ".concat(i),url:"/fence/".concat(d)})},titleText:(0,r.jsxs)(M.z,{children:["Update"," ",(0,r.jsx)(M.Q0,{fontSize:"inherit",children:i})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,r.jsxs)(M.z,{children:["Update fence device"," ",(0,r.jsx)(M.Q0,{fontSize:"inherit",children:i})," ","parameters"]})}),null===(s=n.current.setOpen)||void 0===s||s.call(null,!0)},renderListItemCheckboxState:e=>T(e),renderListItem:(e,t)=>{let{fenceAgent:n,fenceName:s,fenceParameters:l}=t;return(0,r.jsxs)(g.Z,{row:!0,children:[(0,r.jsx)(M.Ac,{children:s}),(0,r.jsx)(M.Ac,{children:Object.entries(l).reduce((e,t)=>{let[n,s]=t,l=(0,r.jsxs)(r.Fragment,{children:[n,'="']});return l=h.JW.test(n)?(0,r.jsxs)(r.Fragment,{children:[l,(0,r.jsx)(M.PJ,{wrapper:"mono",children:s})]}):(0,r.jsxs)(r.Fragment,{children:[l,s]}),(0,r.jsxs)(r.Fragment,{children:[e," ",l,'"']})},n)})]})}}),[I,A,d,p,y,T,k,N,F,f,U,O,o,c,S]),Y=(0,i.useMemo)(()=>v||b?(0,r.jsx)(q.Z,{}):R,[b,v,R]),ee=(0,i.useMemo)(()=>(0,r.jsx)(G.Z,{count:1,defaultMessageType:"warning",ref:s}),[]);return e&&B.Z.get("/fence/template").then(e=>{let{data:t}=e;x(t)}).catch(e=>{(0,z.Z)(e)}).finally(()=>{Z(!1)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(M.z,{children:"Manage fence devices"})}),Y]}),(0,r.jsx)(V.Z,{dialogProps:{PaperProps:{sx:{minWidth:{xs:"90%",md:"50em"}}}},scrollBoxProps:{padding:".3em .5em"},...a,disableProceed:P,loadingAction:C,preActionArea:ee,ref:n,scrollContent:!0,showClose:!0}),(0,r.jsx)(H.Z,{closeOnProceed:!0,scrollBoxProps:{paddingRight:"1em"},...l,ref:t,scrollContent:!0})]})},el=n(42458),eo=n(29535);let ei={online:"ok",offline:"off"},ea={dr:"DR",node:"Subnode"};var ec=e=>{var t;let{data:n}=e,{hostName:s,hostStatus:l,hostType:o,shortHostName:i}=n;return(0,r.jsxs)(g.Z,{row:!0,spacing:".5em",children:[(0,r.jsx)(el.Z,{colour:null!==(t=ei[l])&&void 0!==t?t:"warning",sx:{alignSelf:"stretch",height:"auto"}}),(0,r.jsxs)(g.Z,{flexGrow:1,spacing:0,children:[(0,r.jsxs)(g.Z,{sm:"row",spacing:".5em",children:[(0,r.jsx)(M.Ac,{children:ea[o]}),(0,r.jsx)(M.$_,{whiteSpace:"nowrap",children:i}),(0,r.jsx)(eo.Z,{orientation:"vertical",sx:{alignSelf:"stretch",height:"auto"}}),(0,r.jsx)(M.$_,{sx:{display:{xs:"none",sm:"flex"}},whiteSpace:"nowrap",children:s})]}),(0,r.jsx)(M.Ac,{children:l})]})]})},ed=n(78533),eu=n(34003),eh=n(65895),em=n(99514),ep=n(4845),ex=n(98479),ef=n(66950),ej=n(51714),eg=n(17586),ev=n(60504),eZ=e=>{let{formControlProps:t,formControlLabelProps:n,formLabelProps:s,id:l,label:o,name:a,onChange:c,radioItems:d,radioProps:{sx:u,...h}={},radioGroupProps:m,value:p}=e,x=(0,i.useMemo)(()=>"string"==typeof o?(0,r.jsx)(M.Ac,{children:o}):o,[o]),f=(0,i.useMemo)(()=>Object.entries(d).map(e=>{let[t,{label:s,value:o}]=e,i="string"==typeof s?(0,r.jsx)(M.Ac,{children:s}):s;return(0,r.jsx)(k.Z,{control:(0,r.jsx)(ex.Z,{...h,sx:{["&.".concat(ef.Z.root)]:{color:P.s7},...u}}),value:o,label:i,...n},"".concat(l,"-").concat(t))}),[n,l,d,u,h]);return(0,r.jsxs)(ej.Z,{...t,children:[(0,r.jsx)(eg.Z,{...s,children:x}),(0,r.jsx)(ev.Z,{id:l,name:a,onChange:c,row:!0,value:p,...m,children:f})]})},ew=n(16310),eb=n(74077);let ek=ew.Ry().shape({enterpriseKey:(0,eb.u)().optional(),ip:(0,eb.T)().required(),name:ew.Z_().required(),redhatConfirmPassword:ew.Z_().when("redhatPassword",(e,t)=>String(e).length>0?t.required().oneOf([ew.iH("redhatPassword")]):t.optional()),redhatPassword:ew.Z_().when("redhatUsername",(e,t)=>String(e).length>0?t.required():t.optional()),redhatUsername:ew.Z_().when("redhatPassword",(e,t)=>String(e).length>0?t.required():t.optional()),type:ew.Z_().oneOf(["dr","subnode"]).required(),uuid:(0,eb.u)().required()},[["redhatUsername","redhatPassword"]]);var ey=n(12387),eP=n(82547);let eM={subnode:{label:"Subnode",value:"subnode"},dr:{label:"Disaster Recovery (DR) host",value:"dr"}};var eC=e=>{let{host:t,setResponse:n,tools:s}=e,{disabledSubmit:l,formik:o,formikErrors:a,handleChange:c}=(0,eP.Z)({initialValues:{ip:t.hostIpAddress,name:t.hostName,password:t.hostPassword,type:"",uuid:t.hostUUID},onSubmit:(e,t)=>{let{setSubmitting:l}=t,{enterpriseKey:o,ip:i,name:a,password:c,type:d,uuid:u,redhatPassword:h,redhatUsername:m}=e;s.confirm.prepare({actionProceedText:"Prepare",content:(0,r.jsx)($.Z,{entries:e,hasPassword:!0}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{s.confirm.loading(!0),B.Z.put("/host/prepare",{enterpriseUUID:o,hostIPAddress:i,hostName:a,hostPassword:c,hostType:"subnode"===d?"node":d,hostUUID:u,redhatPassword:h,redhatUser:m}).then(()=>{s.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Started job to prepare host at ",i,"."]})}),s.add.open(!1),setTimeout(n,500)}).catch(e=>{let t=(0,z.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to prepare host at ",i,". ",t.children]}),s.confirm.finish("Error",t),l(!1)})},titleText:"Prepare host at ".concat(e.ip," with the following?")}),s.confirm.open()},validationSchema:ek}),d=(0,i.useMemo)(()=>"enterpriseKey",[]),u=(0,i.useMemo)(()=>"name",[]),h=(0,i.useMemo)(()=>"redhatConfirmPassword",[]),m=(0,i.useMemo)(()=>"redhatPassword",[]),p=(0,i.useMemo)(()=>"redhatUsername",[]),x=(0,i.useMemo)(()=>"type",[]),f=(0,i.useMemo)(()=>t.isInetConnected&&/rhel/i.test(t.hostOS)&&!t.isOSRegistered,[t.hostOS,t.isInetConnected,t.isOSRegistered]);return(0,r.jsxs)(em.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),o.submitForm()},spacing:"1em",children:[(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(eZ,{id:x,label:"Host type",name:x,onChange:c,radioItems:eM,value:o.values.type})})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{id:u,label:"Host name",name:u,onChange:c,required:!0,value:o.values.name})})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{id:d,label:"Alteeve enterprise key",name:d,onChange:c,value:o.values.enterpriseKey})})}),f&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:p,label:"RedHat username",name:p,onChange:c,value:o.values.redhatUsername})})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:m,label:"RedHat password",name:m,onChange:c,type:"password",value:o.values.redhatPassword})})}),(0,r.jsx)(em.ZP,{display:{xs:"none",sm:"initial"},item:!0,sm:1}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:h,label:"Confirm RedHat password",name:h,onChange:c,type:"password",value:o.values.redhatConfirmPassword})})})]}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(G.Z,{count:1,messages:a})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ep.Z,{actions:[{background:"blue",children:"Prepare host",disabled:l,type:"submit"}]})})]})};let eS=ew.Ry({ip:(0,eb.T)().required(),password:ew.Z_().required()});var eI=e=>{let{setResponse:t,tools:n}=e,s=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[a,c]=(0,i.useState)([]),d=(0,i.useCallback)(e=>{var t,n;return null===(n=s.current)||void 0===n?void 0:null===(t=n.setMessage)||void 0===t?void 0:t.call(null,"api",e)},[]),{disabledSubmit:u,formik:h,formikErrors:m,handleChange:p}=(0,eP.Z)({initialValues:{ip:"",password:""},onSubmit:(e,s)=>{let{setSubmitting:l}=s;d(),o(!0),c([]),t(void 0);let{ip:i,password:a}=e;B.Z.put("/command/inquire-host",{ipAddress:i,password:a}).then(e=>{let{data:s}=e,{badSshKeys:l,isConnected:o}=s;if(l){d({children:(0,r.jsxs)(r.Fragment,{children:["Host identification at ",i," changed. If this is valid, please delete the conflicting SSH host key."]}),type:"warning"}),c([{background:"red",children:"Delete keys",onClick:()=>{n.confirm.prepare({actionProceedText:"Delete",content:(0,r.jsxs)(M.Ac,{children:["There's a different host key on ",i,", which could mean a MITM attack. But if this change is expected, you can delete the known host key(s) to resolve the conflict."]}),onProceedAppend:()=>{n.confirm.loading(!0),B.Z.delete("/ssh-key/conflict",{data:l}).then(()=>{n.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Started job to delete host key(s) for ",i,"."]})}),c([])}).catch(e=>{let t=(0,z.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to delete host key(s). ",t.children]}),n.confirm.finish("Error",t)})},proceedColour:"red",titleText:"Delete all known SSH host key(s) for ".concat(i,"?")}),n.confirm.open(!0)},type:"button"}]);return}if(!o){d({children:(0,r.jsx)(r.Fragment,{children:"Failed to connect. Please make sure the credentials are correct, and the host is reachable from this striker."}),type:"warning"});return}t({...s,hostIpAddress:i,hostPassword:a}),d()}).catch(e=>{let t=(0,z.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to access ",i,". ",t.children]}),d(t)}).finally(()=>{l(!1),o(!1)})},validationSchema:eS}),x=(0,i.useMemo)(()=>"ip",[]),f=(0,i.useMemo)(()=>"password",[]);return(0,r.jsxs)(em.ZP,{component:"form",container:!0,columns:{xs:1,sm:2},onSubmit:e=>{e.preventDefault(),h.submitForm()},spacing:"1em",children:[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:x,label:"IP address",name:x,onChange:p,required:!0,value:h.values.ip})})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:f,label:"Password",name:f,onChange:p,required:!0,type:"password",value:h.values.password})})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(G.Z,{count:1,messages:m,ref:s})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:l?(0,r.jsx)(q.Z,{mt:0}):(0,r.jsx)(ep.Z,{actions:[...a,{background:"blue",children:"Test access",disabled:u,type:"submit"}]})})]})},eA=()=>{let[e,t]=(0,i.useState)();return(0,r.jsx)(ed.Z,{formDialogProps:{common:{onClose:function(e){let{handlers:{base:n}}=e;for(var r=arguments.length,s=Array(r>1?r-1:0),l=1;l<r;l++)s[l-1]=arguments[l];null==n||n.call(null,...s),setTimeout(t,500)}}},addHeader:"Initialize host",editHeader:"",entriesUrl:"/host?types=dr,node",entryUrlPrefix:"/host",getDeleteErrorMessage:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return{...n,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete host(s). ",e]})}},getDeleteHeader:e=>"Delete the following ".concat(e," host(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted host(s)"})}),listEmpty:"No host(s) found.",listProps:{allowAddItem:!0,allowEdit:!1,allowItemButton:!0},renderAddForm:n=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eI,{setResponse:t,tools:n}),e&&(0,r.jsx)(eC,{host:e,setResponse:t,tools:n})]}),renderDeleteItem:(e,t)=>{let{key:n}=t,s=null==e?void 0:e[n];return(0,r.jsx)(M.Ac,{children:null==s?void 0:s.shortHostName})},renderEditForm:(e,t)=>t&&(0,r.jsx)(eu.VZ,{children:(0,r.jsx)($.Z,{entries:t,renderEntryValue:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];let{0:{entry:l,key:o}}=n;return"command"===o?(0,r.jsx)(eh.Z,{iconProps:{fontSize:"small"},mapPreset:"copy",onClick:()=>navigator.clipboard.writeText(String(l)),size:"small"}):e(...n)},hasPassword:!0})}),renderListItem:(e,t)=>(0,r.jsx)(ec,{data:t})})},eT=n(7111),eF=n(16826);let eU=(0,x.ZP)(eT.Z)({borderRadius:P.n_,color:P.s7,padding:".4em .8em",textTransform:"none",["&.".concat(eF.Z.selected)]:{color:P.Ej}});var eO=e=>{let{label:t,...n}=e,s=(0,i.useMemo)(()=>"string"==typeof t?(0,r.jsx)(M.Ac,{inheritColour:!0,children:t}):t,[t]);return(0,r.jsx)(eU,{label:s,...n})},eN=n(17038),eR=n(93124),eq=n(49360),eE=n(63885);let e_="1.8em",eD=(0,x.ZP)(eN.Z)({minHeight:"1em",["&.".concat(eR.Z.vertical)]:{minHeight:e_,["& .".concat(eF.Z.root)]:{alignItems:"flex-start",minHeight:e_,paddingLeft:"2em"},["& .".concat(eR.Z.indicator)]:{right:"initial"}},["& .".concat(eF.Z.root)]:{minHeight:"1em"},["& .".concat(eR.Z.indicator)]:{backgroundColor:P.Ej,borderRadius:P.n_}});var eB=e=>{let{orientation:t,variant:n="fullWidth",...s}=e,l=(0,eq.Z)(),o=(0,i.useCallback)(e=>l.breakpoints.up(e),[l]),a=(0,eE.Z)(o("xs")),c=(0,eE.Z)(o("sm")),d=(0,eE.Z)(o("md")),u=(0,eE.Z)(o("lg")),h=(0,eE.Z)(o("xl")),m=(0,i.useMemo)(()=>[["xs",a],["sm",c],["md",d],["lg",u],["xl",h]],[u,d,c,h,a]),p=(0,i.useMemo)(()=>{let e;return"object"==typeof t?m.some(n=>{let[r,s]=n;return s&&t[r]&&(e=t[r]),!s}):e=t,e},[m,t]);return(0,r.jsx)(eD,{orientation:p,variant:n,...s})},eH=e=>{let{list:t,setValue:n,value:s}=e;return 0===t.length?(0,r.jsx)(M.Ac,{children:"No host(s) found."}):(0,r.jsx)(eB,{centered:!0,onChange:(e,t)=>{n(t)},orientation:"vertical",value:s,children:t.map(e=>{let{hostConfigured:t,hostStatus:n,hostUUID:s,shortHostName:l}=e;return(0,r.jsx)(eO,{label:(0,r.jsxs)(em.ZP,{columns:{xs:2},container:!0,spacing:"1em",children:[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{noWrap:!0,children:l})}),(0,r.jsx)(em.ZP,{borderLeft:"thin solid ".concat(P.d),item:!0,xs:1,children:(0,r.jsxs)(M.Ac,{noWrap:!0,children:[n,t?", configured":""]})})]}),sx:{textAlign:"left"},value:s},"host-".concat(s))})})},eL=n(85923),eV=n(38993);let e$=ew.Ry({hostName:ew.Z_().required(),networkInit:eV.P});var ez=n(26339),eW=e=>{let{gatewayIface:t,ifaces:n,values:s}=e;return(0,r.jsxs)(em.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"Host name"})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:s.hostName})}),(0,r.jsx)(em.ZP,{item:!0,sx:{marginTop:"1.4em"},xs:2,children:(0,r.jsx)(M.Ac,{children:"Networks"})}),Object.entries(s.networkInit.networks).map(e=>{let[t,{interfaces:s,ip:l,sequence:o,subnetMask:i,type:a}]=e;return(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsxs)(em.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,r.jsx)(em.ZP,{item:!0,xs:2,children:(0,r.jsxs)(M.Ac,{children:[ez.Z[a]," ",o," (",(0,r.jsx)(M.Q0,{children:"".concat(a.toUpperCase()).concat(o)}),")"]})}),s.map((e,s)=>{let l="network-confirm-".concat(t,"-interface").concat(s),o="none";if(""!==e){var i;l="".concat(l,"-").concat(e),o=null===(i=n[e])||void 0===i?void 0:i.name}return(0,r.jsxs)(em.ZP,{columns:{xs:2},container:!0,item:!0,children:[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"Link ".concat(s+1)})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:o})})]},l)}),(0,r.jsx)(em.ZP,{item:!0,xs:2,children:(0,r.jsx)(M.$_,{children:"".concat(l,"/").concat(i)})})]})},"network-confirm-".concat(t))}),(0,r.jsx)(em.ZP,{item:!0,sx:{marginBottom:"1.4em"},xs:2}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"Gateway"})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:s.networkInit.gateway})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"Gateway network"})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:t.toUpperCase()})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"Domain name server(s)"})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:s.networkInit.dns})})]})},eG=n(60280);let eJ=e=>{let{dns:t="",gateway:n="",hostName:r="",networks:s}=e,l={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"}};return"node"===e.hostType&&(l.defaultifn={interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"},l.defaultsn={interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"sn"}),s&&(l=(0,eG.Z)(s)),{hostName:r,mini:!1,networkInit:{dns:t,gateway:n,networks:l}}};var eQ=e=>{let{detail:t,tools:n,uuid:s}=e,l=(0,i.useRef)(null),o=(0,eP.Z)({initialValues:eJ(t),onSubmit:(e,s)=>{let{setSubmitting:o}=s,i=(0,eL.Z)(e,l.current);n.confirm.prepare({actionProceedText:"Prepare network",content:l.current&&(0,r.jsx)(eW,{gatewayIface:i.gatewayInterface,ifaces:l.current,values:e}),onCancelAppend:()=>o(!1),onProceedAppend:()=>{n.confirm.loading(!0),B.Z.put("/host/".concat(t.hostUUID,"?handler=subnode-network"),i).then(()=>{n.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started network config on"," ",t.shortHostName]})})}).catch(e=>{let s=(0,z.Z)(e);s.children=(0,r.jsxs)(r.Fragment,{children:["Failed to prepare network on ",t.shortHostName,"."," ",s.children]}),n.confirm.finish("Error",s),o(!1)})},titleText:"Prepare network on ".concat(t.shortHostName," with the following?")}),n.confirm.open()},validationSchema:e$}),{disabledSubmit:a,formik:c,formikErrors:d,handleChange:u}=o,h=(0,i.useMemo)(()=>t.hostType.replace("node","subnode"),[t.hostType]),{parentSequence:m,sequence:p}=(0,i.useMemo)(()=>{let[e,n]=t.shortHostName.replace(/^.*a(\d+).*n(\d+)$/,"$1,$2").split(",",2);return{parentSequence:Number(e),sequence:Number(n)}},[t.shortHostName]),x=(0,i.useMemo)(()=>({hostName:"hostName",mini:"mini",networks:"networkInit.networks"}),[]);return(0,r.jsxs)(em.ZP,{columns:{xs:1,sm:2,md:3,lg:4},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),c.handleSubmit(e)},spacing:"1em",children:[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{id:x.hostName,label:"Host name",name:x.hostName,onChange:u,required:!0,value:c.values.hostName})})}),(0,r.jsx)(em.ZP,{display:{xs:"none",md:"initial"},flexGrow:1,item:!0}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(S,{id:x.mini,label:"Minimal config",name:x.mini,onChange:(e,t)=>{if(t){let{defaultbcn:e}=c.values.networkInit.networks;c.setFieldValue(x.networks,{defaultbcn:e},!0)}else c.resetForm();c.handleChange(e)},checked:c.values.mini})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eV.r,{formikUtils:o,host:{parentSequence:m,sequence:p,type:h,uuid:s},onFetchSuccess:e=>{l.current=e}})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(G.Z,{count:1,messages:d})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ep.Z,{actions:[{background:"blue",children:"Prepare network",disabled:a,type:"submit"}]})})]})},eK=n(2188),eX=n(77510),eY=e=>{let{uuid:t}=e,{confirmDialog:n,finishConfirm:s,setConfirmDialogLoading:l,setConfirmDialogOpen:o,setConfirmDialogProps:a}=(0,eK.Z)({initial:{scrollContent:!0,wide:!0}}),c=(0,i.useMemo)(()=>({add:{open:()=>null},confirm:{finish:s,loading:l,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return o(e)},prepare:a},edit:{open:()=>null}}),[s,l,o,a]),{data:d}=(0,eX.Z)("/host/".concat(t));return d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eQ,{detail:d,tools:c,uuid:t}),n]}):(0,r.jsx)(q.Z,{mt:0})},e0=e=>{let{changingTabId:t,children:n,retain:s=!1,tabId:l}=e,o=(0,i.useMemo)(()=>t===l,[t,l]),a=(0,i.useMemo)(()=>s?(0,r.jsx)(m.Z,{sx:{display:o?"initial":"none"},children:n}):o&&n,[n,o,s]);return(0,r.jsx)(r.Fragment,{children:a})},e1=()=>{let[e,t]=(0,i.useState)(!1),{data:n}=(0,eX.Z)("/host?types=dr,node"),s=(0,i.useMemo)(()=>n&&Object.values(n),[n]);return s?(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(eH,{list:s,setValue:t,value:e}),e&&(0,r.jsx)(eo.Z,{sx:{margin:"2em 0"}}),s.map(t=>(0,r.jsx)(e0,{changingTabId:e,tabId:t.hostUUID,children:(0,r.jsx)(eY,{uuid:t.hostUUID})},"cell-".concat(t.hostUUID)))]}):(0,r.jsx)(w.s_,{children:(0,r.jsx)(q.Z,{})})},e2=n(28951),e8=n(99576);let e5="an-host-input",e9="".concat(e5,"-cell"),e3="IPMI IP",e4={fence:(e,t)=>{let{dataset:{hostId:n="",fenceId:r="",fenceName:s=""},value:l}=t,{hostConfig:{hosts:{[n]:o}}}=e,{fences:i={}}=o;i[r]={fenceName:s,fencePort:l},o.fences=i},host:(e,t)=>{let{dataset:{hostId:n="",hostNumber:r="",hostType:s=""}}=t,l=Number.parseInt(r,10);e.hostConfig.hosts[n]={hostNumber:l,hostType:s}},ipmi:(e,t)=>{let{dataset:{hostId:n=""},value:r}=t,{hostConfig:{hosts:{[n]:s}}}=e;s.ipmiIp=r},network:(e,t)=>{let{dataset:{hostId:n="",networkId:r="",networkNumber:s="",networkType:l=""},value:o}=t,{hostConfig:{hosts:{[n]:i}}}=e,{networks:a={}}=i,c=Number.parseInt(s,10);a[r]={networkIp:o,networkNumber:c,networkType:l},i.networks=a},ups:(e,t)=>{let{checked:n,dataset:{hostId:r="",upsId:s="",upsName:l=""}}=t,{hostConfig:{hosts:{[r]:o}}}=e,{upses:i={}}=o;i[s]={isUsed:n,upsName:l},o.upses=i}},e6={xs:1,sm:2,md:3},e7=(e,t)=>"".concat(e5,"-").concat(e,"-").concat(t,"-port"),te=e=>"".concat(e5,"-").concat(e,"-ipmi-ip"),tt=(e,t)=>"".concat(e5,"-").concat(e,"-").concat(t,"-ip"),tn=(e,t)=>"".concat(e5,"-").concat(e,"-").concat(t,"-power-host");var tr=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,buildInputUnmountFunction:s,setMessage:l},hostId:o,hostNumber:a,hostType:d,previous:{fences:u={},ipmiIp:h,networks:m={},upses:p={}}={},hostLabel:x="".concat(d.replace("node","subnode")," ").concat(a)}=e,f=(0,i.useMemo)(()=>Object.entries(u),[u]),j=(0,i.useMemo)(()=>Object.entries(m),[m]),b=(0,i.useMemo)(()=>Object.entries(p),[p]),k=(0,i.useMemo)(()=>!!b.length,[b.length]),y=(0,i.useMemo)(()=>"".concat(e5,"-").concat(o),[o]),P=(0,i.useMemo)(()=>te(o),[o]),C=(0,i.useMemo)(()=>"".concat(e9,"-").concat(o,"-ipmi-ip"),[o]),A=(0,i.useMemo)(()=>f.reduce((e,s)=>{let[i,{fenceName:a,fencePort:c}]=s,d="".concat(e9,"-").concat(o,"-").concat(i,"-port"),u=e7(o,i),h="Plug on ".concat(a);return e[d]={children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"fence","data-host-id":o,"data-fence-id":i,"data-fence-name":a},id:u,label:h,value:c}),inputTestBatch:(0,I.Gn)("".concat(o," ").concat(h),()=>{l(u)},{onFinishBatch:t(u)},e=>{l(u,{children:e})}),onFirstRender:n(u)})},e},{}),[t,n,f,o,l]),T=(0,i.useMemo)(()=>j.reduce((e,i)=>{let[a,{networkIp:c,networkNumber:d,networkType:u}]=i,h="".concat(e9,"-").concat(o,"-").concat(a,"-ip"),m=tt(o,a),p="".concat(u.toUpperCase()," ").concat(d," IP");return e[h]={children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"network","data-host-id":o,"data-network-id":a,"data-network-number":d,"data-network-type":u},id:m,label:p,value:c}),inputTestBatch:(0,I._)("".concat(o," ").concat(p),()=>{l(m)},{onFinishBatch:t(m)},e=>{l(m,{children:e})}),onFirstRender:n(m),onUnmount:s(m),required:!0})},e},{}),[j,o,t,n,s,l]),F=(0,i.useMemo)(()=>b.reduce((e,t)=>{let[n,{isUsed:s,upsName:l}]=t,i="".concat(e9,"-").concat(o,"-").concat(n,"-power-host"),a=tn(o,n),c="Uses ".concat(l);return e[i]={children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(S,{baseInputProps:{"data-handler":"ups","data-host-id":o,"data-ups-id":n,"data-ups-name":l},checked:s,id:a,label:c}),valueType:"boolean"})},e},{}),[o,b]),U=(0,i.useMemo)(()=>k&&(0,r.jsx)(c.Z,{columns:e6,layout:F,spacing:"1em"}),[k,F]);return(0,r.jsxs)(w.Lg,{mv:0,children:[(0,r.jsx)(w.CH,{children:(0,r.jsx)(M.Ac,{children:x})}),(0,r.jsxs)(w.bc,{children:[(0,r.jsx)("input",{hidden:!0,id:y,readOnly:!0,"data-handler":"host","data-host-id":o,"data-host-number":a,"data-host-type":d}),(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(c.Z,{columns:e6,layout:{"fence-message":{children:(0,r.jsx)(e8.Z,{children:"It is recommended to provide at least 1 fence device plug."}),width:"100%",xs:0},...T,[C]:{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"ipmi","data-host-id":o},id:P,label:e3,value:h}),inputTestBatch:(0,I._)("".concat(o," ").concat(e3),()=>{l(P)},{onFinishBatch:t(P)},e=>{l(P,{children:e})}),onFirstRender:n(P),onUnmount:s(P)})},...A},spacing:"1em"}),U]})]})]})};let ts="".concat("".concat("an-host-config-input","-group"),"-cell"),tl={node1:{hostNumber:1,hostType:"node"},node2:{hostNumber:2,hostType:"node"}},to=e=>{let{anSeq:t,minIp:n,offset3:r=10,step3:s=2,subnetMask:l,subSeq:o}=e;try{let e=new e2.Netmask("".concat(n,"/").concat(l));if(16!==e.bitmask)return"".concat(e.base.replace(/\.0/g,""),".");return n.replace(/^((\d+\.){2})\d+\.\d+$/,"$1".concat((t-1)*s+r,".").concat(o))}catch(e){return""}};var ti=e=>{let{anSequence:t,formUtils:n,knownFences:s={},knownUpses:l={},networkListEntries:o,previous:{hosts:a=tl}={}}=e,d=(0,i.useMemo)(()=>Object.entries(a),[a]),u=(0,i.useMemo)(()=>Object.values(s),[s]),h=(0,i.useMemo)(()=>Object.values(l),[l]),m=(0,i.useMemo)(()=>d.reduce((e,s)=>{let[l,i]=s,{fences:a={},hostNumber:c,hostType:d,ipmiIp:m,networks:p={},upses:x={}}=i,f=m,j=u.reduce((e,t)=>{let{fenceName:n}=t,{[n]:{fencePort:r=""}={}}=a;return e[n]={fenceName:n,fencePort:r},e},{}),g=o.reduce((e,n)=>{let[r,{networkMinIp:s,networkNumber:l,networkSubnetMask:o,networkType:i}]=n,{[r]:{networkIp:a=""}={}}=p;return a||(a=to({anSeq:t,minIp:s,subnetMask:o,subSeq:c})),f||"bcn"!==i||1!==l||(f=to({anSeq:t,minIp:s,offset3:11,subnetMask:o,subSeq:c})),e[r]={networkIp:a,networkNumber:l,networkType:i},e},{}),v=h.reduce((e,t)=>{let{upsName:n}=t,{[n]:{isUsed:r=!0}={}}=x;return e[n]={isUsed:r,upsName:n},e},{});return e["".concat(ts,"-").concat(l)]={children:(0,r.jsx)(tr,{formUtils:n,hostId:l,hostNumber:c,hostType:d,previous:{fences:j,ipmiIp:f,networks:g,upses:v}}),md:3,sm:2},e},{}),[t,n,d,u,h,o]);return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:m,spacing:"1em"})},ta=n(23279),tc=n.n(ta);let td="an-id-input",tu="".concat(td,"-domain"),th="".concat(td,"-prefix"),tm="".concat(td,"-sequence"),tp="Domain name",tx="Prefix",tf="Sequence";var tj=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:s,setMessage:l},onSequenceChange:o,previous:{domain:a,prefix:d,sequence:u}={}}=e,h=(0,i.useMemo)(()=>o&&tc()(o,t),[t,o]);return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:{"an-id-input-cell-prefix":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:th,label:tx,value:d}),inputTestBatch:(0,I.Gn)(tx,()=>{l(th)},{onFinishBatch:n(th)},e=>{l(th,{children:e})}),onFirstRender:s(th),required:!0})},"an-id-input-cell-domain":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tu,label:tp,value:a}),inputTestBatch:(0,I.Gn)(tp,()=>{l(tu)},{onFinishBatch:n(tu)},e=>{l(tu,{children:e})}),onFirstRender:s(tu),required:!0})},"an-id-input-cell-sequence":{children:(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:h},input:(0,r.jsx)(Z.Z,{id:tm,label:tf,value:u}),inputTestBatch:(0,I.qY)(tf,()=>{l(tm)},{onFinishBatch:n(tm)},e=>{l(tm,{children:e})}),onFirstRender:s(tm),required:!0,valueType:"number"})}},spacing:"1em"})},tg=n(25934);let tv="an-network-input",tZ="".concat(tv,"-cell"),tw={gateway:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkGateway=r},minip:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkMinIp=r},network:(e,t)=>{let{dataset:{networkId:n="",networkNumber:r="",networkType:s=""}}=t,{networkConfig:{networks:l}}=e,o=Number.parseInt(r,10);l[n]={networkNumber:o,networkType:s}},subnetmask:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkSubnetMask=r}},tb=e=>"".concat(tv,"-").concat(e,"-gateway"),tk=e=>"".concat(tv,"-").concat(e,"-min-ip"),ty=e=>"".concat(tv,"-").concat(e,"-network-type"),tP=e=>"".concat(tv,"-").concat(e,"-subnet-mask");var tM=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:s,buildInputUnmountFunction:l,setMessage:o},inputGatewayLabel:a="Gateway",inputMinIpLabel:d="IP address",inputSubnetMaskLabel:u="Subnet mask",networkId:h,networkNumber:m,networkType:p,networkTypeOptions:x,onClose:f,onNetworkGatewayChange:j,onNetworkMinIpChange:g,onNetworkSubnetMaskChange:k,onNetworkTypeChange:y,previous:{gateway:P,minIp:M,subnetMask:C}={},readonlyNetworkName:S,showCloseButton:A,showGateway:T}=e,F=(0,i.useMemo)(()=>"".concat(ez.Z[p]," ").concat(m),[m,p]),U=(0,i.useMemo)(()=>"".concat(tZ,"-").concat(h,"-gateway"),[h]),O=(0,i.useMemo)(()=>"".concat(tZ,"-").concat(h,"-ip"),[h]),N=(0,i.useMemo)(()=>"".concat(tZ,"-").concat(h,"-subnet-mask"),[h]),R=(0,i.useMemo)(()=>"".concat(tv,"-").concat(h),[h]),q=(0,i.useMemo)(()=>tb(h),[h]),E=(0,i.useMemo)(()=>tk(h),[h]),_=(0,i.useMemo)(()=>ty(h),[h]),D=(0,i.useMemo)(()=>tP(h),[h]),B=(0,i.useMemo)(()=>T?void 0:"none",[T]),H=(0,i.useMemo)(()=>j&&tc()(j,t),[t,j]),L=(0,i.useMemo)(()=>g&&tc()(g,t),[t,g]),V=(0,i.useMemo)(()=>k&&tc()(k,t),[t,k]),$=(0,i.useMemo)(()=>A&&(0,r.jsx)(eh.Z,{mapPreset:"close",iconProps:{fontSize:"small"},onClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==f||f.call(null,{networkId:h,networkType:p},...t)},sx:{padding:".2em",position:"absolute",right:"-.6rem",top:"-.2rem"}}),[A,h,p,f]),z=(0,i.useMemo)(()=>{let e;return T&&q&&(e=(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==H?void 0:H.call(null,{networkId:h,networkType:p},...t)}},input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"gateway","data-network-id":h},id:q,label:a,value:P}),inputTestBatch:(0,I._)("".concat(F," ").concat(a),()=>{o(q)},{onFinishBatch:n(q)},e=>{o(q,{children:e})}),onFirstRender:s(q),onUnmount:l(q),required:T})),e},[T,q,h,a,P,F,n,s,l,H,p,o]);return(0,r.jsxs)(w.Lg,{mv:0,children:[(0,r.jsxs)(w.CH,{children:[(0,r.jsx)(v.Z,{input:(0,r.jsx)(b.Z,{id:_,isReadOnly:S,onChange:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==y||y.call(null,{networkId:h,networkType:p},...t)},selectItems:x,selectProps:{renderValue:()=>F},value:p})}),$]}),(0,r.jsxs)(w.bc,{children:[(0,r.jsx)("input",{hidden:!0,id:R,readOnly:!0,"data-handler":"network","data-network-id":h,"data-network-number":m,"data-network-type":p}),(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:{[O]:{children:(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==L?void 0:L.call(null,{networkId:h,networkType:p},...t)}},input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"minip","data-network-id":h},id:E,label:d,value:M}),inputTestBatch:(0,I._)("".concat(F," ").concat(d),()=>{o(E)},{onFinishBatch:n(E)},e=>{o(E,{children:e})}),onFirstRender:s(E),onUnmount:l(E),required:!0})},[N]:{children:(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==V?void 0:V.call(null,{networkId:h,networkType:p},...t)}},input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"subnetmask","data-network-id":h},id:D,label:u,value:C}),inputTestBatch:(0,I._)("".concat(F," ").concat(u),()=>{o(D)},{onFinishBatch:n(D)},e=>{o(D,{children:e})}),onFirstRender:s(D),onUnmount:l(D),required:!0})},[U]:{children:z,display:B}},spacing:"1em"})]})]})},tC=n(8534);let tS="an-network-config-input",tI="".concat(tS,"-cell"),tA="".concat(tS,"-dns"),tT="".concat(tS,"-ntp"),tF=Object.entries(ez.Z),tU={bcn:{base:"10.201.0.0",mask:"255.255.0.0"},mn:{base:"10.199.0.0",mask:"255.255.0.0"},sn:{base:"10.101.0.0",mask:"255.255.0.0"}},tO=e=>"ifn"===e,tN=e=>"mn"===e,tR=e=>{let{entries:t,type:n}=e,r=t.filter(e=>{let[,{networkType:t}]=e;return t===n}).sort((e,t)=>{let[,{networkNumber:n}]=e,[,{networkNumber:r}]=t;return n>r?1:-1}).pop();if(!r){var s;return null!==(s=tU[n])&&void 0!==s?s:{}}let[,{networkMinIp:l,networkSubnetMask:o}]=r;try{let{base:e,mask:t}=new e2.Netmask("".concat(l,"/").concat(o)).next();return{base:e,mask:t}}catch(e){return{}}};var tq=e=>{let{formUtils:t,networkListEntries:n,previous:{dnsCsv:s="8.8.8.8,8.8.4.4",ntpCsv:l}={},setNetworkList:o}=e,{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:d,setMessage:u,setMessageRe:h}=t,m=(0,i.useCallback)(function(e){let{input:t=n,end:r=n.length}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r-1,l=0;return t.every((t,n)=>{let[,{networkType:r}]=t;return r===e&&(l+=1),n<s}),l},[n]),p=(0,i.useMemo)(()=>tF.map(e=>{let[t,n]=e;return{displayValue:n,value:t}}),[]),x=(0,i.useCallback)(function(){let{networkMinIp:e="",networkSubnetMask:t="",networkType:r=n.some(e=>{let[,{networkType:t}]=e;return tN(t)})?"ifn":"mn",networkGateway:s=tO(r)?"":void 0,networkNumber:l=m(r)+1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{base:o=e,mask:i=t}=tR({entries:n,type:r});return{network:{networkGateway:s,networkMinIp:o,networkNumber:l,networkSubnetMask:i,networkType:r},networkId:(0,tg.Z)()}},[m,n]),f=(0,i.useCallback)((e,t)=>o((0,tC.ZP)(e,t)),[o]),j=(0,i.useCallback)((e,t,n)=>o(r=>{let s={...r},{[e]:l}=s;return l&&(l[t]=n),s}),[o]),g=(0,i.useCallback)((e,t)=>{let{networkId:r,networkType:s}=e,{target:{value:l}}=t,i=String(l),a=!1,c=0;o(n.reduce((e,t)=>{let[l,o]=t,{networkNumber:d,networkType:u,networkMinIp:m,networkSubnetMask:p,...x}=o,f=d,j=u;l===r&&(a=!0,j=i,h(RegExp(l)));let g=j===i;if(g&&(c+=1),a){g?f=c:j===s&&(f-=1);let{base:t=m,mask:r=p}=tR({entries:n,type:j});e[l]={...x,networkMinIp:t,networkSubnetMask:r,networkNumber:f,networkType:j}}else e[l]=o;return e},{}))},[n,h,o]),w=(0,i.useCallback)(e=>{let{networkId:t,networkType:r}=e,s=!1,l=0;o(n.reduce((e,n)=>{let[o,i]=n;if(o===t)return s=!0,e;let{networkType:a}=i,c=a===r;return c&&(l+=1),e[o]=s&&c?{...i,networkNumber:l}:i,e},{}))},[n,o]),b=(0,i.useMemo)(()=>n.reduce((e,n)=>{let[s,{networkGateway:l,networkMinIp:o,networkNumber:i,networkSubnetMask:a,networkType:c}]=n,d="".concat(tI,"-").concat(s),u=1===i,h=tO(c),m=tN(c)||!u;return e[d]={children:(0,r.jsx)(tM,{formUtils:t,networkId:s,networkNumber:i,networkType:c,networkTypeOptions:p,onClose:w,onNetworkMinIpChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return j(n,"networkMinIp",r)},onNetworkSubnetMaskChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return j(n,"networkSubnetMask",r)},onNetworkTypeChange:g,previous:{gateway:l,minIp:o,subnetMask:a},readonlyNetworkName:!m,showCloseButton:m,showGateway:h}),md:3,sm:2},e},{}),[n,t,p,w,g,j]);return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:{...b,"an-network-config-cell-add-network":{children:(0,r.jsx)(eh.Z,{mapPreset:"add",onClick:()=>{let{network:e,networkId:t}=x();f(t,e)}}),display:"flex",justifyContent:"center",md:3,sm:2},"an-network-config-input-cell-dns":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tA,label:"DNS",value:s}),inputTestBatch:(0,I.dg)("DNS",()=>{u(tA)},{onFinishBatch:a(tA)},e=>{u(tA,{children:e})}),onFirstRender:d(tA),required:!0})},"an-network-config-input-cell-ntp":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tT,label:"NTP",value:l}),inputTestBatch:(0,I.dg)("NTP",()=>{u(tT)},{onFinishBatch:a(tT)},e=>{u(tT,{children:e})}),onFirstRender:d(tT)})}},spacing:"1em"})};let tE={bcn1:{networkMinIp:"10.201.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"bcn"},sn1:{networkMinIp:"10.101.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"sn"},ifn1:{networkMinIp:"",networkNumber:1,networkSubnetMask:"",networkType:"ifn"}};var t_=e=>{var t;let{formUtils:n,knownFences:s,knownUpses:l,previous:{hostConfig:o,networkConfig:a={},...c}={}}=e,{networks:d=tE}=a,[u,h]=(0,i.useState)(null!==(t=null==c?void 0:c.sequence)&&void 0!==t?t:0),[m,p]=(0,i.useState)(d),x=(0,i.useMemo)(()=>Object.entries(m),[m]);return(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(tj,{formUtils:n,onSequenceChange:e=>{let{target:{value:t}}=e;h(Number(t))},previous:c}),(0,r.jsx)(tq,{formUtils:n,networkListEntries:x,previous:a,setNetworkList:p}),(0,r.jsx)(ti,{anSequence:u,formUtils:n,knownFences:s,knownUpses:l,networkListEntries:x,previous:o})]})},tD=e=>{let{formUtils:t,knownFences:n,knownUpses:s,previous:l}=e;return(0,r.jsx)(t_,{formUtils:t,knownFences:n,knownUpses:s,previous:l})},tB=n(50361),tH=n.n(tB),tL=n(45486),tV=n(36026);let t$=ew.Ry({name:ew.Z_().required(),uuid:(0,eb.u)().required()}),tz=ew.Ry({anvil:ew.Vo(e=>void 0!==e?t$:ew.nK().optional()),number:ew.Rx(),type:ew.Z_(),uuid:(0,eb.u)().required()}),tW=ew.Z_().when("rerun",(e,t)=>e[0]?t.optional():t.required()),tG=ew.Ry({confirmPassword:tW.oneOf([ew.iH("password")]),description:tW,hosts:ew.Vo(e=>ew.Ry((0,tV.Z)(e,tz))),password:tW,rerun:ew.O7().required(),reuseHosts:ew.O7().when("hosts",(e,t)=>Object.values(e[0]).some(e=>!!e.anvil)?t.isTrue():t.isFalse())});var tJ=e=>{let{detail:t,knownFences:n,knownHosts:s,knownUpses:l,onSubmitSuccess:o,tools:a}=e,{anvil:c,domain:d,hostConfig:u,networkConfig:h}=t,{hosts:m}=u,{dnsCsv:p,networks:x,ntpCsv:f}=h,v=(0,i.useMemo)(()=>Object.entries(m),[m]),w=(0,i.useMemo)(()=>Object.entries(x),[x]),k=(0,i.useMemo)(()=>Object.entries(n),[n]),y=(0,i.useMemo)(()=>Object.entries(s),[s]),P=(0,i.useMemo)(()=>Object.entries(l),[l]),C=(0,i.useMemo)(()=>y.map(e=>{let[,{anvil:t,hostName:n,hostUUID:s}]=e;return{displayValue:(0,r.jsxs)(g.Z,{spacing:0,children:[(0,r.jsx)(M.Ac,{inverted:!0,children:n}),(0,r.jsx)(M.KI,{inverted:!0,children:t?"Used by ".concat(t.name):"Ready"})]}),value:s}}),[y]),{disabledSubmit:S,formik:I,formikErrors:A,handleChange:T}=(0,eP.Z)({initialValues:{confirmPassword:"",description:"",hosts:v.reduce((e,t)=>{let n;let[r,{hostName:l,hostNumber:o,hostType:i}]=t,a="";if(c){let{hosts:{[o]:{uuid:e}}}=c;a=e;let t=s[e];t&&(n=t.anvil)}else if(l){let e=y.find(e=>{let[,{shortHostName:t}]=e;return t===l});if(e){let[,t]=e;n=t.anvil,a=t.hostUUID}}return e[r]={anvil:n,number:o,type:i,uuid:a},e},{}),password:"",rerun:!!c,reuseHosts:!1},onSubmit:(e,n)=>{let{setSubmitting:l}=n,{confirmPassword:i,rerun:c,reuseHosts:u,hosts:h,...p}=e,x={...c?null:p,hosts:Object.values(h).reduce((e,t)=>{let{number:n,type:r,uuid:l}=t,o="".concat(r).concat(n);return e["".concat(r.replace("node","Subnode")," ").concat(n)]={useHost:s[l].hostName,renameTo:"".concat(m[o].hostName,".").concat(d)},e},{})};a.confirm.prepare({actionProceedText:"Run",content:(0,r.jsx)($.Z,{entries:x,hasPassword:!0}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{a.confirm.loading(!0),B.Z.put("/command/run-manifest/".concat(t.uuid),e).then(()=>{a.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started installing ",t.name]})}),null==o||o.call(null),a.edit.open(!1)}).catch(e=>{let t=(0,z.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to run install manifest. ",t.children]}),a.confirm.finish("Error",t),l(!1)})},titleText:"Run install manifest ".concat(t.name," with the following?")}),a.confirm.open()},validationSchema:tG}),F=(0,i.useMemo)(()=>"confirmPassword",[]),U=(0,i.useMemo)(()=>"description",[]),O=(0,i.useMemo)(()=>"hosts",[]),N=(0,i.useMemo)(()=>"password",[]),R=(0,i.useMemo)(()=>"reuseHosts",[]),q=(0,i.useMemo)(()=>v.reduce((e,t)=>{let[n,{hostNumber:l,hostType:o}]=t,i="".concat(O,".").concat(n),a="".concat(i,".uuid"),c="".concat(o.replace("node","Subnode")," ").concat(l);return e.push((0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(b.Z,{id:a,label:c,name:a,onChange:e=>{let{target:{value:t}}=e,{[t]:{anvil:r}}=s,i=tH()(I.values.hosts),a=Object.entries(i).find(e=>{let[r,{uuid:s}]=e;return r!==n&&s===t});if(a){let[e,t]=a,{number:r,type:s}=t;i[e]={...i[n],number:r,type:s}}return i[n]={anvil:r,number:l,type:o,uuid:t},I.setFieldValue(O,i)},required:!0,selectItems:C,selectProps:{renderValue:e=>{let{[e]:{hostName:t}}=s;return t}},value:I.values.hosts[n].uuid})},"".concat(n,"-selector"))),e},[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"Use host"})},"host-selector-header")]),[I,v,C,O,s]),E=(0,i.useMemo)(()=>v.reduce((e,t)=>{let[n,{hostName:s}]=t;return e.push((0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsxs)(M.$_,{noWrap:!0,children:[s,".",d]})},"".concat(n,"-rename"))),e},[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"New hostname"})},"host-rename-header")]),[v,d]),_=(0,i.useMemo)(()=>w.reduce((e,t)=>{let[n,s]=t,{networkNumber:l,networkType:o}=s,i="".concat(o.toLocaleUpperCase()).concat(l),a=v.map(e=>{let[t,{networks:s}]=e,l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:e})},"".concat(n,"-").concat(t,"-ip"))};if(!s)return l();let{[n]:o}=s;if(!o)return l();let{networkIp:i}=o;return l(i)});return e.push((0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:i})},"".concat(n,"-header")),...a),e},[]),[v,w]),D=(0,i.useMemo)(()=>k.reduce((e,t)=>{let[n,s]=t,{fenceName:l}=s,o=v.map(e=>{let[t,{fences:s}]=e,o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:e})},"".concat(n,"-").concat(t,"-port"))};if(!s)return o();let{[l]:i}=s;if(!i)return o();let{fencePort:a}=i;return o(a)});return e.push((0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsxs)(M.Ac,{children:["Plug on ",l]})},"".concat(n,"-header")),...o),e},[]),[v,k]),H=(0,i.useMemo)(()=>P.reduce((e,t)=>{let[n,s]=t,{upsName:l}=s,o=v.map(e=>{let[t,{upses:s}]=e,o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{children:e})},"".concat(n,"-").concat(t,"-used"))};if(!s)return o();let{[l]:i}=s;if(!i)return o();let{isUsed:a}=i;return o(a?"yes":"no")});return e.push((0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsxs)(M.Ac,{children:["Uses ",l]})},"".concat(n,"-header")),...o),e},[]),[v,P]),L=(0,i.useMemo)(()=>{let e;let t=w.find(e=>{let{1:{networkGateway:t}}=e;return!!t}),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{justifyContent:"end",children:e})},"gateway-value")};if(t){let[,{networkGateway:r}]=t;e=r&&r.length>0?n(r):n()}else e=n();return[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"Gateway"})},"gateway-header"),e]},[w]),V=(0,i.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{justifyContent:"end",children:e})},"dns-value")},t=p&&p.length>0?e(p):e();return[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"DNS"})},"dns-header"),t]},[p]),W=(0,i.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.$_,{justifyContent:"end",children:e})},"ntp-value")},t=f&&f.length>0?e(f):e();return[(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Ac,{children:"NTP"})},"ntp-header"),t]},[f]),J=(0,i.useMemo)(()=>{let e=Object.values(I.values.hosts).filter(e=>!!e.anvil);if(0===e.length)return null;let t=e.slice(1).reduce((e,t)=>"".concat(e,", ").concat(s[t.uuid].shortHostName),s[e[0].uuid].shortHostName);return(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(e8.Z,{children:[(0,r.jsx)(tL.Z,{id:R,invert:!0,name:R,onChange:I.handleChange,required:!0,sx:{marginRight:".5em"},thinPadding:!0,value:I.values.reuseHosts}),"Confirm reusing host(s): ",t,"."]})})},[I,s,R]);return(0,r.jsxs)(em.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),I.submitForm()},spacing:"1em",children:[c?(0,r.jsxs)(em.ZP,{item:!0,width:"100%",children:[(0,r.jsx)(M.Ac,{children:"Description"}),(0,r.jsx)(M.Ac,{children:c.description})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{id:U,label:"Description",name:U,onChange:T,required:!0,value:I.values.description})})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:N,label:"Password",name:N,onChange:T,required:!0,type:j.Z.password,value:I.values.password})})}),(0,r.jsx)(em.ZP,{item:!0,xs:1,children:(0,r.jsx)(ey.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:F,label:"Confirm password",name:F,onChange:T,required:!0,type:j.Z.password,value:I.values.confirmPassword})})})]}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(em.ZP,{alignItems:"center",columns:v.length+1,columnSpacing:"1em",container:!0,rowSpacing:".6em",children:[...q,...E,..._,...D,...H]})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(em.ZP,{columns:2,container:!0,spacing:".6em",children:[...L,...V,...W]})}),J,(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(G.Z,{count:1,messages:A})}),(0,r.jsx)(em.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ep.Z,{actions:[{background:"blue",children:"Run",disabled:S,type:"submit"}]})})]})};let tQ=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[{target:r}]=t,{elements:s}=r,{value:l}=s.namedItem(tu),{value:o}=s.namedItem(th),{value:i}=s.namedItem(tm),{value:a}=s.namedItem(tA),{value:c}=s.namedItem(tT),d=Number.parseInt(i,10);return Object.values(s).reduce((e,t)=>{var n,r;let{id:s}=t;if(RegExp("^".concat(e5)).test(s)){let{dataset:{handler:r=""}}=t;null===(n=e4[r])||void 0===n||n.call(null,e,t)}else if(RegExp("^".concat(tv)).test(s)){let{dataset:{handler:n=""}}=t;null===(r=tw[n])||void 0===r||r.call(null,e,t)}return e},{domain:l,hostConfig:{hosts:{}},networkConfig:{dnsCsv:a,networks:{},ntpCsv:c},prefix:o,sequence:d})};var tK=()=>{let e=(0,i.useRef)({}),t=(0,i.useRef)({}),n=(0,i.useRef)({}),s=(0,i.useRef)(null),l=(0,i.useRef)({}),[o,a]=(0,K.Z)(),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!0),[m,p]=(0,i.useState)(),{data:x,loading:f,mutate:j}=(0,eX.Z)("/manifest",{refreshInterval:1e4}),{data:v,loading:Z,mutate:b}=(0,eX.Z)("/manifest/template"),{data:k,loading:y,mutate:P}=(0,eX.Z)("/host?types=node"),C=(0,X.Z)([tu,th,tm,tA,tT],l),{isFormInvalid:S,isFormSubmitting:I,submitForm:A}=C,{buildDeleteDialogProps:T,checks:F,getCheck:U,hasChecks:O,resetChecks:N,setCheck:R}=(0,Q.Z)({list:x}),{name:E,uuid:_}=(0,i.useMemo)(()=>null!=m?m:{},[m]),{domain:D,fences:L,prefix:J,sequence:Y,upses:ee}=(0,i.useMemo)(()=>null!=v?v:{},[v]),et=(0,i.useCallback)(e=>{let{hostConfig:{hosts:t}}=e,n=Object.values(t).reduce((e,t)=>{let{fences:n,hostType:r,hostNumber:s}=t,l="".concat(r.replace(/node/,"subnode")).concat(s);return n?e[l]=Object.values(n).reduce((e,t)=>{let{fencePort:n}=t;return e+(n.length?1:0)},0):e[l]=0,e},{}),s=Object.entries(n).map(e=>{let[t,n]=e;return n?(0,r.jsx)(r.Fragment,{}):(0,r.jsxs)(e8.Z,{children:["No fence device port specified for ",t,"."]},"".concat(t,"-no-fence-port-message"))});return{counts:n,messages:s}},[]),en=(0,i.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(t_,{formUtils:C,knownFences:L,knownUpses:ee,previous:{domain:D,prefix:J,sequence:Y}}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),l=0;l<n;l++)s[l]=arguments[l];let o=tQ(...s),{messages:i}=et(o);a({actionProceedText:"Add",content:(0,r.jsx)($.Z,{entries:o,maxDepth:6}),onProceedAppend:()=>{A({body:o,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add install manifest. ",e]}),method:"post",onSuccess:()=>j(),successMsg:"Successfully added install manifest",url:"/manifest"})},preActionArea:(0,r.jsx)(g.Z,{spacing:".3em",children:i}),titleText:"Add install manifest?"}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},titleText:"Add an install manifest"}),[et,C,j,L,ee,D,J,Y,a,A]),er=(0,i.useMemo)(()=>({actionProceedText:"Edit",content:(0,r.jsx)(tD,{formUtils:C,knownFences:L,knownUpses:ee,previous:m}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),l=0;l<n;l++)s[l]=arguments[l];let o=tQ(...s),{messages:i}=et(o);a({actionProceedText:"Edit",content:(0,r.jsx)($.Z,{entries:o,maxDepth:6}),onProceedAppend:()=>{A({body:o,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update install manifest. ",e]}),method:"put",onSuccess:()=>j(),successMsg:"Successfully updated install manifest ".concat(E),url:"/manifest/".concat(_)})},preActionArea:(0,r.jsx)(g.Z,{spacing:".3em",children:i}),titleText:"Update install manifest ".concat(E,"?")}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},loading:u,titleText:"Update install manifest ".concat(E)}),[et,C,j,u,L,ee,m,E,_,a,A]),es=(0,i.useCallback)((e,t)=>{h(!0),B.Z.get("manifest/".concat(e)).then(t=>{let{data:n}=t;n.uuid=e,p(n)}).catch(e=>{(0,z.Z)(e)}).finally(()=>{h(!1),null==t||t.call(null)})},[h,p]),el=(0,i.useMemo)(()=>(0,r.jsx)(W.Z,{allowEdit:!0,allowItemButton:c,disableDelete:!O,edit:c,header:!0,listEmpty:"No manifest(s) registered.",listItems:x,onAdd:()=>{var e;null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var t;a(T({onProceedAppend:()=>{A({body:{uuids:F},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Delete manifest(s) failed. ",e]}),method:"delete",onSuccess:()=>{j(),N()},url:"/manifest"})},getConfirmDialogTitle:e=>"Delete ".concat(e," manifest(s)?"),renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(M.Ac,{children:null==x?void 0:x[t].manifestName})}})),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},onEdit:()=>{d(e=>!e)},onItemCheckboxChange:(e,t,n)=>{R(e,n)},onItemClick:e=>{var t;let{manifestName:r,manifestUUID:s}=e;p({name:r,uuid:s}),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0),es(s)},renderListItemCheckboxState:e=>U(e),renderListItem:(e,t)=>{let{manifestName:n}=t;return(0,r.jsxs)(g.Z,{fullWidth:!0,row:!0,children:[(0,r.jsx)(eh.Z,{disabled:c,mapPreset:"play",onClick:()=>{var t;null===(t=s.current)||void 0===t||t.setOpen(!0),es(e)},variant:"normal"}),(0,r.jsx)(M.Ac,{children:n})]})}}),[T,F,U,es,j,O,c,x,N,R,a,p,A]),eo=(0,i.useMemo)(()=>y||Z||f?(0,r.jsx)(q.Z,{}):el,[y,f,Z,el]),ei=(0,i.useMemo)(()=>(0,r.jsx)(G.Z,{count:1,defaultMessageType:"warning",ref:l}),[]),{confirmDialog:ea,finishConfirm:ec,setConfirmDialogLoading:ed,setConfirmDialogOpen:em,setConfirmDialogProps:ep}=(0,eK.Z)({initial:{scrollContent:!0,wide:!0}}),ex=(0,i.useMemo)(()=>({add:{open:()=>null},confirm:{finish:ec,loading:ed,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return em(e)},prepare:ep},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==s?void 0:null===(e=s.current)||void 0===e?void 0:e.setOpen(t)}}}),[ec,ed,em,ep]),ef=(0,i.useMemo)(()=>Z||u||y,[y,u,Z]),ej=(0,i.useMemo)(()=>m&&L&&k&&ee&&(0,r.jsx)(tJ,{detail:m,knownFences:L,knownHosts:k,knownUpses:ee,onSubmitSuccess:()=>{b(),P()},tools:ex}),[ex,P,b,k,L,ee,m]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(M.z,{children:"Manage manifests"})}),eo]}),(0,r.jsx)(V.Z,{...en,disableProceed:S,loadingAction:I,preActionArea:ei,ref:t,scrollContent:!0,showClose:!0}),(0,r.jsx)(V.Z,{...er,disableProceed:S,loadingAction:I,preActionArea:ei,ref:n,scrollContent:!0,showClose:!0}),(0,r.jsx)(eu.Js,{header:"".concat((null==m?void 0:m.anvil)?"Rerun":"Run"," install manifest ").concat(null==m?void 0:m.name),loading:ef,ref:s,showClose:!0,wide:!0,children:ej}),(0,r.jsx)(H.Z,{closeOnProceed:!0,...o,ref:e,scrollContent:!0,wide:!0}),ea]})};let tX="common-ups-input-ip-address",tY="common-ups-input-host-name",t0="IP address",t1="Host name";var t2=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,setMessage:s},previous:{upsIPAddress:l,upsName:o}={}}=e;return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2},layout:{"common-ups-input-cell-host-name":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tY,label:t1,value:o}),inputTestBatch:(0,I.Gn)(t1,()=>{s(tY)},{onFinishBatch:t(tY)},e=>{s(tY,{children:e})}),onFirstRender:n(tY),required:!0})},"common-ups-input-cell-ip-address":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tX,label:t0,value:l}),inputTestBatch:(0,I._)(t0,()=>{s(tX)},{onFinishBatch:t(tX)},e=>{s(tX,{children:e})}),onFirstRender:n(tX),required:!0})}},spacing:"1em"})},t8=n(86549);let t5="add-ups-select-ups-type-id";var t9=e=>{let{formUtils:t,loading:n,previous:s={},upsTemplate:l}=e,{buildInputFirstRenderFunction:o,setValidity:a}=t,{upsTypeId:c=""}=s,d=(0,E.Z)(),[u,h]=(0,i.useState)(c),m=(0,i.useMemo)(()=>l?Object.entries(l).map(e=>{let t,[n,{brand:s,description:l,links:{0:o}}]=e;if(o){let{linkHref:e,linkLabel:n}=o;t=(0,r.jsx)(t8.Z,{href:e,onClick:e=>{e.stopPropagation()},sx:{display:"inline-flex",color:P.E5},target:"_blank",children:n})}return{displayValue:(0,r.jsxs)(g.Z,{spacing:0,children:[(0,r.jsx)(M.Ac,{inverted:!0,children:s}),(0,r.jsxs)(M.Ac,{inverted:!0,children:[l," (",t,")"]})]}),value:n}}):[],[l]),p=(0,i.useMemo)(()=>l&&(0,r.jsx)(b.Z,{formControlProps:{sx:{marginTop:".3em"}},id:t5,label:"UPS type",onChange:e=>{let{target:{value:t}}=e,n=String(t);a(t5,!0),h(n)},required:!0,selectItems:m,selectProps:{onClearIndicatorClick:()=>{a(t5,!1),h("")},renderValue:e=>{let{brand:t}=l[String(e)];return t}},value:u}),[l,m,u,a]),x=(0,i.useMemo)(()=>n?(0,r.jsx)(q.Z,{}):(0,r.jsxs)(g.Z,{children:[p,u&&(0,r.jsx)(t2,{formUtils:t,previous:s})]}),[t,u,n,p,s]);return(0,i.useEffect)(()=>{d&&o(t5)({isValid:!!u})},[o,u,d]),x};let t3="edit-ups-input-ups-uuid";var t4=e=>{let{formUtils:t,loading:n,previous:s,upsTemplate:l,upsUUID:o}=e;return(0,i.useMemo)(()=>n?(0,r.jsx)(q.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t9,{formUtils:t,previous:s,upsTemplate:l}),(0,r.jsx)("input",{hidden:!0,id:t3,readOnly:!0,value:o})]}),[t,n,s,l,o])};let t6=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[{target:s}]=n,{elements:l}=s,{value:o}=l.namedItem(tY),{value:i}=l.namedItem(tX),a=l.namedItem(t5),c="",d="",u="";a&&({value:u}=a,{agent:c,brand:d}=e[u]);let h=l.namedItem(t3),m="";return h&&({value:m}=h),{agent:c,brand:d,ipAddress:i,name:o,typeId:u,uuid:m}},t7=e=>{let{brand:t,ipAddress:n,name:s,uuid:l}=e;return(0,r.jsx)(W.Z,{listItems:{"ups-brand":{label:"Brand",value:t},"ups-name":{label:"Host name",value:s},"ups-ip-address":{label:"IP address",value:n}},listItemProps:{sx:{padding:0}},renderListItem:(e,t)=>{let{label:n,value:s}=t;return(0,r.jsxs)(g.Z,{fullWidth:!0,growFirst:!0,row:!0,children:[(0,r.jsx)(M.Ac,{children:n}),(0,r.jsx)(M.$_,{children:s})]},"confirm-ups-".concat(l,"-").concat(e))}})};var ne=()=>{let e=(0,E.Z)(),t=(0,i.useRef)({}),n=(0,i.useRef)({}),s=(0,i.useRef)({}),[l,o]=(0,K.Z)(),[a,c]=(0,K.Z)(),[d,h]=(0,i.useState)(!1),[m,p]=(0,i.useState)(!0),[x,f]=(0,i.useState)(),{data:j,isLoading:v}=(0,J.Z)("".concat(u.Z,"/ups"),{refreshInterval:6e4}),Z=(0,X.Z)([tX,tY,t5],s),{isFormInvalid:b,isFormSubmitting:k,submitForm:y}=Z,{buildDeleteDialogProps:P,checks:C,getCheck:S,hasChecks:I,setCheck:A}=(0,Q.Z)({list:j}),T=(0,i.useCallback)(e=>{var n,s;let{upsAgent:l,upsIPAddress:i,upsName:a,upsUUID:c}=e,d=null!==(s=null===(n=Object.entries(null!=x?x:{}).find(e=>{let[,{agent:t}]=e;return l===t}))||void 0===n?void 0:n[0])&&void 0!==s?s:"";return{actionProceedText:"Update",content:(0,r.jsx)(t4,{formUtils:Z,previous:{upsIPAddress:i,upsName:a,upsTypeId:d},upsTemplate:x,upsUUID:c}),onSubmitAppend:e=>{var n;if(!x)return;let s=t6(x,e),{name:l}=s;o({actionProceedText:"Update",content:t7(s),onProceedAppend:()=>{y({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update UPS. ",e]}),method:"put",successMsg:"Successfully updated UPS ".concat(a),url:"/ups/".concat(c)})},titleText:(0,r.jsxs)(M.z,{children:["Update"," ",(0,r.jsx)(M.Q0,{fontSize:"inherit",children:l})," ","with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,r.jsxs)(M.z,{children:["Update UPS"," ",(0,r.jsx)(M.Q0,{fontSize:"inherit",children:a})]})}},[Z,o,y,x]),F=(0,i.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(t9,{formUtils:Z,upsTemplate:x}),onSubmitAppend:e=>{var n;if(!x)return;let s=t6(x,e),{brand:l,name:i}=s;o({actionProceedText:"Add",content:t7(s),onProceedAppend:()=>{y({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add UPS. ",e]}),method:"post",successMsg:"Successfully added UPS ".concat(i),url:"/ups"})},titleText:(0,r.jsxs)(M.z,{children:["Add a"," ",(0,r.jsx)(M.Q0,{fontSize:"inherit",children:l})," UPS with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a UPS"}),[Z,o,y,x]),U=(0,i.useMemo)(()=>(0,r.jsx)(W.Z,{allowEdit:!0,allowItemButton:d,disableDelete:!I,edit:d,header:!0,listEmpty:"No Ups(es) registered.",listItems:j,onAdd:()=>{var e;c(F),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;o(P({getConfirmDialogTitle:e=>"Delete ".concat(e," UPSes?"),onProceedAppend:()=>{y({body:{uuids:C},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to delete UPS(es). ",e]}),method:"delete",url:"/ups"})},renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(M.Ac,{children:null==j?void 0:j[t].upsName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{h(e=>!e)},onItemCheckboxChange:(e,t,n)=>{A(e,n)},onItemClick:e=>{var t;c(T(e)),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0)},renderListItemCheckboxState:e=>S(e),renderListItem:(e,t)=>{let{upsAgent:n,upsIPAddress:s,upsName:l}=t;return(0,r.jsxs)(g.Z,{fullWidth:!0,row:!0,children:[(0,r.jsx)(M.Ac,{children:l}),(0,r.jsxs)(M.Ac,{children:['agent="',n,'"']}),(0,r.jsxs)(M.Ac,{children:['ip="',s,'"']})]})}}),[F,P,T,C,S,I,d,A,o,c,y,j]),O=(0,i.useMemo)(()=>m||v?(0,r.jsx)(q.Z,{}):U,[m,v,U]),N=(0,i.useMemo)(()=>(0,r.jsx)(G.Z,{count:1,defaultMessageType:"warning",ref:s}),[]);return e&&B.Z.get("/ups/template").then(e=>{let{data:t}=e;f(t)}).catch(e=>{(0,z.Z)(e)}).finally(()=>{p(!1)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(M.z,{children:"Manage UPSes"})}),O]}),(0,r.jsx)(V.Z,{...a,disableProceed:b,loadingAction:k,preActionArea:N,ref:n,showClose:!0}),(0,r.jsx)(H.Z,{closeOnProceed:!0,...l,ref:t})]})};let nt="prepare-host",nn="prepare-network",nr="manage-fence",ns="manage-ups",nl="manage-manifest",no={[nt]:"Prepare Host",[nn]:"Prepare Network",[nr]:"Manage Fence Devices",[ns]:"Manage UPSes",[nl]:"Manage Manifests"},ni="Loading",na={md:8,xs:1},nc={md:6,xs:1},nd=()=>(0,r.jsx)(c.Z,{columns:na,layout:{"preparehost-left-column":{},"preparehost-center-column":{children:(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(M.z,{children:"Hosts"})}),(0,r.jsx)(eA,{})]}),...nc}}}),nu=()=>(0,r.jsx)(c.Z,{columns:na,layout:{"preparenetwork-left-column":{},"preparenetwork-center-column":{children:(0,r.jsx)(e1,{}),...nc}}}),nh=()=>(0,r.jsx)(c.Z,{columns:na,layout:{"managefence-left-column":{},"managefence-center-column":{children:(0,r.jsx)(es,{}),...nc}}}),nm=()=>(0,r.jsx)(c.Z,{columns:na,layout:{"manageups-left-column":{},"manageups-center-column":{children:(0,r.jsx)(ne,{}),...nc}}}),np=()=>(0,r.jsx)(c.Z,{columns:na,layout:{"managemanifest-left-column":{},"managemanifest-center-column":{children:(0,r.jsx)(tK,{}),...nc}}});var nx=()=>{let{isReady:e,push:t,query:n}=(0,o.useRouter)(),[s,c]=(0,i.useState)(!1),[u,h]=(0,i.useState)(ni);return(0,i.useEffect)(()=>{if(!e)return;let{step:r}=n,l=a(r,{fallbackValue:nt});no[l]||(l=nt),t({query:{...n,step:l}},void 0,{shallow:!0}),u===ni&&h(no[l]),s||c(l)},[e]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:u})}),(0,r.jsx)(d.Z,{}),(0,r.jsx)(w.s_,{children:(0,r.jsxs)(eB,{onChange:(e,r)=>{c(r),h(no[r]),t({query:{...n,step:r}},void 0,{shallow:!0})},orientation:{xs:"vertical",sm:"horizontal"},value:s,children:[(0,r.jsx)(eO,{label:"Prepare host",value:nt}),(0,r.jsx)(eO,{label:"Prepare network",value:nn}),(0,r.jsx)(eO,{label:"Manage fence devices",value:nr}),(0,r.jsx)(eO,{label:"Manage UPSes",value:ns}),(0,r.jsx)(eO,{label:"Manage manifests",value:nl})]})}),(0,r.jsx)(e0,{changingTabId:s,tabId:nt,children:(0,r.jsx)(nd,{})}),(0,r.jsx)(e0,{changingTabId:s,tabId:nn,children:(0,r.jsx)(nu,{})}),(0,r.jsx)(e0,{changingTabId:s,tabId:nr,children:(0,r.jsx)(nh,{})}),(0,r.jsx)(e0,{changingTabId:s,tabId:ns,children:(0,r.jsx)(nm,{})}),(0,r.jsx)(e0,{changingTabId:s,tabId:nl,children:(0,r.jsx)(np,{})})]})}}},function(e){e.O(0,[491,442,433,206,74,461,602,982,361,292,593,173,717,967,428,598,888,774,179],function(){return e(e.s=29582)}),_N_E=e.O()}]);