(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[464],{45844:function(e,n,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/init",function(){return i(85083)}])},23435:function(e,n,i){"use strict";var s=i(85893),r=i(99514);n.Z=e=>{let{children:n}=e;return(0,s.jsxs)(r.ZP,{columns:{md:8,xs:1},container:!0,children:[(0,s.jsx)(r.ZP,{item:!0,xs:1}),(0,s.jsx)(r.ZP,{item:!0,md:6,xs:1,children:n}),(0,s.jsx)(r.ZP,{item:!0,xs:1})]})}},85083:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return F}});var s=i(85893),r=i(23435),t=i(67294),a=i(23930),l=i(25137),c=i(99514),o=i(37842),d=i(4845),m=i(98484),x=i(85923),u=i(97607),h=i(12059),j=i(81208),Z=i(91029),f=i(95277),P=i(16310);let p=P.Ry({adminPassword:P.Z_().required(),confirmAdminPassword:P.Z_().oneOf([P.iH("adminPassword")]).required(),domainName:P.Z_().required(),hostName:P.Z_().required(),hostNumber:P.Rx().required(),organizationName:P.Z_().required(),organizationPrefix:P.Z_().min(1).max(5).required(),networkInit:h.P});var g=i(26339),w=i(59278),b=e=>{let{gatewayIface:n,ifaces:i,values:r}=e;return(0,s.jsxs)(c.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Organization name"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:r.organizationName})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Organization prefix"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:r.organizationPrefix})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Striker number"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:r.hostNumber})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Domain name"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:r.domainName})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Host name"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:r.hostName})}),(0,s.jsx)(c.ZP,{item:!0,sx:{marginTop:"1.4em"},xs:2,children:(0,s.jsx)(w.Ac,{children:"Networks"})}),Object.entries(r.networkInit.networks).map(e=>{let[n,{interfaces:r,ip:t,sequence:a,subnetMask:l,type:o}]=e;return(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsxs)(c.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,s.jsx)(c.ZP,{item:!0,xs:2,children:(0,s.jsxs)(w.Ac,{children:[g.Z[o]," ",a," (",(0,s.jsx)(w.Q0,{children:"".concat(o.toUpperCase()).concat(a)}),")"]})}),r.map((e,r)=>{let t="network-confirm-".concat(n,"-interface").concat(r),a="none";if(""!==e){var l;t="".concat(t,"-").concat(e),a=null===(l=i[e])||void 0===l?void 0:l.name}return(0,s.jsxs)(c.ZP,{columns:{xs:2},container:!0,item:!0,children:[(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Link ".concat(r+1)})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:a})})]},t)}),(0,s.jsx)(c.ZP,{item:!0,xs:2,children:(0,s.jsx)(w.$_,{children:"".concat(t,"/").concat(l)})})]})},"network-confirm-".concat(n))}),(0,s.jsx)(c.ZP,{item:!0,sx:{marginBottom:"1.4em"},xs:2}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Gateway"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:r.networkInit.gateway})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Gateway network"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:n.toUpperCase()})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.Ac,{children:"Domain name server(s)"})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(w.$_,{children:r.networkInit.dns})})]})},v=i(60280),k=i(12387),_=i(82547);let N=e=>{let n="",i="",s="",r="",t="",a={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"},defaultifn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"}},l="",c="";if(e){({dns:r="",domain:n="",gateway:t="",hostName:i="",sequence:s="",organization:l="",prefix:c=""}=e);let{networks:o={}}=e;a=(0,v.Z)(o)}return{adminPassword:"",confirmAdminPassword:"",domainName:n,hostName:i,hostNumber:s,networkInit:{dns:r,gateway:t,networks:a},organizationName:l,organizationPrefix:c}},A=(e,n,i)=>[e,n,i].every(e=>e.length>0)?"".concat(e,"-striker").concat((0,f.Z)(n),".").concat(i):"",z=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,i=e.split(/\s+/).filter(e=>!/^(?:and|of)$/.test(e)).slice(0,n),s="";return i.length>1?s=i.map(e=>e.substring(0,1).toLocaleLowerCase()).join(""):1===i.length&&(s=i[0].substring(0,n).toLocaleLowerCase()),s};var q=e=>{let{detail:n,onSubmitSuccess:i,tools:r}=e,a=(0,t.useRef)(null),l=(0,_.Z)({initialValues:N(n),onSubmit:(e,n)=>{let{setSubmitting:t}=n,l=(0,x.Z)(e,a.current);r.confirm.prepare({actionProceedText:"Initialize",content:a.current&&(0,s.jsx)(b,{gatewayIface:l.gatewayInterface,ifaces:a.current,values:e}),onCancelAppend:()=>t(!1),onProceedAppend:()=>{r.confirm.loading(!0),m.Z.put("/init",l).then(e=>{null==i||i.call(null,e.data),r.confirm.finish("Success",{children:(0,s.jsx)(s.Fragment,{children:"Successfully registered striker initialization job."})})}).catch(e=>{let n=(0,u.Z)(e);n.children=(0,s.jsxs)(s.Fragment,{children:["Failed to register striker initialization job. ",n.children]}),r.confirm.finish("Error",n),t(!1)})},titleText:"Initialize ".concat(e.hostName," with the following?")}),r.confirm.open()},validationSchema:p}),{disabledSubmit:f,formik:P,formikErrors:g,getFieldChanged:w,handleChange:v}=l,q=(0,t.useMemo)(()=>"adminPassword",[]),C=(0,t.useMemo)(()=>"confirmAdminPassword",[]),y=(0,t.useMemo)(()=>"domainName",[]),S=(0,t.useMemo)(()=>"hostName",[]),I=(0,t.useMemo)(()=>"hostNumber",[]),M=(0,t.useMemo)(()=>"organizationName",[]),$=(0,t.useMemo)(()=>"organizationPrefix",[]),L=(0,t.useCallback)(e=>n=>{if(w(S))return;let{target:{value:i}}=n,{values:{domainName:s,hostNumber:r,organizationPrefix:t}}=P;switch(e){case y:s=i;break;case I:r=i;break;case $:t=i}let a=A(t,r,s);P.setFieldValue(S,a)},[y,P,w,S,I,$]);return(0,s.jsxs)(c.ZP,{columns:{xs:1,sm:2,md:3},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),P.handleSubmit(e)},spacing:"1em",children:[(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsxs)(c.ZP,{columns:2,container:!0,spacing:"1em",children:[(0,s.jsx)(c.ZP,{item:!0,width:"100%",children:(0,s.jsx)(k.Z,{input:(0,s.jsx)(Z.Z,{id:M,label:"Organization Name",name:M,onBlur:e=>{if(w($))return;let{target:{value:n}}=e,i=z(n);P.setFieldValue($,i)},onChange:v,required:!0,value:P.values.organizationName})})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Z,{input:(0,s.jsx)(Z.Z,{baseInputProps:{maxLength:5},id:$,label:"Prefix",name:$,onBlur:L($),onChange:v,required:!0,value:P.values.organizationPrefix})})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Z,{input:(0,s.jsx)(Z.Z,{id:I,label:"Striker #",name:I,onBlur:L(I),onChange:v,required:!0,value:P.values.hostNumber})})})]})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsxs)(c.ZP,{columns:1,container:!0,spacing:"1em",children:[(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Z,{input:(0,s.jsx)(Z.Z,{id:y,label:"Domain name",name:y,onBlur:L(y),onChange:v,required:!0,value:P.values.domainName})})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Z,{input:(0,s.jsx)(Z.Z,{disableAutofill:!0,id:S,label:"Host name",name:S,onChange:v,required:!0,value:P.values.hostName})})})]})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,sm:2,md:1,children:(0,s.jsxs)(c.ZP,{columns:{xs:1,sm:2,md:1},container:!0,spacing:"1em",children:[(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Z,{input:(0,s.jsx)(Z.Z,{disableAutofill:!0,id:q,label:"Admin password",name:q,onChange:v,required:!0,type:o.Z.password,value:P.values.adminPassword})})}),(0,s.jsx)(c.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Z,{input:(0,s.jsx)(Z.Z,{disableAutofill:!0,id:C,label:"Confirm admin password",name:C,onChange:v,required:!0,type:o.Z.password,value:P.values.confirmAdminPassword})})})]})}),(0,s.jsx)(c.ZP,{item:!0,width:"100%",children:(0,s.jsx)(h.r,{formikUtils:l,host:{parentSequence:NaN,sequence:Number(P.values.hostNumber),type:"striker",uuid:"local"},onFetchSuccess:e=>{a.current=e}})}),(0,s.jsx)(c.ZP,{item:!0,width:"100%",children:(0,s.jsx)(j.Z,{count:1,messages:g})}),(0,s.jsx)(c.ZP,{item:!0,width:"100%",children:(0,s.jsx)(d.Z,{actions:[{background:"blue",children:"Initialize",disabled:f,type:"submit"}]})})]})},C=i(85358),y=i(86549),S=i(64503),I=i(6837),M=i(77510);let $=e=>{let{children:n}=e;return(0,s.jsx)(a.s_,{sx:{marginLeft:{xs:"1em",sm:"auto"},marginRight:{xs:"1em",sm:"auto"},marginTop:"calc(50vh - 10em)",maxWidth:{xs:void 0,sm:"60%",md:"50%",lg:"40%"},minWidth:"fit-content"},children:n})};var L=e=>{let{jobUuid:n,reinit:i}=e,r=(0,t.useRef)(null),o=(0,t.useMemo)(()=>{let e="login",n="/login";return i&&(e="striker config",n="/config"),{label:e,path:n}},[i]),{data:d}=(0,M.Z)("/init/job/".concat(n),{onSuccess:e=>{let{progress:n}=e;null===r.current&&100===n&&(r.current=setTimeout(e=>{window.location.replace(e)},3e3,o.path))},refreshInterval:2e3}),m=(0,t.useMemo)(()=>{if(!(null==d?void 0:d.status))return(0,s.jsx)(S.Z,{children:"Loading..."});let{status:e}=d,n=Object.values(e).reduce((e,n)=>"".concat(e).concat(n.value,"\n\n"),"").trimEnd();return(0,s.jsx)(S.Z,{children:n})},[d]);return d?(0,s.jsx)($,{children:(0,s.jsxs)(c.ZP,{columns:1,container:!0,rowGap:".6em",children:[(0,s.jsx)(c.ZP,{item:!0,width:"100%",children:(0,s.jsxs)(w.Ac,{children:["You will be auto redirected to ",o.label," after initialization completes. If not, you can manually access"," ",(0,s.jsx)(y.Z,{display:"inline-flex",href:o.path,children:o.label})," ","after completion."]})}),(0,s.jsx)(c.ZP,{item:!0,width:"100%",children:(0,s.jsx)(C.ko,{progressPercentage:d.progress})}),(0,s.jsx)(c.ZP,{item:!0,width:"100%",children:(0,s.jsxs)(a.Lg,{mb:0,mt:0,children:[(0,s.jsx)(a.CH,{children:(0,s.jsx)(w.Ac,{children:"Status"})}),(0,s.jsx)(a.bc,{children:(0,s.jsx)(I.Z,{id:"status-scroll-box",height:"20vh",children:m})})]})})]})}):(0,s.jsx)($,{children:(0,s.jsx)(l.Z,{mt:0})})},O=i(2188),E=()=>{let[e,n]=(0,t.useState)(),{confirmDialog:i,finishConfirm:r,setConfirmDialogLoading:c,setConfirmDialogOpen:o,setConfirmDialogProps:d}=(0,O.Z)({initial:{scrollContent:!0,wide:!0}}),m=(0,t.useMemo)(()=>({add:{open:()=>null},confirm:{finish:r,loading:c,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return o(e)},prepare:d},edit:{open:()=>null}}),[r,c,o,d]),{data:x,loading:u}=(0,M.Z)("/host/local");return u?(0,s.jsx)(a.s_,{children:(0,s.jsx)(l.Z,{})}):e?(0,s.jsx)(L,{jobUuid:e,reinit:!!x}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a.s_,{children:[(0,s.jsx)(a.V9,{children:(0,s.jsxs)(w.z,{children:[x?"Rei":"I","nitialize striker"]})}),(0,s.jsx)(q,{detail:x,onSubmitSuccess:e=>{n(e.jobUuid)},tools:m})]}),i]})},F=()=>(0,s.jsx)(r.Z,{children:(0,s.jsx)(E,{})})}},function(e){e.O(0,[810,618,74,225,739,491,142,62,778,773,888,774,179],function(){return e(e.s=45844)}),_N_E=e.O()}]);