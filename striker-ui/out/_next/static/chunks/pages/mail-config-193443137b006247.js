(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[249],{24084:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mail-config",function(){return n(95954)}])},48801:function(e,t,n){"use strict";var r=n(85893),l=n(21640),i=n(93454),a=n(77527),s=n(4989),o=n(1142),u=n(58219),d=n(35562),c=n(90642),m=n(96245),h=n(82492),p=n.n(h),g=n(67294),v=n(39971),x=n(17512),f=n(23852);let j=e=>(0,r.jsx)(l.Z,{in:!0,children:(0,r.jsx)(i.Z,{...e})}),Z=(0,a.ZP)("ul")({padding:0}),y=s.Z;t.Z=e=>{let{componentsProps:t,extendRenderInput:n,getGroupLabel:l,label:i,ListboxProps:a,messageBoxProps:s,renderGroup:h,renderInput:b,sx:C,...A}=e,w=(0,g.useMemo)(()=>p()({paper:{sx:{backgroundColor:v.s7,["& .".concat(o.Z.groupLabel)]:{backgroundColor:v.s7}}}},t),[t]),P=(0,g.useMemo)(()=>p()({sx:{["& .".concat(o.Z.option)]:{'&[aria-selected="true"]':{backgroundColor:v.lD,["&.".concat(o.Z.focused)]:{backgroundColor:v.lD}},["&.".concat(o.Z.focused)]:{backgroundColor:v.lD}}}},a),[a]),O=(0,g.useMemo)(()=>h||l&&(e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(y,{component:"div",className:o.Z.groupLabel,children:l(e.group)}),(0,r.jsx)(Z,{className:o.Z.groupUl,children:e.children})]},e.key)),[l,h]),M=(0,g.useMemo)(()=>null!=b?b:e=>{let{fullWidth:t,InputProps:l,InputLabelProps:a,inputProps:s}=e,o={formControlProps:{fullWidth:t,ref:l.ref},inputLabelProps:a,inputProps:{className:l.className,endAdornment:l.endAdornment,inputProps:s,startAdornment:l.startAdornment},label:i};return null==n||n.call(null,o,e),(0,r.jsx)(f.Z,{...o})},[n,i,b]),k=(0,g.useMemo)(()=>p()({["& .".concat(u.Z.root," .").concat(o.Z.endAdornment)]:{right:"7px",["& .".concat(d.Z.root)]:{color:v.s7}}},C),[C]);return(0,r.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,r.jsx)(m.Z,{autoHighlight:!0,autoSelect:!0,PaperComponent:j,...A,ListboxProps:P,renderGroup:O,renderInput:M,slotProps:w,sx:k}),(0,r.jsx)(x.Z,{...s})]})}},73846:function(e,t,n){"use strict";var r=n(85893),l=n(67294),i=n(66389),a=n(45036),s=n(11100),o=n(18541),u=n(71108),d=n(81013),c=n(40657),m=n(5499);let h=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"==typeof e?e(...n):e};t.Z=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[p]=t,{addHeader:g,editHeader:v,entriesUrl:x,formDialogProps:f,getAddLoading:j,getDeleteErrorMessage:Z,getDeleteHeader:y,getDeletePromiseChain:b=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},getDeleteSuccessMessage:C,getEditLoading:A=e=>e,listEmpty:w,listProps:P,onItemClick:O=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},onValidateEntriesChange:M,refreshInterval:k=5e3,renderAddForm:F,renderDeleteItem:S,renderEditForm:I,renderListItem:D,entryUrlPrefix:V=x}=p,E=(0,l.useRef)(null),_=(0,l.useRef)(null),{confirmDialog:U,finishConfirm:N,setConfirmDialogLoading:q,setConfirmDialogOpen:R,setConfirmDialogProps:T}=(0,c.Z)({initial:{scrollContent:!0}}),[L,H]=(0,l.useState)(!1),[W,K]=(0,l.useState)(),{data:J,mutate:X,loading:z,validating:G}=(0,m.Z)(x,{refreshInterval:k}),{fetch:B,loading:$}=(0,u.Z)({onData:e=>K(e),url:V});(0,l.useEffect)(()=>{null==M||M.call(null,G)},[M,G]);let Q=(0,l.useMemo)(()=>h(g),[g]),Y=(0,l.useMemo)(()=>h(v,W),[W,v]),ee=(0,l.useMemo)(()=>({add:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==E?void 0:null===(e=E.current)||void 0===e?void 0:e.setOpen(t)}},confirm:{finish:N,loading:q,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return R(e)},prepare:T},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==_?void 0:null===(e=_.current)||void 0===e?void 0:e.setOpen(t)}}}),[N,q,R,T]),{buildDeleteDialogProps:et,checks:en,getCheck:er,hasAllChecks:el,hasChecks:ei,multipleItems:ea,resetChecks:es,setAllChecks:eo,setCheck:eu}=(0,d.Z)({list:J});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{allowCheckAll:ea,allowEdit:!0,allowItemButton:L,disableDelete:!ei,edit:L,getListCheckboxProps:()=>({checked:el,onChange:(e,t)=>eo(t)}),getListItemCheckboxProps:e=>({checked:er(e),onChange:(t,n)=>eu(e,n)}),header:!0,listEmpty:w,listItems:J,loading:z,onAdd:()=>{var e;return null==E?void 0:null===(e=E.current)||void 0===e?void 0:e.setOpen(!0)},onDelete:()=>{T(et({onProceedAppend:()=>{q(!0),Promise.all(b((e,t)=>e.map(e=>i.Z.delete("".concat(t,"/").concat(e))),en,x)).then(()=>{N("Success",C()),X()}).catch(e=>{N("Error",Z((0,s.Z)(e)))}).finally(()=>{es()})},getConfirmDialogTitle:y,renderEntry:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return S(J,...t)}})),R(!0)},onEdit:()=>H(e=>!e),onItemClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return O((e,t)=>{var n;null==_||null===(n=_.current)||void 0===n||n.setOpen(!0),B("/".concat(t))},...t)},renderListItem:D,...P}),(0,r.jsx)(a.Js,{header:Q,loading:null==j?void 0:j.call(null),ref:E,showClose:!0,...null==f?void 0:f.common,...null==f?void 0:f.add,children:F(ee)}),(0,r.jsx)(a.Js,{header:Y,loading:A($),ref:_,showClose:!0,...null==f?void 0:f.common,...null==f?void 0:f.edit,children:I(ee,W)}),U]})}},76740:function(e,t,n){"use strict";var r=n(85893),l=n(90642),i=n(19304),a=n(47407),s=n(35338),o=n(44400),u=n(5387),d=n(57882);let c=e=>{let{entry:t}=e;return(0,r.jsx)(d.$_,{whiteSpace:"nowrap",children:String(t)})},m=e=>{let{entry:t,key:n}=e;return s.JW.test(n)?(0,r.jsx)(d.PJ,{wrapper:"mono",children:String(t)}):c(e)},h=e=>{let{entry:t,hasPassword:n}=e;return["",null,void 0].some(e=>t===e)||Number.isNaN(t)?(0,r.jsx)(d.Ac,{children:"none"}):n?m(e):c(e)},p=e=>{let{depth:t,entry:n,getLabel:i,hasPassword:a,key:s,nest:c,renderValue:m}=e;return(0,r.jsxs)(u.Z,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,r.jsx)(d.Ac,{children:i({cap:o.Z,depth:t,entry:n,hasPassword:a,key:s})}),(0,r.jsx)(l.Z,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!c&&m(h,{depth:t,entry:n,hasPassword:a,key:s})})]})},g=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},v=e=>{let{depth:t=0,entries:n,getEntryLabel:l,getListProps:s,getListItemProps:o,hasPassword:u,listKey:d,maxDepth:c,renderEntry:m,renderEntryValue:h,skip:p}=e,x=[];Object.entries(n).forEach(e=>{let[n,a]=e,s=null!==a&&"object"==typeof a,d=s?null:a,f={depth:t,entry:d,hasPassword:u,key:n};p(g,f)||x.push((0,r.jsx)(i.ZP,{sx:{paddingLeft:"".concat(t,"em")},...null==o?void 0:o.call(null,f),children:m({depth:t,entry:d,getLabel:l,hasPassword:u,key:n,nest:s,renderValue:h})},"form-summary-entry-".concat(n))),s&&t<c&&x.push(v({depth:t+1,entries:a,getEntryLabel:l,hasPassword:u,listKey:n,maxDepth:c,renderEntry:m,renderEntryValue:h,skip:p}))});let f="form-summary-list-".concat(null!=d?d:"root");return(0,r.jsx)(a.Z,{dense:!0,disablePadding:!0,...null==s?void 0:s.call(null,{depth:t,entries:n,key:d}),children:x},f)};t.Z=e=>{let{entries:t,getEntryLabel:n=e=>{let{cap:t,key:n}=e;return t(n)},getListProps:r,getListItemProps:l,hasPassword:i=!1,maxDepth:a=3,renderEntry:s=p,renderEntryValue:o=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},skip:u=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)}}=e;return v({entries:t,getEntryLabel:n,getListProps:r,getListItemProps:l,hasPassword:i,maxDepth:a,renderEntry:s,renderEntryValue:o,skip:u})}},71108:function(e,t,n){"use strict";var r=n(67294),l=n(66389),i=n(11100);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{config:t,onError:n,onData:a,url:s=""}=e,[o,u]=(0,r.useState)(!1);return{fetch:(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,o="".concat(s).concat(e);o&&(u(!0),l.Z.get(o,{...t,...r}).then(e=>{let{data:t}=e;null==a||a.call(null,t)}).catch(e=>{let t=(0,i.Z)(e);null==n||n.call(null,t)}).finally(()=>{u(!1)}))},[s,t,a,n]),loading:o}}},81013:function(e,t,n){"use strict";var r=n(85893),l=n(67294),i=n(95996),a=n(76740);t.Z=e=>{let{list:t={}}=e,[n,s]=(0,l.useState)({}),o=(0,l.useMemo)(()=>Object.keys(t),[t]),u=(0,l.useMemo)(()=>Object.keys(n),[n]),d=(0,l.useMemo)(()=>u.length===o.length,[u.length,o.length]),c=(0,l.useMemo)(()=>u.length>0,[u.length]),m=(0,l.useMemo)(()=>o.length>1,[o.length]),h=(0,l.useCallback)(e=>{let{confirmDialogProps:t={},formSummaryProps:l={},getConfirmDialogTitle:i,onProceedAppend:s,renderEntry:o}=e;return{actionProceedText:"Delete",content:(0,r.jsx)(a.Z,{entries:n,maxDepth:0,renderEntry:o,...l}),onProceedAppend:s,proceedColour:"red",titleText:i(u.length),...t}},[n,u.length]),p=(0,l.useCallback)(e=>!!n[e],[n]);return{buildDeleteDialogProps:h,checklist:n,checks:u,getCheck:p,hasAllChecks:d,hasChecks:c,multipleItems:m,resetChecks:(0,l.useCallback)(()=>s({}),[]),setAllChecks:(0,l.useCallback)(e=>s(o.reduce((t,n)=>(e&&(t[n]=e),t),{})),[o]),setCheck:(0,l.useCallback)((e,t)=>s((0,i.ZP)(e,t||void 0)),[])}}},40657:function(e,t,n){"use strict";var r=n(85893),l=n(67294),i=n(47177),a=n(29873);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initial:{actionProceedText:t="",content:n="",titleText:s="",...o}={}}=e,u=(0,l.useRef)(null),[d,c]=(0,l.useState)({actionProceedText:t,content:n,titleText:s}),m=(0,l.useCallback)(e=>c(t=>{let{loading:n,...r}=t;return{...r,loading:e}}),[]),h=(0,l.useCallback)(e=>{var t,n;return null==u?void 0:null===(n=u.current)||void 0===n?void 0:null===(t=n.setOpen)||void 0===t?void 0:t.call(null,e)},[]),p=(0,l.useCallback)((e,t)=>c({actionProceedText:"",content:(0,r.jsx)(a.Z,{...t}),showActionArea:!1,showClose:!0,titleText:e}),[]);return{confirmDialog:(0,l.useMemo)(()=>(0,r.jsx)(i.Z,{...o,...d,ref:u}),[d,o]),confirmDialogRef:u,setConfirmDialogLoading:m,setConfirmDialogOpen:h,setConfirmDialogProps:c,finishConfirm:p}}},2094:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var r=n(20512),l=n(18446),i=n.n(l),a=n(13218),s=n.n(a),o=n(47037),u=n.n(o),d=n(67294),c=n(23279),m=n.n(c),h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{wait:n=500,...r}=t;return m()(e,n,r)},p=n(46671);let g=(e,t,n)=>{let[r,...l]=u()(t)?t.split("."):t;if(!(r in e))return!1;let a=e[r],o=n[r];return s()(a)&&s()(o)&&l.length?g(a,l,o):!i()(a,o)};var v=e=>{let t=(0,d.useRef)({}),n=(0,d.useCallback)(e=>(0,r.u9)(t.current,e),[]),l=(0,d.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.current=(0,r.tP)(t.current,e,n)},[]),[i,a]=(0,d.useState)(!1),s=(0,r.TA)({...e}),o=(0,d.useMemo)(()=>{let e=h(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.handleChange(...t),a(!1)});return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];a(!0);let[i]=n;u()(i)||l((i.target?i.target:i.currentTarget).name,!0),e(...n)}},[s.handleChange,l]),c=(0,d.useCallback)(e=>g(s.values,e,s.initialValues),[s.initialValues,s.values]),m=(0,d.useCallback)(async function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[r]=t;l(r,!0),await s.setFieldValue(...t)},[s.setFieldValue,l]),v=(0,d.useMemo)(()=>i||!s.dirty||!s.isValid||s.isValidating||s.isSubmitting,[i,s.dirty,s.isSubmitting,s.isValid,s.isValidating]),x=(0,d.useMemo)(()=>(0,p.Z)(s.errors,{skip:e=>!n(e)}),[s.errors,n]);return{changeFieldValue:m,disabledSubmit:v,formik:s,formikErrors:x,getFieldChanged:n,getFieldIsDiff:c,handleChange:o,setFieldChanged:l}}},39806:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=e=>e.reduce((e,t)=>{let{hostName:n,hostType:r,hostUUID:l,shortHostName:i}=t;return e[l]={name:n,short:i,type:r,uuid:l},e},{}),l=e=>e.reduce((e,t)=>{let{anvilDescription:n,anvilName:l,anvilUUID:i,hosts:a}=t;return e[i]={description:n,hosts:r(a),name:l,uuid:i},e},{})},95996:function(e,t,n){"use strict";n.d(t,{Um:function(){return l}});let r=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,r,l,i]=t;void 0!==i&&(r[l]=i)},l=function(e,t){let{set:n=r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=>{let l={};return Object.keys(r).forEach(i=>{e.test(i)?n(r,l,i,t):l[i]=r[i]}),l}};t.ZP=function(e,t){let{guard:n=()=>!0,set:l=r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=>{let{[e]:i,...a}=r,s={...a};return n(r,e,t)&&l(r,s,e,t),s}}},95954:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Q}});var r=n(85893),l=n(8506),i=n(9008),a=n.n(i),s=n(25436),o=n(37906),u=n(67294),d=n(25934),c=n(42050),m=n(66389),h=n(5387),p=n(76740),g=n(11100),v=n(16310),x=n(74178),f=n(48313);let j=v.Rx().oneOf([0,1,2,3,4]),Z=v.Ry({delete:v.O7().optional(),level:j.required(),target:v.Ry({type:v.Z_().oneOf(["node","subnode"]).required(),uuid:(0,f.uI)().required()}),uuid:(0,f.uI)().optional()}),y=v.Vo(e=>v.Ry((0,x.Z)(e,Z))),b=v.Ry({alertOverrides:y,email:v.Z_().email().required(),language:v.Z_().oneOf(["en_CA"]).optional(),level:j.required(),name:v.Z_().required(),uuid:(0,f.uI)().optional()}),C=v.Vo(e=>v.Ry((0,x.Z)(e,b)));var A=n(48801),w=n(45328),P=n(37628),O=n(57882),M=n(12823);let k=[{displayValue:"Ignore",value:0},{displayValue:"Critical",value:1},{displayValue:"Warning",value:2},{displayValue:"Notice",value:3},{displayValue:"Info",value:4}];var F=e=>{let{alertOverrideTargetOptions:t,alertOverrideValueId:n,mailRecipientUuid:i,formikUtils:a}=e,s=(0,u.useMemo)(()=>null!=n?n:(0,d.Z)(),[n]),{formik:o}=a,{values:{[i]:c}}=o,{alertOverrides:{[s]:m}}=c,p=(0,u.useMemo)(()=>"".concat(i,".alertOverrides.").concat(s),[s,i]),g=(0,u.useMemo)(()=>"".concat(p,".remove"),[p]),v=(0,u.useMemo)(()=>"".concat(p,".target"),[p]),x=(0,u.useMemo)(()=>"".concat(p,".level"),[p]);return(0,r.jsxs)(l.ZP,{alignItems:"center",columns:{xs:1,sm:10},container:!0,justifyContent:"stretch",spacing:"1em",children:[(0,r.jsx)(l.ZP,{item:!0,xs:6,children:(0,r.jsx)(A.Z,{getOptionLabel:e=>e.name,id:v,isOptionEqualToValue:(e,t)=>e.uuid===t.uuid,label:"Target",noOptionsText:"No node or subnode found.",onChange:(e,t)=>o.setFieldValue(v,t,!0),openOnFocus:!0,options:t,renderOption:(e,t)=>(0,u.createElement)("li",{...e,key:"".concat(t.node,"-").concat(t.uuid)},"node"===t.type?(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(O.Ac,{inheritColour:!0,children:t.name}),(0,r.jsx)(O.KI,{inheritColour:!0,children:t.description})]}):(0,r.jsx)(O.Ac,{inheritColour:!0,paddingLeft:".6em",children:t.name})),value:m.target})}),(0,r.jsx)(l.ZP,{item:!0,flexGrow:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(P.Z,{id:x,label:"Alert level",name:x,onChange:o.handleChange,selectItems:k,value:m.level})})}),(0,r.jsx)(l.ZP,{item:!0,width:"min-content",children:(0,r.jsx)(w.Z,{mapPreset:"delete",onClick:()=>{m.uuids?o.setFieldValue(g,!0,!0):o.setValues(e=>{let t={...e},{[i]:n}=t,{[s]:r,...l}=n.alertOverrides;return n.alertOverrides={...l},t})},size:"small"})})]})},S=n(18541),I=e=>{let{alertOverrideTargetOptions:t,formikUtils:n,mailRecipientUuid:l}=e,{formik:i}=n,{values:{[l]:a}}=i,{alertOverrides:s}=a;return(0,r.jsx)(S.Z,{allowAddItem:!0,edit:!0,header:"Alert override rules",listEmpty:"No alert overrides(s)",listItems:s,onAdd:()=>{let e=(0,d.Z)();i.setValues(t=>{let n={...t},{[l]:r}=n;return r.alertOverrides={...r.alertOverrides,[e]:{level:2,target:null}},n})},renderListItem:(e,i)=>!i.remove&&(0,r.jsx)(F,{alertOverrideTargetOptions:t,alertOverrideValueId:e,formikUtils:n,mailRecipientUuid:l})})},D=n(18050),V=n(23852),E=n(2094);let _=[{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(O.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Critical"}),(0,r.jsx)(O.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that could lead to imminent service interruption or unexpected loss of redundancy."})]}),value:1},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(O.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Warning"}),(0,r.jsx)(O.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that require attention from administrators, such as redundancy loss due to load shedding, hardware in pre-failure, input power loss, temperature anomalies, etc."})]}),value:2},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(O.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Notice"}),(0,r.jsx)(O.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that are generally safe to ignore, but might provide early warnings of developing issues or insight into system behaviour."})]}),value:3},{displayValue:(0,r.jsxs)(h.Z,{spacing:0,children:[(0,r.jsx)(O.Ac,{inheritColour:!0,fontWeight:"inherit",children:"Info"}),(0,r.jsx)(O.KI,{inheritColour:!0,whiteSpace:"normal",children:"Alerts that are almost always safe to ignore, but may be useful in testing and debugging."})]}),value:4}],U={1:"Critical",2:"Warning",3:"Notice",4:"Info"},N=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/alert-override",{uuid:r}=e;return r?Object.values(e.alertOverrides).reduce((e,t)=>{let{remove:l,level:i,target:a,uuids:s}=t;if(s&&e.push(...Object.keys(s).map(e=>({method:"delete",url:"".concat(n,"/").concat(e)}))),a&&!l){var o;let t=null!==(o=a.subnodes)&&void 0!==o?o:[a.uuid];e.push(...t.map(e=>({body:{hostUuid:e,level:i,mailRecipientUuid:r},method:"post",url:n})))}return e},[]):[]};var q=e=>{let{alertOverrideTargetOptions:t,mailRecipientUuid:n,previousFormikValues:i,tools:a}=e,s=(0,u.useMemo)(()=>null!=n?n:(0,d.Z)(),[n]),h=(0,E.Z)({initialValues:null!=i?i:{[s]:{alertOverrides:{},email:"",language:"en_CA",level:2,name:""}},onSubmit:(e,t)=>{let{setSubmitting:n}=t,{[s]:l}=e,o="Add",u=(0,r.jsx)(r.Fragment,{children:"Failed to add mail recipient."}),d="post",c=(0,r.jsx)(r.Fragment,{children:"Mail recipient added."}),h="Add mail recipient with the following?",v="/mail-recipient";i&&(o="Update",u=(0,r.jsx)(r.Fragment,{children:"Failed to update mail server."}),d="put",c=(0,r.jsx)(r.Fragment,{children:"Mail recipient updated."}),h="Update ".concat(l.name," with the following?"),v+="/".concat(s));let{alertOverrides:x,uuid:f,...j}=l;a.confirm.prepare({actionProceedText:o,content:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{entries:j}),(0,r.jsx)(p.Z,{entries:{alertOverrides:Object.entries(x).reduce((e,t)=>{let[n,r]=t;return r.remove||!r.target||(e[n]={level:r.level,name:r.target.name}),e},{})}})]}),onCancelAppend:()=>n(!1),onProceedAppend:async()=>{a.confirm.loading(!0);let e=e=>{let t=(0,g.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:[u," ",t.children]}),a.confirm.finish("Error",t),n(!1)};m.Z[d](v,j).then(t=>{let{data:n}=t,r={...l};n&&(r.uuid=n.uuid),Promise.all(N(r,i&&i[s]).map(e=>m.Z[e.method](e.url,e.body))).then(()=>{a.confirm.finish("Success",{children:c}),a["post"===d?"add":"edit"].open(!1)}).catch(e)}).catch(e)},titleText:h}),a.confirm.open(!0)},validationSchema:C}),{disabledSubmit:v,formik:x,formikErrors:f,handleChange:j}=h,Z=(0,u.useMemo)(()=>"".concat(s,".email"),[s]),y=(0,u.useMemo)(()=>"".concat(s,".level"),[s]),b=(0,u.useMemo)(()=>"".concat(s,".name"),[s]);return(0,r.jsxs)(l.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),x.submitForm()},spacing:"1em",children:[(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{id:b,label:"Recipient name",name:b,onChange:j,required:!0,value:x.values[s].name})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{id:Z,label:"Recipient email",name:Z,onChange:j,required:!0,value:x.values[s].email})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(P.Z,{id:y,label:"Alert level",name:y,onChange:x.handleChange,required:!0,selectItems:_,selectProps:{MenuProps:{sx:{["& .".concat(o.Z.paper)]:{maxWidth:{md:"60%",lg:"40%"}}}},renderValue:e=>U[e]},value:x.values[s].level})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(I,{alertOverrideTargetOptions:t,formikUtils:h,mailRecipientUuid:s})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(D.Z,{count:1,messages:f})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(c.Z,{actions:[{background:"blue",children:i?"Update":"Add",disabled:v,type:"submit"}]})})]})},R=n(39806),T=n(73846),L=e=>(0,r.jsx)(q,{...e}),H=n(71108),W=n(5499),K=()=>{let[e,t]=(0,u.useState)(),{altData:n,loading:l}=(0,W.Z)("/anvil",{mod:R.Z}),i=(0,u.useMemo)(()=>n&&Object.values(n).sort((e,t)=>e.name.localeCompare(t.name)).reduce((e,t)=>{let n={description:t.description,name:t.name,node:t.uuid,subnodes:[],type:"node",uuid:t.uuid},r=Object.values(t.hosts).sort((e,t)=>e.name.localeCompare(t.name)).reduce((e,r)=>{var l;return"dr"===r.type||(e.push({name:r.name,node:t.uuid,type:"subnode",uuid:r.uuid}),null===(l=n.subnodes)||void 0===l||l.push(r.uuid)),e},[]);return e.push(n,...r),e},[]),[n]),{fetch:a,loading:s}=(0,H.Z)({onData:e=>t(e),url:"/alert-override"}),o=(0,u.useMemo)(()=>{if(n&&e)return Object.entries(Object.values(e).reduce((e,t)=>{let{node:{uuid:n}}=t;return e[n]?e[n].push(t):e[n]=[t],e},{})).reduce((e,t)=>{let[r,l]=t,[i,...a]=l;if(l.length>1&&a.every(e=>{let{level:t}=e;return t===i.level})){let{0:{level:t}}=l,{[r]:i}=n;e[r]={level:t,target:{description:i.description,name:i.name,node:i.uuid,subnodes:l.map(e=>{let{subnode:{uuid:t}}=e;return t}),type:"node",uuid:i.uuid},uuids:l.reduce((e,t)=>{let{subnode:n,uuid:r}=t;return e[r]=n.uuid,e},{})}}else l.forEach(t=>{let{level:n,node:r,subnode:l,uuid:i}=t;e[l.uuid]={level:n,target:{name:l.name,node:r.uuid,type:"subnode",uuid:l.uuid},uuids:{[i]:l.uuid}}});return e},{})},[e,n]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(T.Z,{addHeader:"Add mail recipient",editHeader:e=>"Update ".concat(null==e?void 0:e.name),entriesUrl:"/mail-recipient",getAddLoading:e=>e||l,getDeleteErrorMessage:e=>{let{children:t,...n}=e;return{...n,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete mail recipient(s). ",t]})}},getDeleteHeader:e=>"Delete the following ".concat(e," mail recipient(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted mail recipient(s)."})}),getEditLoading:e=>e||s,listEmpty:"No mail recipient(s) found.",onItemClick:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[,l]=n;e(...n),a(void 0,{params:{"mail-recipient":l}})},renderAddForm:e=>i&&(0,r.jsx)(q,{alertOverrideTargetOptions:i,tools:e}),renderDeleteItem:(e,t)=>{let{key:n}=t,l=null==e?void 0:e[n];return(0,r.jsx)(O.Ac,{children:null==l?void 0:l.name})},renderEditForm:(e,t)=>i&&t&&o&&(0,r.jsx)(L,{alertOverrideTargetOptions:i,mailRecipientUuid:t.uuid,previousFormikValues:{[t.uuid]:{alertOverrides:o,...t}},tools:e}),renderListItem:(e,t)=>{let{name:n}=t;return(0,r.jsx)(O.Ac,{children:n})}})})};let J=v.Ry({address:v.Z_().required(),authentication:v.Z_().oneOf(["none","plain-text","encrypted"]),confirmPassword:v.Z_().when("password",(e,t)=>String(e).length>0?t.required().oneOf([v.iH("password")]):t.optional()),heloDomain:v.Z_().required(),password:v.Z_().optional(),port:v.Rx().required(),security:v.Z_().oneOf(["none","starttls","tls-ssl"]),username:v.Z_().optional(),uuid:(0,f.uI)().required()}),X=v.Vo(e=>v.Ry((0,x.Z)(e,J)));var z=e=>{let{localhostDomain:t="",mailServerUuid:n,previousFormikValues:i,tools:a}=e,s=(0,u.useMemo)(()=>null!=n?n:(0,d.Z)(),[n]),{disabledSubmit:o,formik:h,formikErrors:v,handleChange:x}=(0,E.Z)({initialValues:null!=i?i:{[s]:{address:"",authentication:"none",heloDomain:t,port:587,security:"none",uuid:s}},onSubmit:(e,t)=>{let{setSubmitting:n}=t,{[s]:l}=e,o="Add",u=(0,r.jsx)(r.Fragment,{children:"Failed to add mail server."}),d="post",c=(0,r.jsx)(r.Fragment,{children:"Mail server added."}),h="Add mail server with the following?",v="/mail-server";i&&(o="Update",u=(0,r.jsx)(r.Fragment,{children:"Failed to update mail server."}),d="put",c=(0,r.jsx)(r.Fragment,{children:"Mail server updated."}),h="Update ".concat(l.address,":").concat(l.port," with the following?"),v+="/".concat(s));let{confirmPassword:x,uuid:f,...j}=l;a.confirm.prepare({actionProceedText:o,content:(0,r.jsx)(p.Z,{entries:j,hasPassword:!0}),onCancelAppend:()=>n(!1),onProceedAppend:()=>{a.confirm.loading(!0),m.Z[d](v,l).then(()=>{a.confirm.finish("Success",{children:c}),a["post"===d?"add":"edit"].open(!1)}).catch(e=>{let t=(0,g.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:[u," ",t.children]}),a.confirm.finish("Error",t),n(!1)})},titleText:h}),a.confirm.open(!0)},validationSchema:X}),f=(0,u.useMemo)(()=>"".concat(s,".address"),[s]),j=(0,u.useMemo)(()=>"".concat(s,".authentication"),[s]),Z=(0,u.useMemo)(()=>"".concat(s,".confirmPassword"),[s]),y=(0,u.useMemo)(()=>"".concat(s,".heloDomain"),[s]),b=(0,u.useMemo)(()=>"".concat(s,".password"),[s]),C=(0,u.useMemo)(()=>"".concat(s,".port"),[s]),A=(0,u.useMemo)(()=>"".concat(s,".security"),[s]),w=(0,u.useMemo)(()=>"".concat(s,".username"),[s]);return(0,r.jsxs)(l.ZP,{component:"form",onSubmit:e=>{e.preventDefault(),h.submitForm()},container:!0,columns:{xs:1,sm:2},spacing:"1em",children:[(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{id:f,label:"Server address",name:f,onChange:x,required:!0,value:h.values[s].address})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{id:C,label:"Server port",name:C,onChange:x,required:!0,type:"number",value:h.values[s].port})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(P.Z,{id:A,label:"Server security type",name:A,onChange:x,required:!0,selectItems:["none","starttls","tls-ssl"],value:h.values[s].security})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(P.Z,{id:j,label:"Server authentication method",name:j,onChange:x,required:!0,selectItems:["none","plain-text","encrypted"],value:h.values[s].authentication})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{id:y,label:"HELO domain",name:y,onChange:x,required:!0,value:h.values[s].heloDomain})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:w,label:"Server username",name:w,onChange:x,value:h.values[s].username})})}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:b,label:"Server password",name:b,onChange:x,type:"password",value:h.values[s].password})})}),(0,r.jsx)(l.ZP,{display:{xs:"none",sm:"initial"},item:!0,sm:1}),(0,r.jsx)(l.ZP,{item:!0,xs:1,children:(0,r.jsx)(M.Z,{input:(0,r.jsx)(V.Z,{disableAutofill:!0,id:Z,label:"Confirm password",name:Z,onChange:x,type:"password",value:h.values[s].confirmPassword})})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(D.Z,{count:1,messages:v})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(c.Z,{actions:[{background:"blue",children:i?"Update":"Add",disabled:o,type:"submit"}]})})]})},G=e=>(0,r.jsx)(z,{...e}),B=()=>{let{data:e,loading:t}=(0,W.Z)("/host/local");return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(T.Z,{addHeader:"Add mail server",editHeader:e=>"Update ".concat(null==e?void 0:e.address,":").concat(null==e?void 0:e.port),entriesUrl:"/mail-server",getAddLoading:e=>e||t,getDeleteErrorMessage:e=>{let{children:t,...n}=e;return{...n,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete mail server(s). ",t]})}},getDeleteHeader:e=>"Delete the following ".concat(e," mail server(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted mail server(s)."})}),listEmpty:"No mail server(s) found",renderAddForm:t=>e&&(0,r.jsx)(z,{localhostDomain:e.domain,tools:t}),renderDeleteItem:(e,t)=>{let{key:n}=t,l=null==e?void 0:e[n];return(0,r.jsxs)(O.Ac,{children:[null==l?void 0:l.address,":",null==l?void 0:l.port]})},renderEditForm:(e,t)=>t&&(0,r.jsx)(G,{mailServerUuid:t.uuid,previousFormikValues:{[t.uuid]:t},tools:e}),renderListItem:(e,t)=>{let{address:n,port:l}=t;return(0,r.jsxs)(O.Ac,{children:[n,":",l]})}})})},$=n(65375),Q=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{children:(0,r.jsx)("title",{children:"Mail Config"})}),(0,r.jsx)(s.Z,{}),(0,r.jsxs)(l.ZP,{container:!0,columns:{xs:1,md:6,lg:4},children:[(0,r.jsx)(l.ZP,{item:!0,xs:1}),(0,r.jsx)(l.ZP,{item:!0,xs:1,md:4,lg:2,children:(0,r.jsxs)($.s_,{children:[(0,r.jsx)($.V9,{children:(0,r.jsx)(O.z,{children:"Mail config"})}),(0,r.jsx)($.TZ,{expandInitially:!0,header:"Manage mail servers",children:(0,r.jsx)(B,{})}),(0,r.jsx)($.TZ,{expandInitially:!0,header:"Manage mail recipients",children:(0,r.jsx)(K,{})})]})})]})]})}},function(e){e.O(0,[995,256,202,391,126,436,622,888,774,179],function(){return e(e.s=24084)}),_N_E=e.O()}]);