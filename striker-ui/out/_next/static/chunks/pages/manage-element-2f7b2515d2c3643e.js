(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[808],{29582:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-element",function(){return n(66409)}])},78533:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(98484),i=n(34003),o=n(97607),a=n(83916),c=n(68805),d=n(85291),u=n(2188),h=n(77510);let m=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"==typeof e?e(...n):e};t.Z=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[p]=t,{addHeader:x,editHeader:f,entriesUrl:j,formDialogProps:g,getAddLoading:v,getDeleteErrorMessage:Z,getDeleteHeader:w,getDeletePromiseChain:b=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},getDeleteSuccessMessage:k,getEditLoading:y=e=>e,listEmpty:P,listProps:M,onItemClick:C=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},refreshInterval:I=5e3,renderAddForm:S,renderDeleteItem:A,renderEditForm:T,renderListItem:F,entryUrlPrefix:U=j}=p,O=(0,s.useRef)(null),N=(0,s.useRef)(null),{confirmDialog:R,finishConfirm:q,setConfirmDialogLoading:E,setConfirmDialogOpen:_,setConfirmDialogProps:D}=(0,u.Z)({initial:{scrollContent:!0}}),[B,H]=(0,s.useState)(!1),[L,V]=(0,s.useState)(),{data:$,mutate:z,loading:W}=(0,h.Z)(j,{refreshInterval:I}),{fetch:G,loading:J}=(0,c.Z)({onData:e=>V(e),url:U}),Q=(0,s.useMemo)(()=>m(x),[x]),K=(0,s.useMemo)(()=>m(f,L),[L,f]),X=(0,s.useMemo)(()=>({add:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==O?void 0:null===(e=O.current)||void 0===e?void 0:e.setOpen(t)}},confirm:{finish:q,loading:E,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return _(e)},prepare:D},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==N?void 0:null===(e=N.current)||void 0===e?void 0:e.setOpen(t)}}}),[q,E,_,D]),{buildDeleteDialogProps:Y,checks:ee,getCheck:et,hasAllChecks:en,hasChecks:er,multipleItems:es,resetChecks:el,setAllChecks:ei,setCheck:eo}=(0,d.Z)({list:$});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{allowCheckAll:es,allowEdit:!0,allowItemButton:B,disableDelete:!er,edit:B,getListCheckboxProps:()=>({checked:en,onChange:(e,t)=>ei(t)}),getListItemCheckboxProps:e=>({checked:et(e),onChange:(t,n)=>eo(e,n)}),header:!0,listEmpty:P,listItems:$,loading:W,onAdd:()=>{var e;return null==O?void 0:null===(e=O.current)||void 0===e?void 0:e.setOpen(!0)},onDelete:()=>{D(Y({onProceedAppend:()=>{E(!0),Promise.all(b((e,t)=>e.map(e=>l.Z.delete("".concat(t,"/").concat(e))),ee,j)).then(()=>{q("Success",k()),z()}).catch(e=>{q("Error",Z((0,o.Z)(e)))}).finally(()=>{el()})},getConfirmDialogTitle:w,renderEntry:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return A($,...t)}})),_(!0)},onEdit:()=>H(e=>!e),onItemClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return C((e,t)=>{var n;null==N||null===(n=N.current)||void 0===n||n.setOpen(!0),G("/".concat(t))},...t)},renderListItem:F,...M}),(0,r.jsx)(i.Js,{header:Q,loading:null==v?void 0:v.call(null),ref:O,showClose:!0,...null==g?void 0:g.common,...null==g?void 0:g.add,children:S(X)}),(0,r.jsx)(i.Js,{header:K,loading:y(J),ref:N,showClose:!0,...null==g?void 0:g.common,...null==g?void 0:g.edit,children:T(X,L)}),R]})}},11399:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(77583);let i=(0,s.forwardRef)((e,t)=>{let{children:n,contentContainerProps:i,dialogProps:o,onSubmitAppend:a,proceedButtonProps:c,scrollBoxProps:d,scrollContent:u,...h}=e,m=(0,s.useMemo)(()=>({...i,component:"form",onSubmit:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[r]=t;r.preventDefault(),null==a||a.call(null,...t)}}),[i,a]),p=(0,s.useMemo)(()=>({...d,sx:u?{overflowX:"hidden",paddingTop:".6em",...null==d?void 0:d.sx}:null==d?void 0:d.sx}),[d,u]);return(0,r.jsx)(l.Z,{dialogProps:o,contentContainerProps:m,proceedButtonProps:{...c,type:"submit"},scrollContent:u,scrollBoxProps:p,wide:!0,...h,ref:t,children:n})});i.displayName="FormDialog",t.Z=i},44089:function(e,t,n){"use strict";var r=n(85893),s=n(14440),l=n(54965),i=n(37969),o=n(38189),a=n(66173),c=n(56903),d=n(59278);let u=e=>{let{entry:t}=e;return(0,r.jsx)(d.$_,{whiteSpace:"nowrap",children:String(t)})},h=e=>{let{entry:t,key:n}=e;return o.JW.test(n)?(0,r.jsx)(d.PJ,{wrapper:"mono",children:String(t)}):u(e)},m=e=>{let{entry:t,hasPassword:n}=e;return["",null,void 0].some(e=>t===e)||Number.isNaN(t)?(0,r.jsx)(d.Ac,{children:"none"}):n?h(e):u(e)},p=e=>{let{depth:t,entry:n,getLabel:l,hasPassword:i,key:o,nest:u,renderValue:h}=e;return(0,r.jsxs)(c.Z,{fullWidth:!0,growFirst:!0,row:!0,maxWidth:"100%",children:[(0,r.jsx)(d.Ac,{children:l({cap:a.Z,depth:t,entry:n,hasPassword:i,key:o})}),(0,r.jsx)(s.Z,{sx:{maxWidth:"100%",overflowX:"scroll"},children:!u&&h(m,{depth:t,entry:n,hasPassword:i,key:o})})]})},x=e=>{let{key:t}=e;return/confirm|uuid/i.test(t)},f=e=>{let{depth:t=0,entries:n,getEntryLabel:s,getListProps:o,getListItemProps:a,hasPassword:c,listKey:d,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:p}=e,j=[];Object.entries(n).forEach(e=>{let[n,i]=e,o=null!==i&&"object"==typeof i,d=o?null:i,g={depth:t,entry:d,hasPassword:c,key:n};p(x,g)||j.push((0,r.jsx)(l.ZP,{sx:{paddingLeft:"".concat(t,"em")},...null==a?void 0:a.call(null,g),children:h({depth:t,entry:d,getLabel:s,hasPassword:c,key:n,nest:o,renderValue:m})},"form-summary-entry-".concat(n))),o&&t<u&&j.push(f({depth:t+1,entries:i,getEntryLabel:s,hasPassword:c,listKey:n,maxDepth:u,renderEntry:h,renderEntryValue:m,skip:p}))});let g="form-summary-list-".concat(null!=d?d:"root");return(0,r.jsx)(i.Z,{dense:!0,disablePadding:!0,...null==o?void 0:o.call(null,{depth:t,entries:n,key:d}),children:j},g)};t.Z=e=>{let{entries:t,getEntryLabel:n=e=>{let{cap:t,key:n}=e;return t(n)},getListProps:r,getListItemProps:s,hasPassword:l=!1,maxDepth:i=3,renderEntry:o=p,renderEntryValue:a=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)},skip:c=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)}}=e;return f({entries:t,getEntryLabel:n,getListProps:r,getListItemProps:s,hasPassword:l,maxDepth:i,renderEntry:o,renderEntryValue:a,skip:c})}},17483:function(e,t,n){"use strict";var r=n(85893),s=n(89262),l=n(41553),i=n(11901),o=n(67294),a=n(77831),c=n(59278);let d=(0,s.ZP)(l.Z)({height:"3.5em",marginLeft:0,width:"100%"});t.Z=e=>{let{baseInputProps:t,checked:n,formControlLabelProps:s,id:l,label:u,name:h,onChange:m,switchProps:p}=e,x=(0,o.useMemo)(()=>"string"==typeof u?(0,r.jsx)(c.Ac,{inheritColour:!0,color:"".concat(a.s7,"AF"),children:u}):(0,r.jsx)(r.Fragment,{children:u}),[u]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d,{componentsProps:{typography:{flexGrow:1}},control:(0,r.jsx)(i.Z,{checked:n,edge:"end",name:h,onChange:m,...p}),label:x,labelPlacement:"start",...s}),(0,r.jsx)("input",{checked:n,hidden:!0,id:l,readOnly:!0,...t})]})}},13562:function(e,t,n){"use strict";var r=n(85893),s=n(89262),l=n(7111),i=n(16826),o=n(67294),a=n(77831),c=n(59278);let d=(0,s.ZP)(l.Z)({borderRadius:a.n_,color:a.s7,padding:".4em .8em",textTransform:"none",["&.".concat(i.Z.selected)]:{color:a.Ej}});t.Z=e=>{let{label:t,...n}=e,s=(0,o.useMemo)(()=>"string"==typeof t?(0,r.jsx)(c.Ac,{inheritColour:!0,children:t}):t,[t]);return(0,r.jsx)(d,{label:s,...n})}},33474:function(e,t,n){"use strict";var r=n(85893),s=n(14440),l=n(67294);t.Z=e=>{let{changingTabId:t,children:n,retain:i=!1,tabId:o}=e,a=(0,l.useMemo)(()=>t===o,[t,o]),c=(0,l.useMemo)(()=>i?(0,r.jsx)(s.Z,{sx:{display:a?"initial":"none"},children:n}):a&&n,[n,a,i]);return(0,r.jsx)(r.Fragment,{children:c})}},11301:function(e,t,n){"use strict";var r=n(85893),s=n(89262),l=n(17038),i=n(93124),o=n(16826),a=n(49360),c=n(63885),d=n(67294),u=n(77831);let h="1.8em",m=(0,s.ZP)(l.Z)({minHeight:"1em",["&.".concat(i.Z.vertical)]:{minHeight:h,["& .".concat(o.Z.root)]:{alignItems:"flex-start",minHeight:h,paddingLeft:"2em"},["& .".concat(i.Z.indicator)]:{right:"initial"}},["& .".concat(o.Z.root)]:{minHeight:"1em"},["& .".concat(i.Z.indicator)]:{backgroundColor:u.Ej,borderRadius:u.n_}});t.Z=e=>{let{orientation:t,variant:n="fullWidth",...s}=e,l=(0,a.Z)(),i=(0,d.useCallback)(e=>l.breakpoints.up(e),[l]),o=(0,c.Z)(i("xs")),u=(0,c.Z)(i("sm")),h=(0,c.Z)(i("md")),p=(0,c.Z)(i("lg")),x=(0,c.Z)(i("xl")),f=(0,d.useMemo)(()=>[["xs",o],["sm",u],["md",h],["lg",p],["xl",x]],[p,h,u,x,o]),j=(0,d.useMemo)(()=>{let e;return"object"==typeof t?f.some(n=>{let[r,s]=n;return s&&t[r]&&(e=t[r]),!s}):e=t,e},[f,t]);return(0,r.jsx)(m,{orientation:j,variant:n,...s})}},68805:function(e,t,n){"use strict";var r=n(67294),s=n(98484),l=n(97607);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{config:t,onError:n,onData:i,url:o=""}=e,[a,c]=(0,r.useState)(!1);return{fetch:(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,a="".concat(o).concat(e);a&&(c(!0),s.Z.get(a,{...t,...r}).then(e=>{let{data:t}=e;null==i||i.call(null,t)}).catch(e=>{let t=(0,l.Z)(e);null==n||n.call(null,t)}).finally(()=>{c(!1)}))},[o,t,i,n]),loading:a}}},85291:function(e,t,n){"use strict";var r=n(85893),s=n(67294),l=n(8534),i=n(44089);t.Z=e=>{let{list:t={}}=e,[n,o]=(0,s.useState)({}),a=(0,s.useMemo)(()=>Object.keys(t),[t]),c=(0,s.useMemo)(()=>Object.keys(n),[n]),d=(0,s.useMemo)(()=>c.length===a.length,[c.length,a.length]),u=(0,s.useMemo)(()=>c.length>0,[c.length]),h=(0,s.useMemo)(()=>a.length>1,[a.length]),m=(0,s.useCallback)(e=>{let{confirmDialogProps:t={},formSummaryProps:s={},getConfirmDialogTitle:l,onProceedAppend:o,renderEntry:a}=e;return{actionProceedText:"Delete",content:(0,r.jsx)(i.Z,{entries:n,maxDepth:0,renderEntry:a,...s}),onProceedAppend:o,proceedColour:"red",titleText:l(c.length),...t}},[n,c.length]),p=(0,s.useCallback)(e=>!!n[e],[n]);return{buildDeleteDialogProps:m,checklist:n,checks:c,getCheck:p,hasAllChecks:d,hasChecks:u,multipleItems:h,resetChecks:(0,s.useCallback)(()=>o({}),[]),setAllChecks:(0,s.useCallback)(e=>o(a.reduce((t,n)=>(e&&(t[n]=e),t),{})),[a]),setCheck:(0,s.useCallback)((e,t)=>o((0,l.ZP)(e,t||void 0)),[])}}},62848:function(e,t,n){"use strict";var r=n(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:n="",...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useState)({actionProceedText:e,content:t,titleText:n,...s})}},66409:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ns}});var r=n(85893),s=n(9008),l=n.n(s),i=n(11163),o=n(67294),a=function(e){let{fallbackValue:t="",joinSeparator:n="",limit:r=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Array?e.slice(0,r).join(n):null!=e?e:t},c=n(82777),d=n(74717),u=n(92230),h=n(38189),m=n(14440),p=n(96674),x=n(89262),f=n(51050),j=n(37842),g=n(56903),v=n(28293),Z=n(91029),w=n(23930),b=n(6189),k=n(17483),y=n(52675),P=n(59278);let M=["1","on"],C=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,setMessage:n},id:r,label:s}=e,l=t(r),i=()=>{n(r)};return"ip"===s.toLowerCase()?(0,y._)(s,i,{onFinishBatch:l},e=>{n(r,{children:e})}):{defaults:{onSuccess:i},onFinishBatch:l,tests:[{test:y.HJ}]}},I=e=>{let{formUtils:t,id:n,isRequired:s,label:l="",name:i=n,value:o}=e,{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:c,setMessage:d}=t;return(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:n,label:l,name:i,value:o}),inputTestBatch:(0,y.qY)(l,()=>{d(n)},{onFinishBatch:a(n)},e=>{d(n,{children:e})}),onFirstRender:c(n),required:s,valueType:"number"},"".concat(n,"-wrapper"))},S={boolean:e=>{let{id:t,isChecked:n=!1,label:s,name:l=t}=e;return(0,r.jsx)(v.Z,{input:(0,r.jsx)(k.Z,{checked:n,id:t,label:s,name:l}),valueType:"boolean"},"".concat(t,"-wrapper"))},integer:I,second:I,select:e=>{let{formUtils:t,id:n,isRequired:s,label:l,name:i=n,selectOptions:o=[],value:a=""}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:d,setMessage:u}=t;return(0,r.jsx)(v.Z,{input:(0,r.jsx)(b.Z,{id:n,label:l,name:i,selectItems:o,value:a}),inputTestBatch:{defaults:{onSuccess:()=>{u(n)}},onFinishBatch:c(n),tests:[{test:y.HJ}]},onFirstRender:d(n),required:s},"".concat(n,"-wrapper"))},string:e=>{let t;let{formUtils:n,id:s,isRequired:l,isSensitive:i=!1,label:o="",name:a=s,value:c}=e,{buildInputFirstRenderFunction:d}=n;return i&&(t=j.Z.password),(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:s,label:o,name:a,type:t,value:c}),inputTestBatch:C({formUtils:n,id:s,label:o}),onFirstRender:d(s),required:l},"".concat(s,"-wrapper"))}},A=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("-")},T=(0,x.ZP)(g.Z)({margin:".4em 0"});var F=e=>{let{fenceId:t,fenceParameterTooltipProps:n,fenceTemplate:s,formUtils:l,previousFenceName:i,previousFenceParameters:a}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:d,setMessage:u}=l,p=(0,o.useMemo)(()=>{let e;if(s&&t){let{parameters:o}=s[t],p={};a&&(p=Object.entries(a).reduce((e,n)=>{let[r,s]=n;return e[A(t,r)]=s,e},{}));let{optional:x,required:j}=Object.entries(o).sort((e,t)=>{let[n]=e,[r]=t;return n>r?1:-1}).reduce((e,s)=>{var i,o;let[a,{content_type:c,default:d,deprecated:u,description:x,options:j,replacement:g,required:v}]=s;if([1===Number(u),g].some(e=>e))return e;let{optional:Z,required:w}=e,b=null!==(i=S[c])&&void 0!==i?i:S.string,k=A(t,a),y=null!==(o=p[k])&&void 0!==o?o:d,C=!/plug|port/i.test(a)&&1===Number(v),I=h.JW.test(a),T=b({formUtils:l,id:k,isChecked:M.includes(y),isRequired:C,isSensitive:I,label:a,selectOptions:j,value:y}),F=(0,r.jsx)(f.Z,{componentsProps:{tooltip:{sx:{maxWidth:{md:"62.6em"}}}},disableInteractive:!0,placement:"top-start",title:(0,r.jsx)(P.Ac,{children:x}),...n,children:(0,r.jsx)(m.Z,{children:T})},"".concat(k,"-tooltip"));return C?w.push(F):Z.push(F),e},{optional:[],required:[]}),b=A(t,"name"),k="Fence device name";e=(0,r.jsxs)(g.Z,{sx:{"& > div:first-child":{marginTop:0},"& > div":{marginBottom:0}},children:[(0,r.jsx)(w.TZ,{expandInitially:!0,header:"Required parameters",children:(0,r.jsxs)(T,{children:[(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:b,label:k,name:b,value:i}),inputTestBatch:(0,y.Gn)(k,()=>{u(b)},{onFinishBatch:c(b)},e=>{u(b,{children:e})}),onFirstRender:d(b),required:!0},"".concat(b,"-wrapper")),j]})}),(0,r.jsx)(w.TZ,{header:"Optional parameters",children:(0,r.jsx)(T,{children:x})})]})}return e},[c,d,t,n,s,l,i,a,u]);return(0,r.jsx)(r.Fragment,{children:p})},U=n(25137),O=n(6631);let N="add-fence-input-agent";var R=e=>{let{fenceTemplate:t,formUtils:n,loading:s}=e,{setValidity:l}=n,i=(0,O.Z)(),[a,c]=(0,o.useState)(null),d=(0,o.useMemo)(()=>t?Object.entries(t).sort((e,t)=>{let[n]=e,[r]=t;return n>r?1:-1}).map(e=>{let[t,{description:n}]=e;return{fenceDescription:"string"==typeof n?n:"No description.",fenceId:t,label:t}}):[],[t]),u=(0,o.useMemo)(()=>(0,r.jsx)(p.Z,{id:N,isOptionEqualToValue:(e,t)=>e.fenceId===t.fenceId,label:"Fence device type",onChange:(e,t)=>{l(N,null!==t),c(t)},openOnFocus:!0,options:d,renderOption:(e,t,n)=>{let{fenceDescription:s,fenceId:l}=t,{selected:i}=n;return(0,r.jsxs)(m.Z,{component:"li",sx:{display:"flex",flexDirection:"column","& > *":{width:"100%"}},...e,children:[(0,r.jsx)(P.Ac,{inverted:!0,sx:{fontSize:"1.2em",fontWeight:i?400:void 0},children:l}),(0,r.jsx)(P.Ac,{selected:!1,children:s})]})},sx:{marginTop:".3em"},value:a}),[d,a,l]),h=(0,o.useMemo)(()=>(0,r.jsx)(F,{fenceId:null==a?void 0:a.fenceId,fenceTemplate:t,formUtils:n}),[t,null==a?void 0:a.fenceId,n]),x=(0,o.useMemo)(()=>s?(0,r.jsx)(U.Z,{}):(0,r.jsxs)(g.Z,{children:[u,h]}),[u,h,s]);return(0,o.useEffect)(()=>{i&&l(N,null!==a)},[a,i,l]),(0,r.jsx)(r.Fragment,{children:x})},q=n(98484),E=n(77583),_=e=>{let{fenceId:t,fenceTemplate:n,formUtils:s,loading:l,previousFenceName:i,previousFenceParameters:a}=e,c=(0,o.useMemo)(()=>l?(0,r.jsx)(U.Z,{}):(0,r.jsx)(F,{fenceId:t,fenceTemplate:n,formUtils:s,previousFenceName:i,previousFenceParameters:a}),[n,t,s,l,i,a]);return(0,r.jsx)(r.Fragment,{children:c})},D=n(11399),B=n(44089),H=n(97607),L=n(83916),V=n(81208),$=n(48430),z=n(85291),W=n(62848),G=n(56907);let J=e=>{let{id:t}=e,n=new RegExp("^(fence[^-]+)".concat("-","([^\\s]+)$")),r=t.match(n);if(!r)throw Error("Not target input element");return r},Q=(e,t,n)=>{if("name"===e)throw t.name=n,Error("Not child parameter")},K=e=>{if(!e)throw Error("Not parameter specification")},X=(e,t)=>{if([t,"",null,void 0].some(t=>e===t))throw Error("Skippable parameter value")},Y=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[{target:s}]=n,{elements:l}=s;return Object.values(l).reduce((t,n)=>{try{let[,r,s]=J(n);t.agent=r;let{checked:l,value:i}=n;Q(s,t,i);let{[r]:{parameters:{[s]:o}}}=e;K(o);let{content_type:a,default:c}=o,d=i;"boolean"===a&&(d=l?"1":""),X(d,c),t.parameters[s]=d}catch(e){}return t},{agent:"",name:"",parameters:{}})};var ee=()=>{let e=(0,O.Z)(),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)({}),[l,i]=(0,W.Z)(),[a,c]=(0,W.Z)(),[d,m]=(0,o.useState)(),[p,x]=(0,o.useState)(),[f,j]=(0,o.useState)(!1),[v,Z]=(0,o.useState)(!0),{isLoading:b}=(0,$.Z)("".concat(u.Z,"/fence"),{onSuccess:e=>m(e),refreshInterval:6e4}),k=(0,o.useCallback)(()=>{q.Z.get("/fence").then(e=>{let{data:t}=e;m(t)})},[m]),y=(0,G.Z)([N],s),{isFormInvalid:M,isFormSubmitting:C,submitForm:I}=y,{buildDeleteDialogProps:S,checks:A,getCheck:T,hasChecks:F,resetChecks:J,setCheck:Q}=(0,z.Z)({list:d}),K=(0,o.useCallback)(e=>{let{cap:t,depth:n,key:r}=e;return 0===n?t(r):r},[]),X=(0,o.useMemo)(()=>(0,r.jsx)(L.Z,{allowEdit:!0,allowItemButton:f,disableDelete:!F,edit:f,header:!0,listEmpty:"No fence device(s) registered.",listItems:d,onAdd:()=>{var e;c({actionProceedText:"Add",content:(0,r.jsx)(R,{fenceTemplate:p,formUtils:y}),onSubmitAppend:e=>{var n;if(!p)return;let s=Y(p,e),{agent:l,name:o}=s;i({actionProceedText:"Add",content:(0,r.jsx)(B.Z,{entries:s,hasPassword:!0,getEntryLabel:K}),onProceedAppend:()=>{I({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add fence device. ",e]}),method:"post",onSuccess:()=>k(),successMsg:"Added fence device ".concat(o),url:"/fence"})},titleText:(0,r.jsxs)(P.z,{children:["Add a"," ",(0,r.jsx)(P.Q0,{fontSize:"inherit",children:l})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a fence device"}),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;i(S({getConfirmDialogTitle:e=>"Delete ".concat(e," fence device(s)?"),onProceedAppend:()=>{I({body:{uuids:A},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to delete fence device(s). ",e]}),method:"delete",onSuccess:()=>{k(),J()},url:"/fence"})},renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(P.Ac,{children:null==d?void 0:d[t].fenceName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{j(e=>!e)},onItemCheckboxChange:(e,t,n)=>{Q(e,n)},onItemClick:e=>{var s;let{fenceAgent:l,fenceName:o,fenceParameters:a,fenceUUID:d}=e;c({actionProceedText:"Update",content:(0,r.jsx)(_,{fenceId:l,fenceTemplate:p,formUtils:y,previousFenceName:o,previousFenceParameters:a}),onSubmitAppend:e=>{var n;if(!p)return;let s=Y(p,e);i({actionProceedText:"Update",content:(0,r.jsx)(B.Z,{entries:s,hasPassword:!0,getEntryLabel:K}),onProceedAppend:()=>{I({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update fence device. ",e]}),method:"put",onSuccess:()=>k(),successMsg:"Updated fence device ".concat(o),url:"/fence/".concat(d)})},titleText:(0,r.jsxs)(P.z,{children:["Update"," ",(0,r.jsx)(P.Q0,{fontSize:"inherit",children:o})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,r.jsxs)(P.z,{children:["Update fence device"," ",(0,r.jsx)(P.Q0,{fontSize:"inherit",children:o})," ","parameters"]})}),null===(s=n.current.setOpen)||void 0===s||s.call(null,!0)},renderListItemCheckboxState:e=>T(e),renderListItem:(e,t)=>{let{fenceAgent:n,fenceName:s,fenceParameters:l}=t;return(0,r.jsxs)(g.Z,{row:!0,children:[(0,r.jsx)(P.Ac,{children:s}),(0,r.jsx)(P.Ac,{children:Object.entries(l).reduce((e,t)=>{let[n,s]=t,l=(0,r.jsxs)(r.Fragment,{children:[n,'="']});return l=h.JW.test(n)?(0,r.jsxs)(r.Fragment,{children:[l,(0,r.jsx)(P.PJ,{wrapper:"mono",children:s})]}):(0,r.jsxs)(r.Fragment,{children:[l,s]}),(0,r.jsxs)(r.Fragment,{children:[e," ",l,'"']})},n)})]})}}),[S,A,d,p,y,T,k,K,F,f,J,Q,i,c,I]),ee=(0,o.useMemo)(()=>v||b?(0,r.jsx)(U.Z,{}):X,[b,v,X]),et=(0,o.useMemo)(()=>(0,r.jsx)(V.Z,{count:1,defaultMessageType:"warning",ref:s}),[]);return e&&q.Z.get("/fence/template").then(e=>{let{data:t}=e;x(t)}).catch(e=>{(0,H.Z)(e)}).finally(()=>{Z(!1)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(P.z,{children:"Manage fence devices"})}),ee]}),(0,r.jsx)(D.Z,{dialogProps:{PaperProps:{sx:{minWidth:{xs:"90%",md:"50em"}}}},scrollBoxProps:{padding:".3em .5em"},...a,disableProceed:M,loadingAction:C,preActionArea:et,ref:n,scrollContent:!0,showClose:!0}),(0,r.jsx)(E.Z,{closeOnProceed:!0,scrollBoxProps:{paddingRight:"1em"},...l,ref:t,scrollContent:!0})]})},et=n(42458),en=n(29535);let er={online:"ok",offline:"off"},es={dr:"DR",node:"Subnode"};var el=e=>{var t;let{data:n}=e,{hostName:s,hostStatus:l,hostType:i,shortHostName:o}=n;return(0,r.jsxs)(g.Z,{row:!0,spacing:".5em",children:[(0,r.jsx)(et.Z,{colour:null!==(t=er[l])&&void 0!==t?t:"warning",sx:{alignSelf:"stretch",height:"auto"}}),(0,r.jsxs)(g.Z,{flexGrow:1,spacing:0,children:[(0,r.jsxs)(g.Z,{sm:"row",spacing:".5em",children:[(0,r.jsx)(P.Ac,{children:es[i]}),(0,r.jsx)(P.$_,{whiteSpace:"nowrap",children:o}),(0,r.jsx)(en.Z,{orientation:"vertical",sx:{alignSelf:"stretch",height:"auto"}}),(0,r.jsx)(P.$_,{sx:{display:{xs:"none",sm:"flex"}},whiteSpace:"nowrap",children:s})]}),(0,r.jsx)(P.Ac,{children:l})]})]})},ei=n(78533),eo=n(34003),ea=n(65895),ec=n(99514),ed=n(4845),eu=n(41553),eh=n(98479),em=n(66950),ep=n(51714),ex=n(17586),ef=n(60504),ej=n(77831),eg=e=>{let{formControlProps:t,formControlLabelProps:n,formLabelProps:s,id:l,label:i,name:a,onChange:c,radioItems:d,radioProps:{sx:u,...h}={},radioGroupProps:m,value:p}=e,x=(0,o.useMemo)(()=>"string"==typeof i?(0,r.jsx)(P.Ac,{children:i}):i,[i]),f=(0,o.useMemo)(()=>Object.entries(d).map(e=>{let[t,{label:s,value:i}]=e,o="string"==typeof s?(0,r.jsx)(P.Ac,{children:s}):s;return(0,r.jsx)(eu.Z,{control:(0,r.jsx)(eh.Z,{...h,sx:{["&.".concat(em.Z.root)]:{color:ej.s7},...u}}),value:i,label:o,...n},"".concat(l,"-").concat(t))}),[n,l,d,u,h]);return(0,r.jsxs)(ep.Z,{...t,children:[(0,r.jsx)(ex.Z,{...s,children:x}),(0,r.jsx)(ef.Z,{id:l,name:a,onChange:c,row:!0,value:p,...m,children:f})]})},ev=n(16310),eZ=n(1322);let ew=ev.Ry().shape({enterpriseKey:(0,eZ.uI)().optional(),ip:(0,eZ.TB)().required(),name:ev.Z_().required(),redhatConfirmPassword:ev.Z_().when("redhatPassword",(e,t)=>String(e).length>0?t.required().oneOf([ev.iH("redhatPassword")]):t.optional()),redhatPassword:ev.Z_().when("redhatUsername",(e,t)=>String(e).length>0?t.required():t.optional()),redhatUsername:ev.Z_().when("redhatPassword",(e,t)=>String(e).length>0?t.required():t.optional()),type:ev.Z_().oneOf(["dr","subnode"]).required(),uuid:(0,eZ.uI)().required()},[["redhatUsername","redhatPassword"]]);var eb=n(12387),ek=n(82547);let ey={subnode:{label:"Subnode",value:"subnode"},dr:{label:"Disaster Recovery (DR) host",value:"dr"}};var eP=e=>{let{host:t,setResponse:n,tools:s}=e,{disabledSubmit:l,formik:i,formikErrors:a,handleChange:c}=(0,ek.Z)({initialValues:{ip:t.hostIpAddress,name:t.hostName,password:t.hostPassword,type:"",uuid:t.hostUUID},onSubmit:(e,t)=>{let{setSubmitting:l}=t,{enterpriseKey:i,ip:o,name:a,password:c,type:d,uuid:u,redhatPassword:h,redhatUsername:m}=e;s.confirm.prepare({actionProceedText:"Prepare",content:(0,r.jsx)(B.Z,{entries:e,hasPassword:!0}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{s.confirm.loading(!0),q.Z.put("/host/prepare",{enterpriseUUID:i,hostIPAddress:o,hostName:a,hostPassword:c,hostType:"subnode"===d?"node":d,hostUUID:u,redhatPassword:h,redhatUser:m}).then(()=>{s.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Started job to prepare host at ",o,"."]})}),s.add.open(!1),setTimeout(n,500)}).catch(e=>{let t=(0,H.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to prepare host at ",o,". ",t.children]}),s.confirm.finish("Error",t),l(!1)})},titleText:"Prepare host at ".concat(e.ip," with the following?")}),s.confirm.open()},validationSchema:ew}),d=(0,o.useMemo)(()=>"enterpriseKey",[]),u=(0,o.useMemo)(()=>"name",[]),h=(0,o.useMemo)(()=>"redhatConfirmPassword",[]),m=(0,o.useMemo)(()=>"redhatPassword",[]),p=(0,o.useMemo)(()=>"redhatUsername",[]),x=(0,o.useMemo)(()=>"type",[]),f=(0,o.useMemo)(()=>t.isInetConnected&&/rhel/i.test(t.hostOS)&&!t.isOSRegistered,[t.hostOS,t.isInetConnected,t.isOSRegistered]);return(0,r.jsxs)(ec.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),i.submitForm()},spacing:"1em",children:[(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(eg,{id:x,label:"Host type",name:x,onChange:c,radioItems:ey,value:i.values.type})})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{id:u,label:"Host name",name:u,onChange:c,required:!0,value:i.values.name})})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{id:d,label:"Alteeve enterprise key",name:d,onChange:c,value:i.values.enterpriseKey})})}),f&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:p,label:"RedHat username",name:p,onChange:c,value:i.values.redhatUsername})})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:m,label:"RedHat password",name:m,onChange:c,type:"password",value:i.values.redhatPassword})})}),(0,r.jsx)(ec.ZP,{display:{xs:"none",sm:"initial"},item:!0,sm:1}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:h,label:"Confirm RedHat password",name:h,onChange:c,type:"password",value:i.values.redhatConfirmPassword})})})]}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(V.Z,{count:1,messages:a})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ed.Z,{actions:[{background:"blue",children:"Prepare host",disabled:l,type:"submit"}]})})]})};let eM=ev.Ry({ip:(0,eZ.TB)().required(),password:ev.Z_().required()});var eC=e=>{let{setResponse:t,tools:n}=e,s=(0,o.useRef)(null),[l,i]=(0,o.useState)(!1),[a,c]=(0,o.useState)([]),d=(0,o.useCallback)(e=>{var t,n;return null===(n=s.current)||void 0===n?void 0:null===(t=n.setMessage)||void 0===t?void 0:t.call(null,"api",e)},[]),{disabledSubmit:u,formik:h,formikErrors:m,handleChange:p}=(0,ek.Z)({initialValues:{ip:"",password:""},onSubmit:(e,s)=>{let{setSubmitting:l}=s;d(),i(!0),c([]),t(void 0);let{ip:o,password:a}=e;q.Z.put("/command/inquire-host",{ipAddress:o,password:a}).then(e=>{let{data:s}=e,{badSshKeys:l,isConnected:i}=s;if(l){d({children:(0,r.jsxs)(r.Fragment,{children:["Host identification at ",o," changed. If this is valid, please delete the conflicting SSH host key."]}),type:"warning"}),c([{background:"red",children:"Delete keys",onClick:()=>{n.confirm.prepare({actionProceedText:"Delete",content:(0,r.jsxs)(P.Ac,{children:["There's a different host key on ",o,", which could mean a MITM attack. But if this change is expected, you can delete the known host key(s) to resolve the conflict."]}),onProceedAppend:()=>{n.confirm.loading(!0),q.Z.delete("/ssh-key/conflict",{data:l}).then(()=>{n.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Started job to delete host key(s) for ",o,"."]})}),c([])}).catch(e=>{let t=(0,H.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to delete host key(s). ",t.children]}),n.confirm.finish("Error",t)})},proceedColour:"red",titleText:"Delete all known SSH host key(s) for ".concat(o,"?")}),n.confirm.open(!0)},type:"button"}]);return}if(!i){d({children:(0,r.jsx)(r.Fragment,{children:"Failed to connect. Please make sure the credentials are correct, and the host is reachable from this striker."}),type:"warning"});return}t({...s,hostIpAddress:o,hostPassword:a}),d()}).catch(e=>{let t=(0,H.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to access ",o,". ",t.children]}),d(t)}).finally(()=>{l(!1),i(!1)})},validationSchema:eM}),x=(0,o.useMemo)(()=>"ip",[]),f=(0,o.useMemo)(()=>"password",[]);return(0,r.jsxs)(ec.ZP,{component:"form",container:!0,columns:{xs:1,sm:2},onSubmit:e=>{e.preventDefault(),h.submitForm()},spacing:"1em",children:[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:x,label:"IP address",name:x,onChange:p,required:!0,value:h.values.ip})})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:f,label:"Password",name:f,onChange:p,required:!0,type:"password",value:h.values.password})})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(V.Z,{count:1,messages:m,ref:s})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:l?(0,r.jsx)(U.Z,{mt:0}):(0,r.jsx)(ed.Z,{actions:[...a,{background:"blue",children:"Test access",disabled:u,type:"submit"}]})})]})},eI=()=>{let[e,t]=(0,o.useState)();return(0,r.jsx)(ei.Z,{formDialogProps:{common:{onClose:function(e){let{handlers:{base:n}}=e;for(var r=arguments.length,s=Array(r>1?r-1:0),l=1;l<r;l++)s[l-1]=arguments[l];null==n||n.call(null,...s),setTimeout(t,500)}}},addHeader:"Initialize host",editHeader:"",entriesUrl:"/host?types=dr,node",entryUrlPrefix:"/host",getDeleteErrorMessage:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return{...n,children:(0,r.jsxs)(r.Fragment,{children:["Failed to delete host(s). ",e]})}},getDeleteHeader:e=>"Delete the following ".concat(e," host(s)?"),getDeleteSuccessMessage:()=>({children:(0,r.jsx)(r.Fragment,{children:"Successfully deleted host(s)"})}),listEmpty:"No host(s) found.",listProps:{allowAddItem:!0,allowEdit:!1,allowItemButton:!0},renderAddForm:n=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eC,{setResponse:t,tools:n}),e&&(0,r.jsx)(eP,{host:e,setResponse:t,tools:n})]}),renderDeleteItem:(e,t)=>{let{key:n}=t,s=null==e?void 0:e[n];return(0,r.jsx)(P.Ac,{children:null==s?void 0:s.shortHostName})},renderEditForm:(e,t)=>t&&(0,r.jsx)(eo.VZ,{children:(0,r.jsx)(B.Z,{entries:t,renderEntryValue:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];let{0:{entry:l,key:i}}=n;return"command"===i?(0,r.jsx)(ea.Z,{iconProps:{fontSize:"small"},mapPreset:"copy",onClick:()=>navigator.clipboard.writeText(String(l)),size:"small"}):e(...n)},hasPassword:!0})}),renderListItem:(e,t)=>(0,r.jsx)(el,{data:t})})},eS=n(13562),eA=n(11301),eT=e=>{let{list:t,setValue:n,value:s}=e;return 0===t.length?(0,r.jsx)(P.Ac,{children:"No host(s) found."}):(0,r.jsx)(eA.Z,{centered:!0,onChange:(e,t)=>{n(t)},orientation:"vertical",value:s,children:t.map(e=>{let{hostConfigured:t,hostStatus:n,hostUUID:s,shortHostName:l}=e;return(0,r.jsx)(eS.Z,{label:(0,r.jsxs)(ec.ZP,{columns:{xs:2},container:!0,spacing:"1em",children:[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{noWrap:!0,children:l})}),(0,r.jsx)(ec.ZP,{borderLeft:"thin solid ".concat(ej.d),item:!0,xs:1,children:(0,r.jsxs)(P.Ac,{noWrap:!0,children:[n,t?", configured":""]})})]}),sx:{textAlign:"left"},value:s},"host-".concat(s))})})},eF=n(85923),eU=n(12059);let eO=ev.Ry({hostName:ev.Z_().required(),networkInit:eU.P});var eN=n(26339),eR=e=>{let{gatewayIface:t,ifaces:n,values:s}=e;return(0,r.jsxs)(ec.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Host name"})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:s.hostName})}),(0,r.jsx)(ec.ZP,{item:!0,sx:{marginTop:"1.4em"},xs:2,children:(0,r.jsx)(P.Ac,{children:"Networks"})}),Object.entries(s.networkInit.networks).map(e=>{let[t,{interfaces:s,ip:l,sequence:i,subnetMask:o,type:a}]=e;return(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsxs)(ec.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,r.jsx)(ec.ZP,{item:!0,xs:2,children:(0,r.jsxs)(P.Ac,{children:[eN.Z[a]," ",i," (",(0,r.jsx)(P.Q0,{children:"".concat(a.toUpperCase()).concat(i)}),")"]})}),s.map((e,s)=>{let l="network-confirm-".concat(t,"-interface").concat(s),i="none";if(""!==e){var o;l="".concat(l,"-").concat(e),i=null===(o=n[e])||void 0===o?void 0:o.name}return(0,r.jsxs)(ec.ZP,{columns:{xs:2},container:!0,item:!0,children:[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Link ".concat(s+1)})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:i})})]},l)}),(0,r.jsx)(ec.ZP,{item:!0,xs:2,children:(0,r.jsx)(P.$_,{children:"".concat(l,"/").concat(o)})})]})},"network-confirm-".concat(t))}),(0,r.jsx)(ec.ZP,{item:!0,sx:{marginBottom:"1.4em"},xs:2}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Gateway"})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:s.networkInit.gateway})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Gateway network"})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:t.toUpperCase()})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Domain name server(s)"})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:s.networkInit.dns})})]})},eq=n(60280);let eE=e=>{let{dns:t="",gateway:n="",hostName:r="",networks:s}=e,l={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"}};return"node"===e.hostType&&(l.defaultifn={interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"},l.defaultsn={interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"sn"}),s&&(l=(0,eq.Z)(s)),{hostName:r,mini:!1,networkInit:{dns:t,gateway:n,networks:l}}};var e_=e=>{let{detail:t,tools:n,uuid:s}=e,l=(0,o.useRef)(null),i=(0,ek.Z)({initialValues:eE(t),onSubmit:(e,s)=>{let{setSubmitting:i}=s,o=(0,eF.Z)(e,l.current);n.confirm.prepare({actionProceedText:"Prepare network",content:l.current&&(0,r.jsx)(eR,{gatewayIface:o.gatewayInterface,ifaces:l.current,values:e}),onCancelAppend:()=>i(!1),onProceedAppend:()=>{n.confirm.loading(!0),q.Z.put("/host/".concat(t.hostUUID,"?handler=subnode-network"),o).then(()=>{n.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started network config on"," ",t.shortHostName]})})}).catch(e=>{let s=(0,H.Z)(e);s.children=(0,r.jsxs)(r.Fragment,{children:["Failed to prepare network on ",t.shortHostName,"."," ",s.children]}),n.confirm.finish("Error",s),i(!1)})},titleText:"Prepare network on ".concat(t.shortHostName," with the following?")}),n.confirm.open()},validationSchema:eO}),{disabledSubmit:a,formik:c,formikErrors:d,handleChange:u}=i,h=(0,o.useMemo)(()=>t.hostType.replace("node","subnode"),[t.hostType]),{parentSequence:m,sequence:p}=(0,o.useMemo)(()=>{let[e,n]=t.shortHostName.replace(/^.*a(\d+).*n(\d+)$/,"$1,$2").split(",",2);return{parentSequence:Number(e),sequence:Number(n)}},[t.shortHostName]),x=(0,o.useMemo)(()=>({hostName:"hostName",mini:"mini",networks:"networkInit.networks"}),[]);return(0,r.jsxs)(ec.ZP,{columns:{xs:1,sm:2,md:3,lg:4},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),c.handleSubmit(e)},spacing:"1em",children:[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{id:x.hostName,label:"Host name",name:x.hostName,onChange:u,required:!0,value:c.values.hostName})})}),(0,r.jsx)(ec.ZP,{display:{xs:"none",md:"initial"},flexGrow:1,item:!0}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(k.Z,{id:x.mini,label:"Minimal config",name:x.mini,onChange:(e,t)=>{if(t){let{defaultbcn:e}=c.values.networkInit.networks;c.setFieldValue(x.networks,{defaultbcn:e},!0)}else c.resetForm();c.handleChange(e)},checked:c.values.mini})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eU.r,{formikUtils:i,host:{parentSequence:m,sequence:p,type:h,uuid:s},onFetchSuccess:e=>{l.current=e}})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(V.Z,{count:1,messages:d})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ed.Z,{actions:[{background:"blue",children:"Prepare network",disabled:a,type:"submit"}]})})]})},eD=n(2188),eB=n(77510),eH=e=>{let{uuid:t}=e,{confirmDialog:n,finishConfirm:s,setConfirmDialogLoading:l,setConfirmDialogOpen:i,setConfirmDialogProps:a}=(0,eD.Z)({initial:{scrollContent:!0,wide:!0}}),c=(0,o.useMemo)(()=>({add:{open:()=>null},confirm:{finish:s,loading:l,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return i(e)},prepare:a},edit:{open:()=>null}}),[s,l,i,a]),{data:d}=(0,eB.Z)("/host/".concat(t));return d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e_,{detail:d,tools:c,uuid:t}),n]}):(0,r.jsx)(U.Z,{mt:0})},eL=n(33474),eV=()=>{let[e,t]=(0,o.useState)(!1),{data:n}=(0,eB.Z)("/host?types=dr,node"),s=(0,o.useMemo)(()=>n&&Object.values(n),[n]);return s?(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(eT,{list:s,setValue:t,value:e}),e&&(0,r.jsx)(en.Z,{sx:{margin:"2em 0"}}),s.map(t=>(0,r.jsx)(eL.Z,{changingTabId:e,tabId:t.hostUUID,children:(0,r.jsx)(eH,{uuid:t.hostUUID})},"cell-".concat(t.hostUUID)))]}):(0,r.jsx)(w.s_,{children:(0,r.jsx)(U.Z,{})})},e$=n(28951),ez=n(99576);let eW="an-host-input",eG="".concat(eW,"-cell"),eJ="IPMI IP",eQ={fence:(e,t)=>{let{dataset:{hostId:n="",fenceId:r="",fenceName:s=""},value:l}=t,{hostConfig:{hosts:{[n]:i}}}=e,{fences:o={}}=i;o[r]={fenceName:s,fencePort:l},i.fences=o},host:(e,t)=>{let{dataset:{hostId:n="",hostNumber:r="",hostType:s=""}}=t,l=Number.parseInt(r,10);e.hostConfig.hosts[n]={hostNumber:l,hostType:s}},ipmi:(e,t)=>{let{dataset:{hostId:n=""},value:r}=t,{hostConfig:{hosts:{[n]:s}}}=e;s.ipmiIp=r},network:(e,t)=>{let{dataset:{hostId:n="",networkId:r="",networkNumber:s="",networkType:l=""},value:i}=t,{hostConfig:{hosts:{[n]:o}}}=e,{networks:a={}}=o,c=Number.parseInt(s,10);a[r]={networkIp:i,networkNumber:c,networkType:l},o.networks=a},ups:(e,t)=>{let{checked:n,dataset:{hostId:r="",upsId:s="",upsName:l=""}}=t,{hostConfig:{hosts:{[r]:i}}}=e,{upses:o={}}=i;o[s]={isUsed:n,upsName:l},i.upses=o}},eK={xs:1,sm:2,md:3},eX=(e,t)=>"".concat(eW,"-").concat(e,"-").concat(t,"-port"),eY=e=>"".concat(eW,"-").concat(e,"-ipmi-ip"),e0=(e,t)=>"".concat(eW,"-").concat(e,"-").concat(t,"-ip"),e1=(e,t)=>"".concat(eW,"-").concat(e,"-").concat(t,"-power-host");var e2=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,buildInputUnmountFunction:s,setMessage:l},hostId:i,hostNumber:a,hostType:d,previous:{fences:u={},ipmiIp:h,networks:m={},upses:p={}}={},hostLabel:x="".concat(d.replace("node","subnode")," ").concat(a)}=e,f=(0,o.useMemo)(()=>Object.entries(u),[u]),j=(0,o.useMemo)(()=>Object.entries(m),[m]),b=(0,o.useMemo)(()=>Object.entries(p),[p]),M=(0,o.useMemo)(()=>!!b.length,[b.length]),C=(0,o.useMemo)(()=>"".concat(eW,"-").concat(i),[i]),I=(0,o.useMemo)(()=>eY(i),[i]),S=(0,o.useMemo)(()=>"".concat(eG,"-").concat(i,"-ipmi-ip"),[i]),A=(0,o.useMemo)(()=>f.reduce((e,s)=>{let[o,{fenceName:a,fencePort:c}]=s,d="".concat(eG,"-").concat(i,"-").concat(o,"-port"),u=eX(i,o),h="Plug on ".concat(a);return e[d]={children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"fence","data-host-id":i,"data-fence-id":o,"data-fence-name":a},id:u,label:h,value:c}),inputTestBatch:(0,y.Gn)("".concat(i," ").concat(h),()=>{l(u)},{onFinishBatch:t(u)},e=>{l(u,{children:e})}),onFirstRender:n(u)})},e},{}),[t,n,f,i,l]),T=(0,o.useMemo)(()=>j.reduce((e,o)=>{let[a,{networkIp:c,networkNumber:d,networkType:u}]=o,h="".concat(eG,"-").concat(i,"-").concat(a,"-ip"),m=e0(i,a),p="".concat(u.toUpperCase()," ").concat(d," IP");return e[h]={children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"network","data-host-id":i,"data-network-id":a,"data-network-number":d,"data-network-type":u},id:m,label:p,value:c}),inputTestBatch:(0,y._)("".concat(i," ").concat(p),()=>{l(m)},{onFinishBatch:t(m)},e=>{l(m,{children:e})}),onFirstRender:n(m),onUnmount:s(m),required:!0})},e},{}),[j,i,t,n,s,l]),F=(0,o.useMemo)(()=>b.reduce((e,t)=>{let[n,{isUsed:s,upsName:l}]=t,o="".concat(eG,"-").concat(i,"-").concat(n,"-power-host"),a=e1(i,n),c="Uses ".concat(l);return e[o]={children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(k.Z,{baseInputProps:{"data-handler":"ups","data-host-id":i,"data-ups-id":n,"data-ups-name":l},checked:s,id:a,label:c}),valueType:"boolean"})},e},{}),[i,b]),U=(0,o.useMemo)(()=>M&&(0,r.jsx)(c.Z,{columns:eK,layout:F,spacing:"1em"}),[M,F]);return(0,r.jsxs)(w.Lg,{mv:0,children:[(0,r.jsx)(w.CH,{children:(0,r.jsx)(P.Ac,{children:x})}),(0,r.jsxs)(w.bc,{children:[(0,r.jsx)("input",{hidden:!0,id:C,readOnly:!0,"data-handler":"host","data-host-id":i,"data-host-number":a,"data-host-type":d}),(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(c.Z,{columns:eK,layout:{"fence-message":{children:(0,r.jsx)(ez.Z,{children:"It is recommended to provide at least 1 fence device plug."}),width:"100%",xs:0},...T,[S]:{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"ipmi","data-host-id":i},id:I,label:eJ,value:h}),inputTestBatch:(0,y._)("".concat(i," ").concat(eJ),()=>{l(I)},{onFinishBatch:t(I)},e=>{l(I,{children:e})}),onFirstRender:n(I),onUnmount:s(I)})},...A},spacing:"1em"}),U]})]})]})};let e8="".concat("".concat("an-host-config-input","-group"),"-cell"),e5={node1:{hostNumber:1,hostType:"node"},node2:{hostNumber:2,hostType:"node"}},e9=e=>{let{anSeq:t,minIp:n,offset3:r=10,step3:s=2,subnetMask:l,subSeq:i}=e;try{let e=new e$.Netmask("".concat(n,"/").concat(l));if(16!==e.bitmask)return"".concat(e.base.replace(/\.0/g,""),".");return n.replace(/^((\d+\.){2})\d+\.\d+$/,"$1".concat((t-1)*s+r,".").concat(i))}catch(e){return""}};var e3=e=>{let{anSequence:t,formUtils:n,knownFences:s={},knownUpses:l={},networkListEntries:i,previous:{hosts:a=e5}={}}=e,d=(0,o.useMemo)(()=>Object.entries(a),[a]),u=(0,o.useMemo)(()=>Object.values(s),[s]),h=(0,o.useMemo)(()=>Object.values(l),[l]),m=(0,o.useMemo)(()=>d.reduce((e,s)=>{let[l,o]=s,{fences:a={},hostNumber:c,hostType:d,ipmiIp:m,networks:p={},upses:x={}}=o,f=m,j=u.reduce((e,t)=>{let{fenceName:n}=t,{[n]:{fencePort:r=""}={}}=a;return e[n]={fenceName:n,fencePort:r},e},{}),g=i.reduce((e,n)=>{let[r,{networkMinIp:s,networkNumber:l,networkSubnetMask:i,networkType:o}]=n,{[r]:{networkIp:a=""}={}}=p;return a||(a=e9({anSeq:t,minIp:s,subnetMask:i,subSeq:c})),f||"bcn"!==o||1!==l||(f=e9({anSeq:t,minIp:s,offset3:11,subnetMask:i,subSeq:c})),e[r]={networkIp:a,networkNumber:l,networkType:o},e},{}),v=h.reduce((e,t)=>{let{upsName:n}=t,{[n]:{isUsed:r=!0}={}}=x;return e[n]={isUsed:r,upsName:n},e},{});return e["".concat(e8,"-").concat(l)]={children:(0,r.jsx)(e2,{formUtils:n,hostId:l,hostNumber:c,hostType:d,previous:{fences:j,ipmiIp:f,networks:g,upses:v}}),md:3,sm:2},e},{}),[t,n,d,u,h,i]);return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:m,spacing:"1em"})},e4=n(23279),e7=n.n(e4);let e6="an-id-input",te="".concat(e6,"-domain"),tt="".concat(e6,"-prefix"),tn="".concat(e6,"-sequence"),tr="Domain name",ts="Prefix",tl="Sequence";var ti=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:s,setMessage:l},onSequenceChange:i,previous:{domain:a,prefix:d,sequence:u}={}}=e,h=(0,o.useMemo)(()=>i&&e7()(i,t),[t,i]);return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:{"an-id-input-cell-prefix":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tt,label:ts,value:d}),inputTestBatch:(0,y.Gn)(ts,()=>{l(tt)},{onFinishBatch:n(tt)},e=>{l(tt,{children:e})}),onFirstRender:s(tt),required:!0})},"an-id-input-cell-domain":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:te,label:tr,value:a}),inputTestBatch:(0,y.Gn)(tr,()=>{l(te)},{onFinishBatch:n(te)},e=>{l(te,{children:e})}),onFirstRender:s(te),required:!0})},"an-id-input-cell-sequence":{children:(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:h},input:(0,r.jsx)(Z.Z,{id:tn,label:tl,value:u}),inputTestBatch:(0,y.qY)(tl,()=>{l(tn)},{onFinishBatch:n(tn)},e=>{l(tn,{children:e})}),onFirstRender:s(tn),required:!0,valueType:"number"})}},spacing:"1em"})},to=n(25934);let ta="an-network-input",tc="".concat(ta,"-cell"),td={gateway:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkGateway=r},minip:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkMinIp=r},network:(e,t)=>{let{dataset:{networkId:n="",networkNumber:r="",networkType:s=""}}=t,{networkConfig:{networks:l}}=e,i=Number.parseInt(r,10);l[n]={networkNumber:i,networkType:s}},subnetmask:(e,t)=>{let{dataset:{networkId:n=""},value:r}=t,{networkConfig:{networks:s}}=e;s[n].networkSubnetMask=r}},tu=e=>"".concat(ta,"-").concat(e,"-gateway"),th=e=>"".concat(ta,"-").concat(e,"-min-ip"),tm=e=>"".concat(ta,"-").concat(e,"-network-type"),tp=e=>"".concat(ta,"-").concat(e,"-subnet-mask");var tx=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:s,buildInputUnmountFunction:l,setMessage:i},inputGatewayLabel:a="Gateway",inputMinIpLabel:d="IP address",inputSubnetMaskLabel:u="Subnet mask",networkId:h,networkNumber:m,networkType:p,networkTypeOptions:x,onClose:f,onNetworkGatewayChange:j,onNetworkMinIpChange:g,onNetworkSubnetMaskChange:k,onNetworkTypeChange:P,previous:{gateway:M,minIp:C,subnetMask:I}={},readonlyNetworkName:S,showCloseButton:A,showGateway:T}=e,F=(0,o.useMemo)(()=>"".concat(eN.Z[p]," ").concat(m),[m,p]),U=(0,o.useMemo)(()=>"".concat(tc,"-").concat(h,"-gateway"),[h]),O=(0,o.useMemo)(()=>"".concat(tc,"-").concat(h,"-ip"),[h]),N=(0,o.useMemo)(()=>"".concat(tc,"-").concat(h,"-subnet-mask"),[h]),R=(0,o.useMemo)(()=>"".concat(ta,"-").concat(h),[h]),q=(0,o.useMemo)(()=>tu(h),[h]),E=(0,o.useMemo)(()=>th(h),[h]),_=(0,o.useMemo)(()=>tm(h),[h]),D=(0,o.useMemo)(()=>tp(h),[h]),B=(0,o.useMemo)(()=>T?void 0:"none",[T]),H=(0,o.useMemo)(()=>j&&e7()(j,t),[t,j]),L=(0,o.useMemo)(()=>g&&e7()(g,t),[t,g]),V=(0,o.useMemo)(()=>k&&e7()(k,t),[t,k]),$=(0,o.useMemo)(()=>A&&(0,r.jsx)(ea.Z,{mapPreset:"close",iconProps:{fontSize:"small"},onClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==f||f.call(null,{networkId:h,networkType:p},...t)},sx:{padding:".2em",position:"absolute",right:"-.6rem",top:"-.2rem"}}),[A,h,p,f]),z=(0,o.useMemo)(()=>{let e;return T&&q&&(e=(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==H?void 0:H.call(null,{networkId:h,networkType:p},...t)}},input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"gateway","data-network-id":h},id:q,label:a,value:M}),inputTestBatch:(0,y._)("".concat(F," ").concat(a),()=>{i(q)},{onFinishBatch:n(q)},e=>{i(q,{children:e})}),onFirstRender:s(q),onUnmount:l(q),required:T})),e},[T,q,h,a,M,F,n,s,l,H,p,i]);return(0,r.jsxs)(w.Lg,{mv:0,children:[(0,r.jsxs)(w.CH,{children:[(0,r.jsx)(v.Z,{input:(0,r.jsx)(b.Z,{id:_,isReadOnly:S,onChange:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==P||P.call(null,{networkId:h,networkType:p},...t)},selectItems:x,selectProps:{renderValue:()=>F},value:p})}),$]}),(0,r.jsxs)(w.bc,{children:[(0,r.jsx)("input",{hidden:!0,id:R,readOnly:!0,"data-handler":"network","data-network-id":h,"data-network-number":m,"data-network-type":p}),(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:{[O]:{children:(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==L?void 0:L.call(null,{networkId:h,networkType:p},...t)}},input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"minip","data-network-id":h},id:E,label:d,value:C}),inputTestBatch:(0,y._)("".concat(F," ").concat(d),()=>{i(E)},{onFinishBatch:n(E)},e=>{i(E,{children:e})}),onFirstRender:s(E),onUnmount:l(E),required:!0})},[N]:{children:(0,r.jsx)(v.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==V?void 0:V.call(null,{networkId:h,networkType:p},...t)}},input:(0,r.jsx)(Z.Z,{baseInputProps:{"data-handler":"subnetmask","data-network-id":h},id:D,label:u,value:I}),inputTestBatch:(0,y._)("".concat(F," ").concat(u),()=>{i(D)},{onFinishBatch:n(D)},e=>{i(D,{children:e})}),onFirstRender:s(D),onUnmount:l(D),required:!0})},[U]:{children:z,display:B}},spacing:"1em"})]})]})},tf=n(8534);let tj="an-network-config-input",tg="".concat(tj,"-cell"),tv="".concat(tj,"-dns"),tZ="".concat(tj,"-ntp"),tw=Object.entries(eN.Z),tb={bcn:{base:"10.201.0.0",mask:"255.255.0.0"},mn:{base:"10.199.0.0",mask:"255.255.0.0"},sn:{base:"10.101.0.0",mask:"255.255.0.0"}},tk=e=>"ifn"===e,ty=e=>"mn"===e,tP=e=>{let{entries:t,type:n}=e,r=t.filter(e=>{let[,{networkType:t}]=e;return t===n}).sort((e,t)=>{let[,{networkNumber:n}]=e,[,{networkNumber:r}]=t;return n>r?1:-1}).pop();if(!r){var s;return null!==(s=tb[n])&&void 0!==s?s:{}}let[,{networkMinIp:l,networkSubnetMask:i}]=r;try{let{base:e,mask:t}=new e$.Netmask("".concat(l,"/").concat(i)).next();return{base:e,mask:t}}catch(e){return{}}};var tM=e=>{let{formUtils:t,networkListEntries:n,previous:{dnsCsv:s="8.8.8.8,8.8.4.4",ntpCsv:l}={},setNetworkList:i}=e,{buildFinishInputTestBatchFunction:a,buildInputFirstRenderFunction:d,setMessage:u,setMessageRe:h}=t,m=(0,o.useCallback)(function(e){let{input:t=n,end:r=n.length}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r-1,l=0;return t.every((t,n)=>{let[,{networkType:r}]=t;return r===e&&(l+=1),n<s}),l},[n]),p=(0,o.useMemo)(()=>tw.map(e=>{let[t,n]=e;return{displayValue:n,value:t}}),[]),x=(0,o.useCallback)(function(){let{networkMinIp:e="",networkSubnetMask:t="",networkType:r=n.some(e=>{let[,{networkType:t}]=e;return ty(t)})?"ifn":"mn",networkGateway:s=tk(r)?"":void 0,networkNumber:l=m(r)+1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{base:i=e,mask:o=t}=tP({entries:n,type:r});return{network:{networkGateway:s,networkMinIp:i,networkNumber:l,networkSubnetMask:o,networkType:r},networkId:(0,to.Z)()}},[m,n]),f=(0,o.useCallback)((e,t)=>i((0,tf.ZP)(e,t)),[i]),j=(0,o.useCallback)((e,t,n)=>i(r=>{let s={...r},{[e]:l}=s;return l&&(l[t]=n),s}),[i]),g=(0,o.useCallback)((e,t)=>{let{networkId:r,networkType:s}=e,{target:{value:l}}=t,o=String(l),a=!1,c=0;i(n.reduce((e,t)=>{let[l,i]=t,{networkNumber:d,networkType:u,networkMinIp:m,networkSubnetMask:p,...x}=i,f=d,j=u;l===r&&(a=!0,j=o,h(RegExp(l)));let g=j===o;if(g&&(c+=1),a){g?f=c:j===s&&(f-=1);let{base:t=m,mask:r=p}=tP({entries:n,type:j});e[l]={...x,networkMinIp:t,networkSubnetMask:r,networkNumber:f,networkType:j}}else e[l]=i;return e},{}))},[n,h,i]),w=(0,o.useCallback)(e=>{let{networkId:t,networkType:r}=e,s=!1,l=0;i(n.reduce((e,n)=>{let[i,o]=n;if(i===t)return s=!0,e;let{networkType:a}=o,c=a===r;return c&&(l+=1),e[i]=s&&c?{...o,networkNumber:l}:o,e},{}))},[n,i]),b=(0,o.useMemo)(()=>n.reduce((e,n)=>{let[s,{networkGateway:l,networkMinIp:i,networkNumber:o,networkSubnetMask:a,networkType:c}]=n,d="".concat(tg,"-").concat(s),u=1===o,h=tk(c),m=ty(c)||!u;return e[d]={children:(0,r.jsx)(tx,{formUtils:t,networkId:s,networkNumber:o,networkType:c,networkTypeOptions:p,onClose:w,onNetworkMinIpChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return j(n,"networkMinIp",r)},onNetworkSubnetMaskChange:(e,t)=>{let{networkId:n}=e,{target:{value:r}}=t;return j(n,"networkSubnetMask",r)},onNetworkTypeChange:g,previous:{gateway:l,minIp:i,subnetMask:a},readonlyNetworkName:!m,showCloseButton:m,showGateway:h}),md:3,sm:2},e},{}),[n,t,p,w,g,j]);return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2,md:3},layout:{...b,"an-network-config-cell-add-network":{children:(0,r.jsx)(ea.Z,{mapPreset:"add",onClick:()=>{let{network:e,networkId:t}=x();f(t,e)}}),display:"flex",justifyContent:"center",md:3,sm:2},"an-network-config-input-cell-dns":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tv,label:"DNS",value:s}),inputTestBatch:(0,y.dg)("DNS",()=>{u(tv)},{onFinishBatch:a(tv)},e=>{u(tv,{children:e})}),onFirstRender:d(tv),required:!0})},"an-network-config-input-cell-ntp":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tZ,label:"NTP",value:l}),inputTestBatch:(0,y.dg)("NTP",()=>{u(tZ)},{onFinishBatch:a(tZ)},e=>{u(tZ,{children:e})}),onFirstRender:d(tZ)})}},spacing:"1em"})};let tC={bcn1:{networkMinIp:"10.201.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"bcn"},sn1:{networkMinIp:"10.101.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"sn"},ifn1:{networkMinIp:"",networkNumber:1,networkSubnetMask:"",networkType:"ifn"}};var tI=e=>{var t;let{formUtils:n,knownFences:s,knownUpses:l,previous:{hostConfig:i,networkConfig:a={},...c}={}}=e,{networks:d=tC}=a,[u,h]=(0,o.useState)(null!==(t=null==c?void 0:c.sequence)&&void 0!==t?t:0),[m,p]=(0,o.useState)(d),x=(0,o.useMemo)(()=>Object.entries(m),[m]);return(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(ti,{formUtils:n,onSequenceChange:e=>{let{target:{value:t}}=e;h(Number(t))},previous:c}),(0,r.jsx)(tM,{formUtils:n,networkListEntries:x,previous:a,setNetworkList:p}),(0,r.jsx)(e3,{anSequence:u,formUtils:n,knownFences:s,knownUpses:l,networkListEntries:x,previous:i})]})},tS=e=>{let{formUtils:t,knownFences:n,knownUpses:s,previous:l}=e;return(0,r.jsx)(tI,{formUtils:t,knownFences:n,knownUpses:s,previous:l})},tA=n(50361),tT=n.n(tA),tF=n(45486),tU=n(36026);let tO=ev.Ry({name:ev.Z_().required(),uuid:(0,eZ.uI)().required()}),tN=ev.Ry({anvil:ev.Vo(e=>void 0!==e?tO:ev.nK().optional()),number:ev.Rx(),type:ev.Z_(),uuid:(0,eZ.uI)().required()}),tR=ev.Z_().when("rerun",(e,t)=>e[0]?t.optional():t.required()),tq=ev.Ry({confirmPassword:tR.oneOf([ev.iH("password")]),description:tR,hosts:ev.Vo(e=>ev.Ry((0,tU.Z)(e,tN))),password:tR,rerun:ev.O7().required(),reuseHosts:ev.O7().when("hosts",(e,t)=>Object.values(e[0]).some(e=>!!e.anvil)?t.isTrue():t.isFalse())});var tE=e=>{let{detail:t,knownFences:n,knownHosts:s,knownUpses:l,onSubmitSuccess:i,tools:a}=e,{anvil:c,domain:d,hostConfig:u,networkConfig:h}=t,{hosts:m}=u,{dnsCsv:p,networks:x,ntpCsv:f}=h,v=(0,o.useMemo)(()=>Object.entries(m),[m]),w=(0,o.useMemo)(()=>Object.entries(x),[x]),k=(0,o.useMemo)(()=>Object.entries(n),[n]),y=(0,o.useMemo)(()=>Object.entries(s),[s]),M=(0,o.useMemo)(()=>Object.entries(l),[l]),C=(0,o.useMemo)(()=>y.map(e=>{let[,{anvil:t,hostName:n,hostUUID:s}]=e;return{displayValue:(0,r.jsxs)(g.Z,{spacing:0,children:[(0,r.jsx)(P.Ac,{inverted:!0,children:n}),(0,r.jsx)(P.KI,{inverted:!0,children:t?"Used by ".concat(t.name):"Ready"})]}),value:s}}),[y]),{disabledSubmit:I,formik:S,formikErrors:A,handleChange:T}=(0,ek.Z)({initialValues:{confirmPassword:"",description:"",hosts:v.reduce((e,t)=>{let n;let[r,{hostName:l,hostNumber:i,hostType:o}]=t,a="";if(c){let{hosts:{[i]:{uuid:e}}}=c;a=e;let t=s[e];t&&(n=t.anvil)}else if(l){let e=y.find(e=>{let[,{shortHostName:t}]=e;return t===l});if(e){let[,t]=e;n=t.anvil,a=t.hostUUID}}return e[r]={anvil:n,number:i,type:o,uuid:a},e},{}),password:"",rerun:!!c,reuseHosts:!1},onSubmit:(e,n)=>{let{setSubmitting:l}=n,{confirmPassword:o,rerun:c,reuseHosts:u,hosts:h,...p}=e,x={...c?null:p,hosts:Object.values(h).reduce((e,t)=>{let{number:n,type:r,uuid:l}=t,i="".concat(r).concat(n);return e["".concat(r.replace("node","Subnode")," ").concat(n)]={useHost:s[l].hostName,renameTo:"".concat(m[i].hostName,".").concat(d)},e},{})};a.confirm.prepare({actionProceedText:"Run",content:(0,r.jsx)(B.Z,{entries:x,hasPassword:!0}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{a.confirm.loading(!0),q.Z.put("/command/run-manifest/".concat(t.uuid),e).then(()=>{a.confirm.finish("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully started installing ",t.name]})}),null==i||i.call(null),a.edit.open(!1)}).catch(e=>{let t=(0,H.Z)(e);t.children=(0,r.jsxs)(r.Fragment,{children:["Failed to run install manifest. ",t.children]}),a.confirm.finish("Error",t),l(!1)})},titleText:"Run install manifest ".concat(t.name," with the following?")}),a.confirm.open()},validationSchema:tq}),F=(0,o.useMemo)(()=>"confirmPassword",[]),U=(0,o.useMemo)(()=>"description",[]),O=(0,o.useMemo)(()=>"hosts",[]),N=(0,o.useMemo)(()=>"password",[]),R=(0,o.useMemo)(()=>"reuseHosts",[]),E=(0,o.useMemo)(()=>v.reduce((e,t)=>{let[n,{hostNumber:l,hostType:i}]=t,o="".concat(O,".").concat(n),a="".concat(o,".uuid"),c="".concat(i.replace("node","Subnode")," ").concat(l);return e.push((0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(b.Z,{id:a,label:c,name:a,onChange:e=>{let{target:{value:t}}=e,{[t]:{anvil:r}}=s,o=tT()(S.values.hosts),a=Object.entries(o).find(e=>{let[r,{uuid:s}]=e;return r!==n&&s===t});if(a){let[e,t]=a,{number:r,type:s}=t;o[e]={...o[n],number:r,type:s}}return o[n]={anvil:r,number:l,type:i,uuid:t},S.setFieldValue(O,o)},required:!0,selectItems:C,selectProps:{renderValue:e=>{let{[e]:{hostName:t}}=s;return t}},value:S.values.hosts[n].uuid})},"".concat(n,"-selector"))),e},[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Use host"})},"host-selector-header")]),[S,v,C,O,s]),_=(0,o.useMemo)(()=>v.reduce((e,t)=>{let[n,{hostName:s}]=t;return e.push((0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsxs)(P.$_,{noWrap:!0,children:[s,".",d]})},"".concat(n,"-rename"))),e},[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"New hostname"})},"host-rename-header")]),[v,d]),D=(0,o.useMemo)(()=>w.reduce((e,t)=>{let[n,s]=t,{networkNumber:l,networkType:i}=s,o="".concat(i.toLocaleUpperCase()).concat(l),a=v.map(e=>{let[t,{networks:s}]=e,l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:e})},"".concat(n,"-").concat(t,"-ip"))};if(!s)return l();let{[n]:i}=s;if(!i)return l();let{networkIp:o}=i;return l(o)});return e.push((0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:o})},"".concat(n,"-header")),...a),e},[]),[v,w]),L=(0,o.useMemo)(()=>k.reduce((e,t)=>{let[n,s]=t,{fenceName:l}=s,i=v.map(e=>{let[t,{fences:s}]=e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:e})},"".concat(n,"-").concat(t,"-port"))};if(!s)return i();let{[l]:o}=s;if(!o)return i();let{fencePort:a}=o;return i(a)});return e.push((0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsxs)(P.Ac,{children:["Plug on ",l]})},"".concat(n,"-header")),...i),e},[]),[v,k]),$=(0,o.useMemo)(()=>M.reduce((e,t)=>{let[n,s]=t,{upsName:l}=s,i=v.map(e=>{let[t,{upses:s}]=e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{children:e})},"".concat(n,"-").concat(t,"-used"))};if(!s)return i();let{[l]:o}=s;if(!o)return i();let{isUsed:a}=o;return i(a?"yes":"no")});return e.push((0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsxs)(P.Ac,{children:["Uses ",l]})},"".concat(n,"-header")),...i),e},[]),[v,M]),z=(0,o.useMemo)(()=>{let e;let t=w.find(e=>{let{1:{networkGateway:t}}=e;return!!t}),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{justifyContent:"end",children:e})},"gateway-value")};if(t){let[,{networkGateway:r}]=t;e=r&&r.length>0?n(r):n()}else e=n();return[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"Gateway"})},"gateway-header"),e]},[w]),W=(0,o.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{justifyContent:"end",children:e})},"dns-value")},t=p&&p.length>0?e(p):e();return[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"DNS"})},"dns-header"),t]},[p]),G=(0,o.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.$_,{justifyContent:"end",children:e})},"ntp-value")},t=f&&f.length>0?e(f):e();return[(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(P.Ac,{children:"NTP"})},"ntp-header"),t]},[f]),J=(0,o.useMemo)(()=>{let e=Object.values(S.values.hosts).filter(e=>!!e.anvil);if(0===e.length)return null;let t=e.slice(1).reduce((e,t)=>"".concat(e,", ").concat(s[t.uuid].shortHostName),s[e[0].uuid].shortHostName);return(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(ez.Z,{children:[(0,r.jsx)(tF.Z,{id:R,invert:!0,name:R,onChange:S.handleChange,required:!0,sx:{marginRight:".5em"},thinPadding:!0,value:S.values.reuseHosts}),"Confirm reusing host(s): ",t,"."]})})},[S,s,R]);return(0,r.jsxs)(ec.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),S.submitForm()},spacing:"1em",children:[c?(0,r.jsxs)(ec.ZP,{item:!0,width:"100%",children:[(0,r.jsx)(P.Ac,{children:"Description"}),(0,r.jsx)(P.Ac,{children:c.description})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{id:U,label:"Description",name:U,onChange:T,required:!0,value:S.values.description})})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:N,label:"Password",name:N,onChange:T,required:!0,type:j.Z.password,value:S.values.password})})}),(0,r.jsx)(ec.ZP,{item:!0,xs:1,children:(0,r.jsx)(eb.Z,{input:(0,r.jsx)(Z.Z,{disableAutofill:!0,id:F,label:"Confirm password",name:F,onChange:T,required:!0,type:j.Z.password,value:S.values.confirmPassword})})})]}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(ec.ZP,{alignItems:"center",columns:v.length+1,columnSpacing:"1em",container:!0,rowSpacing:".6em",children:[...E,..._,...D,...L,...$]})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsxs)(ec.ZP,{columns:2,container:!0,spacing:".6em",children:[...z,...W,...G]})}),J,(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(V.Z,{count:1,messages:A})}),(0,r.jsx)(ec.ZP,{item:!0,width:"100%",children:(0,r.jsx)(ed.Z,{actions:[{background:"blue",children:"Run",disabled:I,type:"submit"}]})})]})};let t_=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[{target:r}]=t,{elements:s}=r,{value:l}=s.namedItem(te),{value:i}=s.namedItem(tt),{value:o}=s.namedItem(tn),{value:a}=s.namedItem(tv),{value:c}=s.namedItem(tZ),d=Number.parseInt(o,10);return Object.values(s).reduce((e,t)=>{var n,r;let{id:s}=t;if(RegExp("^".concat(eW)).test(s)){let{dataset:{handler:r=""}}=t;null===(n=eQ[r])||void 0===n||n.call(null,e,t)}else if(RegExp("^".concat(ta)).test(s)){let{dataset:{handler:n=""}}=t;null===(r=td[n])||void 0===r||r.call(null,e,t)}return e},{domain:l,hostConfig:{hosts:{}},networkConfig:{dnsCsv:a,networks:{},ntpCsv:c},prefix:i,sequence:d})};var tD=()=>{let e=(0,o.useRef)({}),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)(null),l=(0,o.useRef)({}),[i,a]=(0,W.Z)(),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(!0),[m,p]=(0,o.useState)(),{data:x,loading:f,mutate:j}=(0,eB.Z)("/manifest",{refreshInterval:1e4}),{data:v,loading:Z,mutate:b}=(0,eB.Z)("/manifest/template"),{data:k,loading:y,mutate:M}=(0,eB.Z)("/host?types=node"),C=(0,G.Z)([te,tt,tn,tv,tZ],l),{isFormInvalid:I,isFormSubmitting:S,submitForm:A}=C,{buildDeleteDialogProps:T,checks:F,getCheck:O,hasChecks:N,resetChecks:R,setCheck:_}=(0,z.Z)({list:x}),{name:$,uuid:J}=(0,o.useMemo)(()=>null!=m?m:{},[m]),{domain:Q,fences:K,prefix:X,sequence:Y,upses:ee}=(0,o.useMemo)(()=>null!=v?v:{},[v]),et=(0,o.useCallback)(e=>{let{hostConfig:{hosts:t}}=e,n=Object.values(t).reduce((e,t)=>{let{fences:n,hostType:r,hostNumber:s}=t,l="".concat(r.replace(/node/,"subnode")).concat(s);return n?e[l]=Object.values(n).reduce((e,t)=>{let{fencePort:n}=t;return e+(n.length?1:0)},0):e[l]=0,e},{}),s=Object.entries(n).map(e=>{let[t,n]=e;return n?(0,r.jsx)(r.Fragment,{}):(0,r.jsxs)(ez.Z,{children:["No fence device port specified for ",t,"."]},"".concat(t,"-no-fence-port-message"))});return{counts:n,messages:s}},[]),en=(0,o.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(tI,{formUtils:C,knownFences:K,knownUpses:ee,previous:{domain:Q,prefix:X,sequence:Y}}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),l=0;l<n;l++)s[l]=arguments[l];let i=t_(...s),{messages:o}=et(i);a({actionProceedText:"Add",content:(0,r.jsx)(B.Z,{entries:i,maxDepth:6}),onProceedAppend:()=>{A({body:i,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add install manifest. ",e]}),method:"post",onSuccess:()=>j(),successMsg:"Successfully added install manifest",url:"/manifest"})},preActionArea:(0,r.jsx)(g.Z,{spacing:".3em",children:o}),titleText:"Add install manifest?"}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},titleText:"Add an install manifest"}),[et,C,j,K,ee,Q,X,Y,a,A]),er=(0,o.useMemo)(()=>({actionProceedText:"Edit",content:(0,r.jsx)(tS,{formUtils:C,knownFences:K,knownUpses:ee,previous:m}),onSubmitAppend:function(){for(var t,n=arguments.length,s=Array(n),l=0;l<n;l++)s[l]=arguments[l];let i=t_(...s),{messages:o}=et(i);a({actionProceedText:"Edit",content:(0,r.jsx)(B.Z,{entries:i,maxDepth:6}),onProceedAppend:()=>{A({body:i,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update install manifest. ",e]}),method:"put",onSuccess:()=>j(),successMsg:"Successfully updated install manifest ".concat($),url:"/manifest/".concat(J)})},preActionArea:(0,r.jsx)(g.Z,{spacing:".3em",children:o}),titleText:"Update install manifest ".concat($,"?")}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},loading:u,titleText:"Update install manifest ".concat($)}),[et,C,j,u,K,ee,m,$,J,a,A]),es=(0,o.useCallback)((e,t)=>{h(!0),q.Z.get("manifest/".concat(e)).then(t=>{let{data:n}=t;n.uuid=e,p(n)}).catch(e=>{(0,H.Z)(e)}).finally(()=>{h(!1),null==t||t.call(null)})},[h,p]),el=(0,o.useMemo)(()=>(0,r.jsx)(L.Z,{allowEdit:!0,allowItemButton:c,disableDelete:!N,edit:c,header:!0,listEmpty:"No manifest(s) registered.",listItems:x,onAdd:()=>{var e;null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var t;a(T({onProceedAppend:()=>{A({body:{uuids:F},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Delete manifest(s) failed. ",e]}),method:"delete",onSuccess:()=>{j(),R()},url:"/manifest"})},getConfirmDialogTitle:e=>"Delete ".concat(e," manifest(s)?"),renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(P.Ac,{children:null==x?void 0:x[t].manifestName})}})),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},onEdit:()=>{d(e=>!e)},onItemCheckboxChange:(e,t,n)=>{_(e,n)},onItemClick:e=>{var t;let{manifestName:r,manifestUUID:s}=e;p({name:r,uuid:s}),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0),es(s)},renderListItemCheckboxState:e=>O(e),renderListItem:(e,t)=>{let{manifestName:n}=t;return(0,r.jsxs)(g.Z,{fullWidth:!0,row:!0,children:[(0,r.jsx)(ea.Z,{disabled:c,mapPreset:"play",onClick:()=>{var t;null===(t=s.current)||void 0===t||t.setOpen(!0),es(e)},variant:"normal"}),(0,r.jsx)(P.Ac,{children:n})]})}}),[T,F,O,es,j,N,c,x,R,_,a,p,A]),ei=(0,o.useMemo)(()=>y||Z||f?(0,r.jsx)(U.Z,{}):el,[y,f,Z,el]),ec=(0,o.useMemo)(()=>(0,r.jsx)(V.Z,{count:1,defaultMessageType:"warning",ref:l}),[]),{confirmDialog:ed,finishConfirm:eu,setConfirmDialogLoading:eh,setConfirmDialogOpen:em,setConfirmDialogProps:ep}=(0,eD.Z)({initial:{scrollContent:!0,wide:!0}}),ex=(0,o.useMemo)(()=>({add:{open:()=>null},confirm:{finish:eu,loading:eh,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return em(e)},prepare:ep},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==s?void 0:null===(e=s.current)||void 0===e?void 0:e.setOpen(t)}}}),[eu,eh,em,ep]),ef=(0,o.useMemo)(()=>Z||u||y,[y,u,Z]),ej=(0,o.useMemo)(()=>m&&K&&k&&ee&&(0,r.jsx)(tE,{detail:m,knownFences:K,knownHosts:k,knownUpses:ee,onSubmitSuccess:()=>{b(),M()},tools:ex}),[ex,M,b,k,K,ee,m]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(P.z,{children:"Manage manifests"})}),ei]}),(0,r.jsx)(D.Z,{...en,disableProceed:I,loadingAction:S,preActionArea:ec,ref:t,scrollContent:!0,showClose:!0}),(0,r.jsx)(D.Z,{...er,disableProceed:I,loadingAction:S,preActionArea:ec,ref:n,scrollContent:!0,showClose:!0}),(0,r.jsx)(eo.Js,{header:"".concat((null==m?void 0:m.anvil)?"Rerun":"Run"," install manifest ").concat(null==m?void 0:m.name),loading:ef,ref:s,showClose:!0,wide:!0,children:ej}),(0,r.jsx)(E.Z,{closeOnProceed:!0,...i,ref:e,scrollContent:!0,wide:!0}),ed]})};let tB="common-ups-input-ip-address",tH="common-ups-input-host-name",tL="IP address",tV="Host name";var t$=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,setMessage:s},previous:{upsIPAddress:l,upsName:i}={}}=e;return(0,r.jsx)(c.Z,{columns:{xs:1,sm:2},layout:{"common-ups-input-cell-host-name":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tH,label:tV,value:i}),inputTestBatch:(0,y.Gn)(tV,()=>{s(tH)},{onFinishBatch:t(tH)},e=>{s(tH,{children:e})}),onFirstRender:n(tH),required:!0})},"common-ups-input-cell-ip-address":{children:(0,r.jsx)(v.Z,{input:(0,r.jsx)(Z.Z,{id:tB,label:tL,value:l}),inputTestBatch:(0,y._)(tL,()=>{s(tB)},{onFinishBatch:t(tB)},e=>{s(tB,{children:e})}),onFirstRender:n(tB),required:!0})}},spacing:"1em"})},tz=n(86549);let tW="add-ups-select-ups-type-id";var tG=e=>{let{formUtils:t,loading:n,previous:s={},upsTemplate:l}=e,{buildInputFirstRenderFunction:i,setValidity:a}=t,{upsTypeId:c=""}=s,d=(0,O.Z)(),[u,h]=(0,o.useState)(c),m=(0,o.useMemo)(()=>l?Object.entries(l).map(e=>{let t,[n,{brand:s,description:l,links:{0:i}}]=e;if(i){let{linkHref:e,linkLabel:n}=i;t=(0,r.jsx)(tz.Z,{href:e,onClick:e=>{e.stopPropagation()},sx:{display:"inline-flex",color:ej.E5},target:"_blank",children:n})}return{displayValue:(0,r.jsxs)(g.Z,{spacing:0,children:[(0,r.jsx)(P.Ac,{inverted:!0,children:s}),(0,r.jsxs)(P.Ac,{inverted:!0,children:[l," (",t,")"]})]}),value:n}}):[],[l]),p=(0,o.useMemo)(()=>l&&(0,r.jsx)(b.Z,{formControlProps:{sx:{marginTop:".3em"}},id:tW,label:"UPS type",onChange:e=>{let{target:{value:t}}=e,n=String(t);a(tW,!0),h(n)},required:!0,selectItems:m,selectProps:{onClearIndicatorClick:()=>{a(tW,!1),h("")},renderValue:e=>{let{brand:t}=l[String(e)];return t}},value:u}),[l,m,u,a]),x=(0,o.useMemo)(()=>n?(0,r.jsx)(U.Z,{}):(0,r.jsxs)(g.Z,{children:[p,u&&(0,r.jsx)(t$,{formUtils:t,previous:s})]}),[t,u,n,p,s]);return(0,o.useEffect)(()=>{d&&i(tW)({isValid:!!u})},[i,u,d]),x};let tJ="edit-ups-input-ups-uuid";var tQ=e=>{let{formUtils:t,loading:n,previous:s,upsTemplate:l,upsUUID:i}=e;return(0,o.useMemo)(()=>n?(0,r.jsx)(U.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tG,{formUtils:t,previous:s,upsTemplate:l}),(0,r.jsx)("input",{hidden:!0,id:tJ,readOnly:!0,value:i})]}),[t,n,s,l,i])};let tK=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[{target:s}]=n,{elements:l}=s,{value:i}=l.namedItem(tH),{value:o}=l.namedItem(tB),a=l.namedItem(tW),c="",d="",u="";a&&({value:u}=a,{agent:c,brand:d}=e[u]);let h=l.namedItem(tJ),m="";return h&&({value:m}=h),{agent:c,brand:d,ipAddress:o,name:i,typeId:u,uuid:m}},tX=e=>{let{brand:t,ipAddress:n,name:s,uuid:l}=e;return(0,r.jsx)(L.Z,{listItems:{"ups-brand":{label:"Brand",value:t},"ups-name":{label:"Host name",value:s},"ups-ip-address":{label:"IP address",value:n}},listItemProps:{sx:{padding:0}},renderListItem:(e,t)=>{let{label:n,value:s}=t;return(0,r.jsxs)(g.Z,{fullWidth:!0,growFirst:!0,row:!0,children:[(0,r.jsx)(P.Ac,{children:n}),(0,r.jsx)(P.$_,{children:s})]},"confirm-ups-".concat(l,"-").concat(e))}})};var tY=()=>{let e=(0,O.Z)(),t=(0,o.useRef)({}),n=(0,o.useRef)({}),s=(0,o.useRef)({}),[l,i]=(0,W.Z)(),[a,c]=(0,W.Z)(),[d,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!0),[x,f]=(0,o.useState)(),{data:j,isLoading:v}=(0,$.Z)("".concat(u.Z,"/ups"),{refreshInterval:6e4}),Z=(0,G.Z)([tB,tH,tW],s),{isFormInvalid:b,isFormSubmitting:k,submitForm:y}=Z,{buildDeleteDialogProps:M,checks:C,getCheck:I,hasChecks:S,setCheck:A}=(0,z.Z)({list:j}),T=(0,o.useCallback)(e=>{var n,s;let{upsAgent:l,upsIPAddress:o,upsName:a,upsUUID:c}=e,d=null!==(s=null===(n=Object.entries(null!=x?x:{}).find(e=>{let[,{agent:t}]=e;return l===t}))||void 0===n?void 0:n[0])&&void 0!==s?s:"";return{actionProceedText:"Update",content:(0,r.jsx)(tQ,{formUtils:Z,previous:{upsIPAddress:o,upsName:a,upsTypeId:d},upsTemplate:x,upsUUID:c}),onSubmitAppend:e=>{var n;if(!x)return;let s=tK(x,e),{name:l}=s;i({actionProceedText:"Update",content:tX(s),onProceedAppend:()=>{y({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to update UPS. ",e]}),method:"put",successMsg:"Successfully updated UPS ".concat(a),url:"/ups/".concat(c)})},titleText:(0,r.jsxs)(P.z,{children:["Update"," ",(0,r.jsx)(P.Q0,{fontSize:"inherit",children:l})," ","with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,r.jsxs)(P.z,{children:["Update UPS"," ",(0,r.jsx)(P.Q0,{fontSize:"inherit",children:a})]})}},[Z,i,y,x]),F=(0,o.useMemo)(()=>({actionProceedText:"Add",content:(0,r.jsx)(tG,{formUtils:Z,upsTemplate:x}),onSubmitAppend:e=>{var n;if(!x)return;let s=tK(x,e),{brand:l,name:o}=s;i({actionProceedText:"Add",content:tX(s),onProceedAppend:()=>{y({body:s,getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to add UPS. ",e]}),method:"post",successMsg:"Successfully added UPS ".concat(o),url:"/ups"})},titleText:(0,r.jsxs)(P.z,{children:["Add a"," ",(0,r.jsx)(P.Q0,{fontSize:"inherit",children:l})," UPS with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a UPS"}),[Z,i,y,x]),N=(0,o.useMemo)(()=>(0,r.jsx)(L.Z,{allowEdit:!0,allowItemButton:d,disableDelete:!S,edit:d,header:!0,listEmpty:"No Ups(es) registered.",listItems:j,onAdd:()=>{var e;c(F),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;i(M({getConfirmDialogTitle:e=>"Delete ".concat(e," UPSes?"),onProceedAppend:()=>{y({body:{uuids:C},getErrorMsg:e=>(0,r.jsxs)(r.Fragment,{children:["Failed to delete UPS(es). ",e]}),method:"delete",url:"/ups"})},renderEntry:e=>{let{key:t}=e;return(0,r.jsx)(P.Ac,{children:null==j?void 0:j[t].upsName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{h(e=>!e)},onItemCheckboxChange:(e,t,n)=>{A(e,n)},onItemClick:e=>{var t;c(T(e)),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0)},renderListItemCheckboxState:e=>I(e),renderListItem:(e,t)=>{let{upsAgent:n,upsIPAddress:s,upsName:l}=t;return(0,r.jsxs)(g.Z,{fullWidth:!0,row:!0,children:[(0,r.jsx)(P.Ac,{children:l}),(0,r.jsxs)(P.Ac,{children:['agent="',n,'"']}),(0,r.jsxs)(P.Ac,{children:['ip="',s,'"']})]})}}),[F,M,T,C,I,S,d,A,i,c,y,j]),R=(0,o.useMemo)(()=>m||v?(0,r.jsx)(U.Z,{}):N,[m,v,N]),_=(0,o.useMemo)(()=>(0,r.jsx)(V.Z,{count:1,defaultMessageType:"warning",ref:s}),[]);return e&&q.Z.get("/ups/template").then(e=>{let{data:t}=e;f(t)}).catch(e=>{(0,H.Z)(e)}).finally(()=>{p(!1)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(P.z,{children:"Manage UPSes"})}),R]}),(0,r.jsx)(D.Z,{...a,disableProceed:b,loadingAction:k,preActionArea:_,ref:n,showClose:!0}),(0,r.jsx)(E.Z,{closeOnProceed:!0,...l,ref:t})]})};let t0="prepare-host",t1="prepare-network",t2="manage-fence",t8="manage-ups",t5="manage-manifest",t9={[t0]:"Prepare Host",[t1]:"Prepare Network",[t2]:"Manage Fence Devices",[t8]:"Manage UPSes",[t5]:"Manage Manifests"},t3="Loading",t4={md:8,xs:1},t7={md:6,xs:1},t6=()=>(0,r.jsx)(c.Z,{columns:t4,layout:{"preparehost-left-column":{},"preparehost-center-column":{children:(0,r.jsxs)(w.s_,{children:[(0,r.jsx)(w.V9,{children:(0,r.jsx)(P.z,{children:"Hosts"})}),(0,r.jsx)(eI,{})]}),...t7}}}),ne=()=>(0,r.jsx)(c.Z,{columns:t4,layout:{"preparenetwork-left-column":{},"preparenetwork-center-column":{children:(0,r.jsx)(eV,{}),...t7}}}),nt=()=>(0,r.jsx)(c.Z,{columns:t4,layout:{"managefence-left-column":{},"managefence-center-column":{children:(0,r.jsx)(ee,{}),...t7}}}),nn=()=>(0,r.jsx)(c.Z,{columns:t4,layout:{"manageups-left-column":{},"manageups-center-column":{children:(0,r.jsx)(tY,{}),...t7}}}),nr=()=>(0,r.jsx)(c.Z,{columns:t4,layout:{"managemanifest-left-column":{},"managemanifest-center-column":{children:(0,r.jsx)(tD,{}),...t7}}});var ns=()=>{let{isReady:e,push:t,query:n}=(0,i.useRouter)(),[s,c]=(0,o.useState)(!1),[u,h]=(0,o.useState)(t3);return(0,o.useEffect)(()=>{if(!e)return;let{step:r}=n,l=a(r,{fallbackValue:t0});t9[l]||(l=t0),t({query:{...n,step:l}},void 0,{shallow:!0}),u===t3&&h(t9[l]),s||c(l)},[e]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:u})}),(0,r.jsx)(d.Z,{}),(0,r.jsx)(w.s_,{children:(0,r.jsxs)(eA.Z,{onChange:(e,r)=>{c(r),h(t9[r]),t({query:{...n,step:r}},void 0,{shallow:!0})},orientation:{xs:"vertical",sm:"horizontal"},value:s,children:[(0,r.jsx)(eS.Z,{label:"Prepare host",value:t0}),(0,r.jsx)(eS.Z,{label:"Prepare network",value:t1}),(0,r.jsx)(eS.Z,{label:"Manage fence devices",value:t2}),(0,r.jsx)(eS.Z,{label:"Manage UPSes",value:t8}),(0,r.jsx)(eS.Z,{label:"Manage manifests",value:t5})]})}),(0,r.jsx)(eL.Z,{changingTabId:s,tabId:t0,children:(0,r.jsx)(t6,{})}),(0,r.jsx)(eL.Z,{changingTabId:s,tabId:t1,children:(0,r.jsx)(ne,{})}),(0,r.jsx)(eL.Z,{changingTabId:s,tabId:t2,children:(0,r.jsx)(nt,{})}),(0,r.jsx)(eL.Z,{changingTabId:s,tabId:t8,children:(0,r.jsx)(nn,{})}),(0,r.jsx)(eL.Z,{changingTabId:s,tabId:t5,children:(0,r.jsx)(nr,{})})]})}}},function(e){e.O(0,[810,433,618,74,225,739,491,135,142,329,62,717,778,957,773,888,774,179],function(){return e(e.s=29582)}),_N_E=e.O()}]);