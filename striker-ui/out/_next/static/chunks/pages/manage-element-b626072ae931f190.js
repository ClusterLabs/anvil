(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[808],{29582:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-element",function(){return n(67099)}])},18950:function(e,t,n){"use strict";var s=n(85893),r=n(67294),l=n(47177);let a=(0,r.forwardRef)((e,t)=>{let{children:n,contentContainerProps:a,dialogProps:i,onSubmitAppend:o,proceedButtonProps:c,scrollBoxProps:d,scrollContent:u,...m}=e,p=(0,r.useMemo)(()=>({...a,component:"form",onSubmit:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[s]=t;s.preventDefault(),null==o||o.call(null,...t)}}),[a,o]),h=(0,r.useMemo)(()=>({...d,sx:u?{overflowX:"hidden",paddingTop:".6em",...null==d?void 0:d.sx}:null==d?void 0:d.sx}),[d,u]);return(0,s.jsx)(l.Z,{dialogProps:i,contentContainerProps:p,proceedButtonProps:{...c,type:"submit"},scrollContent:u,scrollBoxProps:h,wide:!0,...m,ref:t,children:n})});a.displayName="FormDialog",t.Z=a},16562:function(e,t,n){"use strict";var s=n(85893),r=n(77527),l=n(50385),a=n(13539),i=n(67294),o=n(39971),c=n(57882);let d=(0,r.ZP)(l.Z)({height:"3.5em",marginLeft:0,width:"100%"});t.Z=e=>{let{baseInputProps:t,checked:n,formControlLabelProps:r,id:l,label:u,name:m,onChange:p,switchProps:h}=e,x=(0,i.useMemo)(()=>"string"==typeof u?(0,s.jsx)(c.Ac,{inheritColour:!0,color:"".concat(o.s7,"AF"),children:u}):(0,s.jsx)(s.Fragment,{children:u}),[u]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d,{componentsProps:{typography:{flexGrow:1}},control:(0,s.jsx)(a.Z,{checked:n,edge:"end",name:m,onChange:p,...h}),label:x,labelPlacement:"start",...r}),(0,s.jsx)("input",{checked:n,hidden:!0,id:l,readOnly:!0,...t})]})}},84337:function(e,t,n){"use strict";var s=n(67294);t.Z=function(){let{actionProceedText:e="",content:t="",titleText:n="",...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.useState)({actionProceedText:e,content:t,titleText:n,...r})}},99246:function(e,t,n){"use strict";var s=n(67294);t.Z=()=>{let e=(0,s.useRef)(!0);return e.current?(e.current=!1,!0):e.current}},67099:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return tX}});var s=n(85893),r=n(9008),l=n.n(r),a=n(11163),i=n(67294),o=n(82040),c=n(25436),d=n(35338),u=n(90642),m=n(48801),p=n(77527),h=n(21038),x=n(46315),f=n(5387),j=n(2911),g=n(23852),v=n(65375),Z=n(37628),b=n(16562),w=n(68007),k=n(57882);let P=["1","on"],y=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,setMessage:n},id:s,label:r}=e,l=t(s),a=()=>{n(s)};return"ip"===r.toLowerCase()?(0,w._)(r,a,{onFinishBatch:l},e=>{n(s,{children:e})}):{defaults:{onSuccess:a},onFinishBatch:l,tests:[{test:w.HJ}]}},M=e=>{let{formUtils:t,id:n,isRequired:r,label:l="",name:a=n,value:i}=e,{buildFinishInputTestBatchFunction:o,buildInputFirstRenderFunction:c,setMessage:d}=t;return(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:n,label:l,name:a,value:i}),inputTestBatch:(0,w.qY)(l,()=>{d(n)},{onFinishBatch:o(n)},e=>{d(n,{children:e})}),onFirstRender:c(n),required:r,valueType:"number"},"".concat(n,"-wrapper"))},I={boolean:e=>{let{id:t,isChecked:n=!1,label:r,name:l=t}=e;return(0,s.jsx)(j.Z,{input:(0,s.jsx)(b.Z,{checked:n,id:t,label:r,name:l}),valueType:"boolean"},"".concat(t,"-wrapper"))},integer:M,second:M,select:e=>{let{formUtils:t,id:n,isRequired:r,label:l,name:a=n,selectOptions:i=[],value:o=""}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:d,setMessage:u}=t;return(0,s.jsx)(j.Z,{input:(0,s.jsx)(Z.Z,{id:n,label:l,name:a,selectItems:i,value:o}),inputTestBatch:{defaults:{onSuccess:()=>{u(n)}},onFinishBatch:c(n),tests:[{test:w.HJ}]},onFirstRender:d(n),required:r},"".concat(n,"-wrapper"))},string:e=>{let t;let{formUtils:n,id:r,isRequired:l,isSensitive:a=!1,label:i="",name:o=r,value:c}=e,{buildInputFirstRenderFunction:d}=n;return a&&(t=x.Z.password),(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:r,label:i,name:o,type:t,value:c}),inputTestBatch:y({formUtils:n,id:r,label:i}),onFirstRender:d(r),required:l},"".concat(r,"-wrapper"))}},S=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("-")},C=(0,p.ZP)(f.Z)({margin:".4em 0"});var A=e=>{let{fenceId:t,fenceParameterTooltipProps:n,fenceTemplate:r,formUtils:l,previousFenceName:a,previousFenceParameters:o}=e,{buildFinishInputTestBatchFunction:c,buildInputFirstRenderFunction:m,setMessage:p}=l,x=(0,i.useMemo)(()=>{let e;if(r&&t){let{parameters:i}=r[t],x={};o&&(x=Object.entries(o).reduce((e,n)=>{let[s,r]=n;return e[S(t,s)]=r,e},{}));let{optional:Z,required:b}=Object.entries(i).sort((e,t)=>{let[n]=e,[s]=t;return n>s?1:-1}).reduce((e,r)=>{var a,i;let[o,{content_type:c,default:m,deprecated:p,description:f,options:j,replacement:g,required:v}]=r;if([1===Number(p),g].some(e=>e))return e;let{optional:Z,required:b}=e,w=null!==(a=I[c])&&void 0!==a?a:I.string,y=S(t,o),M=null!==(i=x[y])&&void 0!==i?i:m,C=!/plug|port/i.test(o)&&1===Number(v),A=d.JW.test(o),T=w({formUtils:l,id:y,isChecked:P.includes(M),isRequired:C,isSensitive:A,label:o,selectOptions:j,value:M}),F=(0,s.jsx)(h.Z,{componentsProps:{tooltip:{sx:{maxWidth:{md:"62.6em"}}}},disableInteractive:!0,placement:"top-start",title:(0,s.jsx)(k.Ac,{children:f}),...n,children:(0,s.jsx)(u.Z,{children:T})},"".concat(y,"-tooltip"));return C?b.push(F):Z.push(F),e},{optional:[],required:[]}),y=S(t,"name"),M="Fence device name";e=(0,s.jsxs)(f.Z,{sx:{"& > div:first-child":{marginTop:0},"& > div":{marginBottom:0}},children:[(0,s.jsx)(v.TZ,{expandInitially:!0,header:"Required parameters",children:(0,s.jsxs)(C,{children:[(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{disableAutofill:!0,id:y,label:M,name:y,value:a}),inputTestBatch:(0,w.Gn)(M,()=>{p(y)},{onFinishBatch:c(y)},e=>{p(y,{children:e})}),onFirstRender:m(y),required:!0},"".concat(y,"-wrapper")),b]})}),(0,s.jsx)(v.TZ,{header:"Optional parameters",children:(0,s.jsx)(C,{children:Z})})]})}return e},[c,m,t,n,r,l,a,o,p]);return(0,s.jsx)(s.Fragment,{children:x})},T=n(90209),F=n(99246);let U="add-fence-input-agent";var O=e=>{let{fenceTemplate:t,formUtils:n,loading:r}=e,{setValidity:l}=n,a=(0,F.Z)(),[o,c]=(0,i.useState)(null),d=(0,i.useMemo)(()=>t?Object.entries(t).sort((e,t)=>{let[n]=e,[s]=t;return n>s?1:-1}).map(e=>{let[t,{description:n}]=e;return{fenceDescription:"string"==typeof n?n:"No description.",fenceId:t,label:t}}):[],[t]),p=(0,i.useMemo)(()=>(0,s.jsx)(m.Z,{id:U,isOptionEqualToValue:(e,t)=>e.fenceId===t.fenceId,label:"Fence device type",onChange:(e,t)=>{l(U,null!==t),c(t)},openOnFocus:!0,options:d,renderOption:(e,t,n)=>{let{fenceDescription:r,fenceId:l}=t,{selected:a}=n;return(0,s.jsxs)(u.Z,{component:"li",sx:{display:"flex",flexDirection:"column","& > *":{width:"100%"}},...e,children:[(0,s.jsx)(k.Ac,{inverted:!0,sx:{fontSize:"1.2em",fontWeight:a?400:void 0},children:l}),(0,s.jsx)(k.Ac,{selected:!1,children:r})]})},sx:{marginTop:".3em"},value:o}),[d,o,l]),h=(0,i.useMemo)(()=>(0,s.jsx)(A,{fenceId:null==o?void 0:o.fenceId,fenceTemplate:t,formUtils:n}),[t,null==o?void 0:o.fenceId,n]),x=(0,i.useMemo)(()=>r?(0,s.jsx)(T.Z,{}):(0,s.jsxs)(f.Z,{children:[p,h]}),[p,h,r]);return(0,i.useEffect)(()=>{a&&l(U,null!==o)},[o,a,l]),(0,s.jsx)(s.Fragment,{children:x})},N=n(66389),q=n(47177),R=e=>{let{fenceId:t,fenceTemplate:n,formUtils:r,loading:l,previousFenceName:a,previousFenceParameters:o}=e,c=(0,i.useMemo)(()=>l?(0,s.jsx)(T.Z,{}):(0,s.jsx)(A,{fenceId:t,fenceTemplate:n,formUtils:r,previousFenceName:a,previousFenceParameters:o}),[n,t,r,l,a,o]);return(0,s.jsx)(s.Fragment,{children:c})},E=n(18950),B=n(76740),_=n(11100),D=n(18541),H=n(18050),L=n(81013),V=n(84337),z=n(5499),$=n(95275);let G=e=>{let{id:t}=e,n=new RegExp("^(fence[^-]+)".concat("-","([^\\s]+)$")),s=t.match(n);if(!s)throw Error("Not target input element");return s},W=(e,t,n)=>{if("name"===e)throw t.name=n,Error("Not child parameter")},Q=e=>{if(!e)throw Error("Not parameter specification")},J=(e,t)=>{if([t,"",null,void 0].some(t=>e===t))throw Error("Skippable parameter value")},X=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];let[{target:r}]=n,{elements:l}=r;return Object.values(l).reduce((t,n)=>{try{let[,s,r]=G(n);t.agent=s;let{checked:l,value:a}=n;W(r,t,a);let{[s]:{parameters:{[r]:i}}}=e;Q(i);let{content_type:o,default:c}=i,d=a;"boolean"===o&&(d=l?"1":""),J(d,c),t.parameters[r]=d}catch(e){}return t},{agent:"",name:"",parameters:{}})};var K=()=>{let e=(0,F.Z)(),t=(0,i.useRef)({}),n=(0,i.useRef)({}),r=(0,i.useRef)({}),[l,a]=(0,V.Z)(),[o,c]=(0,V.Z)(),[u,m]=(0,i.useState)(),[p,h]=(0,i.useState)(),[x,j]=(0,i.useState)(!1),[g,Z]=(0,i.useState)(!0),{loading:b}=(0,z.Z)("/fence",{onSuccess:e=>m(e),refreshInterval:6e4}),w=(0,i.useCallback)(()=>{N.Z.get("/fence").then(e=>{let{data:t}=e;m(t)})},[m]),P=(0,$.Z)([U],r),{isFormInvalid:y,isFormSubmitting:M,submitForm:I}=P,{buildDeleteDialogProps:S,checks:C,getCheck:A,hasChecks:G,resetChecks:W,setCheck:Q}=(0,L.Z)({list:u}),J=(0,i.useCallback)(e=>{let{cap:t,depth:n,key:s}=e;return 0===n?t(s):s},[]),K=(0,i.useMemo)(()=>(0,s.jsx)(D.Z,{allowEdit:!0,allowItemButton:x,disableDelete:!G,edit:x,header:!0,listEmpty:"No fence device(s) registered.",listItems:u,onAdd:()=>{var e;c({actionProceedText:"Add",content:(0,s.jsx)(O,{fenceTemplate:p,formUtils:P}),onSubmitAppend:e=>{var n;if(!p)return;let r=X(p,e),{agent:l,name:i}=r;a({actionProceedText:"Add",content:(0,s.jsx)(B.Z,{entries:r,hasPassword:!0,getEntryLabel:J}),onProceedAppend:()=>{I({body:r,getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to add fence device. ",e]}),method:"post",onSuccess:()=>w(),successMsg:"Added fence device ".concat(i),url:"/fence"})},titleText:(0,s.jsxs)(k.z,{children:["Add a"," ",(0,s.jsx)(k.Q0,{fontSize:"inherit",children:l})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a fence device"}),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;a(S({getConfirmDialogTitle:e=>"Delete ".concat(e," fence device(s)?"),onProceedAppend:()=>{I({body:{uuids:C},getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to delete fence device(s). ",e]}),method:"delete",onSuccess:()=>{w(),W()},url:"/fence"})},renderEntry:e=>{let{key:t}=e;return(0,s.jsx)(k.Ac,{children:null==u?void 0:u[t].fenceName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{j(e=>!e)},onItemCheckboxChange:(e,t,n)=>{Q(e,n)},onItemClick:e=>{var r;let{fenceAgent:l,fenceName:i,fenceParameters:o,fenceUUID:d}=e;c({actionProceedText:"Update",content:(0,s.jsx)(R,{fenceId:l,fenceTemplate:p,formUtils:P,previousFenceName:i,previousFenceParameters:o}),onSubmitAppend:e=>{var n;if(!p)return;let r=X(p,e);a({actionProceedText:"Update",content:(0,s.jsx)(B.Z,{entries:r,hasPassword:!0,getEntryLabel:J}),onProceedAppend:()=>{I({body:r,getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to update fence device. ",e]}),method:"put",onSuccess:()=>w(),successMsg:"Updated fence device ".concat(i),url:"/fence/".concat(d)})},titleText:(0,s.jsxs)(k.z,{children:["Update"," ",(0,s.jsx)(k.Q0,{fontSize:"inherit",children:i})," ","fence device with the following parameters?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,s.jsxs)(k.z,{children:["Update fence device"," ",(0,s.jsx)(k.Q0,{fontSize:"inherit",children:i})," ","parameters"]})}),null===(r=n.current.setOpen)||void 0===r||r.call(null,!0)},renderListItemCheckboxState:e=>A(e),renderListItem:(e,t)=>{let{fenceAgent:n,fenceName:r,fenceParameters:l}=t;return(0,s.jsxs)(f.Z,{row:!0,children:[(0,s.jsx)(k.Ac,{children:r}),(0,s.jsx)(k.Ac,{children:Object.entries(l).reduce((e,t)=>{let[n,r]=t,l=(0,s.jsxs)(s.Fragment,{children:[n,'="']});return l=d.JW.test(n)?(0,s.jsxs)(s.Fragment,{children:[l,(0,s.jsx)(k.PJ,{wrapper:"mono",children:r})]}):(0,s.jsxs)(s.Fragment,{children:[l,r]}),(0,s.jsxs)(s.Fragment,{children:[e," ",l,'"']})},n)})]})}}),[S,C,u,p,P,A,w,J,G,x,W,Q,a,c,I]),Y=(0,i.useMemo)(()=>g||b?(0,s.jsx)(T.Z,{}):K,[b,g,K]),ee=(0,i.useMemo)(()=>(0,s.jsx)(H.Z,{count:1,defaultMessageType:"warning",ref:r}),[]);return e&&N.Z.get("/fence/template").then(e=>{let{data:t}=e;h(t)}).catch(e=>{(0,_.Z)(e)}).finally(()=>{Z(!1)}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(v.s_,{children:[(0,s.jsx)(v.V9,{children:(0,s.jsx)(k.z,{children:"Manage fence devices"})}),Y]}),(0,s.jsx)(E.Z,{dialogProps:{PaperProps:{sx:{minWidth:{xs:"90%",md:"50em"}}}},scrollBoxProps:{padding:".3em .5em"},...o,disableProceed:y,loadingAction:M,preActionArea:ee,ref:n,scrollContent:!0,showClose:!0}),(0,s.jsx)(q.Z,{closeOnProceed:!0,scrollBoxProps:{paddingRight:"1em"},...l,ref:t,scrollContent:!0})]})},Y=n(946),ee=n(82092),et=n(8506),en=n(24811),es=n(39971),er=n(19166),el=n(22143),ea=e=>{let{list:t,setValue:n,value:r}=e;return 0===t.length?(0,s.jsx)(k.Ac,{children:"No host(s) found."}):(0,s.jsx)(el.Z,{centered:!0,onChange:(e,t)=>{n(t)},orientation:"vertical",value:r,children:t.map(e=>{let{hostConfigured:t,hostStatus:n,hostType:r,hostUUID:l,shortHostName:a}=e,i=r.replace("dr","DR").replace("node","Subnode");return(0,s.jsx)(er.Z,{label:(0,s.jsxs)(et.ZP,{container:!0,spacing:"1em",sx:{[".".concat(en.Z.item,":not(:first-child)")]:{borderLeft:"thin solid ".concat(es.d)}},children:[(0,s.jsx)(et.ZP,{item:!0,xs:!0,children:(0,s.jsx)(k.Ac,{noWrap:!0,children:i})}),(0,s.jsx)(et.ZP,{item:!0,xs:!0,children:(0,s.jsx)(k.$_,{noWrap:!0,children:a})}),(0,s.jsx)(et.ZP,{item:!0,xs:!0,children:(0,s.jsxs)(k.Ac,{noWrap:!0,children:[n,t?", configured":""]})})]}),sx:{textAlign:"left"},value:l},"host-".concat(l))})})},ei=n(41609),eo=n.n(ei),ec=n(42050),ed=n(66859),eu=n(19306),em=n(16310);let ep=em.Ry({hostName:em.Z_().required(),networkInit:eu.PC});var eh=e=>{let{values:t}=e;return(0,s.jsxs)(et.ZP,{container:!0,spacing:".6em",columns:{xs:2},children:[(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Ac,{children:"Host name"})}),(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.$_,{children:t.hostName})}),(0,s.jsx)(eu.e2,{...e})]})},ex=n(93666),ef=n(12823),ej=n(22582);let eg=e=>{let{dns:t="",gateway:n="",networks:s,ntp:r=""}=e.netconf,l={defaultbcn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"bcn"},defaultifn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"ifn"},defaultsn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"sn"},defaultmn:{interfaces:["",""],ip:"",sequence:"1",subnetMask:"",type:"mn"}};eo()(s)||(l=(0,ex.Z)(s));let{name:a}=e;return{hostName:a,mini:!1,networkInit:{dns:t,gateway:n,networks:l,ntp:r}}};var ev=e=>{let{detail:t,tools:n,uuid:r}=e,l=(0,i.useRef)(null),a=(0,ej.Z)({initialValues:eg(t),onSubmit:(e,r)=>{let{setSubmitting:a}=r,i=(0,ed.Z)(e,l.current);n.confirm.prepare({actionProceedText:"Prepare network",content:l.current&&(0,s.jsx)(eh,{gatewayIface:i.gatewayInterface,ifaces:l.current,values:e}),onCancelAppend:()=>a(!1),onProceedAppend:()=>{n.confirm.loading(!0),N.Z.put("/host/".concat(t.uuid,"?handler=subnode-network"),i).then(()=>{n.confirm.finish("Success",{children:(0,s.jsxs)(s.Fragment,{children:["Successfully started network config on ",t.short]})})}).catch(e=>{let r=(0,_.Z)(e);r.children=(0,s.jsxs)(s.Fragment,{children:["Failed to prepare network on ",t.short,". ",r.children]}),n.confirm.finish("Error",r),a(!1)})},titleText:"Prepare network on ".concat(t.short," with the following?")}),n.confirm.open()},validationSchema:ep}),{disabledSubmit:o,formik:c,formikErrors:d,handleChange:u}=a,m=(0,i.useMemo)(()=>t.type.replace("node","subnode"),[t.type]),{parentSequence:p,sequence:h}=(0,i.useMemo)(()=>{let[e,n]=t.short.replace(/^.*a(\d+).*(?:n|dr)(\d+)$/,"$1,$2").split(",",2);return{parentSequence:Number(e),sequence:Number(n)}},[t.short]),x=(0,i.useMemo)(()=>({hostName:"hostName",mini:"mini",networks:"networkInit.networks"}),[]);return(0,s.jsxs)(et.ZP,{columns:{xs:1,sm:2,md:3,lg:4},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),c.handleSubmit(e)},spacing:"1em",children:[(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(ef.Z,{input:(0,s.jsx)(g.Z,{id:x.hostName,label:"Host name",name:x.hostName,onChange:u,required:!0,value:c.values.hostName})})}),(0,s.jsx)(et.ZP,{display:{xs:"none",md:"initial"},flexGrow:1,item:!0}),(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(b.Z,{id:x.mini,label:"Minimal config",name:x.mini,onChange:(e,t)=>{if(t){let{defaultbcn:e}=c.values.networkInit.networks;c.setFieldValue(x.networks,{defaultbcn:e},!0)}else c.resetForm();c.handleChange(e)},checked:c.values.mini})}),(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsx)(eu.rQ,{formikUtils:a,host:{parentSequence:p,sequence:h,type:m,uuid:r},onFetchSuccess:e=>{l.current=e}})}),(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsx)(H.Z,{count:1,messages:d})}),(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsx)(ec.Z,{actions:[{background:"blue",children:"Prepare network",disabled:o,type:"submit"}]})})]})},eZ=n(40657),eb=e=>{let{uuid:t}=e,{confirmDialog:n,finishConfirm:r,setConfirmDialogLoading:l,setConfirmDialogOpen:a,setConfirmDialogProps:o}=(0,eZ.Z)({initial:{scrollContent:!0,wide:!0}}),c=(0,i.useMemo)(()=>({add:{open:()=>null},confirm:{finish:r,loading:l,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return a(e)},prepare:o},edit:{open:()=>null}}),[r,l,a,o]),{data:d}=(0,z.Z)("/host/".concat(t));return d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ev,{detail:d,tools:c,uuid:t}),n]}):(0,s.jsx)(T.Z,{mt:0})},ew=n(17428),ek=()=>{let[e,t]=(0,i.useState)(!1),{data:n}=(0,z.Z)("/host?type=dr&type=subnode"),r=(0,i.useMemo)(()=>n&&Object.values(n),[n]);return r?(0,s.jsxs)(v.s_,{children:[(0,s.jsx)(ea,{list:r,setValue:t,value:e}),e&&(0,s.jsx)(ee.Z,{sx:{margin:"2em 0"}}),r.map(t=>(0,s.jsx)(ew.Z,{changingTabId:e,tabId:t.hostUUID,children:(0,s.jsx)(eb,{uuid:t.hostUUID})},"cell-".concat(t.hostUUID)))]}):(0,s.jsx)(v.s_,{children:(0,s.jsx)(T.Z,{})})},eP=n(28951),ey=n(91905),eM=n(29873);let eI="an-host-input",eS="".concat(eI,"-cell"),eC="IPMI IP",eA={fence:(e,t)=>{let{dataset:{hostId:n="",fenceId:s="",fenceName:r=""},value:l}=t,{hostConfig:{hosts:{[n]:a}}}=e,{fences:i={}}=a;i[s]={fenceName:r,fencePort:l},a.fences=i},host:(e,t)=>{let{dataset:{hostId:n="",hostNumber:s="",hostType:r=""}}=t,l=Number.parseInt(s,10);e.hostConfig.hosts[n]={hostNumber:l,hostType:r}},ipmi:(e,t)=>{let{dataset:{hostId:n=""},value:s}=t,{hostConfig:{hosts:{[n]:r}}}=e;r.ipmiIp=s},network:(e,t)=>{let{dataset:{hostId:n="",networkId:s="",networkNumber:r="",networkType:l=""},value:a}=t,{hostConfig:{hosts:{[n]:i}}}=e,{networks:o={}}=i,c=Number.parseInt(r,10);o[s]={networkIp:a,networkNumber:c,networkType:l},i.networks=o},ups:(e,t)=>{let{checked:n,dataset:{hostId:s="",upsId:r="",upsName:l=""}}=t,{hostConfig:{hosts:{[s]:a}}}=e,{upses:i={}}=a;i[r]={isUsed:n,upsName:l},a.upses=i}},eT={xs:1,sm:2,md:3},eF=(e,t)=>"".concat(eI,"-").concat(e,"-").concat(t,"-port"),eU=e=>"".concat(eI,"-").concat(e,"-ipmi-ip"),eO=(e,t)=>"".concat(eI,"-").concat(e,"-").concat(t,"-ip"),eN=(e,t)=>"".concat(eI,"-").concat(e,"-").concat(t,"-power-host");var eq=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,buildInputUnmountFunction:r,setMessage:l},hostId:a,hostNumber:o,hostType:c,previous:{fences:d={},ipmiIp:u,networks:m={},upses:p={}}={},hostLabel:h="".concat(c.replace("node","subnode")," ").concat(o)}=e,x=(0,i.useMemo)(()=>Object.entries(d),[d]),Z=(0,i.useMemo)(()=>Object.entries(m),[m]),P=(0,i.useMemo)(()=>Object.entries(p),[p]),y=(0,i.useMemo)(()=>!!P.length,[P.length]),M=(0,i.useMemo)(()=>"".concat(eI,"-").concat(a),[a]),I=(0,i.useMemo)(()=>eU(a),[a]),S=(0,i.useMemo)(()=>"".concat(eS,"-").concat(a,"-ipmi-ip"),[a]),C=(0,i.useMemo)(()=>x.reduce((e,r)=>{let[i,{fenceName:o,fencePort:c}]=r,d="".concat(eS,"-").concat(a,"-").concat(i,"-port"),u=eF(a,i),m="Plug on ".concat(o);return e[d]={children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{baseInputProps:{"data-handler":"fence","data-host-id":a,"data-fence-id":i,"data-fence-name":o},id:u,label:m,value:c}),inputTestBatch:(0,w.Gn)("".concat(a," ").concat(m),()=>{l(u)},{onFinishBatch:t(u)},e=>{l(u,{children:e})}),onFirstRender:n(u)})},e},{}),[t,n,x,a,l]),A=(0,i.useMemo)(()=>Z.reduce((e,i)=>{let[o,{networkIp:c,networkNumber:d,networkType:u}]=i,m="".concat(eS,"-").concat(a,"-").concat(o,"-ip"),p=eO(a,o),h="".concat(u.toUpperCase()," ").concat(d," IP");return e[m]={children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{baseInputProps:{"data-handler":"network","data-host-id":a,"data-network-id":o,"data-network-number":d,"data-network-type":u},id:p,label:h,value:c}),inputTestBatch:(0,w._)("".concat(a," ").concat(h),()=>{l(p)},{onFinishBatch:t(p)},e=>{l(p,{children:e})}),onFirstRender:n(p),onUnmount:r(p),required:!0})},e},{}),[Z,a,t,n,r,l]),T=(0,i.useMemo)(()=>P.reduce((e,t)=>{let[n,{isUsed:r,upsName:l}]=t,i="".concat(eS,"-").concat(a,"-").concat(n,"-power-host"),o=eN(a,n),c="Uses ".concat(l);return e[i]={children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(b.Z,{baseInputProps:{"data-handler":"ups","data-host-id":a,"data-ups-id":n,"data-ups-name":l},checked:r,id:o,label:c}),valueType:"boolean"})},e},{}),[a,P]),F=(0,i.useMemo)(()=>y&&(0,s.jsx)(ey.Z,{columns:eT,layout:T,spacing:"1em"}),[y,T]);return(0,s.jsxs)(v.Lg,{mv:0,children:[(0,s.jsx)(v.CH,{children:(0,s.jsx)(k.Ac,{children:h})}),(0,s.jsxs)(v.bc,{children:[(0,s.jsx)("input",{hidden:!0,id:M,readOnly:!0,"data-handler":"host","data-host-id":a,"data-host-number":o,"data-host-type":c}),(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(ey.Z,{columns:eT,layout:{"fence-message":{children:(0,s.jsx)(eM.Z,{children:"It is recommended to provide at least 1 fence device plug."}),width:"100%",xs:0},...A,[S]:{children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{baseInputProps:{"data-handler":"ipmi","data-host-id":a},id:I,label:eC,value:u}),inputTestBatch:(0,w._)("".concat(a," ").concat(eC),()=>{l(I)},{onFinishBatch:t(I)},e=>{l(I,{children:e})}),onFirstRender:n(I),onUnmount:r(I)})},...C},spacing:"1em"}),F]})]})]})};let eR="".concat("".concat("an-host-config-input","-group"),"-cell"),eE={node1:{hostNumber:1,hostType:"node"},node2:{hostNumber:2,hostType:"node"}},eB=e=>{let{anSeq:t,minIp:n,offset3:s=10,step3:r=2,subnetMask:l,subSeq:a}=e;try{let e=new eP.Netmask("".concat(n,"/").concat(l));if(16!==e.bitmask)return"".concat(e.base.replace(/\.0/g,""),".");return n.replace(/^((\d+\.){2})\d+\.\d+$/,"$1".concat((t-1)*r+s,".").concat(a))}catch(e){return""}};var e_=e=>{let{anSequence:t,formUtils:n,knownFences:r={},knownUpses:l={},networkListEntries:a,previous:{hosts:o=eE}={}}=e,c=(0,i.useMemo)(()=>Object.entries(o),[o]),d=(0,i.useMemo)(()=>Object.values(r),[r]),u=(0,i.useMemo)(()=>Object.values(l),[l]),m=(0,i.useMemo)(()=>c.reduce((e,r)=>{let[l,i]=r,{fences:o={},hostNumber:c,hostType:m,ipmiIp:p,networks:h={},upses:x={}}=i,f=p,j=d.reduce((e,t)=>{let{fenceName:n}=t,{[n]:{fencePort:s=""}={}}=o;return e[n]={fenceName:n,fencePort:s},e},{}),g=a.reduce((e,n)=>{let[s,{networkMinIp:r,networkNumber:l,networkSubnetMask:a,networkType:i}]=n,{[s]:{networkIp:o=""}={}}=h;return o||(o=eB({anSeq:t,minIp:r,subnetMask:a,subSeq:c})),f||"bcn"!==i||1!==l||(f=eB({anSeq:t,minIp:r,offset3:11,subnetMask:a,subSeq:c})),e[s]={networkIp:o,networkNumber:l,networkType:i},e},{}),v=u.reduce((e,t)=>{let{upsName:n}=t,{[n]:{isUsed:s=!0}={}}=x;return e[n]={isUsed:s,upsName:n},e},{});return e["".concat(eR,"-").concat(l)]={children:(0,s.jsx)(eq,{formUtils:n,hostId:l,hostNumber:c,hostType:m,previous:{fences:j,ipmiIp:f,networks:g,upses:v}}),md:3,sm:2},e},{}),[t,n,c,d,u,a]);return(0,s.jsx)(ey.Z,{columns:{xs:1,sm:2,md:3},layout:m,spacing:"1em"})},eD=n(23279),eH=n.n(eD);let eL="an-id-input",eV="".concat(eL,"-domain"),ez="".concat(eL,"-prefix"),e$="".concat(eL,"-sequence"),eG="Domain name",eW="Prefix",eQ="Sequence";var eJ=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:r,setMessage:l},onSequenceChange:a,previous:{domain:o,prefix:c,sequence:d}={}}=e,u=(0,i.useMemo)(()=>a&&eH()(a,t),[t,a]);return(0,s.jsx)(ey.Z,{columns:{xs:1,sm:2,md:3},layout:{"an-id-input-cell-prefix":{children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:ez,label:eW,value:c}),inputTestBatch:(0,w.Gn)(eW,()=>{l(ez)},{onFinishBatch:n(ez)},e=>{l(ez,{children:e})}),onFirstRender:r(ez),required:!0})},"an-id-input-cell-domain":{children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:eV,label:eG,value:o}),inputTestBatch:(0,w.Gn)(eG,()=>{l(eV)},{onFinishBatch:n(eV)},e=>{l(eV,{children:e})}),onFirstRender:r(eV),required:!0})},"an-id-input-cell-sequence":{children:(0,s.jsx)(j.Z,{createInputOnChangeHandlerOptions:{postSet:u},input:(0,s.jsx)(g.Z,{id:e$,label:eQ,value:d}),inputTestBatch:(0,w.qY)(eQ,()=>{l(e$)},{onFinishBatch:n(e$)},e=>{l(e$,{children:e})}),onFirstRender:r(e$),required:!0,valueType:"number"})}},spacing:"1em"})},eX=n(25934),eK=n(94047),eY=n(45328);let e0="an-network-input",e1="".concat(e0,"-cell"),e2={gateway:(e,t)=>{let{dataset:{networkId:n=""},value:s}=t,{networkConfig:{networks:r}}=e;r[n].networkGateway=s},minip:(e,t)=>{let{dataset:{networkId:n=""},value:s}=t,{networkConfig:{networks:r}}=e;r[n].networkMinIp=s},network:(e,t)=>{let{dataset:{networkId:n="",networkNumber:s="",networkType:r=""}}=t,{networkConfig:{networks:l}}=e,a=Number.parseInt(s,10);l[n]={networkNumber:a,networkType:r}},subnetmask:(e,t)=>{let{dataset:{networkId:n=""},value:s}=t,{networkConfig:{networks:r}}=e;r[n].networkSubnetMask=s}},e5=e=>"".concat(e0,"-").concat(e,"-gateway"),e9=e=>"".concat(e0,"-").concat(e,"-min-ip"),e6=e=>"".concat(e0,"-").concat(e,"-network-type"),e8=e=>"".concat(e0,"-").concat(e,"-subnet-mask");var e3=e=>{let{debounceWait:t=500,formUtils:{buildFinishInputTestBatchFunction:n,buildInputFirstRenderFunction:r,buildInputUnmountFunction:l,setMessage:a},inputGatewayLabel:o="Gateway",inputMinIpLabel:c="IP address",inputSubnetMaskLabel:d="Subnet mask",networkId:u,networkNumber:m,networkType:p,networkTypeOptions:h,onClose:x,onNetworkGatewayChange:f,onNetworkMinIpChange:b,onNetworkSubnetMaskChange:k,onNetworkTypeChange:P,previous:{gateway:y,minIp:M,subnetMask:I}={},readonlyNetworkName:S,showCloseButton:C,showGateway:A}=e,T=(0,i.useMemo)(()=>"".concat(eK.Z[p]," ").concat(m),[m,p]),F=(0,i.useMemo)(()=>"".concat(e1,"-").concat(u,"-gateway"),[u]),U=(0,i.useMemo)(()=>"".concat(e1,"-").concat(u,"-ip"),[u]),O=(0,i.useMemo)(()=>"".concat(e1,"-").concat(u,"-subnet-mask"),[u]),N=(0,i.useMemo)(()=>"".concat(e0,"-").concat(u),[u]),q=(0,i.useMemo)(()=>e5(u),[u]),R=(0,i.useMemo)(()=>e9(u),[u]),E=(0,i.useMemo)(()=>e6(u),[u]),B=(0,i.useMemo)(()=>e8(u),[u]),_=(0,i.useMemo)(()=>A?void 0:"none",[A]),D=(0,i.useMemo)(()=>f&&eH()(f,t),[t,f]),H=(0,i.useMemo)(()=>b&&eH()(b,t),[t,b]),L=(0,i.useMemo)(()=>k&&eH()(k,t),[t,k]),V=(0,i.useMemo)(()=>C&&(0,s.jsx)(eY.Z,{mapPreset:"close",iconProps:{fontSize:"small"},onClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==x||x.call(null,{networkId:u,networkType:p},...t)},sx:{padding:".2em",position:"absolute",right:"-.6rem",top:"-.2rem"}}),[C,u,p,x]),z=(0,i.useMemo)(()=>{let e;return A&&q&&(e=(0,s.jsx)(j.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==D?void 0:D.call(null,{networkId:u,networkType:p},...t)}},input:(0,s.jsx)(g.Z,{baseInputProps:{"data-handler":"gateway","data-network-id":u},id:q,label:o,value:y}),inputTestBatch:(0,w._)("".concat(T," ").concat(o),()=>{a(q)},{onFinishBatch:n(q)},e=>{a(q,{children:e})}),onFirstRender:r(q),onUnmount:l(q),required:A})),e},[A,q,u,o,y,T,n,r,l,D,p,a]);return(0,s.jsxs)(v.Lg,{mv:0,children:[(0,s.jsxs)(v.CH,{children:[(0,s.jsx)(j.Z,{input:(0,s.jsx)(Z.Z,{id:E,isReadOnly:S,onChange:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];null==P||P.call(null,{networkId:u,networkType:p},...t)},selectItems:h,selectProps:{renderValue:()=>T},value:p})}),V]}),(0,s.jsxs)(v.bc,{children:[(0,s.jsx)("input",{hidden:!0,id:N,readOnly:!0,"data-handler":"network","data-network-id":u,"data-network-number":m,"data-network-type":p}),(0,s.jsx)(ey.Z,{columns:{xs:1,sm:2,md:3},layout:{[U]:{children:(0,s.jsx)(j.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==H?void 0:H.call(null,{networkId:u,networkType:p},...t)}},input:(0,s.jsx)(g.Z,{baseInputProps:{"data-handler":"minip","data-network-id":u},id:R,label:c,value:M}),inputTestBatch:(0,w._)("".concat(T," ").concat(c),()=>{a(R)},{onFinishBatch:n(R)},e=>{a(R,{children:e})}),onFirstRender:r(R),onUnmount:l(R),required:!0})},[O]:{children:(0,s.jsx)(j.Z,{createInputOnChangeHandlerOptions:{postSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return null==L?void 0:L.call(null,{networkId:u,networkType:p},...t)}},input:(0,s.jsx)(g.Z,{baseInputProps:{"data-handler":"subnetmask","data-network-id":u},id:B,label:d,value:I}),inputTestBatch:(0,w._)("".concat(T," ").concat(d),()=>{a(B)},{onFinishBatch:n(B)},e=>{a(B,{children:e})}),onFirstRender:r(B),onUnmount:l(B),required:!0})},[F]:{children:z,display:_}},spacing:"1em"})]})]})},e4=n(95996);let e7="an-network-config-input",te="".concat(e7,"-cell"),tt="".concat(e7,"-dns"),tn="".concat(e7,"-ntp"),ts=Object.entries(eK.Z),tr={bcn:{base:"10.201.0.0",mask:"255.255.0.0"},mn:{base:"10.199.0.0",mask:"255.255.0.0"},sn:{base:"10.101.0.0",mask:"255.255.0.0"}},tl=e=>"ifn"===e,ta=e=>"mn"===e,ti=e=>{let{entries:t,type:n}=e,s=t.filter(e=>{let[,{networkType:t}]=e;return t===n}).sort((e,t)=>{let[,{networkNumber:n}]=e,[,{networkNumber:s}]=t;return n>s?1:-1}).pop();if(!s){var r;return null!==(r=tr[n])&&void 0!==r?r:{}}let[,{networkMinIp:l,networkSubnetMask:a}]=s;try{let{base:e,mask:t}=new eP.Netmask("".concat(l,"/").concat(a)).next();return{base:e,mask:t}}catch(e){return{}}};var to=e=>{let{formUtils:t,networkListEntries:n,previous:{dnsCsv:r="8.8.8.8,8.8.4.4",ntpCsv:l}={},setNetworkList:a}=e,{buildFinishInputTestBatchFunction:o,buildInputFirstRenderFunction:c,setMessage:d,setMessageRe:u,setValidity:m}=t,p=(0,i.useCallback)(function(e){let{input:t=n,end:s=n.length}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=s-1,l=0;return t.every((t,n)=>{let[,{networkType:s}]=t;return s===e&&(l+=1),n<r}),l},[n]),h=(0,i.useMemo)(()=>ts.map(e=>{let[t,n]=e;return{displayValue:n,value:t}}),[]),x=(0,i.useCallback)(function(){let{networkMinIp:e="",networkSubnetMask:t="",networkType:s=n.some(e=>{let[,{networkType:t}]=e;return ta(t)})?"ifn":"mn",networkGateway:r=tl(s)?"":void 0,networkNumber:l=p(s)+1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{base:a=e,mask:i=t}=ti({entries:n,type:s});return{network:{networkGateway:r,networkMinIp:a,networkNumber:l,networkSubnetMask:i,networkType:s},networkId:(0,eX.Z)()}},[p,n]),f=(0,i.useCallback)((e,t)=>a((0,e4.ZP)(e,t)),[a]),v=(0,i.useCallback)((e,t,n)=>a(s=>{let r={...s},{[e]:l}=r;return l&&(l[t]=n),r}),[a]),Z=(0,i.useCallback)((e,t)=>{let{networkId:s,networkType:r}=e,{target:{value:l}}=t,i=String(l),o=!1,c=0;a(n.reduce((e,t)=>{let[l,a]=t,{networkNumber:d,networkType:m,networkMinIp:p,networkSubnetMask:h,...x}=a,f=d,j=m;l===s&&(o=!0,j=i,u(RegExp(l)));let g=j===i;if(g&&(c+=1),o){g?f=c:j===r&&(f-=1);let{base:t=p,mask:s=h}=ti({entries:n,type:j});e[l]={...x,networkMinIp:t,networkSubnetMask:s,networkNumber:f,networkType:j}}else e[l]=a;return e},{}))},[n,u,a]),b=(0,i.useCallback)(e=>{let{networkId:t,networkType:s}=e,r=!1,l=0;a(n.reduce((e,n)=>{let[a,i]=n;if(a===t)return r=!0,e;let{networkType:o}=i,c=o===s;return c&&(l+=1),e[a]=r&&c?{...i,networkNumber:l}:i,e},{}))},[n,a]),k=(0,i.useMemo)(()=>n.reduce((e,n)=>{let[r,{networkGateway:l,networkMinIp:a,networkNumber:i,networkSubnetMask:o,networkType:c}]=n,d="".concat(te,"-").concat(r),u=1===i,m=tl(c),p=ta(c)||!u;return e[d]={children:(0,s.jsx)(e3,{formUtils:t,networkId:r,networkNumber:i,networkType:c,networkTypeOptions:h,onClose:b,onNetworkMinIpChange:(e,t)=>{let{networkId:n}=e,{target:{value:s}}=t;return v(n,"networkMinIp",s)},onNetworkSubnetMaskChange:(e,t)=>{let{networkId:n}=e,{target:{value:s}}=t;return v(n,"networkSubnetMask",s)},onNetworkTypeChange:Z,previous:{gateway:l,minIp:a,subnetMask:o},readonlyNetworkName:!p,showCloseButton:p,showGateway:m}),md:3,sm:2},e},{}),[n,t,h,b,Z,v]);return(0,s.jsx)(ey.Z,{columns:{xs:1,sm:2,md:3},layout:{...k,"an-network-config-cell-add-network":{children:(0,s.jsx)(eY.Z,{mapPreset:"add",onClick:()=>{let{network:e,networkId:t}=x();f(t,e)}}),display:"flex",justifyContent:"center",md:3,sm:2},"an-network-config-input-cell-dns":{children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:tt,label:"DNS",value:r}),inputTestBatch:(0,w.dg)("DNS",()=>{d(tt)},{onFinishBatch:o(tt)},e=>{d(tt,{children:e})}),onFirstRender:c(tt),required:!0})},"an-network-config-input-cell-ntp":{children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:tn,label:"NTP",value:l}),onFirstRender:()=>{m(tn,!0)}})}},spacing:"1em"})};let tc={bcn1:{networkMinIp:"10.201.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"bcn"},sn1:{networkMinIp:"10.101.0.0",networkNumber:1,networkSubnetMask:"255.255.0.0",networkType:"sn"},ifn1:{networkMinIp:"",networkNumber:1,networkSubnetMask:"",networkType:"ifn"}};var td=e=>{var t;let{formUtils:n,knownFences:r,knownUpses:l,previous:{hostConfig:a,networkConfig:o={},...c}={}}=e,{networks:d=tc}=o,[u,m]=(0,i.useState)(null!==(t=null==c?void 0:c.sequence)&&void 0!==t?t:0),[p,h]=(0,i.useState)(d),x=(0,i.useMemo)(()=>Object.entries(p),[p]);return(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(eJ,{formUtils:n,onSequenceChange:e=>{let{target:{value:t}}=e;m(Number(t))},previous:c}),(0,s.jsx)(to,{formUtils:n,networkListEntries:x,previous:o,setNetworkList:h}),(0,s.jsx)(e_,{anSequence:u,formUtils:n,knownFences:r,knownUpses:l,networkListEntries:x,previous:a})]})},tu=n(45036),tm=e=>{let{formUtils:t,knownFences:n,knownUpses:r,previous:l}=e;return(0,s.jsx)(td,{formUtils:t,knownFences:n,knownUpses:r,previous:l})},tp=n(50361),th=n.n(tp),tx=n(47856),tf=n(74178),tj=n(48313);let tg=em.Ry({name:em.Z_().required(),uuid:(0,tj.uI)().required()}),tv=em.Ry({anvil:em.Vo(e=>void 0!==e?tg:em.nK().optional()),number:em.Rx(),type:em.Z_(),uuid:(0,tj.uI)().required()}),tZ=em.Z_().when(["rerun"],(e,t)=>e[0]?t.optional():t.required()),tb=em.Ry({confirmPassword:tZ.oneOf([em.iH("password")]),description:tZ,hosts:em.Vo(e=>em.Ry((0,tf.Z)(e,tv))),password:tZ,rerun:em.O7().required(),reuseHosts:em.O7().when(["hosts"],(e,t)=>{let n=e[0];return n&&Object.values(n).some(e=>!!e.anvil)?t.isTrue():t.isFalse()})});var tw=e=>{let{detail:t,knownFences:n,knownHosts:r,knownUpses:l,onSubmitSuccess:a,tools:o}=e,{anvil:c,domain:d,hostConfig:u,networkConfig:m}=t,{hosts:p}=u,{dnsCsv:h,networks:j,ntpCsv:v}=m,b=(0,i.useMemo)(()=>Object.entries(p),[p]),w=(0,i.useMemo)(()=>Object.entries(j),[j]),P=(0,i.useMemo)(()=>Object.entries(n),[n]),y=(0,i.useMemo)(()=>Object.entries(r),[r]),M=(0,i.useMemo)(()=>Object.entries(l),[l]),I=(0,i.useMemo)(()=>y.map(e=>{let[,{anvil:t,hostName:n,hostUUID:r}]=e;return{displayValue:(0,s.jsxs)(f.Z,{spacing:0,children:[(0,s.jsx)(k.Ac,{inverted:!0,children:n}),(0,s.jsx)(k.KI,{inverted:!0,children:t?"Used by ".concat(t.name):"Ready"})]}),value:r}}),[y]),{disabledSubmit:S,formik:C,formikErrors:A,handleChange:T}=(0,ej.Z)({initialValues:{confirmPassword:"",description:"",hosts:b.reduce((e,t)=>{let n;let[s,{hostName:l,hostNumber:a,hostType:i}]=t,o="";if(c){let{hosts:{[a]:{uuid:e}}}=c;o=e;let t=r[e];t&&(n=t.anvil)}else if(l){let e=y.find(e=>{let[,{shortHostName:t}]=e;return t===l});if(e){let[,t]=e;n=t.anvil,o=t.hostUUID}}return e[s]={anvil:n,number:a,type:i,uuid:o},e},{}),password:"",rerun:!!c,reuseHosts:!1},onSubmit:(e,n)=>{let{setSubmitting:l}=n,{confirmPassword:i,rerun:c,reuseHosts:u,hosts:m,...h}=e,x={...c?null:h,hosts:Object.values(m).reduce((e,t)=>{let{number:n,type:s,uuid:l}=t,a="".concat(s).concat(n);return e["".concat(s.replace("node","Subnode")," ").concat(n)]={useHost:r[l].hostName,renameTo:"".concat(p[a].hostName,".").concat(d)},e},{})};o.confirm.prepare({actionProceedText:"Run",content:(0,s.jsx)(B.Z,{entries:x,hasPassword:!0}),onCancelAppend:()=>l(!1),onProceedAppend:()=>{o.confirm.loading(!0),N.Z.put("/command/run-manifest/".concat(t.uuid),e).then(()=>{o.confirm.finish("Success",{children:(0,s.jsxs)(s.Fragment,{children:["Successfully started installing ",t.name]})}),null==a||a.call(null),o.edit.open(!1)}).catch(e=>{let t=(0,_.Z)(e);t.children=(0,s.jsxs)(s.Fragment,{children:["Failed to run install manifest. ",t.children]}),o.confirm.finish("Error",t),l(!1)})},titleText:"Run install manifest ".concat(t.name," with the following?")}),o.confirm.open()},validationSchema:tb}),F=(0,i.useMemo)(()=>"confirmPassword",[]),U=(0,i.useMemo)(()=>"description",[]),O=(0,i.useMemo)(()=>"hosts",[]),q=(0,i.useMemo)(()=>"password",[]),R=(0,i.useMemo)(()=>"reuseHosts",[]),E=(0,i.useMemo)(()=>b.reduce((e,t)=>{let[n,{hostNumber:l,hostType:a}]=t,i="".concat(O,".").concat(n),o="".concat(i,".uuid"),c="".concat(a.replace("node","Subnode")," ").concat(l);return e.push((0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(Z.Z,{id:o,label:c,name:o,onChange:e=>{let{target:{value:t}}=e,{[t]:{anvil:s}}=r,i=th()(C.values.hosts),o=Object.entries(i).find(e=>{let[s,{uuid:r}]=e;return s!==n&&r===t});if(o){let[e,t]=o,{number:s,type:r}=t;i[e]={...i[n],number:s,type:r}}return i[n]={anvil:s,number:l,type:a,uuid:t},C.setFieldValue(O,i)},required:!0,selectItems:I,selectProps:{renderValue:e=>{let{[e]:{hostName:t}}=r;return t}},value:C.values.hosts[n].uuid})},"".concat(n,"-selector"))),e},[(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Ac,{children:"Use host"})},"host-selector-header")]),[C,b,I,O,r]),D=(0,i.useMemo)(()=>b.reduce((e,t)=>{let[n,{hostName:r}]=t;return e.push((0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsxs)(k.$_,{noWrap:!0,children:[r,".",d]})},"".concat(n,"-rename"))),e},[(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Ac,{children:"New hostname"})},"host-rename-header")]),[b,d]),L=(0,i.useMemo)(()=>w.reduce((e,t)=>{let[n,r]=t,{networkNumber:l,networkType:a}=r,i="".concat(a.toLocaleUpperCase()).concat(l),o=b.map(e=>{let[t,{networks:r}]=e,l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.$_,{children:e})},"".concat(n,"-").concat(t,"-ip"))};if(!r)return l();let{[n]:a}=r;if(!a)return l();let{networkIp:i}=a;return l(i)});return e.push((0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Ac,{children:i})},"".concat(n,"-header")),...o),e},[]),[b,w]),V=(0,i.useMemo)(()=>P.reduce((e,t)=>{let[n,r]=t,{fenceName:l}=r,a=b.map(e=>{let[t,{fences:r}]=e,a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.$_,{children:e})},"".concat(n,"-").concat(t,"-port"))};if(!r)return a();let{[l]:i}=r;if(!i)return a();let{fencePort:o}=i;return a(o)});return e.push((0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsxs)(k.Ac,{children:["Plug on ",l]})},"".concat(n,"-header")),...a),e},[]),[b,P]),z=(0,i.useMemo)(()=>M.reduce((e,t)=>{let[n,r]=t,{upsName:l}=r,a=b.map(e=>{let[t,{upses:r}]=e,a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.$_,{children:e})},"".concat(n,"-").concat(t,"-used"))};if(!r)return a();let{[l]:i}=r;if(!i)return a();let{isUsed:o}=i;return a(o?"yes":"no")});return e.push((0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsxs)(k.Ac,{children:["Uses ",l]})},"".concat(n,"-header")),...a),e},[]),[b,M]),$=(0,i.useMemo)(()=>{let e;let t=w.find(e=>{let{1:{networkGateway:t}}=e;return!!t}),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.$_,{justifyContent:"end",children:e})},"gateway-value")};if(t){let[,{networkGateway:s}]=t;e=s&&s.length>0?n(s):n()}else e=n();return[(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Ac,{children:"Gateway"})},"gateway-header"),e]},[w]),G=(0,i.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.$_,{justifyContent:"end",children:e})},"dns-value")},t=h&&h.length>0?e(h):e();return[(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Ac,{children:"DNS"})},"dns-header"),t]},[h]),W=(0,i.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"--";return(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.$_,{justifyContent:"end",children:e})},"ntp-value")},t=v&&v.length>0?e(v):e();return[(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(k.Ac,{children:"NTP"})},"ntp-header"),t]},[v]),Q=(0,i.useMemo)(()=>{let e=Object.values(C.values.hosts).filter(e=>!!e.anvil);if(0===e.length)return null;let t=e.slice(1).reduce((e,t)=>"".concat(e,", ").concat(r[t.uuid].shortHostName),r[e[0].uuid].shortHostName);return(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsxs)(eM.Z,{children:[(0,s.jsx)(tx.Z,{id:R,invert:!0,name:R,onChange:C.handleChange,required:!0,sx:{marginRight:".5em"},thinPadding:!0,value:C.values.reuseHosts}),"Confirm reusing host(s): ",t,"."]})})},[C,r,R]);return(0,s.jsxs)(et.ZP,{columns:{xs:1,sm:2},component:"form",container:!0,onSubmit:e=>{e.preventDefault(),C.submitForm()},spacing:"1em",children:[c?(0,s.jsxs)(et.ZP,{item:!0,width:"100%",children:[(0,s.jsx)(k.Ac,{children:"Description"}),(0,s.jsx)(k.Ac,{children:c.description})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsx)(ef.Z,{input:(0,s.jsx)(g.Z,{id:U,label:"Description",name:U,onChange:T,required:!0,value:C.values.description})})}),(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(ef.Z,{input:(0,s.jsx)(g.Z,{disableAutofill:!0,id:q,label:"Password",name:q,onChange:T,required:!0,type:x.Z.password,value:C.values.password})})}),(0,s.jsx)(et.ZP,{item:!0,xs:1,children:(0,s.jsx)(ef.Z,{input:(0,s.jsx)(g.Z,{disableAutofill:!0,id:F,label:"Confirm password",name:F,onChange:T,required:!0,type:x.Z.password,value:C.values.confirmPassword})})})]}),(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsxs)(et.ZP,{alignItems:"center",columns:b.length+1,columnSpacing:"1em",container:!0,rowSpacing:".6em",children:[...E,...D,...L,...V,...z]})}),(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsxs)(et.ZP,{columns:2,container:!0,spacing:".6em",children:[...$,...G,...W]})}),Q,(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsx)(H.Z,{count:1,messages:A})}),(0,s.jsx)(et.ZP,{item:!0,width:"100%",children:(0,s.jsx)(ec.Z,{actions:[{background:"blue",children:"Run",disabled:S,type:"submit"}]})})]})};let tk=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[{target:s}]=t,{elements:r}=s,{value:l}=r.namedItem(eV),{value:a}=r.namedItem(ez),{value:i}=r.namedItem(e$),{value:o}=r.namedItem(tt),{value:c}=r.namedItem(tn),d=Number.parseInt(i,10);return Object.values(r).reduce((e,t)=>{var n,s;let{id:r}=t;if(RegExp("^".concat(eI)).test(r)){let{dataset:{handler:s=""}}=t;null===(n=eA[s])||void 0===n||n.call(null,e,t)}else if(RegExp("^".concat(e0)).test(r)){let{dataset:{handler:n=""}}=t;null===(s=e2[n])||void 0===s||s.call(null,e,t)}return e},{domain:l,hostConfig:{hosts:{}},networkConfig:{dnsCsv:o,networks:{},ntpCsv:c},prefix:a,sequence:d})};var tP=()=>{let e=(0,i.useRef)({}),t=(0,i.useRef)({}),n=(0,i.useRef)({}),r=(0,i.useRef)(null),l=(0,i.useRef)({}),[a,o]=(0,V.Z)(),[c,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!0),[p,h]=(0,i.useState)(),{data:x,loading:j,mutate:g}=(0,z.Z)("/manifest",{refreshInterval:1e4}),{data:Z,loading:b,mutate:w}=(0,z.Z)("/manifest/template"),{data:P,loading:y,mutate:M}=(0,z.Z)("/host?type=subnode"),I=(0,$.Z)([eV,ez,e$,tt,tn],l),{isFormInvalid:S,isFormSubmitting:C,submitForm:A}=I,{buildDeleteDialogProps:F,checks:U,getCheck:O,hasChecks:R,resetChecks:G,setCheck:W}=(0,L.Z)({list:x}),{name:Q,uuid:J}=(0,i.useMemo)(()=>null!=p?p:{},[p]),{domain:X,fences:K,prefix:Y,sequence:ee,upses:et}=(0,i.useMemo)(()=>null!=Z?Z:{},[Z]),en=(0,i.useCallback)(e=>{let{hostConfig:{hosts:t}}=e,n=Object.values(t).reduce((e,t)=>{let{fences:n,hostType:s,hostNumber:r}=t,l="".concat(s.replace(/node/,"subnode")).concat(r);return n?e[l]=Object.values(n).reduce((e,t)=>{let{fencePort:n}=t;return e+(n.length?1:0)},0):e[l]=0,e},{}),r=Object.entries(n).map(e=>{let[t,n]=e;return n?(0,s.jsx)(s.Fragment,{}):(0,s.jsxs)(eM.Z,{children:["No fence device port specified for ",t,"."]},"".concat(t,"-no-fence-port-message"))});return{counts:n,messages:r}},[]),es=(0,i.useMemo)(()=>({actionProceedText:"Add",content:(0,s.jsx)(td,{formUtils:I,knownFences:K,knownUpses:et,previous:{domain:X,prefix:Y,sequence:ee}}),onSubmitAppend:function(){for(var t,n=arguments.length,r=Array(n),l=0;l<n;l++)r[l]=arguments[l];let a=tk(...r),{messages:i}=en(a);o({actionProceedText:"Add",content:(0,s.jsx)(B.Z,{entries:a,maxDepth:6}),onProceedAppend:()=>{A({body:a,getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to add install manifest. ",e]}),method:"post",onSuccess:()=>g(),successMsg:"Successfully added install manifest",url:"/manifest"})},preActionArea:(0,s.jsx)(f.Z,{spacing:".3em",children:i}),titleText:"Add install manifest?"}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},titleText:"Add an install manifest"}),[en,I,g,K,et,X,Y,ee,o,A]),er=(0,i.useMemo)(()=>({actionProceedText:"Update",content:(0,s.jsx)(tm,{formUtils:I,knownFences:K,knownUpses:et,previous:p}),onSubmitAppend:function(){for(var t,n=arguments.length,r=Array(n),l=0;l<n;l++)r[l]=arguments[l];let a=tk(...r),{messages:i}=en(a);o({actionProceedText:"Update",content:(0,s.jsx)(B.Z,{entries:a,maxDepth:6}),onProceedAppend:()=>{A({body:a,getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to update install manifest. ",e]}),method:"put",onSuccess:()=>g(),successMsg:"Successfully updated install manifest ".concat(Q),url:"/manifest/".concat(J)})},preActionArea:(0,s.jsx)(f.Z,{spacing:".3em",children:i}),titleText:"Update install manifest ".concat(Q,"?")}),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},loading:u,titleText:"Update install manifest ".concat(Q)}),[en,I,g,u,K,et,p,Q,J,o,A]),el=(0,i.useCallback)((e,t)=>{m(!0),N.Z.get("manifest/".concat(e)).then(t=>{let{data:n}=t;n.uuid=e,h(n)}).catch(e=>{(0,_.Z)(e)}).finally(()=>{m(!1),null==t||t.call(null)})},[m,h]),ea=(0,i.useMemo)(()=>(0,s.jsx)(D.Z,{allowEdit:!0,allowItemButton:c,disableDelete:!R,edit:c,header:!0,listEmpty:"No manifest(s) registered.",listItems:x,onAdd:()=>{var e;null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var t;o(F({onProceedAppend:()=>{A({body:{uuids:U},getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Delete manifest(s) failed. ",e]}),method:"delete",onSuccess:()=>{g(),G()},url:"/manifest"})},getConfirmDialogTitle:e=>"Delete ".concat(e," manifest(s)?"),renderEntry:e=>{let{key:t}=e;return(0,s.jsx)(k.Ac,{children:null==x?void 0:x[t].manifestName})}})),null===(t=e.current.setOpen)||void 0===t||t.call(null,!0)},onEdit:()=>{d(e=>!e)},onItemCheckboxChange:(e,t,n)=>{W(e,n)},onItemClick:e=>{var t;let{manifestName:s,manifestUUID:r}=e;h({name:s,uuid:r}),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0),el(r)},renderListItemCheckboxState:e=>O(e),renderListItem:(e,t)=>{let{manifestName:n}=t;return(0,s.jsxs)(f.Z,{fullWidth:!0,row:!0,children:[(0,s.jsx)(eY.Z,{disabled:c,mapPreset:"play",onClick:()=>{var t;null===(t=r.current)||void 0===t||t.setOpen(!0),el(e)},variant:"normal"}),(0,s.jsx)(k.Ac,{children:n})]})}}),[F,U,O,el,g,R,c,x,G,W,o,h,A]),ei=(0,i.useMemo)(()=>y||b||j?(0,s.jsx)(T.Z,{}):ea,[y,j,b,ea]),eo=(0,i.useMemo)(()=>(0,s.jsx)(H.Z,{count:1,defaultMessageType:"warning",ref:l}),[]),{confirmDialog:ec,finishConfirm:ed,setConfirmDialogLoading:eu,setConfirmDialogOpen:em,setConfirmDialogProps:ep}=(0,eZ.Z)({initial:{scrollContent:!0,wide:!0}}),eh=(0,i.useMemo)(()=>({add:{open:()=>null},confirm:{finish:ed,loading:eu,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return em(e)},prepare:ep},edit:{open:function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return null==r?void 0:null===(e=r.current)||void 0===e?void 0:e.setOpen(t)}}}),[ed,eu,em,ep]),ex=(0,i.useMemo)(()=>b||u||y,[y,u,b]),ef=(0,i.useMemo)(()=>p&&K&&P&&et&&(0,s.jsx)(tw,{detail:p,knownFences:K,knownHosts:P,knownUpses:et,onSubmitSuccess:()=>{w(),M()},tools:eh}),[eh,M,w,P,K,et,p]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(v.s_,{children:[(0,s.jsx)(v.V9,{children:(0,s.jsx)(k.z,{children:"Manage manifests"})}),ei]}),(0,s.jsx)(E.Z,{...es,disableProceed:S,loadingAction:C,preActionArea:eo,ref:t,scrollContent:!0,showClose:!0}),(0,s.jsx)(E.Z,{...er,disableProceed:S,loadingAction:C,preActionArea:eo,ref:n,scrollContent:!0,showClose:!0}),(0,s.jsx)(tu.Js,{header:"".concat((null==p?void 0:p.anvil)?"Rerun":"Run"," install manifest ").concat(null==p?void 0:p.name),loading:ex,ref:r,showClose:!0,wide:!0,children:ef}),(0,s.jsx)(q.Z,{closeOnProceed:!0,...a,ref:e,scrollContent:!0,wide:!0}),ec]})};let ty="common-ups-input-ip-address",tM="common-ups-input-host-name",tI="IP address",tS="Host name";var tC=e=>{let{formUtils:{buildFinishInputTestBatchFunction:t,buildInputFirstRenderFunction:n,setMessage:r},previous:{upsIPAddress:l,upsName:a}={}}=e;return(0,s.jsx)(ey.Z,{columns:{xs:1,sm:2},layout:{"common-ups-input-cell-host-name":{children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:tM,label:tS,value:a}),inputTestBatch:(0,w.Gn)(tS,()=>{r(tM)},{onFinishBatch:t(tM)},e=>{r(tM,{children:e})}),onFirstRender:n(tM),required:!0})},"common-ups-input-cell-ip-address":{children:(0,s.jsx)(j.Z,{input:(0,s.jsx)(g.Z,{id:ty,label:tI,value:l}),inputTestBatch:(0,w._)(tI,()=>{r(ty)},{onFinishBatch:t(ty)},e=>{r(ty,{children:e})}),onFirstRender:n(ty),required:!0})}},spacing:"1em"})},tA=n(65716);let tT="add-ups-select-ups-type-id";var tF=e=>{let{formUtils:t,loading:n,previous:r={},upsTemplate:l}=e,{buildInputFirstRenderFunction:a,setValidity:o}=t,{upsTypeId:c=""}=r,d=(0,F.Z)(),[u,m]=(0,i.useState)(c),p=(0,i.useMemo)(()=>l?Object.entries(l).map(e=>{let t,[n,{brand:r,description:l,links:{0:a}}]=e;if(a){let{linkHref:e,linkLabel:n}=a;t=(0,s.jsx)(tA.Z,{href:e,onClick:e=>{e.stopPropagation()},sx:{display:"inline-flex",color:es.E5},target:"_blank",children:n})}return{displayValue:(0,s.jsxs)(f.Z,{spacing:0,children:[(0,s.jsx)(k.Ac,{inverted:!0,children:r}),(0,s.jsxs)(k.Ac,{inverted:!0,children:[l," (",t,")"]})]}),value:n}}):[],[l]),h=(0,i.useMemo)(()=>l&&(0,s.jsx)(Z.Z,{formControlProps:{sx:{marginTop:".3em"}},id:tT,label:"UPS type",onChange:e=>{let{target:{value:t}}=e,n=String(t);o(tT,!0),m(n)},required:!0,selectItems:p,selectProps:{onClearIndicatorClick:()=>{o(tT,!1),m("")},renderValue:e=>{let{brand:t}=l[String(e)];return t}},value:u}),[l,p,u,o]),x=(0,i.useMemo)(()=>n?(0,s.jsx)(T.Z,{}):(0,s.jsxs)(f.Z,{children:[h,u&&(0,s.jsx)(tC,{formUtils:t,previous:r})]}),[t,u,n,h,r]);return(0,i.useEffect)(()=>{d&&a(tT)({isValid:!!u})},[a,u,d]),x};let tU="edit-ups-input-ups-uuid";var tO=e=>{let{formUtils:t,loading:n,previous:r,upsTemplate:l,upsUUID:a}=e;return(0,i.useMemo)(()=>n?(0,s.jsx)(T.Z,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tF,{formUtils:t,previous:r,upsTemplate:l}),(0,s.jsx)("input",{hidden:!0,id:tU,readOnly:!0,value:a})]}),[t,n,r,l,a])};let tN=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];let[{target:r}]=n,{elements:l}=r,{value:a}=l.namedItem(tM),{value:i}=l.namedItem(ty),o=l.namedItem(tT),c="",d="",u="";o&&({value:u}=o,{agent:c,brand:d}=e[u]);let m=l.namedItem(tU),p="";return m&&({value:p}=m),{agent:c,brand:d,ipAddress:i,name:a,typeId:u,uuid:p}},tq=e=>{let{brand:t,ipAddress:n,name:r,uuid:l}=e;return(0,s.jsx)(D.Z,{listItems:{"ups-brand":{label:"Brand",value:t},"ups-name":{label:"Host name",value:r},"ups-ip-address":{label:"IP address",value:n}},listItemProps:{sx:{padding:0}},renderListItem:(e,t)=>{let{label:n,value:r}=t;return(0,s.jsxs)(f.Z,{fullWidth:!0,growFirst:!0,row:!0,children:[(0,s.jsx)(k.Ac,{children:n}),(0,s.jsx)(k.$_,{children:r})]},"confirm-ups-".concat(l,"-").concat(e))}})};var tR=()=>{let e=(0,F.Z)(),t=(0,i.useRef)({}),n=(0,i.useRef)({}),r=(0,i.useRef)({}),[l,a]=(0,V.Z)(),[o,c]=(0,V.Z)(),[d,u]=(0,i.useState)(!1),[m,p]=(0,i.useState)(!0),[h,x]=(0,i.useState)(),{data:j,loading:g}=(0,z.Z)("/ups",{refreshInterval:6e4}),Z=(0,$.Z)([ty,tM,tT],r),{isFormInvalid:b,isFormSubmitting:w,submitForm:P}=Z,{buildDeleteDialogProps:y,checks:M,getCheck:I,hasChecks:S,setCheck:C}=(0,L.Z)({list:j}),A=(0,i.useCallback)(e=>{var n,r;let{upsAgent:l,upsIPAddress:i,upsName:o,upsUUID:c}=e,d=null!==(r=null===(n=Object.entries(null!=h?h:{}).find(e=>{let[,{agent:t}]=e;return l===t}))||void 0===n?void 0:n[0])&&void 0!==r?r:"";return{actionProceedText:"Update",content:(0,s.jsx)(tO,{formUtils:Z,previous:{upsIPAddress:i,upsName:o,upsTypeId:d},upsTemplate:h,upsUUID:c}),onSubmitAppend:e=>{var n;if(!h)return;let r=tN(h,e),{name:l}=r;a({actionProceedText:"Update",content:tq(r),onProceedAppend:()=>{P({body:r,getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to update UPS. ",e]}),method:"put",successMsg:"Successfully updated UPS ".concat(o),url:"/ups/".concat(c)})},titleText:(0,s.jsxs)(k.z,{children:["Update"," ",(0,s.jsx)(k.Q0,{fontSize:"inherit",children:l})," ","with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:(0,s.jsxs)(k.z,{children:["Update UPS"," ",(0,s.jsx)(k.Q0,{fontSize:"inherit",children:o})]})}},[Z,a,P,h]),U=(0,i.useMemo)(()=>({actionProceedText:"Add",content:(0,s.jsx)(tF,{formUtils:Z,upsTemplate:h}),onSubmitAppend:e=>{var n;if(!h)return;let r=tN(h,e),{brand:l,name:i}=r;a({actionProceedText:"Add",content:tq(r),onProceedAppend:()=>{P({body:r,getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to add UPS. ",e]}),method:"post",successMsg:"Successfully added UPS ".concat(i),url:"/ups"})},titleText:(0,s.jsxs)(k.z,{children:["Add a"," ",(0,s.jsx)(k.Q0,{fontSize:"inherit",children:l})," UPS with the following data?"]})}),null===(n=t.current.setOpen)||void 0===n||n.call(null,!0)},titleText:"Add a UPS"}),[Z,a,P,h]),O=(0,i.useMemo)(()=>(0,s.jsx)(D.Z,{allowEdit:!0,allowItemButton:d,disableDelete:!S,edit:d,header:!0,listEmpty:"No Ups(es) registered.",listItems:j,onAdd:()=>{var e;c(U),null===(e=n.current.setOpen)||void 0===e||e.call(null,!0)},onDelete:()=>{var e;a(y({getConfirmDialogTitle:e=>"Delete ".concat(e," UPSes?"),onProceedAppend:()=>{P({body:{uuids:M},getErrorMsg:e=>(0,s.jsxs)(s.Fragment,{children:["Failed to delete UPS(es). ",e]}),method:"delete",url:"/ups"})},renderEntry:e=>{let{key:t}=e;return(0,s.jsx)(k.Ac,{children:null==j?void 0:j[t].upsName})}})),null===(e=t.current.setOpen)||void 0===e||e.call(null,!0)},onEdit:()=>{u(e=>!e)},onItemCheckboxChange:(e,t,n)=>{C(e,n)},onItemClick:e=>{var t;c(A(e)),null===(t=n.current.setOpen)||void 0===t||t.call(null,!0)},renderListItemCheckboxState:e=>I(e),renderListItem:(e,t)=>{let{upsAgent:n,upsIPAddress:r,upsName:l}=t;return(0,s.jsxs)(f.Z,{fullWidth:!0,row:!0,children:[(0,s.jsx)(k.Ac,{children:l}),(0,s.jsxs)(k.Ac,{children:['agent="',n,'"']}),(0,s.jsxs)(k.Ac,{children:['ip="',r,'"']})]})}}),[U,y,A,M,I,S,d,C,a,c,P,j]),R=(0,i.useMemo)(()=>m||g?(0,s.jsx)(T.Z,{}):O,[m,g,O]),B=(0,i.useMemo)(()=>(0,s.jsx)(H.Z,{count:1,defaultMessageType:"warning",ref:r}),[]);return e&&N.Z.get("/ups/template").then(e=>{let{data:t}=e;x(t)}).catch(e=>{(0,_.Z)(e)}).finally(()=>{p(!1)}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(v.s_,{children:[(0,s.jsx)(v.V9,{children:(0,s.jsx)(k.z,{children:"Manage UPSes"})}),R]}),(0,s.jsx)(E.Z,{...o,disableProceed:b,loadingAction:w,preActionArea:B,ref:n,showClose:!0}),(0,s.jsx)(q.Z,{closeOnProceed:!0,...l,ref:t})]})},tE=n(92214);let tB="prepare-host",t_="prepare-network",tD="manage-fence",tH="manage-ups",tL="manage-manifest",tV={[tB]:"Prepare Host",[t_]:"Prepare Network",[tD]:"Manage Fence Devices",[tH]:"Manage UPSes",[tL]:"Manage Manifests"},tz="Loading",t$=()=>(0,s.jsx)(tE.Z,{children:(0,s.jsx)(Y.y,{})}),tG=()=>(0,s.jsx)(tE.Z,{children:(0,s.jsx)(ek,{})}),tW=()=>(0,s.jsx)(tE.Z,{children:(0,s.jsx)(K,{})}),tQ=()=>(0,s.jsx)(tE.Z,{children:(0,s.jsx)(tR,{})}),tJ=()=>(0,s.jsx)(tE.Z,{children:(0,s.jsx)(tP,{})});var tX=()=>{let{isReady:e,push:t,query:n}=(0,a.useRouter)(),[r,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(tz);return(0,i.useEffect)(()=>{if(!e)return;let{step:s}=n,l=(0,o.Z)(s,{fallbackValue:tB});tV[l]||(l=tB),t({query:{...n,step:l}},void 0,{shallow:!0}),u===tz&&m(tV[l]),r||d(l)},[e]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l(),{children:(0,s.jsx)("title",{children:u})}),(0,s.jsx)(c.Z,{}),(0,s.jsx)(v.s_,{children:(0,s.jsxs)(el.Z,{onChange:(e,s)=>{d(s),m(tV[s]),t({query:{...n,step:s}},void 0,{shallow:!0})},orientation:{xs:"vertical",sm:"horizontal"},value:r,children:[(0,s.jsx)(er.Z,{label:"Prepare host",value:tB}),(0,s.jsx)(er.Z,{label:"Prepare network",value:t_}),(0,s.jsx)(er.Z,{label:"Manage fence devices",value:tD}),(0,s.jsx)(er.Z,{label:"Manage UPSes",value:tH}),(0,s.jsx)(er.Z,{label:"Manage manifests",value:tL})]})}),(0,s.jsx)(ew.Z,{changingTabId:r,tabId:tB,children:(0,s.jsx)(t$,{})}),(0,s.jsx)(ew.Z,{changingTabId:r,tabId:t_,children:(0,s.jsx)(tG,{})}),(0,s.jsx)(ew.Z,{changingTabId:r,tabId:tD,children:(0,s.jsx)(tW,{})}),(0,s.jsx)(ew.Z,{changingTabId:r,tabId:tH,children:(0,s.jsx)(tQ,{})}),(0,s.jsx)(ew.Z,{changingTabId:r,tabId:tL,children:(0,s.jsx)(tJ,{})})]})}}},function(e){e.O(0,[662,256,760,14,245,145,48,538,771,25,215,436,590,879,846,489,504,888,774,179],function(){return e(e.s=29582)}),_N_E=e.O()}]);