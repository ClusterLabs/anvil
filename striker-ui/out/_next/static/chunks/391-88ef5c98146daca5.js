"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[391],{2690:(e,n,l)=>{l.d(n,{pO:()=>S,lN:()=>G,i:()=>Q,wL:()=>K});var t=l(37876),r=l(48504),o=l(92156),s=l(49209),i=l(34713),c=l(12981),a=l(77018),u=l(54773),d=l(18847),h=l.n(d),f=l(14232),m=l(49948),v=l(22481);let x="0xffe3",p="0xffe9",j=[{keys:"Ctrl + Alt + Delete",scans:[]},{keys:"Ctrl + Alt + F1",scans:[x,p,"0xffbe"]},{keys:"Ctrl + Alt + F2",scans:[x,p,"0xffbf"]},{keys:"Ctrl + Alt + F3",scans:[x,p,"0xffc0"]},{keys:"Ctrl + Alt + F4",scans:[x,p,"0xffc1"]},{keys:"Ctrl + Alt + F5",scans:[x,p,"0xffc2"]},{keys:"Ctrl + Alt + F6",scans:[x,p,"0xffc3"]},{keys:"Ctrl + Alt + F7",scans:[x,p,"0xffc4"]},{keys:"Ctrl + Alt + F8",scans:[x,p,"0xffc5"]},{keys:"Ctrl + Alt + F9",scans:[x,p,"0xffc6"]}];var g=l(74503),A=l(72015),b=l(23437),C=l(98513),y=l(79982),k=l(51677);let w="FullSize",F={displayBox:"".concat(w,"-displayBox"),spinnerBox:"".concat(w,"-spinnerBox")},M=(0,u.Ay)("div")(()=>({["& .".concat(F.displayBox)]:{width:"75vw",height:"75vh"},["& .".concat(F.spinnerBox)]:{flexDirection:"column",width:"75vw",height:"75vh",alignItems:"center",justifyContent:"center"}})),B=h()(()=>Promise.all([l.e(346),l.e(285)]).then(l.bind(l,83285)),{loadableGenerated:{webpack:()=>[83285]},ssr:!1}),I={1e3:"in-use by another process?",1006:"destination is down?"},S=function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let[u]=n,{node:d,onClickCloseButton:h,server:x,vncReconnectTimerStart:p=3}=u,[w]=(0,m.lT)(["suiapi.vncerror.".concat(x.uuid)]),S=(()=>{let e=(0,f.useRef)(!0);return e.current?(e.current=!1,!0):e.current})(),[P,z]=(0,f.useState)(null),[E,R]=(0,f.useState)(void 0),[T,W]=(0,f.useState)(!1),[q,H]=(0,f.useState)(!1),[N,O]=(0,f.useState)(),[Q,D]=(0,f.useState)(),[_,G]=(0,f.useState)(p),K=(0,f.useRef)(null),L=(0,f.useRef)(null),V=e=>{z(e.currentTarget)},J=(0,f.useCallback)(()=>{let e,n;W(!0),H(!1),R({url:(e=window.location.host,n=x.uuid,"ws://".concat(e,"/ws/server/vnc/").concat(n))})},[x.uuid]),U=(0,f.useCallback)(()=>{(null==K?void 0:K.current)&&(K.current.disconnect(),K.current=null),R(void 0)},[]),X=(0,f.useCallback)(()=>{U(),J()},[J,U]),Z=(0,f.useCallback)(()=>{let e=setInterval(()=>{G(n=>{let l=n-1;return l<1&&clearInterval(e),l})},1e3)},[]),$=(0,f.useCallback)(()=>{W(!1)},[]),Y=(0,f.useCallback)(e=>{let{clean:n}=e.detail;n||(W(!1),H(!0),Z())},[Z]),ee=(0,f.useCallback)(e=>{if(!e)return void O(void 0);let{code:n,reason:l}=e,t="ws: ".concat(n),r=I[n];r&&(t+=" (".concat(r,")")),l&&(t+=", ".concat(l)),O(t);let o=w["suiapi.vncerror.".concat(x.uuid)];if(!o)return void D(void 0);let{code:s,message:i}=o;D("api: ".concat(s,", ").concat(i))},[w,x.uuid]),en=(0,f.useMemo)(()=>!T&&!q,[T,q]),el=(0,f.useMemo)(()=>(0,t.jsx)(c.A,{children:(0,t.jsx)(v.A,{onClick:()=>{var e;null==(e=L.current)||e.requestFullscreen()},children:(0,t.jsx)(s.A,{})})}),[]),et=(0,f.useMemo)(()=>(0,t.jsxs)(c.A,{children:[(0,t.jsx)(v.A,{onClick:V,children:(0,t.jsx)(i.A,{})}),(0,t.jsx)(g.A,{open:!!P,slotProps:{menu:{anchorEl:P,keepMounted:!0,onClose:()=>z(null)}},children:j.map(e=>{let{keys:n,scans:l}=e;return(0,t.jsx)(A.A,{onClick:()=>(e=>{if(K.current){if(e.length){for(let n=0;n<=e.length-1;n+=1)K.current.sendKey(e[n],1);for(let n=e.length-1;n>=0;n-=1)K.current.sendKey(e[n],0)}else K.current.sendCtrlAltDel();z(null)}})(l),children:(0,t.jsx)(a.A,{variant:"subtitle1",children:n})},n)})})]}),[P]),er=(0,f.useMemo)(()=>(0,t.jsx)(c.A,{children:(0,t.jsx)(v.A,{onClick:function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];U(),null==h||h.call(null,...n)},children:(0,t.jsx)(r.A,{})})}),[U,h]),eo=(0,f.useMemo)(()=>(0,t.jsx)(c.A,{children:(0,t.jsx)(v.A,{onClick:()=>{window&&(U(),window.location.assign("/"))},children:(0,t.jsx)(o.A,{})})}),[U]),es=(0,f.useMemo)(()=>(0,t.jsxs)(t.Fragment,{children:[el,et,(0,t.jsx)(C.A,{node:d,server:x}),eo,er]}),[el,et,d,eo,x,er]);return(0,f.useEffect)(()=>{0===_&&(G(p),X())},[X,_,p]),(0,f.useEffect)(()=>{S&&J()},[J,S]),(0,t.jsxs)(b.Zk,{children:[(0,t.jsxs)(b.aO,{children:[(0,t.jsx)(k.HM,{text:"Server: ".concat(x.name)}),es]}),(0,t.jsxs)(M,{children:[(0,t.jsx)(c.A,{display:en?"flex":"none",className:F.displayBox,children:(0,t.jsx)(B,{onConnect:$,onDisconnect:Y,onWsClose:ee,rfb:K,rfbConnectArgs:E,rfbScreen:L})}),!en&&(0,t.jsxs)(c.A,{display:"flex",className:F.spinnerBox,textAlign:"center",children:[T&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(k.HM,{children:["Connecting to ",x.name,"."]}),(0,t.jsx)(y.A,{})]}),q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.HM,{children:"Can't connect to the server."}),(0,t.jsx)(k.a3,{children:Q}),(0,t.jsx)(k.a3,{children:N}),(0,t.jsxs)(k.HM,{mt:".5em",children:["Retrying in ",_,"."]})]})]})]})]})};var P=l(56744),z=l(73460),E=l(86250),R=l(52076),T=l.n(R),W=l(50046),q=l.n(W),H=l(90890),N=l(78792),O=l(37422);let Q=(0,u.Ay)(c.A)({alignItems:"center",display:"flex",justifyContent:"center",margin:".2em",overflow:"hidden",position:"relative"});var D=l(71603),_=l(59664);let G=function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let[r]=n,{onClick:o,server:s,slotProps:i,slots:a}=r,{href:u="/server?name=".concat(s.name,"&view=vnc")}=r,{data:d,loading:h}=(0,_.A)("/server/".concat(s.uuid,"?ss=1"),{refreshInterval:6e4}),m=null==d?void 0:d.screenshot,v=null==d?void 0:d.timestamp,x=(0,D.tB)(),p=(0,f.useMemo)(()=>!!v&&!(0,D.HV)(v,300),[v]),j=(0,f.useMemo)(()=>{var e;return null!=(e=null==a?void 0:a.screenshotBox)?e:(0,t.jsx)(Q,{})},[null==a?void 0:a.screenshotBox]),g=(0,f.useMemo)(()=>({...null==i?void 0:i.screenshotBox}),[null==i?void 0:i.screenshotBox]),A=(0,f.useMemo)(()=>N.A.states.blocking.includes(s.state),[s.state]),b=(0,f.useMemo)(()=>{let e,n;if(A){if(!s.jobs)return;return(0,f.cloneElement)(j,g,(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(k.a3,{children:[T()(s.state),"..."]}),Object.values(s.jobs).map((e,n)=>{let{peer:l,progress:r,uuid:o}=e;return(0,t.jsx)(O.A,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(7em - ".concat(1.5*n,"em)"),sx:{opacity:l?.6:void 0,["& .".concat(z.A.circle)]:{strokeLinecap:"round"}},thickness:3},underline:{thickness:+!r}},value:r},"".concat(o,"-progress"))})]}))}if(h)return(0,f.cloneElement)(j,g,(0,t.jsx)(y.A,{mt:0}));if("running"!==s.state)return(0,f.cloneElement)(j,g,(0,t.jsx)(P.A,{sx:{color:H.XS,height:"100%",width:"auto"}}));let l="1";if(v&&p){l="0.4";let{unit:n,value:r}=(0,D.vk)(x-v);e=(0,t.jsxs)(k.a3,{position:"absolute",children:["Updated ~",r," ",n," ago"]})}let r=null==i?void 0:i.screenshot;return r&&({sx:n,...r}=r),(0,f.cloneElement)(j,g,(0,t.jsx)(c.A,{alt:"".concat(T()(s.state),". Preview unavailable"),component:"img",src:"data:image;base64,".concat(m),sx:q()({color:H.Qu,fontFamily:"Roboto Condensed",height:m?"100%":"auto",opacity:l,width:"auto"},n),...r}),e)},[A,h,x,m,s.jobs,s.state,null==i?void 0:i.screenshot,p,v,j,g]);return(0,f.useMemo)(()=>{let e,n=null==i?void 0:i.button;return n&&({sx:e,...n}=n),(0,f.createElement)(E.A,{disabled:A,href:u,onClick:o,sx:q()({padding:0,width:"calc(100% - 0em)"},e),...n},b)},[A,b,o,u,null==i?void 0:i.button])},K=function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let[r]=n,{children:o,getHeader:s=e=>{let{name:n}=e;return(0,t.jsx)(k.a3,{children:n})},server:i,showControls:c=!0,slotProps:a}=r;return(0,t.jsxs)(b.t$,{mb:0,mt:0,...null==a?void 0:a.panel,children:[(0,t.jsxs)(b.WJ,{...null==a?void 0:a.header,children:[s(i),c&&(0,t.jsx)(C.A,{node:i.anvil,server:i,slotProps:{button:{slotProps:{button:{icon:{size:"small"}}}}}})]}),o]})}},44981:(e,n,l)=>{l.d(n,{A:()=>r});let t=e=>{let{free:n,size:l,used:t,...r}=e,o=BigInt(0),s=BigInt(0),i=BigInt(0);try{o=BigInt(n),s=BigInt(l),i=t?BigInt(t):s-o}catch(e){}return{...r,free:o,size:s,used:i}},r=e=>{let{storage:n,...l}=e,r=Object.values(n.volumeGroups).reduce((e,n)=>(e[n.uuid]=t(n),e),{}),o=t(n.volumeGroupTotals);return{...l,storage:{volumeGroups:r,volumeGroupTotals:o}}}},46274:(e,n,l)=>{l.d(n,{A:()=>s});var t=l(37876),r=l(23934),o=l(5806);let s=function(e,n,l){var s,i;let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{body:a,description:u,messages:d,method:h="put",onCancel:f,onFail:m,onProceed:v,onSuccess:x,dangerous:p=/delete/i.test(null!=(s=null==d?void 0:d.proceed)?s:"")}=c;e.confirm.prepare({actionProceedText:null!=(i=null==d?void 0:d.proceed)?i:"Confirm",content:u,onCancelAppend:()=>{null==f||f.call(null)},onProceedAppend:()=>{e.confirm.loading(!0),null==v||v.call(null),r.A.request({data:a,method:h,url:n}).then(()=>{e.confirm.finish("Success",{children:null==d?void 0:d.success}),null==x||x.call(null)}).catch(n=>{let l=(0,o.A)(n);l.children=(0,t.jsxs)(t.Fragment,{children:[null==d?void 0:d.fail," ",l.children]}),e.confirm.finish("Error",l),null==m||m.call(null)})},proceedColour:p?"red":void 0,titleText:l}),e.confirm.open(!0)}},53909:(e,n,l)=>{l.d(n,{o3:()=>o,Wh:()=>i,qg:()=>a});var t=l(90890);let r={offline:t.Qu,optimal:t.ft},o=e=>r[e]||t.hr,s={none:t.Qu,offline:t.Qu,optimal:t.ft,syncing:t.Qu},i=e=>s[e]||t.hr,c={online:t.ft,"powered off":t.Qu},a=e=>c[e]||t.hr},91322:(e,n,l)=>{l.d(n,{A:()=>t});let t=e=>{let{allocated:n,available:l,reserved:t,total:r}=e,o=BigInt(n),s=BigInt(l);return{allocated:o,available:s,reserved:BigInt(t),total:BigInt(r)}}},98513:(e,n,l)=>{l.d(n,{A:()=>g});var t=l(37876),r=l(56826),o=l(12981),s=l(64410),i=l(14232),c=l(78792),a=l(50046),u=l.n(a),d=l(53198),h=l(14732),f=l(74503);let m=function(){for(var e,n,l,s,c,a=arguments.length,m=Array(a),v=0;v<a;v++)m[v]=arguments[v];let[x]=m,{children:p,onClick:j,onItemClick:g,slotProps:A,variant:b="icon",...C}=x,[y,k]=(0,i.useState)(null),w=(0,i.useMemo)(()=>!!y,[y]),F=(0,i.useMemo)(()=>{if(p)return p;if("icon"===b){var e,n;return(0,t.jsx)(r.A,{fontSize:null==A||null==(n=A.button)||null==(e=n.icon)?void 0:e.size})}return"Options"},[p,null==A||null==(n=A.button)||null==(e=n.icon)?void 0:e.size,b]),M=(0,i.useCallback)(function(){for(var e=arguments.length,n=Array(e),l=0;l<e;l++)n[l]=arguments[l];let{0:{currentTarget:t}}=n;return k(t),null==j?void 0:j.call(null,...n)},[j]),B=(0,i.useMemo)(()=>{var e,n;return"contained"===b?(0,t.jsx)(d.A,{onClick:M,...null==A||null==(n=A.button)?void 0:n.contained,children:F}):(0,t.jsx)(h.A,{onClick:M,...null==A||null==(e=A.button)?void 0:e.icon,children:F})},[M,F,null==A||null==(l=A.button)?void 0:l.contained,null==A||null==(s=A.button)?void 0:s.icon,b]),I=(0,i.useCallback)(function(e,n){for(var l=arguments.length,t=Array(l>2?l-2:0),r=2;r<l;r++)t[r-2]=arguments[r];return k(null),null==g?void 0:g.call(null,e,n,...t)},[g]),S=(0,i.useMemo)(()=>{var e;return u()({menu:{anchorEl:y,keepMounted:!0,onClose:()=>k(null)}},null==A||null==(e=A.menu)?void 0:e.slotProps)},[y,null==A||null==(c=A.menu)?void 0:c.slotProps]);return(0,t.jsxs)(o.A,{children:[B,(0,t.jsx)(f.A,{onItemClick:I,open:w,...C,...null==A?void 0:A.menu,slotProps:S})]})};var v=l(30198),x=l(46274),p=l(51677),j=l(30764);let g=function(){for(var e,n,l,a,u=arguments.length,h=Array(u),f=0;f<u;f++)h[f]=arguments[f];let[g]=h,{node:A,server:b,slotProps:C}=g,{confirmDialog:y,setConfirmDialogLoading:k,setConfirmDialogOpen:w,setConfirmDialogProps:F,finishConfirm:M}=(0,j.A)(),B=(0,i.useRef)({add:{open:()=>null},confirm:{finish:M,loading:k,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return w(e)},prepare:F},edit:{open:()=>null}}),I=(0,i.useMemo)(()=>"shut off"===b.state,[b.state]),S=(0,i.useMemo)(()=>c.A.states.blocking.includes(b.state),[b.state]),P=(0,i.useMemo)(()=>{let e={server:{disabled:()=>S,href:()=>"/server?name=".concat(b.name),render:()=>(0,t.jsx)(p.a3,{inheritColour:!0,noWrap:!0,children:"Manage server"})},node:{href:()=>"/anvil?name=".concat(A.name),render:()=>(0,t.jsxs)(p.a3,{inheritColour:!0,noWrap:!0,children:["On node: ",A.name]})},"subheader-power":{render:()=>(0,t.jsx)(v.A,{orientation:"horizontal",sx:{margin:".4em 0"}})}};return e["power on"]={disabled:()=>!I,onClick:()=>{(0,x.A)(B.current,"/command/start-server/".concat(b.uuid),"Power on server ".concat(b.name,"?"),{description:(0,t.jsx)(p.a3,{children:"This is equal to pushing the power button."}),messages:{fail:(0,t.jsxs)(t.Fragment,{children:["Failed to register power on job on ",b.name,"."]}),proceed:"Power on",success:(0,t.jsxs)(t.Fragment,{children:["Successfully registered power on job on ",b.name,"."]})},method:"put"})},render:()=>(0,t.jsx)(p.a3,{inheritColour:!0,noWrap:!0,children:"Power on"})},e.reset={disabled:()=>I,onClick:()=>{(0,x.A)(B.current,"/server/".concat(b.uuid,"/reset"),"Reset server ".concat(b.name,"?"),{dangerous:!0,description:(0,t.jsxs)(s.Ay,{container:!0,spacing:"1em",children:[(0,t.jsx)(s.Ay,{item:!0,width:"100%",children:(0,t.jsx)(p.a3,{children:"This is equal to holding the power button to force shut down, followed by pushing the power button again to turn the machine back on."})}),(0,t.jsx)(s.Ay,{item:!0,width:"100%",children:(0,t.jsx)(p.a3,{children:"Reset is usually used to access the boot menu when you've missed it in the live VNC connection."})})]}),messages:{fail:(0,t.jsxs)(t.Fragment,{children:["Failed to register reset job on ",b.name,"."]}),proceed:"Reset",success:(0,t.jsxs)(t.Fragment,{children:["Successfully registered reset join on ",b.name,"."]})},method:"put"})},render:()=>(0,t.jsx)(p.a3,{color:d.S.red,inheritColour:!0,noWrap:!0,children:"Reset"})},e["power off"]={disabled:()=>I,onClick:()=>{(0,x.A)(B.current,"/command/stop-server/".concat(b.uuid),"Power off server ".concat(b.name,"?"),{description:(0,t.jsx)(p.a3,{children:"This is equal to pushing the power button. If the server doesn't respond to the corresponding signals, you may have to manually shut it down."}),messages:{fail:(0,t.jsxs)(t.Fragment,{children:["Failed to register power off job on ",b.name,"."]}),proceed:"Power off",success:(0,t.jsxs)(t.Fragment,{children:["Successfully registered power off job on ",b.name,"."]})},method:"put"})},render:()=>(0,t.jsx)(p.a3,{inheritColour:!0,noWrap:!0,children:"Power off"})},e["force off"]={disabled:()=>I,onClick:()=>{(0,x.A)(B.current,"/command/stop-server/".concat(b.uuid,"?force=1"),"Force off server ".concat(b.name,"?"),{dangerous:!0,description:(0,t.jsx)(p.a3,{children:"This is equal to pulling the power cord, which may cause data loss or system corruption."}),messages:{fail:(0,t.jsxs)(t.Fragment,{children:["Failed to register force off job on ",b.name,"."]}),proceed:"Force off",success:(0,t.jsxs)(t.Fragment,{children:["Successfully registered force off job on ",b.name,"."]})},method:"put"})},render:()=>(0,t.jsx)(p.a3,{color:d.S.red,inheritColour:!0,noWrap:!0,children:"Force off"})},e},[A.name,I,S,b.name,b.uuid]);return(0,t.jsxs)(o.A,{children:[(0,t.jsx)(m,{getItemDisabled:(e,n)=>{var l;return null==(l=n.disabled)?void 0:l.call(null,e,n)},getItemHref:(e,n)=>{var l;return null==(l=n.href)?void 0:l.call(null,e,n)},items:P,onItemClick:(e,n)=>{var l;return null==(l=n.onClick)?void 0:l.call(null,e,n)},renderItem:(e,n)=>n.render(e,n),...null==C?void 0:C.button,children:(0,t.jsx)(r.A,{fontSize:null==C||null==(a=C.button)||null==(l=a.slotProps)||null==(n=l.button)||null==(e=n.icon)?void 0:e.size})}),y]})}}}]);