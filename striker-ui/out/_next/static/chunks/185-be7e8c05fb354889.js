"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{37156:function(e,n,t){t.d(n,{SJ:function(){return q},MB:function(){return V},$x:function(){return K},bC:function(){return W}});var r=t(85893),s=t(53183),l=t(24378),o=t(12641),c=t(55278),i=t(89262),a=t(14440),u=t(94246),d=t(5152),h=t.n(d),x=t(67294),f=t(65895);let v="0xffe3",m="0xffe9";var p=[{keys:"Ctrl + Alt + Delete",scans:[]},{keys:"Ctrl + Alt + F1",scans:[v,m,"0xffbe"]},{keys:"Ctrl + Alt + F2",scans:[v,m,"0xffbf"]},{keys:"Ctrl + Alt + F3",scans:[v,m,"0xffc0"]},{keys:"Ctrl + Alt + F4",scans:[v,m,"0xffc1"]},{keys:"Ctrl + Alt + F5",scans:[v,m,"0xffc2"]},{keys:"Ctrl + Alt + F6",scans:[v,m,"0xffc3"]},{keys:"Ctrl + Alt + F7",scans:[v,m,"0xffc4"]},{keys:"Ctrl + Alt + F8",scans:[v,m,"0xffc5"]},{keys:"Ctrl + Alt + F9",scans:[v,m,"0xffc6"]}],g=t(67732),j=t(23833),C=t(23930),b=t(5552),Z=t(98484),k=t(14789),y=t(99429),w=t(60207),A=e=>{let{children:n,containedButtonProps:t,iconButtonProps:s,muiMenuProps:l,onButtonClick:o,onItemClick:c,variant:i="icon",...u}=e,[d,h]=(0,x.useState)(null),f=(0,x.useMemo)(()=>!!d,[d]),v=(0,x.useMemo)(()=>n||("icon"===i?(0,r.jsx)(k.Z,{fontSize:null==s?void 0:s.size}):"Options"),[n,null==s?void 0:s.size,i]),m=(0,x.useCallback)(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let{0:{currentTarget:r}}=n;return h(r),null==o?void 0:o.call(null,...n)},[o]),p=(0,x.useMemo)(()=>"contained"===i?(0,r.jsx)(y.Z,{onClick:m,...t,children:v}):(0,r.jsx)(w.Z,{onClick:m,...s,children:v}),[m,v,t,s,i]),j=(0,x.useCallback)(function(e,n){for(var t=arguments.length,r=Array(t>2?t-2:0),s=2;s<t;s++)r[s-2]=arguments[s];return h(null),null==c?void 0:c.call(null,e,n,...r)},[c]);return(0,r.jsxs)(a.Z,{children:[p,(0,r.jsx)(g.Z,{muiMenuProps:{anchorEl:d,keepMounted:!0,onClose:()=>h(null),...l},onItemClick:j,open:f,...u})]})},B=t(97607),F=t(59278),M=t(2188),S=e=>{var n;let{getItemDisabled:t,items:s,onItemClick:l,renderItem:o,serverName:c,serverState:i,serverUuid:u,...d}=e,{confirmDialog:h,setConfirmDialogOpen:f,setConfirmDialogProps:v,finishConfirm:m}=(0,M.Z)(),p=(0,x.useMemo)(()=>({"force-off":{colour:"red",description:(0,r.jsx)(r.Fragment,{children:"This is equal to pulling the power cord, which may cause data loss or system corruption."}),label:"Force off",path:"/command/stop-server/".concat(u,"?force=1")},"power-off":{description:(0,r.jsx)(r.Fragment,{children:"This is equal to pushing the power button. If the server doesn't respond to the corresponding signals, you may have to manually shut it down."}),label:"Power off",path:"/command/stop-server/".concat(u)},"power-on":{description:(0,r.jsx)(r.Fragment,{children:"This is equal to pushing the power button."}),label:"Power on",path:"/command/start-server/".concat(u)}}),[u]);return(0,r.jsxs)(a.Z,{children:[(0,r.jsx)(A,{getItemDisabled:e=>"running"===i===e.includes("on"),items:p,onItemClick:(e,n)=>{let{colour:t,description:s,label:l,path:o}=n,i=l.toLocaleLowerCase();v({actionProceedText:l,content:(0,r.jsx)(F.Ac,{children:s}),onProceedAppend:()=>{v(e=>({...e,loading:!0})),Z.Z.put(o).then(()=>{m("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully registered ",i," job on ",c,"."]})})}).catch(e=>{let n=(0,B.Z)(e);n.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register ",i," job on ",c,"; CAUSE:"," ",n.children,"."]}),m("Error",n)})},proceedColour:t,titleText:"".concat(l," server ").concat(c,"?")}),f(!0)},renderItem:(e,n)=>{let t;let{colour:s,label:l}=n;return s&&(t=y.D[s]),(0,r.jsx)(F.Ac,{inheritColour:!0,color:t,children:l})},...d,children:(0,r.jsx)(b.Z,{fontSize:null==d?void 0:null===(n=d.iconButtonProps)||void 0===n?void 0:n.size})}),h]})},I=t(25137),P=t(6946),_=t(6631);let z="FullSize",E={displayBox:"".concat(z,"-displayBox"),spinnerBox:"".concat(z,"-spinnerBox")},D=(0,i.ZP)("div")(()=>({["& .".concat(E.displayBox)]:{width:"75vw",height:"75vh"},["& .".concat(E.spinnerBox)]:{flexDirection:"column",width:"75vw",height:"75vh",alignItems:"center",justifyContent:"center"}})),N=h()(()=>Promise.all([t.e(460),t.e(724)]).then(t.bind(t,38724)),{loadableGenerated:{webpack:()=>[38724]},ssr:!1}),T={1e3:"in-use by another process?",1006:"destination is down?"},U=(e,n)=>"ws://".concat(e,"/ws/server/vnc/").concat(n);var q=e=>{let{onClickCloseButton:n,serverUUID:t,serverName:i,vncReconnectTimerStart:d=10}=e,{buildCookieJar:h}=(0,P.Z)(),v=(0,_.Z)(),[m,b]=(0,x.useState)(null),[Z,k]=(0,x.useState)(void 0),[y,w]=(0,x.useState)(!1),[A,B]=(0,x.useState)(!1),[M,z]=(0,x.useState)(),[q,L]=(0,x.useState)(),[G,O]=(0,x.useState)(d),R=(0,x.useRef)(null),J=(0,x.useRef)(null),K=e=>{b(e.currentTarget)},$=e=>{if(R.current){if(e.length){for(let n=0;n<=e.length-1;n+=1)R.current.sendKey(e[n],1);for(let n=e.length-1;n>=0;n-=1)R.current.sendKey(e[n],0)}else R.current.sendCtrlAltDel();b(null)}},H=(0,x.useCallback)(()=>{w(!0),B(!1),k({url:U(window.location.host,t)})},[t]),V=(0,x.useCallback)(()=>{(null==R?void 0:R.current)&&(R.current.disconnect(),R.current=null),k(void 0)},[]),W=(0,x.useCallback)(()=>{V(),H()},[H,V]),Q=(0,x.useCallback)(()=>{let e=setInterval(()=>{O(n=>{let t=n-1;return t<1&&clearInterval(e),t})},1e3)},[]),X=(0,x.useCallback)(()=>{w(!1)},[]),Y=(0,x.useCallback)(e=>{let{detail:n}=e,{clean:t}=n;t||(w(!1),B(!0),Q())},[Q]),ee=(0,x.useCallback)(e=>{if(!e){z(void 0);return}let{code:n,reason:r}=e,s="ws: ".concat(n),l=T[n];l&&(s+=" (".concat(l,")")),r&&(s+=", ".concat(r)),z(s);let o=h()["suiapi.vncerror.".concat(t)];if(!o){L(void 0);return}let{code:c,message:i}=o;L("api: ".concat(c,", ").concat(i))},[h,t]),en=(0,x.useMemo)(()=>!y&&!A,[y,A]),et=(0,x.useMemo)(()=>(0,r.jsx)(a.Z,{children:(0,r.jsx)(f.Z,{onClick:()=>{var e;null===(e=J.current)||void 0===e||e.requestFullscreen()},children:(0,r.jsx)(s.Z,{})})}),[]),er=(0,x.useMemo)(()=>(0,r.jsxs)(a.Z,{children:[(0,r.jsx)(f.Z,{onClick:K,children:(0,r.jsx)(l.Z,{})}),(0,r.jsx)(g.Z,{muiMenuProps:{anchorEl:m,keepMounted:!0,onClose:()=>b(null)},open:!!m,children:p.map(e=>{let{keys:n,scans:t}=e;return(0,r.jsx)(j.Z,{onClick:()=>$(t),children:(0,r.jsx)(u.Z,{variant:"subtitle1",children:n})},n)})})]}),[m]),es=(0,x.useMemo)(()=>(0,r.jsx)(a.Z,{children:(0,r.jsx)(f.Z,{onClick:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];V(),null==n||n.call(null,...t)},children:(0,r.jsx)(o.Z,{})})}),[V,n]),el=(0,x.useMemo)(()=>(0,r.jsx)(a.Z,{children:(0,r.jsx)(f.Z,{onClick:()=>{window&&(V(),window.location.assign("/"))},children:(0,r.jsx)(c.Z,{})})}),[V]),eo=(0,x.useMemo)(()=>en&&(0,r.jsxs)(r.Fragment,{children:[et,er,(0,r.jsx)(S,{serverName:i,serverState:"running",serverUuid:t}),el,es]}),[et,er,el,i,t,en,es]);return(0,x.useEffect)(()=>{0===G&&(O(d),W())},[W,G,d]),(0,x.useEffect)(()=>{v&&H()},[H,v]),(0,r.jsxs)(C.s_,{children:[(0,r.jsxs)(C.V9,{children:[(0,r.jsx)(F.z,{text:"Server: ".concat(i)}),eo]}),(0,r.jsxs)(D,{children:[(0,r.jsx)(a.Z,{display:en?"flex":"none",className:E.displayBox,children:(0,r.jsx)(N,{onConnect:X,onDisconnect:Y,onWsClose:ee,rfb:R,rfbConnectArgs:Z,rfbScreen:J})}),!en&&(0,r.jsxs)(a.Z,{display:"flex",className:E.spinnerBox,textAlign:"center",children:[y&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(F.z,{children:["Connecting to ",i,"."]}),(0,r.jsx)(I.Z,{})]}),A&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.z,{children:"Can't connect to the server."}),(0,r.jsx)(F.Ac,{children:q}),(0,r.jsx)(F.Ac,{children:M}),(0,r.jsxs)(F.z,{mt:".5em",children:["Retrying in ",G,"."]})]})]})]})]})},L=t(59826),G=t(71363),O=t(80594),R=t(77831),J=t(75550),K=(0,i.ZP)(a.Z)({alignItems:"center",display:"flex",justifyContent:"center",margin:".2em",overflow:"hidden",position:"relative"}),$=t(41021),H=t(77510),V=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[s]=n,{onClick:l,server:o,slotProps:c,slots:i}=s,{href:u="/server?name=".concat(o.name,"&view=vnc")}=s,{data:d,loading:h}=(0,H.Z)("/server/".concat(o.uuid,"?ss=1"),{refreshInterval:6e4}),f=null==d?void 0:d.screenshot,v=null==d?void 0:d.timestamp,m=(0,$.zO)(),p=(0,x.useMemo)(()=>!!v&&!(0,$.Z$)(v,300),[v]),g=(0,x.useMemo)(()=>{var e;return null!==(e=null==i?void 0:i.screenshotBox)&&void 0!==e?e:(0,r.jsx)(K,{})},[null==i?void 0:i.screenshotBox]),j=(0,x.useMemo)(()=>({...null==c?void 0:c.screenshotBox}),[null==c?void 0:c.screenshotBox]),C=(0,x.useMemo)(()=>{let e;if(o.jobs)return(0,x.cloneElement)(g,j,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Ac,{children:"Provisioning..."}),Object.values(o.jobs).map((e,n)=>{let{peer:t,progress:s,uuid:l}=e;return(0,r.jsx)(J.Z,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(7em - ".concat(1.5*n,"em)"),sx:{opacity:t?.6:void 0,["& .".concat(G.Z.circle)]:{strokeLinecap:"round"}},thickness:3},underline:{thickness:0}},value:s},"".concat(l,"-progress"))})]}));if(h)return(0,x.cloneElement)(g,j,(0,r.jsx)(I.Z,{mt:0}));if("running"!==o.state)return(0,x.cloneElement)(g,j,(0,r.jsx)(L.Z,{sx:{color:R.UZ,height:"100%",width:"auto"}}));let n="1";if(v&&p){n="0.4";let{unit:t,value:s}=(0,$._J)(m-v);e=(0,r.jsxs)(F.Ac,{position:"absolute",children:["Updated ~",s," ",t," ago"]})}return(0,x.cloneElement)(g,j,(0,r.jsx)(a.Z,{alt:"Preview is temporarily unavailable, but the server is ".concat(o.state,"."),component:"img",src:"data:image;base64,".concat(f),sx:{color:R.s7,height:f?"100%":"auto",opacity:n,width:"auto"},...null==c?void 0:c.screenshot}),e)},[h,m,f,o.jobs,o.state,null==c?void 0:c.screenshot,p,v,g,j]);return(0,x.useMemo)(()=>{let e="running"!==o.state||!!o.jobs;return(0,x.createElement)(O.Z,{disabled:e,href:u,onClick:l,sx:{padding:0},...null==c?void 0:c.button},C)},[C,l,u,o.jobs,o.state,null==c?void 0:c.button])},W=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[s]=n,{children:l,getHeader:o=e=>{let{name:n}=e;return(0,r.jsx)(F.Ac,{children:n})},server:c,showControls:i=!0,slotProps:a}=s;return(0,r.jsxs)(C.Lg,{mb:0,mt:0,...null==a?void 0:a.panel,children:[(0,r.jsxs)(C.CH,{...null==a?void 0:a.header,children:[o(c),i&&(0,r.jsx)(S,{iconButtonProps:{size:"small"},serverName:c.name,serverState:c.state,serverUuid:c.uuid})]}),l]})}},92643:function(e,n){n.Z=e=>{let{allocated:n,available:t,reserved:r,total:s}=e,l=BigInt(n);return{allocated:l,available:BigInt(t),reserved:BigInt(r),total:BigInt(s)}}},97733:function(e,n){n.Z=e=>{let{storage_groups:n,total_free:t,total_size:r}=e,s=BigInt(t),l=BigInt(r);return n.reduce((e,n)=>{let{storage_group_free:t,storage_group_name:r,storage_group_total:s,storage_group_uuid:l}=n,o=BigInt(t),c=BigInt(s);return e.storageGroups[l]={free:o,name:r,size:c,used:c-o,uuid:l},e},{storageGroups:{},totalFree:s,totalSize:l,totalUsed:l-s})}}}]);