"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[352],{45842:function(e,n,t){t.d(n,{SJ:function(){return S},MB:function(){return H},$x:function(){return O},bC:function(){return J}});var r=t(85893),l=t(83688),o=t(55751),s=t(38444),i=t(60018),c=t(77527),u=t(90642),a=t(96788),d=t(5152),v=t.n(d),h=t(67294),x=t(55756),f=t(45328);let m="0xffe3",p="0xffe9";var g=[{keys:"Ctrl + Alt + Delete",scans:[]},{keys:"Ctrl + Alt + F1",scans:[m,p,"0xffbe"]},{keys:"Ctrl + Alt + F2",scans:[m,p,"0xffbf"]},{keys:"Ctrl + Alt + F3",scans:[m,p,"0xffc0"]},{keys:"Ctrl + Alt + F4",scans:[m,p,"0xffc1"]},{keys:"Ctrl + Alt + F5",scans:[m,p,"0xffc2"]},{keys:"Ctrl + Alt + F6",scans:[m,p,"0xffc3"]},{keys:"Ctrl + Alt + F7",scans:[m,p,"0xffc4"]},{keys:"Ctrl + Alt + F8",scans:[m,p,"0xffc5"]},{keys:"Ctrl + Alt + F9",scans:[m,p,"0xffc6"]}],j=t(75492),b=t(18766),C=t(65375),Z=t(54420),k=t(90209),y=t(57882),w=t(99246);let A="FullSize",F={displayBox:"".concat(A,"-displayBox"),spinnerBox:"".concat(A,"-spinnerBox")},B=(0,c.ZP)("div")(()=>({["& .".concat(F.displayBox)]:{width:"75vw",height:"75vh"},["& .".concat(F.spinnerBox)]:{flexDirection:"column",width:"75vw",height:"75vh",alignItems:"center",justifyContent:"center"}})),M=v()(()=>Promise.all([t.e(460),t.e(791)]).then(t.bind(t,38791)),{loadableGenerated:{webpack:()=>[38791]},ssr:!1}),I={1e3:"in-use by another process?",1006:"destination is down?"},P=(e,n)=>"ws://".concat(e,"/ws/server/vnc/").concat(n);var S=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[c]=n,{node:d,onClickCloseButton:v,server:m,vncReconnectTimerStart:p=10}=c,[A]=(0,x.fP)(["suiapi.vncerror.".concat(m.uuid)]),S=(0,w.Z)(),[z,_]=(0,h.useState)(null),[E,D]=(0,h.useState)(void 0),[T,W]=(0,h.useState)(!1),[R,q]=(0,h.useState)(!1),[N,O]=(0,h.useState)(),[G,U]=(0,h.useState)(),[H,J]=(0,h.useState)(p),K=(0,h.useRef)(null),L=(0,h.useRef)(null),$=e=>{_(e.currentTarget)},V=e=>{if(K.current){if(e.length){for(let n=0;n<=e.length-1;n+=1)K.current.sendKey(e[n],1);for(let n=e.length-1;n>=0;n-=1)K.current.sendKey(e[n],0)}else K.current.sendCtrlAltDel();_(null)}},Q=(0,h.useCallback)(()=>{W(!0),q(!1),D({url:P(window.location.host,m.uuid)})},[m.uuid]),X=(0,h.useCallback)(()=>{(null==K?void 0:K.current)&&(K.current.disconnect(),K.current=null),D(void 0)},[]),Y=(0,h.useCallback)(()=>{X(),Q()},[Q,X]),ee=(0,h.useCallback)(()=>{let e=setInterval(()=>{J(n=>{let t=n-1;return t<1&&clearInterval(e),t})},1e3)},[]),en=(0,h.useCallback)(()=>{W(!1)},[]),et=(0,h.useCallback)(e=>{let{detail:n}=e,{clean:t}=n;t||(W(!1),q(!0),ee())},[ee]),er=(0,h.useCallback)(e=>{if(!e){O(void 0);return}let{code:n,reason:t}=e,r="ws: ".concat(n),l=I[n];l&&(r+=" (".concat(l,")")),t&&(r+=", ".concat(t)),O(r);let o=A["suiapi.vncerror.".concat(m.uuid)];if(!o){U(void 0);return}let{code:s,message:i}=o;U("api: ".concat(s,", ").concat(i))},[A,m.uuid]),el=(0,h.useMemo)(()=>!T&&!R,[T,R]),eo=(0,h.useMemo)(()=>(0,r.jsx)(u.Z,{children:(0,r.jsx)(f.Z,{onClick:()=>{var e;null===(e=L.current)||void 0===e||e.requestFullscreen()},children:(0,r.jsx)(l.Z,{})})}),[]),es=(0,h.useMemo)(()=>(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(f.Z,{onClick:$,children:(0,r.jsx)(o.Z,{})}),(0,r.jsx)(j.Z,{open:!!z,slotProps:{menu:{anchorEl:z,keepMounted:!0,onClose:()=>_(null)}},children:g.map(e=>{let{keys:n,scans:t}=e;return(0,r.jsx)(b.Z,{onClick:()=>V(t),children:(0,r.jsx)(a.Z,{variant:"subtitle1",children:n})},n)})})]}),[z]),ei=(0,h.useMemo)(()=>(0,r.jsx)(u.Z,{children:(0,r.jsx)(f.Z,{onClick:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];X(),null==v||v.call(null,...n)},children:(0,r.jsx)(s.Z,{})})}),[X,v]),ec=(0,h.useMemo)(()=>(0,r.jsx)(u.Z,{children:(0,r.jsx)(f.Z,{onClick:()=>{window&&(X(),window.location.assign("/"))},children:(0,r.jsx)(i.Z,{})})}),[X]),eu=(0,h.useMemo)(()=>el&&(0,r.jsxs)(r.Fragment,{children:[eo,es,(0,r.jsx)(Z.Z,{node:d,server:m}),ec,ei]}),[eo,es,d,ec,m,el,ei]);return(0,h.useEffect)(()=>{0===H&&(J(p),Y())},[Y,H,p]),(0,h.useEffect)(()=>{S&&Q()},[Q,S]),(0,r.jsxs)(C.s_,{children:[(0,r.jsxs)(C.V9,{children:[(0,r.jsx)(y.z,{text:"Server: ".concat(m.name)}),eu]}),(0,r.jsxs)(B,{children:[(0,r.jsx)(u.Z,{display:el?"flex":"none",className:F.displayBox,children:(0,r.jsx)(M,{onConnect:en,onDisconnect:et,onWsClose:er,rfb:K,rfbConnectArgs:E,rfbScreen:L})}),!el&&(0,r.jsxs)(u.Z,{display:"flex",className:F.spinnerBox,textAlign:"center",children:[T&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.z,{children:["Connecting to ",m.name,"."]}),(0,r.jsx)(k.Z,{})]}),R&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.z,{children:"Can't connect to the server."}),(0,r.jsx)(y.Ac,{children:G}),(0,r.jsx)(y.Ac,{children:N}),(0,r.jsxs)(y.z,{mt:".5em",children:["Retrying in ",H,"."]})]})]})]})]})},z=t(10617),_=t(65625),E=t(7727),D=t(48403),T=t.n(D),W=t(82492),R=t.n(W),q=t(39971),N=t(21758),O=(0,c.ZP)(u.Z)({alignItems:"center",display:"flex",justifyContent:"center",margin:".2em",overflow:"hidden",position:"relative"}),G=t(29255),U=t(5499),H=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[l]=n,{onClick:o,server:s,slotProps:i,slots:c}=l,{href:a="/server?name=".concat(s.name,"&view=vnc")}=l,{data:d,loading:v}=(0,U.Z)("/server/".concat(s.uuid,"?ss=1"),{refreshInterval:6e4}),x=null==d?void 0:d.screenshot,f=null==d?void 0:d.timestamp,m=(0,G.zO)(),p=(0,h.useMemo)(()=>!!f&&!(0,G.Z$)(f,300),[f]),g=(0,h.useMemo)(()=>{var e;return null!==(e=null==c?void 0:c.screenshotBox)&&void 0!==e?e:(0,r.jsx)(O,{})},[null==c?void 0:c.screenshotBox]),j=(0,h.useMemo)(()=>({...null==i?void 0:i.screenshotBox}),[null==i?void 0:i.screenshotBox]),b=(0,h.useMemo)(()=>{let e,n;if(s.jobs)return(0,h.cloneElement)(g,j,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Ac,{children:"Provisioning..."}),Object.values(s.jobs).map((e,n)=>{let{peer:t,progress:l,uuid:o}=e;return(0,r.jsx)(N.Z,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(7em - ".concat(1.5*n,"em)"),sx:{opacity:t?.6:void 0,["& .".concat(_.Z.circle)]:{strokeLinecap:"round"}},thickness:3},underline:{thickness:l?0:1}},value:l},"".concat(o,"-progress"))})]}));if(v)return(0,h.cloneElement)(g,j,(0,r.jsx)(k.Z,{mt:0}));if("running"!==s.state)return(0,h.cloneElement)(g,j,(0,r.jsx)(z.Z,{sx:{color:q.UZ,height:"100%",width:"auto"}}));let t="1";if(f&&p){t="0.4";let{unit:n,value:l}=(0,G._J)(m-f);e=(0,r.jsxs)(y.Ac,{position:"absolute",children:["Updated ~",l," ",n," ago"]})}let l=null==i?void 0:i.screenshot;return l&&({sx:n,...l}=l),(0,h.cloneElement)(g,j,(0,r.jsx)(u.Z,{alt:"".concat(T()(s.state),". Preview unavailable"),component:"img",src:"data:image;base64,".concat(x),sx:R()({color:q.s7,fontFamily:"Roboto Condensed",height:x?"100%":"auto",opacity:t,width:"auto"},n),...l}),e)},[v,m,x,s.jobs,s.state,null==i?void 0:i.screenshot,p,f,g,j]);return(0,h.useMemo)(()=>{let e;let n="running"!==s.state||!!s.jobs,t=null==i?void 0:i.button;return t&&({sx:e,...t}=t),(0,h.createElement)(E.Z,{disabled:n,href:a,onClick:o,sx:R()({padding:0,width:"calc(100% - 0em)"},e),...t},b)},[b,o,a,s.jobs,s.state,null==i?void 0:i.button])},J=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let[l]=n,{children:o,getHeader:s=e=>{let{name:n}=e;return(0,r.jsx)(y.Ac,{children:n})},server:i,showControls:c=!0,slotProps:u}=l;return(0,r.jsxs)(C.Lg,{mb:0,mt:0,...null==u?void 0:u.panel,children:[(0,r.jsxs)(C.CH,{...null==u?void 0:u.header,children:[s(i),c&&(0,r.jsx)(Z.Z,{node:i.anvil,server:i,slotProps:{button:{slotProps:{button:{icon:{size:"small"}}}}}})]}),o]})}},54420:function(e,n,t){t.d(n,{Z:function(){return b}});var r=t(85893),l=t(86142),o=t(90642),s=t(48403),i=t.n(s),c=t(67294),u=t(66389),a=t(82492),d=t.n(a),v=t(46194),h=t(16667),x=t(75492),f=function(){for(var e,n,t,s,i,u=arguments.length,a=Array(u),f=0;f<u;f++)a[f]=arguments[f];let[m]=a,{children:p,onClick:g,onItemClick:j,slotProps:b,variant:C="icon",...Z}=m,[k,y]=(0,c.useState)(null),w=(0,c.useMemo)(()=>!!k,[k]),A=(0,c.useMemo)(()=>{if(p)return p;if("icon"===C){var e,n;return(0,r.jsx)(l.Z,{fontSize:null==b?void 0:null===(n=b.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size})}return"Options"},[p,null==b?void 0:null===(n=b.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size,C]),F=(0,c.useCallback)(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let{0:{currentTarget:r}}=n;return y(r),null==g?void 0:g.call(null,...n)},[g]),B=(0,c.useMemo)(()=>{var e,n;return"contained"===C?(0,r.jsx)(v.Z,{onClick:F,...null==b?void 0:null===(n=b.button)||void 0===n?void 0:n.contained,children:A}):(0,r.jsx)(h.Z,{onClick:F,...null==b?void 0:null===(e=b.button)||void 0===e?void 0:e.icon,children:A})},[F,A,null==b?void 0:null===(t=b.button)||void 0===t?void 0:t.contained,null==b?void 0:null===(s=b.button)||void 0===s?void 0:s.icon,C]),M=(0,c.useCallback)(function(e,n){for(var t=arguments.length,r=Array(t>2?t-2:0),l=2;l<t;l++)r[l-2]=arguments[l];return y(null),null==j?void 0:j.call(null,e,n,...r)},[j]),I=(0,c.useMemo)(()=>{var e;return d()({menu:{anchorEl:k,keepMounted:!0,onClose:()=>y(null)}},null==b?void 0:null===(e=b.menu)||void 0===e?void 0:e.slotProps)},[k,null==b?void 0:null===(i=b.menu)||void 0===i?void 0:i.slotProps]);return(0,r.jsxs)(o.Z,{children:[B,(0,r.jsx)(x.Z,{onItemClick:M,open:w,...Z,...null==b?void 0:b.menu,slotProps:I})]})},m=t(11100),p=t(57882),g=t(40657),j=t(82092),b=function(){for(var e,n,t,s,a=arguments.length,d=Array(a),h=0;h<a;h++)d[h]=arguments[h];let[x]=d,{node:b,server:C,slotProps:Z}=x,{confirmDialog:k,setConfirmDialogOpen:y,setConfirmDialogProps:w,finishConfirm:A}=(0,g.Z)(),F=(0,c.useMemo)(()=>["running"].includes(C.state),[C.state]),B=(0,c.useCallback)((e,n,t)=>l=>{let o=i()(l);w({actionProceedText:o,content:(0,r.jsx)(p.Ac,{children:e}),onProceedAppend:()=>{w(e=>({...e,loading:!0})),u.Z.put(n).then(()=>{A("Success",{children:(0,r.jsxs)(r.Fragment,{children:["Successfully registered ",l," job on ",C.name,"."]})})}).catch(e=>{let n=(0,m.Z)(e);n.children=(0,r.jsxs)(r.Fragment,{children:["Failed to register ",l," job on ",C.name,"."," ",n.children]}),A("Error",n)})},proceedColour:null==t?void 0:t.colour,titleText:"".concat(o," server ").concat(C.name,"?")}),y(!0)},[A,C.name,y,w]),M=(0,c.useMemo)(()=>{let e={server:{href:()=>"/server?name=".concat(C.name),render:()=>(0,r.jsx)(p.Ac,{inheritColour:!0,noWrap:!0,children:"Manage server"})},node:{href:()=>"/anvil?name=".concat(b.name),render:()=>(0,r.jsxs)(p.Ac,{inheritColour:!0,noWrap:!0,children:["On node: ",b.name]})},"subheader-power":{render:()=>(0,r.jsx)(j.Z,{orientation:"horizontal",sx:{margin:".4em 0"}})}},n={disabled:()=>!F,onClick:B((0,r.jsx)(r.Fragment,{children:"This is equal to pulling the power cord, which may cause data loss or system corruption."}),"/command/stop-server/".concat(C.uuid,"?force=1"),{colour:"red"}),render:()=>(0,r.jsx)(p.Ac,{color:v.D.red,inheritColour:!0,noWrap:!0,children:"Force off"})},t={disabled:()=>!F,onClick:B((0,r.jsx)(r.Fragment,{children:"This is equal to pushing the power button. If the server doesn't respond to the corresponding signals, you may have to manually shut it down."}),"/command/stop-server/".concat(C.uuid)),render:()=>(0,r.jsx)(p.Ac,{inheritColour:!0,noWrap:!0,children:"Power off"})},l={disabled:()=>F,onClick:B((0,r.jsx)(r.Fragment,{children:"This is equal to pushing the power button."}),"/command/start-server/".concat(C.uuid)),render:()=>(0,r.jsx)(p.Ac,{inheritColour:!0,noWrap:!0,children:"Power on"})};return e["power on"]=l,e["power off"]=t,e["force off"]=n,e},[B,b.name,F,C.name,C.uuid]);return(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(f,{getItemDisabled:(e,n)=>{var t;return null===(t=n.disabled)||void 0===t?void 0:t.call(null,e,n)},getItemHref:(e,n)=>{var t;return null===(t=n.href)||void 0===t?void 0:t.call(null,e,n)},items:M,onItemClick:(e,n)=>{var t;return null===(t=n.onClick)||void 0===t?void 0:t.call(null,e,n)},renderItem:(e,n)=>n.render(e,n),...null==Z?void 0:Z.button,children:(0,r.jsx)(l.Z,{fontSize:null==Z?void 0:null===(s=Z.button)||void 0===s?void 0:null===(t=s.slotProps)||void 0===t?void 0:null===(n=t.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size})}),k]})}},99246:function(e,n,t){var r=t(67294);n.Z=()=>{let e=(0,r.useRef)(!0);return e.current?(e.current=!1,!0):e.current}},22700:function(e,n){n.Z=e=>{let{allocated:n,available:t,reserved:r,total:l}=e,o=BigInt(n);return{allocated:o,available:BigInt(t),reserved:BigInt(r),total:BigInt(l)}}},60665:function(e,n){n.Z=e=>{let{storage_groups:n,total_free:t,total_size:r}=e,l=BigInt(t),o=BigInt(r);return n.reduce((e,n)=>{let{storage_group_free:t,storage_group_name:r,storage_group_total:l,storage_group_uuid:o}=n,s=BigInt(t),i=BigInt(l);return e.storageGroups[o]={free:s,name:r,size:i,used:i-s,uuid:o},e},{storageGroups:{},totalFree:l,totalSize:o,totalUsed:o-l})}}}]);