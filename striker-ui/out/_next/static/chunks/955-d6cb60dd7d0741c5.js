"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[955],{45842:function(e,n,o){o.d(n,{SJ:function(){return I},MB:function(){return K},$x:function(){return O},bC:function(){return L}});var r=o(85893),t=o(83688),l=o(55751),s=o(38444),i=o(60018),c=o(77527),u=o(90642),a=o(96788),d=o(5152),h=o.n(d),v=o(67294),f=o(55756),m=o(45328);let x="0xffe3",p="0xffe9";var j=[{keys:"Ctrl + Alt + Delete",scans:[]},{keys:"Ctrl + Alt + F1",scans:[x,p,"0xffbe"]},{keys:"Ctrl + Alt + F2",scans:[x,p,"0xffbf"]},{keys:"Ctrl + Alt + F3",scans:[x,p,"0xffc0"]},{keys:"Ctrl + Alt + F4",scans:[x,p,"0xffc1"]},{keys:"Ctrl + Alt + F5",scans:[x,p,"0xffc2"]},{keys:"Ctrl + Alt + F6",scans:[x,p,"0xffc3"]},{keys:"Ctrl + Alt + F7",scans:[x,p,"0xffc4"]},{keys:"Ctrl + Alt + F8",scans:[x,p,"0xffc5"]},{keys:"Ctrl + Alt + F9",scans:[x,p,"0xffc6"]}],g=o(75492),b=o(18766),C=o(65375),Z=o(64537),w=o(90209),k=o(57882),y=o(99246);let A="FullSize",F={displayBox:"".concat(A,"-displayBox"),spinnerBox:"".concat(A,"-spinnerBox")},P=(0,c.ZP)("div")(()=>({["& .".concat(F.displayBox)]:{width:"75vw",height:"75vh"},["& .".concat(F.spinnerBox)]:{flexDirection:"column",width:"75vw",height:"75vh",alignItems:"center",justifyContent:"center"}})),M=h()(()=>Promise.all([o.e(460),o.e(791)]).then(o.bind(o,38791)),{loadableGenerated:{webpack:()=>[38791]},ssr:!1}),S={1e3:"in-use by another process?",1006:"destination is down?"},B=(e,n)=>"ws://".concat(e,"/ws/server/vnc/").concat(n);var I=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];let[c]=n,{node:d,onClickCloseButton:h,server:x,vncReconnectTimerStart:p=3}=c,[A]=(0,f.fP)(["suiapi.vncerror.".concat(x.uuid)]),I=(0,y.Z)(),[z,E]=(0,v.useState)(null),[R,D]=(0,v.useState)(void 0),[T,W]=(0,v.useState)(!1),[q,_]=(0,v.useState)(!1),[N,O]=(0,v.useState)(),[H,J]=(0,v.useState)(),[K,L]=(0,v.useState)(p),U=(0,v.useRef)(null),V=(0,v.useRef)(null),$=e=>{E(e.currentTarget)},G=e=>{if(U.current){if(e.length){for(let n=0;n<=e.length-1;n+=1)U.current.sendKey(e[n],1);for(let n=e.length-1;n>=0;n-=1)U.current.sendKey(e[n],0)}else U.current.sendCtrlAltDel();E(null)}},Q=(0,v.useCallback)(()=>{W(!0),_(!1),D({url:B(window.location.host,x.uuid)})},[x.uuid]),X=(0,v.useCallback)(()=>{(null==U?void 0:U.current)&&(U.current.disconnect(),U.current=null),D(void 0)},[]),Y=(0,v.useCallback)(()=>{X(),Q()},[Q,X]),ee=(0,v.useCallback)(()=>{let e=setInterval(()=>{L(n=>{let o=n-1;return o<1&&clearInterval(e),o})},1e3)},[]),en=(0,v.useCallback)(()=>{W(!1)},[]),eo=(0,v.useCallback)(e=>{let{detail:n}=e,{clean:o}=n;o||(W(!1),_(!0),ee())},[ee]),er=(0,v.useCallback)(e=>{if(!e){O(void 0);return}let{code:n,reason:o}=e,r="ws: ".concat(n),t=S[n];t&&(r+=" (".concat(t,")")),o&&(r+=", ".concat(o)),O(r);let l=A["suiapi.vncerror.".concat(x.uuid)];if(!l){J(void 0);return}let{code:s,message:i}=l;J("api: ".concat(s,", ").concat(i))},[A,x.uuid]),et=(0,v.useMemo)(()=>!T&&!q,[T,q]),el=(0,v.useMemo)(()=>(0,r.jsx)(u.Z,{children:(0,r.jsx)(m.Z,{onClick:()=>{var e;null===(e=V.current)||void 0===e||e.requestFullscreen()},children:(0,r.jsx)(t.Z,{})})}),[]),es=(0,v.useMemo)(()=>(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(m.Z,{onClick:$,children:(0,r.jsx)(l.Z,{})}),(0,r.jsx)(g.Z,{open:!!z,slotProps:{menu:{anchorEl:z,keepMounted:!0,onClose:()=>E(null)}},children:j.map(e=>{let{keys:n,scans:o}=e;return(0,r.jsx)(b.Z,{onClick:()=>G(o),children:(0,r.jsx)(a.Z,{variant:"subtitle1",children:n})},n)})})]}),[z]),ei=(0,v.useMemo)(()=>(0,r.jsx)(u.Z,{children:(0,r.jsx)(m.Z,{onClick:function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];X(),null==h||h.call(null,...n)},children:(0,r.jsx)(s.Z,{})})}),[X,h]),ec=(0,v.useMemo)(()=>(0,r.jsx)(u.Z,{children:(0,r.jsx)(m.Z,{onClick:()=>{window&&(X(),window.location.assign("/"))},children:(0,r.jsx)(i.Z,{})})}),[X]),eu=(0,v.useMemo)(()=>(0,r.jsxs)(r.Fragment,{children:[el,es,(0,r.jsx)(Z.Z,{node:d,server:x}),ec,ei]}),[el,es,d,ec,x,ei]);return(0,v.useEffect)(()=>{0===K&&(L(p),Y())},[Y,K,p]),(0,v.useEffect)(()=>{I&&Q()},[Q,I]),(0,r.jsxs)(C.s_,{children:[(0,r.jsxs)(C.V9,{children:[(0,r.jsx)(k.z,{text:"Server: ".concat(x.name)}),eu]}),(0,r.jsxs)(P,{children:[(0,r.jsx)(u.Z,{display:et?"flex":"none",className:F.displayBox,children:(0,r.jsx)(M,{onConnect:en,onDisconnect:eo,onWsClose:er,rfb:U,rfbConnectArgs:R,rfbScreen:V})}),!et&&(0,r.jsxs)(u.Z,{display:"flex",className:F.spinnerBox,textAlign:"center",children:[T&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(k.z,{children:["Connecting to ",x.name,"."]}),(0,r.jsx)(w.Z,{})]}),q&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.z,{children:"Can't connect to the server."}),(0,r.jsx)(k.Ac,{children:H}),(0,r.jsx)(k.Ac,{children:N}),(0,r.jsxs)(k.z,{mt:".5em",children:["Retrying in ",K,"."]})]})]})]})]})},z=o(10617),E=o(65625),R=o(7727),D=o(48403),T=o.n(D),W=o(82492),q=o.n(W),_=o(39971),N=o(21758),O=(0,c.ZP)(u.Z)({alignItems:"center",display:"flex",justifyContent:"center",margin:".2em",overflow:"hidden",position:"relative"}),H=o(29255),J=o(5499),K=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];let[t]=n,{onClick:l,server:s,slotProps:i,slots:c}=t,{href:a="/server?name=".concat(s.name,"&view=vnc")}=t,{data:d,loading:h}=(0,J.Z)("/server/".concat(s.uuid,"?ss=1"),{refreshInterval:6e4}),f=null==d?void 0:d.screenshot,m=null==d?void 0:d.timestamp,x=(0,H.zO)(),p=(0,v.useMemo)(()=>!!m&&!(0,H.Z$)(m,300),[m]),j=(0,v.useMemo)(()=>{var e;return null!==(e=null==c?void 0:c.screenshotBox)&&void 0!==e?e:(0,r.jsx)(O,{})},[null==c?void 0:c.screenshotBox]),g=(0,v.useMemo)(()=>({...null==i?void 0:i.screenshotBox}),[null==i?void 0:i.screenshotBox]),b=(0,v.useMemo)(()=>{let e,n;if(s.jobs)return(0,v.cloneElement)(j,g,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.Ac,{children:"Provisioning..."}),Object.values(s.jobs).map((e,n)=>{let{peer:o,progress:t,uuid:l}=e;return(0,r.jsx)(N.Z,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(7em - ".concat(1.5*n,"em)"),sx:{opacity:o?.6:void 0,["& .".concat(E.Z.circle)]:{strokeLinecap:"round"}},thickness:3},underline:{thickness:t?0:1}},value:t},"".concat(l,"-progress"))})]}));if(h)return(0,v.cloneElement)(j,g,(0,r.jsx)(w.Z,{mt:0}));if("running"!==s.state)return(0,v.cloneElement)(j,g,(0,r.jsx)(z.Z,{sx:{color:_.UZ,height:"100%",width:"auto"}}));let o="1";if(m&&p){o="0.4";let{unit:n,value:t}=(0,H._J)(x-m);e=(0,r.jsxs)(k.Ac,{position:"absolute",children:["Updated ~",t," ",n," ago"]})}let t=null==i?void 0:i.screenshot;return t&&({sx:n,...t}=t),(0,v.cloneElement)(j,g,(0,r.jsx)(u.Z,{alt:"".concat(T()(s.state),". Preview unavailable"),component:"img",src:"data:image;base64,".concat(f),sx:q()({color:_.s7,fontFamily:"Roboto Condensed",height:f?"100%":"auto",opacity:o,width:"auto"},n),...t}),e)},[h,x,f,s.jobs,s.state,null==i?void 0:i.screenshot,p,m,j,g]);return(0,v.useMemo)(()=>{let e;let n=!!s.jobs,o=null==i?void 0:i.button;return o&&({sx:e,...o}=o),(0,v.createElement)(R.Z,{disabled:n,href:a,onClick:l,sx:q()({padding:0,width:"calc(100% - 0em)"},e),...o},b)},[b,l,a,s.jobs,null==i?void 0:i.button])},L=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];let[t]=n,{children:l,getHeader:s=e=>{let{name:n}=e;return(0,r.jsx)(k.Ac,{children:n})},server:i,showControls:c=!0,slotProps:u}=t;return(0,r.jsxs)(C.Lg,{mb:0,mt:0,...null==u?void 0:u.panel,children:[(0,r.jsxs)(C.CH,{...null==u?void 0:u.header,children:[s(i),c&&(0,r.jsx)(Z.Z,{node:i.anvil,server:i,slotProps:{button:{slotProps:{button:{icon:{size:"small"}}}}}})]}),l]})}},64537:function(e,n,o){o.d(n,{Z:function(){return j}});var r=o(85893),t=o(86142),l=o(8506),s=o(90642),i=o(67294),c=o(82492),u=o.n(c),a=o(46194),d=o(16667),h=o(75492),v=function(){for(var e,n,o,l,c,v=arguments.length,f=Array(v),m=0;m<v;m++)f[m]=arguments[m];let[x]=f,{children:p,onClick:j,onItemClick:g,slotProps:b,variant:C="icon",...Z}=x,[w,k]=(0,i.useState)(null),y=(0,i.useMemo)(()=>!!w,[w]),A=(0,i.useMemo)(()=>{if(p)return p;if("icon"===C){var e,n;return(0,r.jsx)(t.Z,{fontSize:null==b?void 0:null===(n=b.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size})}return"Options"},[p,null==b?void 0:null===(n=b.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size,C]),F=(0,i.useCallback)(function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];let{0:{currentTarget:r}}=n;return k(r),null==j?void 0:j.call(null,...n)},[j]),P=(0,i.useMemo)(()=>{var e,n;return"contained"===C?(0,r.jsx)(a.Z,{onClick:F,...null==b?void 0:null===(n=b.button)||void 0===n?void 0:n.contained,children:A}):(0,r.jsx)(d.Z,{onClick:F,...null==b?void 0:null===(e=b.button)||void 0===e?void 0:e.icon,children:A})},[F,A,null==b?void 0:null===(o=b.button)||void 0===o?void 0:o.contained,null==b?void 0:null===(l=b.button)||void 0===l?void 0:l.icon,C]),M=(0,i.useCallback)(function(e,n){for(var o=arguments.length,r=Array(o>2?o-2:0),t=2;t<o;t++)r[t-2]=arguments[t];return k(null),null==g?void 0:g.call(null,e,n,...r)},[g]),S=(0,i.useMemo)(()=>{var e;return u()({menu:{anchorEl:w,keepMounted:!0,onClose:()=>k(null)}},null==b?void 0:null===(e=b.menu)||void 0===e?void 0:e.slotProps)},[w,null==b?void 0:null===(c=b.menu)||void 0===c?void 0:c.slotProps]);return(0,r.jsxs)(s.Z,{children:[P,(0,r.jsx)(h.Z,{onItemClick:M,open:y,...Z,...null==b?void 0:b.menu,slotProps:S})]})},f=o(82092),m=o(53833),x=o(57882),p=o(40657),j=function(){for(var e,n,o,c,u=arguments.length,d=Array(u),h=0;h<u;h++)d[h]=arguments[h];let[j]=d,{node:g,server:b,slotProps:C}=j,{confirmDialog:Z,setConfirmDialogLoading:w,setConfirmDialogOpen:k,setConfirmDialogProps:y,finishConfirm:A}=(0,p.Z)(),F=(0,i.useRef)({add:{open:()=>null},confirm:{finish:A,loading:w,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return k(e)},prepare:y},edit:{open:()=>null}}),P=(0,i.useMemo)(()=>["shut off"].includes(b.state),[b.state]),M=(0,i.useMemo)(()=>{let e={server:{href:()=>"/server?name=".concat(b.name),render:()=>(0,r.jsx)(x.Ac,{inheritColour:!0,noWrap:!0,children:"Manage server"})},node:{href:()=>"/anvil?name=".concat(g.name),render:()=>(0,r.jsxs)(x.Ac,{inheritColour:!0,noWrap:!0,children:["On node: ",g.name]})},"subheader-power":{render:()=>(0,r.jsx)(f.Z,{orientation:"horizontal",sx:{margin:".4em 0"}})}};return e["power on"]={disabled:()=>!P,onClick:()=>{(0,m.Z)(F.current,"/command/start-server/".concat(b.uuid),"Power on server ".concat(b.name,"?"),{description:(0,r.jsx)(x.Ac,{children:"This is equal to pushing the power button."}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register power on job on ",b.name,"."]}),proceed:"Power on",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered power on job on ",b.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.Ac,{inheritColour:!0,noWrap:!0,children:"Power on"})},e.reset={disabled:()=>P,onClick:()=>{(0,m.Z)(F.current,"/server/".concat(b.uuid,"/reset"),"Reset server ".concat(b.name,"?"),{dangerous:!0,description:(0,r.jsxs)(l.ZP,{container:!0,spacing:"1em",children:[(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(x.Ac,{children:"This is equal to holding the power button to force shut down, followed by pushing the power button again to turn the machine back on."})}),(0,r.jsx)(l.ZP,{item:!0,width:"100%",children:(0,r.jsx)(x.Ac,{children:"Reset is usually used to access the boot menu when you've missed it in the live VNC connection."})})]}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register reset job on ",b.name,"."]}),proceed:"Reset",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered reset join on ",b.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.Ac,{color:a.D.red,inheritColour:!0,noWrap:!0,children:"Reset"})},e["power off"]={disabled:()=>P,onClick:()=>{(0,m.Z)(F.current,"/command/stop-server/".concat(b.uuid),"Power off server ".concat(b.name,"?"),{description:(0,r.jsx)(x.Ac,{children:"This is equal to pushing the power button. If the server doesn't respond to the corresponding signals, you may have to manually shut it down."}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register power off job on ",b.name,"."]}),proceed:"Power off",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered power off job on ",b.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.Ac,{inheritColour:!0,noWrap:!0,children:"Power off"})},e["force off"]={disabled:()=>P,onClick:()=>{(0,m.Z)(F.current,"/command/stop-server/".concat(b.uuid,"?force=1"),"Force off server ".concat(b.name,"?"),{dangerous:!0,description:(0,r.jsx)(x.Ac,{children:"This is equal to pulling the power cord, which may cause data loss or system corruption."}),messages:{fail:(0,r.jsxs)(r.Fragment,{children:["Failed to register force off job on ",b.name,"."]}),proceed:"Force off",success:(0,r.jsxs)(r.Fragment,{children:["Successfully registered force off job on ",b.name,"."]})},method:"put"})},render:()=>(0,r.jsx)(x.Ac,{color:a.D.red,inheritColour:!0,noWrap:!0,children:"Force off"})},e},[g.name,P,b.name,b.uuid]);return(0,r.jsxs)(s.Z,{children:[(0,r.jsx)(v,{getItemDisabled:(e,n)=>{var o;return null===(o=n.disabled)||void 0===o?void 0:o.call(null,e,n)},getItemHref:(e,n)=>{var o;return null===(o=n.href)||void 0===o?void 0:o.call(null,e,n)},items:M,onItemClick:(e,n)=>{var o;return null===(o=n.onClick)||void 0===o?void 0:o.call(null,e,n)},renderItem:(e,n)=>n.render(e,n),...null==C?void 0:C.button,children:(0,r.jsx)(t.Z,{fontSize:null==C?void 0:null===(c=C.button)||void 0===c?void 0:null===(o=c.slotProps)||void 0===o?void 0:null===(n=o.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size})}),Z]})}},53833:function(e,n,o){var r=o(85893),t=o(66389),l=o(11100);n.Z=(e,n,o,s)=>{var i,c;let{body:u,description:a,messages:d,method:h="put",onFail:v,onSuccess:f,dangerous:m=/delete/i.test(null!==(i=null==d?void 0:d.proceed)&&void 0!==i?i:"")}=s;e.confirm.prepare({actionProceedText:null!==(c=null==d?void 0:d.proceed)&&void 0!==c?c:"Confirm",content:a,onProceedAppend:()=>{e.confirm.loading(!0),t.Z.request({data:u,method:h,url:n}).then(()=>{e.confirm.finish("Success",{children:null==d?void 0:d.success}),null==f||f.call(null)}).catch(n=>{let o=(0,l.Z)(n);o.children=(0,r.jsxs)(r.Fragment,{children:[null==d?void 0:d.fail," ",o.children]}),e.confirm.finish("Error",o),null==v||v.call(null)})},proceedColour:m?"red":void 0,titleText:o}),e.confirm.open(!0)}},99246:function(e,n,o){var r=o(67294);n.Z=()=>{let e=(0,r.useRef)(!0);return e.current?(e.current=!1,!0):e.current}},22700:function(e,n){n.Z=e=>{let{allocated:n,available:o,reserved:r,total:t}=e,l=BigInt(n);return{allocated:l,available:BigInt(o),reserved:BigInt(r),total:BigInt(t)}}}}]);