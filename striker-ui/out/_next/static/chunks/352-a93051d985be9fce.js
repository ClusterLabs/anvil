"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[352],{45842:function(e,n,r){r.d(n,{SJ:function(){return S},MB:function(){return H},$x:function(){return O},bC:function(){return J}});var o=r(85893),t=r(83688),l=r(55751),s=r(38444),i=r(60018),c=r(77527),u=r(90642),a=r(96788),d=r(5152),h=r.n(d),f=r(67294),v=r(55756),m=r(45328);let x="0xffe3",p="0xffe9";var g=[{keys:"Ctrl + Alt + Delete",scans:[]},{keys:"Ctrl + Alt + F1",scans:[x,p,"0xffbe"]},{keys:"Ctrl + Alt + F2",scans:[x,p,"0xffbf"]},{keys:"Ctrl + Alt + F3",scans:[x,p,"0xffc0"]},{keys:"Ctrl + Alt + F4",scans:[x,p,"0xffc1"]},{keys:"Ctrl + Alt + F5",scans:[x,p,"0xffc2"]},{keys:"Ctrl + Alt + F6",scans:[x,p,"0xffc3"]},{keys:"Ctrl + Alt + F7",scans:[x,p,"0xffc4"]},{keys:"Ctrl + Alt + F8",scans:[x,p,"0xffc5"]},{keys:"Ctrl + Alt + F9",scans:[x,p,"0xffc6"]}],j=r(75492),b=r(18766),C=r(65375),Z=r(64537),w=r(90209),k=r(57882),y=r(99246);let A="FullSize",F={displayBox:"".concat(A,"-displayBox"),spinnerBox:"".concat(A,"-spinnerBox")},P=(0,c.ZP)("div")(()=>({["& .".concat(F.displayBox)]:{width:"75vw",height:"75vh"},["& .".concat(F.spinnerBox)]:{flexDirection:"column",width:"75vw",height:"75vh",alignItems:"center",justifyContent:"center"}})),B=h()(()=>Promise.all([r.e(460),r.e(791)]).then(r.bind(r,38791)),{loadableGenerated:{webpack:()=>[38791]},ssr:!1}),M={1e3:"in-use by another process?",1006:"destination is down?"},I=(e,n)=>"ws://".concat(e,"/ws/server/vnc/").concat(n);var S=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];let[c]=n,{node:d,onClickCloseButton:h,server:x,vncReconnectTimerStart:p=3}=c,[A]=(0,v.fP)(["suiapi.vncerror.".concat(x.uuid)]),S=(0,y.Z)(),[z,_]=(0,f.useState)(null),[E,R]=(0,f.useState)(void 0),[D,T]=(0,f.useState)(!1),[W,q]=(0,f.useState)(!1),[N,O]=(0,f.useState)(),[G,U]=(0,f.useState)(),[H,J]=(0,f.useState)(p),K=(0,f.useRef)(null),L=(0,f.useRef)(null),V=e=>{_(e.currentTarget)},$=e=>{if(K.current){if(e.length){for(let n=0;n<=e.length-1;n+=1)K.current.sendKey(e[n],1);for(let n=e.length-1;n>=0;n-=1)K.current.sendKey(e[n],0)}else K.current.sendCtrlAltDel();_(null)}},Q=(0,f.useCallback)(()=>{T(!0),q(!1),R({url:I(window.location.host,x.uuid)})},[x.uuid]),X=(0,f.useCallback)(()=>{(null==K?void 0:K.current)&&(K.current.disconnect(),K.current=null),R(void 0)},[]),Y=(0,f.useCallback)(()=>{X(),Q()},[Q,X]),ee=(0,f.useCallback)(()=>{let e=setInterval(()=>{J(n=>{let r=n-1;return r<1&&clearInterval(e),r})},1e3)},[]),en=(0,f.useCallback)(()=>{T(!1)},[]),er=(0,f.useCallback)(e=>{let{detail:n}=e,{clean:r}=n;r||(T(!1),q(!0),ee())},[ee]),eo=(0,f.useCallback)(e=>{if(!e){O(void 0);return}let{code:n,reason:r}=e,o="ws: ".concat(n),t=M[n];t&&(o+=" (".concat(t,")")),r&&(o+=", ".concat(r)),O(o);let l=A["suiapi.vncerror.".concat(x.uuid)];if(!l){U(void 0);return}let{code:s,message:i}=l;U("api: ".concat(s,", ").concat(i))},[A,x.uuid]),et=(0,f.useMemo)(()=>!D&&!W,[D,W]),el=(0,f.useMemo)(()=>(0,o.jsx)(u.Z,{children:(0,o.jsx)(m.Z,{onClick:()=>{var e;null===(e=L.current)||void 0===e||e.requestFullscreen()},children:(0,o.jsx)(t.Z,{})})}),[]),es=(0,f.useMemo)(()=>(0,o.jsxs)(u.Z,{children:[(0,o.jsx)(m.Z,{onClick:V,children:(0,o.jsx)(l.Z,{})}),(0,o.jsx)(j.Z,{open:!!z,slotProps:{menu:{anchorEl:z,keepMounted:!0,onClose:()=>_(null)}},children:g.map(e=>{let{keys:n,scans:r}=e;return(0,o.jsx)(b.Z,{onClick:()=>$(r),children:(0,o.jsx)(a.Z,{variant:"subtitle1",children:n})},n)})})]}),[z]),ei=(0,f.useMemo)(()=>(0,o.jsx)(u.Z,{children:(0,o.jsx)(m.Z,{onClick:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];X(),null==h||h.call(null,...n)},children:(0,o.jsx)(s.Z,{})})}),[X,h]),ec=(0,f.useMemo)(()=>(0,o.jsx)(u.Z,{children:(0,o.jsx)(m.Z,{onClick:()=>{window&&(X(),window.location.assign("/"))},children:(0,o.jsx)(i.Z,{})})}),[X]),eu=(0,f.useMemo)(()=>(0,o.jsxs)(o.Fragment,{children:[el,es,(0,o.jsx)(Z.Z,{node:d,server:x}),ec,ei]}),[el,es,d,ec,x,ei]);return(0,f.useEffect)(()=>{0===H&&(J(p),Y())},[Y,H,p]),(0,f.useEffect)(()=>{S&&Q()},[Q,S]),(0,o.jsxs)(C.s_,{children:[(0,o.jsxs)(C.V9,{children:[(0,o.jsx)(k.z,{text:"Server: ".concat(x.name)}),eu]}),(0,o.jsxs)(P,{children:[(0,o.jsx)(u.Z,{display:et?"flex":"none",className:F.displayBox,children:(0,o.jsx)(B,{onConnect:en,onDisconnect:er,onWsClose:eo,rfb:K,rfbConnectArgs:E,rfbScreen:L})}),!et&&(0,o.jsxs)(u.Z,{display:"flex",className:F.spinnerBox,textAlign:"center",children:[D&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(k.z,{children:["Connecting to ",x.name,"."]}),(0,o.jsx)(w.Z,{})]}),W&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.z,{children:"Can't connect to the server."}),(0,o.jsx)(k.Ac,{children:G}),(0,o.jsx)(k.Ac,{children:N}),(0,o.jsxs)(k.z,{mt:".5em",children:["Retrying in ",H,"."]})]})]})]})]})},z=r(10617),_=r(65625),E=r(7727),R=r(48403),D=r.n(R),T=r(82492),W=r.n(T),q=r(39971),N=r(21758),O=(0,c.ZP)(u.Z)({alignItems:"center",display:"flex",justifyContent:"center",margin:".2em",overflow:"hidden",position:"relative"}),G=r(29255),U=r(5499),H=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];let[t]=n,{onClick:l,server:s,slotProps:i,slots:c}=t,{href:a="/server?name=".concat(s.name,"&view=vnc")}=t,{data:d,loading:h}=(0,U.Z)("/server/".concat(s.uuid,"?ss=1"),{refreshInterval:6e4}),v=null==d?void 0:d.screenshot,m=null==d?void 0:d.timestamp,x=(0,G.zO)(),p=(0,f.useMemo)(()=>!!m&&!(0,G.Z$)(m,300),[m]),g=(0,f.useMemo)(()=>{var e;return null!==(e=null==c?void 0:c.screenshotBox)&&void 0!==e?e:(0,o.jsx)(O,{})},[null==c?void 0:c.screenshotBox]),j=(0,f.useMemo)(()=>({...null==i?void 0:i.screenshotBox}),[null==i?void 0:i.screenshotBox]),b=(0,f.useMemo)(()=>{let e,n;if(s.jobs)return(0,f.cloneElement)(g,j,(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.Ac,{children:"Provisioning..."}),Object.values(s.jobs).map((e,n)=>{let{peer:r,progress:t,uuid:l}=e;return(0,o.jsx)(N.Z,{slotProps:{box:{sx:{position:"absolute"}},pie:{size:"calc(7em - ".concat(1.5*n,"em)"),sx:{opacity:r?.6:void 0,["& .".concat(_.Z.circle)]:{strokeLinecap:"round"}},thickness:3},underline:{thickness:t?0:1}},value:t},"".concat(l,"-progress"))})]}));if(h)return(0,f.cloneElement)(g,j,(0,o.jsx)(w.Z,{mt:0}));if("running"!==s.state)return(0,f.cloneElement)(g,j,(0,o.jsx)(z.Z,{sx:{color:q.UZ,height:"100%",width:"auto"}}));let r="1";if(m&&p){r="0.4";let{unit:n,value:t}=(0,G._J)(x-m);e=(0,o.jsxs)(k.Ac,{position:"absolute",children:["Updated ~",t," ",n," ago"]})}let t=null==i?void 0:i.screenshot;return t&&({sx:n,...t}=t),(0,f.cloneElement)(g,j,(0,o.jsx)(u.Z,{alt:"".concat(D()(s.state),". Preview unavailable"),component:"img",src:"data:image;base64,".concat(v),sx:W()({color:q.s7,fontFamily:"Roboto Condensed",height:v?"100%":"auto",opacity:r,width:"auto"},n),...t}),e)},[h,x,v,s.jobs,s.state,null==i?void 0:i.screenshot,p,m,g,j]);return(0,f.useMemo)(()=>{let e;let n=!!s.jobs,r=null==i?void 0:i.button;return r&&({sx:e,...r}=r),(0,f.createElement)(E.Z,{disabled:n,href:a,onClick:l,sx:W()({padding:0,width:"calc(100% - 0em)"},e),...r},b)},[b,l,a,s.jobs,null==i?void 0:i.button])},J=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];let[t]=n,{children:l,getHeader:s=e=>{let{name:n}=e;return(0,o.jsx)(k.Ac,{children:n})},server:i,showControls:c=!0,slotProps:u}=t;return(0,o.jsxs)(C.Lg,{mb:0,mt:0,...null==u?void 0:u.panel,children:[(0,o.jsxs)(C.CH,{...null==u?void 0:u.header,children:[s(i),c&&(0,o.jsx)(Z.Z,{node:i.anvil,server:i,slotProps:{button:{slotProps:{button:{icon:{size:"small"}}}}}})]}),l]})}},64537:function(e,n,r){r.d(n,{Z:function(){return g}});var o=r(85893),t=r(86142),l=r(8506),s=r(90642),i=r(67294),c=r(82492),u=r.n(c),a=r(46194),d=r(16667),h=r(75492),f=function(){for(var e,n,r,l,c,f=arguments.length,v=Array(f),m=0;m<f;m++)v[m]=arguments[m];let[x]=v,{children:p,onClick:g,onItemClick:j,slotProps:b,variant:C="icon",...Z}=x,[w,k]=(0,i.useState)(null),y=(0,i.useMemo)(()=>!!w,[w]),A=(0,i.useMemo)(()=>{if(p)return p;if("icon"===C){var e,n;return(0,o.jsx)(t.Z,{fontSize:null==b?void 0:null===(n=b.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size})}return"Options"},[p,null==b?void 0:null===(n=b.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size,C]),F=(0,i.useCallback)(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];let{0:{currentTarget:o}}=n;return k(o),null==g?void 0:g.call(null,...n)},[g]),P=(0,i.useMemo)(()=>{var e,n;return"contained"===C?(0,o.jsx)(a.Z,{onClick:F,...null==b?void 0:null===(n=b.button)||void 0===n?void 0:n.contained,children:A}):(0,o.jsx)(d.Z,{onClick:F,...null==b?void 0:null===(e=b.button)||void 0===e?void 0:e.icon,children:A})},[F,A,null==b?void 0:null===(r=b.button)||void 0===r?void 0:r.contained,null==b?void 0:null===(l=b.button)||void 0===l?void 0:l.icon,C]),B=(0,i.useCallback)(function(e,n){for(var r=arguments.length,o=Array(r>2?r-2:0),t=2;t<r;t++)o[t-2]=arguments[t];return k(null),null==j?void 0:j.call(null,e,n,...o)},[j]),M=(0,i.useMemo)(()=>{var e;return u()({menu:{anchorEl:w,keepMounted:!0,onClose:()=>k(null)}},null==b?void 0:null===(e=b.menu)||void 0===e?void 0:e.slotProps)},[w,null==b?void 0:null===(c=b.menu)||void 0===c?void 0:c.slotProps]);return(0,o.jsxs)(s.Z,{children:[P,(0,o.jsx)(h.Z,{onItemClick:B,open:y,...Z,...null==b?void 0:b.menu,slotProps:M})]})},v=r(82092),m=r(53833),x=r(57882),p=r(40657),g=function(){for(var e,n,r,c,u=arguments.length,d=Array(u),h=0;h<u;h++)d[h]=arguments[h];let[g]=d,{node:j,server:b,slotProps:C}=g,{confirmDialog:Z,setConfirmDialogLoading:w,setConfirmDialogOpen:k,setConfirmDialogProps:y,finishConfirm:A}=(0,p.Z)(),F=(0,i.useRef)({add:{open:()=>null},confirm:{finish:A,loading:w,open:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return k(e)},prepare:y},edit:{open:()=>null}}),P=(0,i.useMemo)(()=>["shut off"].includes(b.state),[b.state]),B=(0,i.useMemo)(()=>{let e={server:{href:()=>"/server?name=".concat(b.name),render:()=>(0,o.jsx)(x.Ac,{inheritColour:!0,noWrap:!0,children:"Manage server"})},node:{href:()=>"/anvil?name=".concat(j.name),render:()=>(0,o.jsxs)(x.Ac,{inheritColour:!0,noWrap:!0,children:["On node: ",j.name]})},"subheader-power":{render:()=>(0,o.jsx)(v.Z,{orientation:"horizontal",sx:{margin:".4em 0"}})}};return e["power on"]={disabled:()=>!P,onClick:()=>{(0,m.Z)(F.current,"/command/start-server/".concat(b.uuid),"Power on server ".concat(b.name,"?"),{description:(0,o.jsx)(x.Ac,{children:"This is equal to pushing the power button."}),messages:{fail:(0,o.jsxs)(o.Fragment,{children:["Failed to register power on job on ",b.name,"."]}),proceed:"Power on",success:(0,o.jsxs)(o.Fragment,{children:["Successfully registered power on job on ",b.name,"."]})},method:"put"})},render:()=>(0,o.jsx)(x.Ac,{inheritColour:!0,noWrap:!0,children:"Power on"})},e.reset={disabled:()=>P,onClick:()=>{(0,m.Z)(F.current,"/server/".concat(b.uuid,"/reset"),"Reset server ".concat(b.name,"?"),{dangerous:!0,description:(0,o.jsxs)(l.ZP,{container:!0,spacing:"1em",children:[(0,o.jsx)(l.ZP,{item:!0,width:"100%",children:(0,o.jsx)(x.Ac,{children:"This is equal to holding the power button to force shut down, followed by pushing the power button again to turn the machine back on."})}),(0,o.jsx)(l.ZP,{item:!0,width:"100%",children:(0,o.jsx)(x.Ac,{children:"Reset is usually used to access the boot menu when you've missed it in the live VNC connection."})})]}),messages:{fail:(0,o.jsxs)(o.Fragment,{children:["Failed to register reset job on ",b.name,"."]}),proceed:"Reset",success:(0,o.jsxs)(o.Fragment,{children:["Successfully registered reset join on ",b.name,"."]})},method:"put"})},render:()=>(0,o.jsx)(x.Ac,{color:a.D.red,inheritColour:!0,noWrap:!0,children:"Reset"})},e["power off"]={disabled:()=>P,onClick:()=>{(0,m.Z)(F.current,"/command/stop-server/".concat(b.uuid),"Power off server ".concat(b.name,"?"),{description:(0,o.jsx)(x.Ac,{children:"This is equal to pushing the power button. If the server doesn't respond to the corresponding signals, you may have to manually shut it down."}),messages:{fail:(0,o.jsxs)(o.Fragment,{children:["Failed to register power off job on ",b.name,"."]}),proceed:"Power off",success:(0,o.jsxs)(o.Fragment,{children:["Successfully registered power off job on ",b.name,"."]})},method:"put"})},render:()=>(0,o.jsx)(x.Ac,{inheritColour:!0,noWrap:!0,children:"Power off"})},e["force off"]={disabled:()=>P,onClick:()=>{(0,m.Z)(F.current,"/command/stop-server/".concat(b.uuid,"?force=1"),"Force off server ".concat(b.name,"?"),{dangerous:!0,description:(0,o.jsx)(x.Ac,{children:"This is equal to pulling the power cord, which may cause data loss or system corruption."}),messages:{fail:(0,o.jsxs)(o.Fragment,{children:["Failed to register force off job on ",b.name,"."]}),proceed:"Force off",success:(0,o.jsxs)(o.Fragment,{children:["Successfully registered force off job on ",b.name,"."]})},method:"put"})},render:()=>(0,o.jsx)(x.Ac,{color:a.D.red,inheritColour:!0,noWrap:!0,children:"Force off"})},e},[j.name,P,b.name,b.uuid]);return(0,o.jsxs)(s.Z,{children:[(0,o.jsx)(f,{getItemDisabled:(e,n)=>{var r;return null===(r=n.disabled)||void 0===r?void 0:r.call(null,e,n)},getItemHref:(e,n)=>{var r;return null===(r=n.href)||void 0===r?void 0:r.call(null,e,n)},items:B,onItemClick:(e,n)=>{var r;return null===(r=n.onClick)||void 0===r?void 0:r.call(null,e,n)},renderItem:(e,n)=>n.render(e,n),...null==C?void 0:C.button,children:(0,o.jsx)(t.Z,{fontSize:null==C?void 0:null===(c=C.button)||void 0===c?void 0:null===(r=c.slotProps)||void 0===r?void 0:null===(n=r.button)||void 0===n?void 0:null===(e=n.icon)||void 0===e?void 0:e.size})}),Z]})}},53833:function(e,n,r){var o=r(85893),t=r(66389),l=r(11100);n.Z=(e,n,r,s)=>{var i,c;let{body:u,description:a,messages:d,method:h="put",onFail:f,onSuccess:v,dangerous:m=/delete/i.test(null!==(i=null==d?void 0:d.proceed)&&void 0!==i?i:"")}=s;e.confirm.prepare({actionProceedText:null!==(c=null==d?void 0:d.proceed)&&void 0!==c?c:"Confirm",content:a,onProceedAppend:()=>{e.confirm.loading(!0),t.Z.request({data:u,method:h,url:n}).then(()=>{e.confirm.finish("Success",{children:null==d?void 0:d.success}),null==v||v.call(null)}).catch(n=>{let r=(0,l.Z)(n);r.children=(0,o.jsxs)(o.Fragment,{children:[null==d?void 0:d.fail," ",r.children]}),e.confirm.finish("Error",r),null==f||f.call(null)})},proceedColour:m?"red":void 0,titleText:r}),e.confirm.open(!0)}},99246:function(e,n,r){var o=r(67294);n.Z=()=>{let e=(0,o.useRef)(!0);return e.current?(e.current=!1,!0):e.current}},22700:function(e,n){n.Z=e=>{let{allocated:n,available:r,reserved:o,total:t}=e,l=BigInt(n);return{allocated:l,available:BigInt(r),reserved:BigInt(o),total:BigInt(t)}}},60665:function(e,n){n.Z=e=>{let{storage_groups:n,total_free:r,total_size:o}=e,t=BigInt(r),l=BigInt(o);return n.reduce((e,n)=>{let{storage_group_free:r,storage_group_name:o,storage_group_total:t,storage_group_uuid:l}=n,s=BigInt(r),i=BigInt(t);return e.storageGroups[l]={free:s,name:o,size:i,used:i-s,uuid:l},e},{storageGroups:{},totalFree:t,totalSize:l,totalUsed:l-t})}}}]);